#!/usr/bin/env python3

import numpy as np

from SHARC_INTERFACE import SHARC_INTERFACE
from SHARC_LVC import SHARC_LVC
from utils import InDir

np.set_printoptions(linewidth=400, formatter={'float': lambda x: f'{x: 12.8f}'})


def test_lvc():
    lvc: SHARC_INTERFACE = SHARC_LVC(loglevel=10)
    lvc.setup_mol("inputs/QM_lvc.in")
    lvc.read_template("inputs/LVC.template")
    lvc.read_requests("inputs/QM_lvc.in")
    lvc.setup_interface()
    lvc.set_coords("inputs/QM_lvc.in")
    lvc._do_kabsch = True
    lvc.run()
    # f = open('/user/severin/sharc_main/tests/interface/test_lvc.py', 'a')
    # print('H_ref =', np.array2string(lvc.QMout.h, separator=','), file=f)
    # print('grad_ref =', np.array2string(lvc.QMout.grad, separator=','), file=f)
    # print('nacdr_ref =', np.array2string(lvc.QMout.nacdr, separator=','), file=f)
    # f.close()
    H_ref = np.array(
        [
            [0.09984907 + 0.j, 0. + 0.j, 0. + 0.00053928j, 0. + 0.j, 0. + 0.j, 0. + 0.j, 0. - 0.00053928j, 0. + 0.j],
            [0. + 0.j, 0.14845449 + 0.j, 0. + 0.j, 0. + 0.00051385j, 0. + 0.j, 0. + 0.j, 0. + 0.j, 0. - 0.00051385j],
            [0. - 0.00053928j, 0. + 0.j, 0.145514 + 0.j, 0. + 0.j, 0. + 0.j, 0. + 0.00049544j, 0. + 0.j, 0. + 0.j],
            [0. + 0.j, 0. - 0.00051385j, 0. + 0.j, 0.14686069 + 0.j, 0. - 0.00049544j, 0. + 0.j, 0. + 0.j, 0. + 0.j],
            [0. + 0.j, 0. + 0.j, 0. + 0.j, 0. + 0.00049544j, 0.145514 + 0.j, 0. + 0.j, 0. + 0.j, 0. + 0.00049544j],
            [0. + 0.j, 0. + 0.j, 0. - 0.00049544j, 0. + 0.j, 0. + 0.j, 0.14686069 + 0.j, 0. - 0.00049544j, 0. + 0.j],
            [0. + 0.00053928j, 0. + 0.j, 0. + 0.j, 0. + 0.j, 0. + 0.j, 0. + 0.00049544j, 0.145514 + 0.j, 0. + 0.j],
            [0. + 0.j, 0. + 0.00051385j, 0. + 0.j, 0. + 0.j, 0. - 0.00049544j, 0. + 0.j, 0. + 0.j, 0.14686069 + 0.j]
        ],
        dtype=complex
    )

    grad_ref = np.array(
        [
            [
                [-0.35181231, 0.03750365, 0.00000000], [0.23358130, 0.01865815, 0.00000000],
                [0.03708290, 0.02870697, 0.00000000], [0.08114810, -0.08486877, 0.00000000]
            ],
            [
                [-0.29399611, 0.03740319, 0.00000000], [0.18081330, 0.01867766, 0.00000000],
                [0.03454353, 0.02867124, 0.00000000], [0.07863928, -0.08475209, 0.00000000]
            ],
            [
                [-0.30372436, 0.03746482, 0.00000000], [0.19361383, 0.01859713, 0.00000000],
                [0.03300216, 0.02782883, 0.00000000], [0.07710838, -0.08389078, 0.00000000]
            ],
            [
                [-0.21479062, 0.03748682, 0.00000000], [0.09613700, 0.01849323, 0.00000000],
                [0.03723016, 0.02634040, 0.00000000], [0.08142347, -0.08232045, 0.00000000]
            ],
            [
                [-0.30372436, 0.03746482, 0.00000000], [0.19361383, 0.01859713, 0.00000000],
                [0.03300216, 0.02782883, 0.00000000], [0.07710838, -0.08389078, 0.00000000]
            ],
            [
                [-0.21479062, 0.03748682, 0.00000000], [0.09613700, 0.01849323, 0.00000000],
                [0.03723016, 0.02634040, 0.00000000], [0.08142347, -0.08232045, 0.00000000]
            ],
            [
                [-0.30372436, 0.03746482, 0.00000000], [0.19361383, 0.01859713, 0.00000000],
                [0.03300216, 0.02782883, 0.00000000], [0.07710838, -0.08389078, 0.00000000]
            ],
            [
                [-0.21479062, 0.03748682, 0.00000000], [0.09613700, 0.01849323, 0.00000000],
                [0.03723016, 0.02634040, 0.00000000], [0.08142347, -0.08232045, 0.00000000]
            ]
        ]
    )

    np.allclose(H_ref, lvc.QMout.h, rtol=1e-8)
    np.allclose(grad_ref, lvc.QMout.grad, rtol=1e-8)


def test_lvc_pc():
    lvc: SHARC_INTERFACE = SHARC_LVC(loglevel=10)
    lvc.setup_mol("inputs/QM_lvc.in")
    lvc.read_template("inputs/LVC.template")
    lvc.read_requests("inputs/QM_lvc.in")
    lvc.setup_interface()
    lvc.set_coords("inputs/QM_lvc.in")
    lvc.QMin.molecule["point_charges"] = True
    lvc.QMin.coords["pccoords"] = np.array([[0.1, 0.3, 0.3]])
    lvc.QMin.coords["pccharge"] = np.array([1.])
    lvc._do_kabsch = True
    lvc.run()

    H_ref = np.array(
        [
            [
                -13.94051826 + 0.00000000e+00j, 0. + 0.00000000e+00j, 0. + 7.60246303e-06j, 0. + 5.27577004e-04j,
                0. + 0.00000000e+00j, 0. + 0.00000000e+00j, 0. - 7.60246303e-06j, 0. - 5.27577004e-04j
            ],
            [
                0. + 0.00000000e+00j, 12.32959042 + 0.00000000e+00j, 0. - 5.25502588e-04j, 0. - 1.77508237e-05j,
                0. + 0.00000000e+00j, 0. + 0.00000000e+00j, 0. + 5.25502588e-04j, 0. + 1.77508237e-05j
            ],
            [
                0. - 7.60246303e-06j, 0. + 5.25502588e-04j, -12.07894845 + 0.00000000e+00j, 0. + 0.00000000e+00j,
                0. - 3.22442798e-21j, 0. + 4.95437640e-04j, 0. + 0.00000000e+00j, 0. + 0.00000000e+00j
            ],
            [
                0. - 5.27577004e-04j, 0. + 1.77508237e-05j, 0. + 0.00000000e+00j, 10.49185439 + 0.00000000e+00j,
                0. - 4.95437640e-04j, 0. + 2.25786479e-21j, 0. + 0.00000000e+00j, 0. + 0.00000000e+00j
            ],
            [
                0. + 0.00000000e+00j, 0. + 0.00000000e+00j, 0. - 3.22442798e-21j, 0. + 4.95437640e-04j,
                -12.07894845 + 0.00000000e+00j, 0. + 0.00000000e+00j, 0. - 3.22442798e-21j, 0. + 4.95437640e-04j
            ],
            [
                0. + 0.00000000e+00j, 0. + 0.00000000e+00j, 0. - 4.95437640e-04j, 0. + 2.25786479e-21j,
                0. + 0.00000000e+00j, 10.49185439 + 0.00000000e+00j, 0. - 4.95437640e-04j, 0. + 2.25786479e-21j
            ],
            [
                0. + 7.60246303e-06j, 0. - 5.25502588e-04j, 0. + 0.00000000e+00j, 0. + 0.00000000e+00j,
                0. - 3.22442798e-21j, 0. + 4.95437640e-04j, -12.07894845 + 0.00000000e+00j, 0. + 0.00000000e+00j
            ],
            [
                0. + 5.27577004e-04j, 0. - 1.77508237e-05j, 0. + 0.00000000e+00j, 0. + 0.00000000e+00j,
                0. - 4.95437640e-04j, 0. + 2.25786479e-21j, 0. + 0.00000000e+00j, 10.49185439 + 0.00000000e+00j
            ]
        ],
        dtype=complex
    )

    grad_ref = np.array(
        [
            [
                [-0.35634860, -1.45345523, -1.29105837], [-38.89562233, -56.58578280, -66.59999318],
                [0.14636060, -0.15861842, 1.48883233], [-0.01796128, -0.27795053, -1.81643577]
            ],
            [
                [-0.34359396, 0.50526461, 0.53871892], [30.08679718, 56.52694135, 55.10747405],
                [0.00911246, 0.09241282, 0.28207691], [0.12253934, -0.02903332, -0.14321958]
            ],
            [
                [-0.26478476, -1.18287796, -0.98418609], [-32.01862482, -48.25183103, -59.05074025],
                [0.12313215, -0.12758333, 1.65280451], [-0.00456997, -0.24037522, -1.90338935]
            ],
            [
                [-0.26917279, 0.55295346, 0.56532406], [27.09830342, 47.47024893, 46.84235063],
                [0.00194709, 0.09540983, 0.15766082], [0.12057840, -0.02019627, -0.01293264]
            ],
            [
                [-0.26478476, -1.18287796, -0.98418609], [-32.01862482, -48.25183103, -59.05074025],
                [0.12313215, -0.12758333, 1.65280451], [-0.00456997, -0.24037522, -1.90338935]
            ],
            [
                [-0.26917279, 0.55295346, 0.56532406], [27.09830342, 47.47024893, 46.84235063],
                [0.00194709, 0.09540983, 0.15766082], [0.12057840, -0.02019627, -0.01293264]
            ],
            [
                [-0.26478476, -1.18287796, -0.98418609], [-32.01862482, -48.25183103, -59.05074025],
                [0.12313215, -0.12758333, 1.65280451], [-0.00456997, -0.24037522, -1.90338935]
            ],
            [
                [-0.26917279, 0.55295346, 0.56532406], [27.09830342, 47.47024893, 46.84235063],
                [0.00194709, 0.09540983, 0.15766082], [0.12057840, -0.02019627, -0.01293264]
            ]
        ]
    )

    nacdr_ref = np.array(
        [
            [
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00093005, 0.05917476, -0.00354153], [0.08791114, -1.23872331, 1.10666465],
                    [-0.00412137, 0.00765521, -0.38398988], [0.00427265, 0.00745136, 0.38311228]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ]
            ],
            [
                [
                    [-0.00093005, -0.05917476, 0.00354153], [-0.08791114, 1.23872331, -1.10666465],
                    [0.00412137, -0.00765521, 0.38398988], [-0.00427265, -0.00745136, -0.38311228]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ]
            ],
            [
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [-0.00298968, 0.05944350, -0.00822480], [0.03260688, -1.33002822, 1.19255520],
                    [-0.00404525, 0.00779726, -0.41352304], [0.00444909, 0.00739583, 0.41149703]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ]
            ],
            [
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00298968, -0.05944350, 0.00822480], [-0.03260688, 1.33002822, -1.19255520],
                    [0.00404525, -0.00779726, 0.41352304], [-0.00444909, -0.00739583, -0.41149703]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ]
            ],
            [
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [-0.00298968, 0.05944350, -0.00822480], [0.03260688, -1.33002822, 1.19255520],
                    [-0.00404525, 0.00779726, -0.41352304], [0.00444909, 0.00739583, 0.41149703]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ]
            ],
            [
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00298968, -0.05944350, 0.00822480], [-0.03260688, 1.33002822, -1.19255520],
                    [0.00404525, -0.00779726, 0.41352304], [-0.00444909, -0.00739583, -0.41149703]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ]
            ],
            [
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [-0.00298968, 0.05944350, -0.00822480], [0.03260688, -1.33002822, 1.19255520],
                    [-0.00404525, 0.00779726, -0.41352304], [0.00444909, 0.00739583, 0.41149703]
                ]
            ],
            [
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ],
                [
                    [0.00298968, -0.05944350, 0.00822480], [-0.03260688, 1.33002822, -1.19255520],
                    [0.00404525, -0.00779726, 0.41352304], [-0.00444909, -0.00739583, -0.41149703]
                ],
                [
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000],
                    [0.00000000, 0.00000000, 0.00000000], [0.00000000, 0.00000000, 0.00000000]
                ]
            ]
        ]
    )
    np.allclose(H_ref, lvc.QMout.h, rtol=1e-8)
    np.allclose(grad_ref, lvc.QMout.grad, rtol=1e-8)
    np.allclose(nacdr_ref, lvc.QMout.nacdr, rtol=1e-8)
    # f = open('/user/severin/sharc_main/tests/interface/test_lvc.py', 'a')
    # print('H_ref =', np.array2string(lvc.QMout.h, separator=','), file=f)
    # print('grad_ref =', np.array2string(lvc.QMout.grad, separator=','), file=f)
    # print('nacdr_ref =', np.array2string(lvc.QMout.nacdr, separator=','), file=f)
    # f.close()


if __name__ == "__main__":
    with InDir('tests/interface/'):
        test_lvc()
        test_lvc_pc()
