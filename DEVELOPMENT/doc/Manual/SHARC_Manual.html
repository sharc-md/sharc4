<title> SHARC: Surface Hopping in the Adiabatic Representation Including Arbitrary Couplings -- Manual</title>
<h1 align="center">SHARC: Surface Hopping in the Adiabatic Representation Including Arbitrary Couplings - Manual </h1>
<div class="p"><!----></div>
<div class="p"><!----></div>
<div class="p"><!----></div>
<div class="p"><!----></div>
<div class="p"><!----></div>
<h1>Contents </h1><a href="#tth_chAp1">1&nbsp; Introduction</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc1.1">1.1&nbsp; Capabilities</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc1.2">1.2&nbsp; References</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc1.3">1.3&nbsp; Authors</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc1.4">1.4&nbsp; Suggestions and Bug Reports</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc1.5">1.5&nbsp; Notation in this Manual</a>
<a href="#tth_chAp2">2&nbsp; Installation</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.1">2.1&nbsp; How To Obtain</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.2">2.2&nbsp; Terms of Use</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.3">2.3&nbsp; Installation</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.3.1">2.3.1&nbsp; Libraries</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.3.2">2.3.2&nbsp; Test Suite</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.3.3">2.3.3&nbsp; Additional Programs</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.3.4">2.3.4&nbsp; Quantum Chemistry Programs</a>
<a href="#tth_chAp3">3&nbsp; Execution</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.1">3.1&nbsp; Running a single trajectory</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.1.1">3.1.1&nbsp; Input files</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.1.2">3.1.2&nbsp; Running the dynamics code</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.1.3">3.1.3&nbsp; Output files</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.2">3.2&nbsp; Typical workflow for an ensemble of trajectories</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.2.1">3.2.1&nbsp; Initial condition generation</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.2.2">3.2.2&nbsp; Running the dynamics simulations</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.2.3">3.2.3&nbsp; Analysis of the dynamics results</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.3">3.3&nbsp; Auxilliary Programs and Scripts</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.3.1">3.3.1&nbsp; Setup</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.3.2">3.3.2&nbsp; Analysis</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.3.3">3.3.3&nbsp; Interfaces</a>
<a href="#tth_chAp4">4&nbsp; Input files</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.1">4.1&nbsp; Main input file</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.1.1">4.1.1&nbsp; General remarks</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.1.2">4.1.2&nbsp; Input keywords</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.1.3">4.1.3&nbsp; Detailed Description of the Keywords</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.1.4">4.1.4&nbsp; Example</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.2">4.2&nbsp; Geometry file</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.3">4.3&nbsp; Velocity file</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.4">4.4&nbsp; Coefficient file</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.5">4.5&nbsp; Laser file</a>
<a href="#tth_chAp5">5&nbsp; Output files</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc5.1">5.1&nbsp; Log file</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc5.2">5.2&nbsp; Listing file</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc5.3">5.3&nbsp; Data file</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc5.3.1">5.3.1&nbsp; Specification of the data file</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc5.4">5.4&nbsp; XYZ file</a>
<a href="#tth_chAp6">6&nbsp; Interfaces</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.1">6.1&nbsp; Interface Specifications</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.1.1">6.1.1&nbsp; <b><tt>QM.in</tt></b> Specification</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.1.2">6.1.2&nbsp; <b><tt>QM.out</tt></b> Specification</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.1.3">6.1.3&nbsp; Further Specifications</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.1.4">6.1.4&nbsp; Save Directory Specification</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.2">6.2&nbsp; MOLPRO Interface</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.2.1">6.2.1&nbsp; Interface specific input file: <b><tt>SH2PRO.inp</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.2.2">6.2.2&nbsp; Template file: <b><tt>MOLPRO.template</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.2.3">6.2.3&nbsp; Error checking</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.2.4">6.2.4&nbsp; Things to keep in mind</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.2.5">6.2.5&nbsp; Molpro input generator: <b><tt>molpro_input.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.3">6.3&nbsp; MOLCAS Interface</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.3.1">6.3.1&nbsp; Interface specific input file: <b><tt>SH2CAS.inp</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.3.2">6.3.2&nbsp; Template file: <b><tt>MOLCAS.template</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.3.3">6.3.3&nbsp; Template file generator: <b><tt>molcas_input.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.4">6.4&nbsp; COLUMBUS Interface</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.4.1">6.4.1&nbsp; Template input</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.4.2">6.4.2&nbsp; Interface specific input file: <b><tt>SH2COL.inp</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.4.3">6.4.3&nbsp; Template setup</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.5">6.5&nbsp; Analytical PESs Interface</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.5.1">6.5.1&nbsp; Parametrization</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.5.2">6.5.2&nbsp; Interface-specific input file</a>
<a href="#tth_chAp7">7&nbsp; Auxilliary Scripts</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.1">7.1&nbsp; Wigner Distribution Sampling: <b><tt>wigner.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.1.1">7.1.1&nbsp; Usage</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.1.2">7.1.2&nbsp; Output</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.1.3">7.1.3&nbsp; Non-default Masses</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.2">7.2&nbsp; Setup of Initial Calculations: <b><tt>setup_init.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.2.1">7.2.1&nbsp; Usage</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.2.2">7.2.2&nbsp; Input</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.2.3">7.2.3&nbsp; Input for  M<span style="font-size:x-small">OLPRO</span></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.2.4">7.2.4&nbsp; Input for  C<span style="font-size:x-small">OLUMBUS</span></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.2.5">7.2.5&nbsp; Input for  M<span style="font-size:x-small">OLCAS</span></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.2.6">7.2.6&nbsp; Input for analytical potentials</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.2.7">7.2.7&nbsp; Input for Run Scripts</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.2.8">7.2.8&nbsp; Output</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.3">7.3&nbsp; Excitation Selection: <b><tt>excite.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.3.1">7.3.1&nbsp; Usage</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.3.2">7.3.2&nbsp; Input</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.3.3">7.3.3&nbsp; Matrix diagonalization</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.3.4">7.3.4&nbsp; Output</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.3.5">7.3.5&nbsp; Specification of the <b><tt>initconds.excited</tt></b> file format</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.4">7.4&nbsp; Setup of Trajectories: <b><tt>setup_traj.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.4.1">7.4.1&nbsp; Input</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.4.2">7.4.2&nbsp; Interface-specific input</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.4.3">7.4.3&nbsp; Run script setup</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.4.4">7.4.4&nbsp; Output</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.5">7.5&nbsp; Laser field generation: <b><tt>laser.x</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.5.1">7.5.1&nbsp; Usage</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.5.2">7.5.2&nbsp; Input</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.6">7.6&nbsp; Calculation of Absorption Spectra: <b><tt>spectrum.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.6.1">7.6.1&nbsp; Input</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.6.2">7.6.2&nbsp; Output</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.7">7.7&nbsp; File transfer: <b><tt>retrieve.sh</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.8">7.8&nbsp; Data Extractor: <b><tt>data_extractor.x</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.8.1">7.8.1&nbsp; Usage</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.8.2">7.8.2&nbsp; Output</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.9">7.9&nbsp; Plotting the Extracted Data: <b><tt>make_gnuscript.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.10">7.10&nbsp; Calculation of Ensemble Populations: <b><tt>populations.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.10.1">7.10.1&nbsp; Usage</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.10.2">7.10.2&nbsp; Output</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.11">7.11&nbsp; Obtaining special geometries: <b><tt>crossing.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.11.1">7.11.1&nbsp; Usage</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.11.2">7.11.2&nbsp; Output</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.12">7.12&nbsp; Internal Coordinates Analysis: <b><tt>geo.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.12.1">7.12.1&nbsp; Input</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.12.2">7.12.2&nbsp; Options</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.13">7.13&nbsp; Diagonalization Helper: <b><tt>diagonalizer.x</tt></b></a>
<a href="#tth_chAp8">8&nbsp; Methodology</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.1">8.1&nbsp; Absorption Spectrum</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.2">8.2&nbsp; Active and inactive states</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.3">8.3&nbsp; Damping</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.4">8.4&nbsp; Decoherence</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.5">8.5&nbsp; Excitation Selection</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.6">8.6&nbsp; Internal coordinates definitions</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.7">8.7&nbsp; Kinetic energy adjustments</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.8">8.8&nbsp; Laser fields</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.8.1">8.8.1&nbsp; Form of the laser field</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.8.2">8.8.2&nbsp; Envelope functions</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.8.3">8.8.3&nbsp; Field functions</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.8.4">8.8.4&nbsp; Chirped pulses</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.8.5">8.8.5&nbsp; Quadratic chirp without Fourier transform</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.9">8.9&nbsp; Laser interactions</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.9.1">8.9.1&nbsp; Surface Hopping with laser fields</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.10">8.10&nbsp; Random initial velocities</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.11">8.11&nbsp; Representations</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.11.1">8.11.1&nbsp; Current state in MCH representation</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.12">8.12&nbsp; Sampling from Wigner Distribution</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.13">8.13&nbsp; Scaling</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.14">8.14&nbsp; Seeding of the RNG</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.15">8.15&nbsp; Selection of gradients and non-adiabatic couplings</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.16">8.16&nbsp; State ordering</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.17">8.17&nbsp; Surface Hopping</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.18">8.18&nbsp; Velocity Verlet</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.19">8.19&nbsp; Wavefunction propagation</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.19.1">8.19.1&nbsp; Propagation using non-adiabatic couplings</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.19.2">8.19.2&nbsp; Propagation using overlap matrices</a>
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_chAp1"></a><h1>
Chapter 1 Introduction</h1>
<div class="p"><!----></div>
When a molecule is irradiated by light, a number of dynamical processes can take place, in which the molecule redistributes the energy among different electronic and vibrational degrees of freedom. Kasha's rule <a href="#Kasha1950DFS" id="CITEKasha1950DFS" class="tth_citation">[1</a>] states that radiationless transfer from higher excited singlet states to the lowest-lying S<sub>1</sub> excited state is faster than fluorescence (F). This radiationless transfer is called internal conversion (IC) and involves a changes between electronic states of the same multiplicity. If a transition occurs between electronic states of different spin, the process is called intersystem crossing (ISC). A typical ISC process is from a singlet to a triplet state, and once the lowest triplet is populated, phosphorescence (P) can take place. In figure&nbsp;<a href="#fig:jablonski"> 1.1</a>, radiative (F and P) and radiationless (IC and ISC) processes are summarized in a so-called Jablonski diagram.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_fIg1.1">
</a>   <div style="text-align:center">  <img src="http://sharc-md.org/wp-content/uploads/2014/10/jablonski.png">  
<div style="text-align:center">Figure 1.1: Jablonski diagram showing the conceptual photophysical processes. Straight arrows show radiative processes: absorption (h&#957;), fluorescence (F), and phosphorescence (P); wavy arrows show radiationless processes: internal conversion (IC) and intersystem crossing (ISC). </div>
  <a id="fig:jablonski">
</a>
</div>
<div class="p"><!----></div>
The non-radiative IC and ISC process are fundamental concepts which play a decisive role in photochemistry and photobiology. IC processes are present in the excited-state dynamics of many organic and inorganic molecules, whose applications range from solar energy conversion to drug therapy. Even many, very small molecules, for example O2 and O3, SO2, NO2 and other nitrous oxides, show efficient IC, which has important consequences in atmospheric chemistry and the study of the environment and pollution. IC is also the first step of the biological process of visual perception, where the retinal moiety of rhodopsin absorbs a photon and non-radiatively performs a torsion around one of the double bonds, changing the conformation of the protein and inducing a neural signal. Similarly, protection of the human body from the influence of UV light is achieved through very efficient IC in DNA, proteins and melanins. Ultrafast IC to the electronic ground state allows quickly converting the excitation energy of the UV photons into nuclear kinetic energy, which is spread harmlessly as heat to the environment.
<div class="p"><!----></div>
ISC processes are completely forbidden in the frame of the non-relativistic Schr&#246;dinger equation, but they become allowed when including spin-orbit couplings, a relativistic effect&nbsp;<a href="#Marian2012WCMS" id="CITEMarian2012WCMS" class="tth_citation">[2</a>]. Spin-orbit coupling depends on the nuclear charge and becomes stronger for heavy atoms, therefore it is typically known as a "heavy atom" effect. However, it has been recently recognized that even for molecules with only first- and second-row atoms, ISC might be relevant and can be competitive in time scales with IC. A small selection of the growing number of molecules where efficient ISC in a sub-ps time scale has been predicted are SO2&nbsp;<a href="#Wilkinson2014JCP" id="CITEWilkinson2014JCP" class="tth_citation">[3</a>,<a href="#Mai2014JCP_SO2" id="CITEMai2014JCP_SO2" class="tth_citation">[4</a>,<a href="#Leveque2014JCP_ISC" id="CITELeveque2014JCP_ISC" class="tth_citation">[5</a>], benzene&nbsp;<a href="#Penfold2012JCP" id="CITEPenfold2012JCP" class="tth_citation">[6</a>], aromatic nitrocompounds&nbsp;<a href="#Vogt2013JPC" id="CITEVogt2013JPC" class="tth_citation">[7</a>] or DNA nucleobases and derivatives&nbsp;<a href="#Crespo-Hernandez2004CR" id="CITECrespo-Hernandez2004CR" class="tth_citation">[8</a>,<a href="#Richter2012JPCL" id="CITERichter2012JPCL" class="tth_citation">[9</a>,<a href="#Martinez-Fernandez2012CC" id="CITEMartinez-Fernandez2012CC" class="tth_citation">[10</a>,<a href="#Mai2013C" id="CITEMai2013C" class="tth_citation">[11</a>,<a href="#Reichardt2010CC" id="CITEReichardt2010CC" class="tth_citation">[12</a>].
<div class="p"><!----></div>
Theoretical simulations can greatly contribute to understand non-radiative processes by following the nuclear motion on the excited-state potential energy surfaces (PES) in real time. These simulations are called excited-state dynamics simulations. 
Since the Born-Oppenheimer approximation is not applicable for this kind of dynamics, non-adiabatic effects need to be incorporated into the simulations.
<div class="p"><!----></div>
The principal methodology to tackle excited-state dynamics simulations is to numerically integrate the time-dependent Schr&#246;dinger equation, which is usually called full quantum dynamics simulations (QD). Given accurate PESs, QD is able to reach or surpass experimental accuracy. However, the need of an "a priori" knowledge of the full multi-dimensional PES renders this type of simulations quickly unfeasible for more than few degrees of freedom. Several alternative methodologies are possible to alleviate this problem. One of the most popular ones is to use surface hopping non-adiabatic dynamics.
<div class="p"><!----></div>
Surface hopping was originally devised by Tully&nbsp;<a href="#Tully1971JCP" id="CITETully1971JCP" class="tth_citation">[13</a>] and greatly improved later by the "fewest-switches criterion"<a href="#Tully1990JCP" id="CITETully1990JCP" class="tth_citation">[14</a>] and it has been reviewed extensively since then, see e.g.&nbsp;<a href="#Barbatti2011WCMS" id="CITEBarbatti2011WCMS" class="tth_citation">[15</a>,<a href="#Doltsinis2006" id="CITEDoltsinis2006" class="tth_citation">[16</a>,<a href="#Doltsinis2002JTCC" id="CITEDoltsinis2002JTCC" class="tth_citation">[17</a>].
In surface hopping, the motion of the excited-state wavepacket is approximated by the motion of an ensemble of many independent, classical trajectories. Each trajectory is at every instant of time tied to one particular PES, and the nuclear motion is integrated using the gradient of this PES. However, non-adiabatic population transfer can lead to the switching of a trajectory from one PES to another PES. This switching (also called "hopping", which is the origin of the name "surface hopping") is based on a stochastic algorithm, taking into account the change of the electronic population from one time step to the next one.
<div class="p"><!----></div>
The advantages of the surface hopping methodology and thus its popularity are well summarized in Ref.&nbsp;<a href="#Barbatti2011WCMS" class="tth_citeref">[15</a>]:
<ul>
<li> The method is conceptually simple, since it is based on classical mechanics. The nuclear propagation is based on Newton's equations and can be performed in cartesian coordinates, avoiding any problems with curved coordinate systems as in QD.
<div class="p"><!----></div>
</li>
<li> For the propagation of the trajectories only local information of the PESs is needed. This avoids the calculation of the full, multi-dimensional PES in advance, which is the main bottleneck of QD methods. In surface hopping dynamics, all degrees of freedom can be included in the simulation. Additionally, all necessary quantities can be calculated on-demand, usually called "on-the-fly" in this context.
<div class="p"><!----></div>
</li>
<li> The independent trajectories can be trivially parallelized.
<div class="p"><!----></div>
</li>
</ul>
The strongest of these points of course is the fact that all degrees of freedom can be included easily in the calculations, allowing to describe large systems.
One should note, however, that surface hopping methods in the standard formulation&nbsp;<a href="#Tully1971JCP" class="tth_citeref">[13</a>,<a href="#Tully1990JCP" class="tth_citeref">[14</a>] - due to  the classical nature of the trajectories - do not allow to treat some purely quantum-mechanical effects like tunneling, (tunneling for selected degrees of freedom is possible <a href="#Hammes-Schiffer1994JCP" id="CITEHammes-Schiffer1994JCP" class="tth_citation">[18</a>]). Additionally, quantum coherence between the electronic states is usually described poorly, because of the independent-trajectory ansatz. This can be treated with some ad-hoc corrections, e.g., in <a href="#Granucci2007JCP" id="CITEGranucci2007JCP" class="tth_citation">[19</a>].
<div class="p"><!----></div>
In the original surface hopping method, only non-adiabatic couplings are considered, only allowing for population transfer between electronic states of the same multiplicity. 
The  S<span style="font-size:x-small">HARC</span>&nbsp;methodology is a generalization of standard surface hopping since it allows to include any type of coupling. Beyond non-adiabatic couplings (for IC), spin-orbit couplings (for ISC) or interactions of dipole moments with electric fields (to explicitly describe laser-induced processes) can be included.
A number of methodologies for surface hopping including one or the other type of potential couplings have been proposed in references&nbsp;<a href="#Thachuk1996JCP" id="CITEThachuk1996JCP" class="tth_citation">[20</a>,<a href="#Maiti2004JPCA" id="CITEMaiti2004JPCA" class="tth_citation">[21</a>,<a href="#Jones2008JPCA" id="CITEJones2008JPCA" class="tth_citation">[22</a>,<a href="#Mitric2009PRA" id="CITEMitric2009PRA" class="tth_citation">[23</a>,<a href="#Granucci2012JCP" id="CITEGranucci2012JCP" class="tth_citation">[24</a>,<a href="#Curchod2013C" id="CITECurchod2013C" class="tth_citation">[25</a>,<a href="#Cui2014JCP" id="CITECui2014JCP" class="tth_citation">[26</a>], but  S<span style="font-size:x-small">HARC</span>&nbsp;can include all types of potential couplings on the same footing. 
<div class="p"><!----></div>
The  S<span style="font-size:x-small">HARC</span>&nbsp;methodology is an extension to standard surface hopping which allows to include these kinds of couplings. The central idea of  S<span style="font-size:x-small">HARC</span>&nbsp;is to obtain a fully diagonal Hamiltonian, which is adiabatic with respect to all couplings. The diagonal Hamiltonian is obtained by unitary transformation of the Hamiltonian including all couplings. Surface hopping is conducted on the transformed electronic states.
This has a number of advantages over the standard surface hopping methodology, where no diagonalization is performed:
<ul>
<li> Potential couplings (like spin-orbit couplings and laser-dipole couplings) are usually delocalized. Surface hopping, however, rests on the assumption that the couplings are localized and hence surface hops only occur in the small region where the couplings are large. Within  S<span style="font-size:x-small">HARC</span>, by transforming away the potential couplings, additional terms of non-adiabatic (kinetic) couplings arise, which are localized.
<div class="p"><!----></div>
</li>
<li> The potential couplings have an influence on the gradients acting on the nuclei. To a good approximation, within  S<span style="font-size:x-small">HARC</span>&nbsp;it is possible to include this influence in the dynamics.
<div class="p"><!----></div>
</li>
<li> When including spin-orbit couplings for states of higher multiplicity, diagonalization solves the problem of rotational invariance of the multiplet components (see&nbsp;<a href="#Granucci2012JCP" class="tth_citeref">[24</a>]).
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
The  S<span style="font-size:x-small">HARC</span>&nbsp;suite of programs is an implementation of the  S<span style="font-size:x-small">HARC</span>&nbsp;method. Besides the core dynamics code, it comes with a number of tools aiding in the setup, maintenance and analysis of the trajectories. 
<div class="p"><!----></div>
 <a id="tth_sEc1.1"></a><h2>
1.1&nbsp;&nbsp;Capabilities</h2>
<div class="p"><!----></div>
The main features of the  S<span style="font-size:x-small">HARC</span>&nbsp;suite are:
<ul>
<li> Non-adiabatic dynamics based on the surface hopping methodology able to describe internal conversion and intersystem crossing with any number of states (singlets, doublets, triplets, or higher multiplicities).
<div class="p"><!----></div>
</li>
<li> Algorithms for stable wavefunction propagation in the presence of very small or very large couplings.
<div class="p"><!----></div>
</li>
<li> Inclusion of interactions with laser fields in the long-wavelength limit. The derivatives of the dipole moments can be included in strong-field applications.
<div class="p"><!----></div>
</li>
<li> Propagation using either non-adiabatic couplings vectors &#9001;&#945;&#124;[(&#8706;)/(&#8706;<b>R</b>)]&#124;&#946;&#9002;, time-derivative couplings &#9001;&#945;&#124;[(&#8706;)/(&#8706;t)]&#124;&#946;&#9002; or wavefunction overlaps &#9001;&#945;(t<sub>0</sub>)&#124;&#946;(t)&#9002; (via the local diabatization procedure <a href="#Granucci2007JCP" class="tth_citeref">[19</a>]).
<div class="p"><!----></div>
</li>
<li> Gradients including the effects of spin-orbit couplings (with the approximation that the diabatic spin-orbit couplings are slowly varying).
<div class="p"><!----></div>
</li>
<li> Energy-difference-based partial coupling approximation to speed up calculations <a href="#Pittner2009CP" id="CITEPittner2009CP" class="tth_citation">[27</a>].
<div class="p"><!----></div>
</li>
<li> Energy-based decoherence correction <a href="#Granucci2007JCP" class="tth_citeref">[19</a>].
<div class="p"><!----></div>
</li>
<li> Flexible interface to quantum chemistry programs. Existing interfaces to  M<span style="font-size:x-small">OLPRO</span> 2010 and 2012,  M<span style="font-size:x-small">OLCAS</span> 7.8 and 8.0, and to  C<span style="font-size:x-small">OLUMBUS</span> 7.0 (only if interfaced to  M<span style="font-size:x-small">OLCAS</span>). An interface to implement dynamics based on analytical expressions is also available.
<div class="p"><!----></div>
</li>
<li> Calculation of Dyson norms for single-photon ionization spectra through the  C<span style="font-size:x-small">OLUMBUS</span> interface.
<div class="p"><!----></div>
</li>
<li> Suite of auxiliary Python scripts for all steps of the setup procedure and for various analysis tasks.
<div class="p"><!----></div>
</li>
<li> Comprehensive tutorial.
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc1.2"></a><h2>
1.2&nbsp;&nbsp;References</h2>
<div class="p"><!----></div>
The following references should be cited when using the  S<span style="font-size:x-small">HARC</span>&nbsp;suite:
<ul>
<li> <a href="#Richter2011JCTC" id="CITERichter2011JCTC" class="tth_citation">[28</a>] .
<div class="p"><!----></div>
</li>
<li> <a href="#Mai2014SHARC" id="CITEMai2014SHARC" class="tth_citation">[29</a>] .
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
Further details can be found in the following references:
<div class="p"><!----></div>
The theoretical background of  S<span style="font-size:x-small">HARC</span>&nbsp;is described in Refs.&nbsp;<a href="#Richter2011JCTC" class="tth_citeref">[28</a>,<a href="#Richter2012JCTC_erratum" id="CITERichter2012JCTC_erratum" class="tth_citation">[30</a>,<a href="#Bajo2011JPCA" id="CITEBajo2011JPCA" class="tth_citation">[31</a>,<a href="#Marquetand2011FD" id="CITEMarquetand2011FD" class="tth_citation">[32</a>].
<div class="p"><!----></div>
Applications of the  S<span style="font-size:x-small">HARC</span>&nbsp;code can be found in Refs.&nbsp;<a href="#Richter2012JPCL" class="tth_citeref">[9</a>,<a href="#Mai2013C" class="tth_citeref">[11</a>,<a href="#Mai2014TCC" id="CITEMai2014TCC" class="tth_citation">[33</a>,<a href="#Mai2014JCP_SO2" class="tth_citeref">[4</a>,<a href="#Gonzalez2014" id="CITEGonzalez2014" class="tth_citation">[34</a>].
<div class="p"><!----></div>
Other features implemented in the  S<span style="font-size:x-small">HARC</span>&nbsp;suite are described in the following references:
<ul>
<li> Energy-based decoherence correction: <a href="#Granucci2007JCP" class="tth_citeref">[19</a>].
<div class="p"><!----></div>
</li>
<li> Local diabatization and wavefunction overlap calculation: <a href="#Granucci2001JCP" id="CITEGranucci2001JCP" class="tth_citation">[35</a>,<a href="#Pittner2009CP" class="tth_citeref">[27</a>,<a href="#Plasser2012JCP" id="CITEPlasser2012JCP" class="tth_citation">[36</a>].
<div class="p"><!----></div>
</li>
<li> Sampling of initial conditions from a quantum-mechanical harmonic Wigner distribution: <a href="#Dahl1988JCP" id="CITEDahl1988JCP" class="tth_citation">[37</a>,<a href="#Schinke1995" id="CITESchinke1995" class="tth_citation">[38</a>].
<div class="p"><!----></div>
</li>
<li> Excited state selection for initial condition generation: <a href="#Barbatti2011" id="CITEBarbatti2011" class="tth_citation">[39</a>].
<div class="p"><!----></div>
</li>
<li> Calculation of ring puckering parameters and their classification: <a href="#Cremer1975JACS" id="CITECremer1975JACS" class="tth_citation">[40</a>,<a href="#Boeyens1976JCMS" id="CITEBoeyens1976JCMS" class="tth_citation">[41</a>].
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
The quantum chemistry programs to which interfaces with  S<span style="font-size:x-small">HARC</span>&nbsp;exist are described in the following sources:
<ul>
<li>  C<span style="font-size:x-small">OLUMBUS</span>: <a href="#Lischka2011WCMS" id="CITELischka2011WCMS" class="tth_citation">[42</a>,<a href="#Lischka2012" id="CITELischka2012" class="tth_citation">[43</a>,<a href="#Yabushita1999JPCA" id="CITEYabushita1999JPCA" class="tth_citation">[44</a>,<a href="#Mai2014JCP_reindex" id="CITEMai2014JCP_reindex" class="tth_citation">[45</a>],
<div class="p"><!----></div>
</li>
<li>  M<span style="font-size:x-small">OLPRO</span>: <a href="#Werner2012WCMS" id="CITEWerner2012WCMS" class="tth_citation">[46</a>,<a href="#Werner2012" id="CITEWerner2012" class="tth_citation">[47</a>],
<div class="p"><!----></div>
</li>
<li>  M<span style="font-size:x-small">OLCAS</span>: <a href="#Karlstrom2003CMS" id="CITEKarlstrom2003CMS" class="tth_citation">[48</a>,<a href="#Aquilante2010JCC" id="CITEAquilante2010JCC" class="tth_citation">[49</a>].
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
 <a id="tth_sEc1.3"></a><h2>
1.3&nbsp;&nbsp;Authors</h2>
<div class="p"><!----></div>
The current version of the  S<span style="font-size:x-small">HARC</span>&nbsp;suite has been programmed by Sebastian Mai and Martin Richter of the AG Gonz&#225;lez of the Institute of Theoretical Chemistry of the University of Vienna with contributions from Jes&#250;s Gonz&#225;lez-V&#225;zquez, Philipp Marquetand, Matthias Ruckenbauer, Markus Oppel and Leticia Gonz&#225;lez.
<div class="p"><!----></div>
 <a id="tth_sEc1.4"></a><h2>
1.4&nbsp;&nbsp;Suggestions and Bug Reports</h2>
<div class="p"><!----></div>
Bug reports and suggestions for possible features can be submitted to <a href="mailto:sharc@univie.ac.at">sharc@univie.ac.at</a>.
<div class="p"><!----></div>
 <a id="tth_sEc1.5"></a><h2>
1.5&nbsp;&nbsp;Notation in this Manual</h2>
<div class="p"><!----></div>
<b>Names of programs&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The  S<span style="font-size:x-small">HARC</span>&nbsp;suite consists of Fortran90 programs as well as Python and Shell scripts. The executable Fortran90 programs are denoted by the extension <b><tt>.x</tt></b>, the Python scripts have the extension <b><tt>.py</tt></b> and the Shell scripts <b><tt>.sh</tt></b>. Within this manual, all program names are given in <b><tt>bold monospaced font</tt></b>.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_chAp2"></a><h1>
Chapter 2 Installation</h1>
<div class="p"><!----></div>
 <a id="tth_sEc2.1"></a><h2>
2.1&nbsp;&nbsp;How To Obtain</h2>
<div class="p"><!----></div>
 S<span style="font-size:x-small">HARC</span>&nbsp;can be obtained from the  S<span style="font-size:x-small">HARC</span>&nbsp;homepage <a href="http://sharc-md.org">www.sharc-md.org</a>. In the Download section, register with your e-mail adress and affiliation. You will receive a download link to the stated e-mail adress. Clicking on the link in the email will download the archive file containing the  S<span style="font-size:x-small">HARC</span>&nbsp;package. Note that the link is active only for 24 h and the number of downloads is limited.
<div class="p"><!----></div>
Note that you must accept the Terms of Use given in the following section in order to download  S<span style="font-size:x-small">HARC</span>.
<div class="p"><!----></div>
 <a id="tth_sEc2.2"></a><h2>
2.2&nbsp;&nbsp;Terms of Use</h2>
<div class="p"><!----></div>
 <b>1.&nbsp;&nbsp;&nbsp; Recitals</b>
<div class="p"><!----></div>
The University of Vienna (in following the "University"), whose principal address is at Universit&#228;tsring 1, 1010 Vienna, Austria, developed the Software "SHARC: Surface Hopping with Arbitrary Couplings. A program suite to study the excited-state dynamics of molecules" (in the following the "Software").
<div class="p"><!----></div>
The Software is not to be used for commercial purposes. Our Software provided on the relevant website is solely to be used for research, teaching and demonstration purposes and is free of any charge. The user of the Software is required to have the appropriate knowledge and know-how to use the Software (in the following the "User"). Any User should seek further guidance and make independent enquiries before relying on the Software.
<div class="p"><!----></div>
 <b>2.&nbsp;&nbsp;&nbsp; Research, Teaching and Demonstration Purposes, Content and Liability</b>
<div class="p"><!----></div>
The Software on this website is based on scientific work and is solely to be used for research, teaching and demonstration purposes. The University, its organs, associated companies, employees and representatives do not warrant, represent or guarantee the functionality of the Software whatsoever. 
<div class="p"><!----></div>
The use of the Software is at your own risk and your own responsibility. The University, its organs, associated companies, employees and representatives do not assume any liability for the use the Software including its results. The University does not warrant, represent or guarantee any quality or performance of the Software and shall not be responsible for including but not limited to
<div class="p"><!----></div>
<ul>
<li> any contents of the Software in any kind;
<div class="p"><!----></div>
</li>
<li> any intermediate or permanent amendments of the Software of any kind;
<div class="p"><!----></div>
</li>
<li> any damages of any kind arising out of or in connection with the use of the Software (including without limitation damages for any consequential loss or loss of business opportunities or projects, or loss of profits) including, but not limited to, data theft or data loss;
<div class="p"><!----></div>
</li>
<li> any errors, faults, incompleteness, inaccuracy, inadequacy or unsuitability or incorrectness of the provided Software or its results;
<div class="p"><!----></div>
</li>
<li> any personal damages or damages to property due to the use of the Software;
<div class="p"><!----></div>
</li>
<li> any damages of computers, any viruses or Trojans or similar which were transferred or conveyed by the Software;
<div class="p"><!----></div>
</li>
<li> any defaults or incompleteness of the Software including any loss or damages of any kind due to or arising out of the use of the Software provided on the website of the University;
<div class="p"><!----></div>
</li>
<li> any damages caused by third persons or subcontractors.
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
Hence, the University explicitly reserves the right to amend, supplement, delete or remove the Software, partially or as a whole, at any time and without prior notice.
<div class="p"><!----></div>
The University explicitly refrains from and does not assume any liability whatsoever for any products or services offered or advertised by third persons via the provided Software.
<div class="p"><!----></div>
 <b>3.&nbsp;&nbsp;&nbsp; Acknowledgements</b>
<div class="p"><!----></div>
The User shall acknowledge the authors or originators and use of the Software in the publication of any results achieved through use of the Software in the form of including the following references:
<div class="p"><!----></div>
<ul>
<li> S. Mai, M. Richter, M. Ruckenbauer, M. Oppel, P. Marquetand, L. Gonz&#225;lez: "SHARC: Surface Hopping Including Arbitrary Couplings - Program Package for Non-Adiabatic Dynamics". www.sharc-md.org (2014).
<div class="p"><!----></div>
</li>
<li> M. Richter, P. Marquetand, J. Gonz&#225;lez-V&#225;zquez, I. Sola, L. Gonz&#225;lez: "SHARC: ab Initio Molecular Dynamics with Surface Hopping in the Adiabatic Representation Including Arbitrary Couplings". J. Chem. Theory Comput., 7, 1253-1258 (2011).
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
The User shall reproduce a copyright notice on every copy of the Software including partial copies and on any accompanying manuals and documentation in the form "Copyright &#169;&nbsp;2014 University of Vienna. All rights reserved." Trademark and other proprietary notices must also be reproduced but the User has no longer the right to use the name, arms, trademark, logo or other designation of the University of Vienna.
<div class="p"><!----></div>
 <b>4.&nbsp;&nbsp;&nbsp; Intellectual Property</b>
<div class="p"><!----></div>
The contents of this Software are exclusively governed and construed by Austrian intellectual property laws. Any copying, editing, distribution or use of the contents require the prior consent of the respective authors or originators which is not granted or deemed to be granted without the prior written consent as described above.
<div class="p"><!----></div>
If and to the extent the User amends, edits or otherwise supplements the Software with own information or other information of third persons, the User shall be deemed as the new operator of the Software. Consequently, the User expressly assumes any and all liability in connection with the Software.
<div class="p"><!----></div>
 <b>5.&nbsp;&nbsp;&nbsp; Indemnity</b>
<div class="p"><!----></div>
The User is irrevocably obliged to indemnify the University, its employees, its organs, its associated companies and representatives for any damages in particular claims and damage claims including legal cost for
<ul>
<li> any use of the Software by the User;
<div class="p"><!----></div>
</li>
<li> any violation or infringement of this terms of use partially or in whole;
<div class="p"><!----></div>
</li>
<li> any violation of rights of third persons in particular of intellectual property rights or personality rights of publicity or
<div class="p"><!----></div>
</li>
<li> any claims of third persons due to the use of the Software.
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
This obligation of the User to indemnify shall not impede any other provision of this disclaimer described herein and shall remain in force and effect after the User has ceased to use the Software.
<div class="p"><!----></div>
If and to the extent third persons assert any claims against the University due to or arising out of the use by any User, such User shall be obliged to indemnify and hold harmless the University for any damages asserted against the University.
<div class="p"><!----></div>
 <b>6.&nbsp;&nbsp;&nbsp; Data Protection</b>
<div class="p"><!----></div>
The User explicitly acknowledges that the University uses services of third party suppliers (e.g. Google Analytics etc.) and consents to the use of its data by the third party supplier. Further, the User consents to the use of the respective IP address of the User or similar by third persons (e.g. for statistical use). The University shall be entitled to provide third persons with such data for statistical purposes. If personal data of Users is provided to or used by third persons, the University shall not be deemed as a sponsor pursuant to the Austrian Data Protection Act 2000.
<div class="p"><!----></div>
 <b>7.&nbsp;&nbsp;&nbsp; Final Provisions</b>
<div class="p"><!----></div>
The Software was developed in Austria and is applicable through a server located in Austria. Any and all interpretation of the content of the Software, any claims with regards to the Software and any disputes in connection with the Software shall be governed by Austrian law excluding any applicable collision provisions. Exclusive place of jurisdiction shall be Vienna, Austria.
<div class="p"><!----></div>
 <a id="tth_sEc2.3"></a><h2>
2.3&nbsp;&nbsp;Installation</h2>
<div class="p"><!----></div>
In order to install and run  S<span style="font-size:x-small">HARC</span>&nbsp;under Linux (Windows and OS X are currently not supported), you need the following:
<ul>
<li> A Fortran90 compiler (This release is tested against <a href="https://gcc.gnu.org/fortran/">GNU Fortran</a> 4.4.7 and <a href="https://software.intel.com/en-us/fortran-compilers">Intel Fortran</a> 15.0).
<div class="p"><!----></div>
</li>
<li> The <a href="http://www.netlib.org/blas/">BLAS</a>, <a href="http://www.netlib.org/lapack/">LAPACK</a> and <a href="http://http://www.fftw.org/">FFTW3</a> libraries.
<div class="p"><!----></div>
</li>
<li> <a href="https://www.python.org/downloads/release/python-278/">Python 2</a> (This release is tested against Python 2.6.6 and 2.7.3).
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
The source code of the   S<span style="font-size:x-small">HARC</span>&nbsp;suite is distributed as a tar archive file. In order to install it, first extract the content of the archive to a suitable directory:
<tt>tar&nbsp;-xzvf&nbsp;sharc.tgz</tt>
This should create a new directory called <b><tt>sharc/</tt></b> which contains all the necessary subdirectories and files. 
<div class="p"><!----></div>
To compile the Fortran90 programs of the  S<span style="font-size:x-small">HARC</span>&nbsp;suite, go to the <b><tt>source/</tt></b> directory.
<tt>cd&nbsp;source/</tt>
and edit the <b><tt>Makefile</tt></b> by adjusting the <b><tt>F90</tt></b> variable to point to the Fortran compiler of your choice. 
Issuing the command:
<tt>make</tt>
will compile the source and create all the binaries.
<tt>make&nbsp;install</tt>
will copy the binary files into the <b><tt>sharc/bin/</tt></b> directory of the 
 S<span style="font-size:x-small">HARC</span>&nbsp;distribution, which already contains all the python scripts which
come with  S<span style="font-size:x-small">HARC</span>.
In figure&nbsp;<a href="#fig:installation"> 2.1</a> the directory structure of the complete  S<span style="font-size:x-small">HARC</span>&nbsp;directory is shown.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_fIg2.1">
</a>   <div style="text-align:center">  <img src="http://sharc-md.org/wp-content/uploads/2014/10/dirs_SHARC.png">  
<div style="text-align:center">Figure 2.1: Directory tree containing a complete  S<span style="font-size:x-small">HARC</span>&nbsp;installation.</div>
  <a id="fig:installation">
</a>
</div>
<div class="p"><!----></div>
In order to use the  S<span style="font-size:x-small">HARC</span>&nbsp;suite, set the environment variable <b><tt>$SHARC</tt></b> to the <b><tt>bin/</tt></b> directory of the  S<span style="font-size:x-small">HARC</span>&nbsp;installation. This ensures that all programs of the  S<span style="font-size:x-small">HARC</span>&nbsp;suite find the other executables and all calls are successful. For example, if you have unpacked  S<span style="font-size:x-small">HARC</span>into your home directory, 
just set: 
<tt>export&nbsp;SHARC=~/sharc/bin</tt>&nbsp;&nbsp;&nbsp; (for bourne shell users)
or
<tt>setenv&nbsp;SHARC&nbsp;$HOME/sharc/bin</tt>&nbsp;&nbsp;&nbsp; (for c-shell type users)
Note that it is advisable to put this line into your shell's login
scripts.
<div class="p"><!----></div>
     <a id="tth_sEc2.3.1"></a><h3>
2.3.1&nbsp;&nbsp;Libraries</h3>
<div class="p"><!----></div>
 S<span style="font-size:x-small">HARC</span>&nbsp;requires the BLAS, LAPACK and FFTW3 libraries. During the installation, it might be necessary to alter the <b><tt>LDFLAGS</tt></b> string in the <b><tt>Makefile</tt></b>, depending on where the relevant libraries are located on your system. In this way, it is for example possible to use vendor-provided libraries like the <a href="https://software.intel.com/en-us/intel-mkl">Intel MKL</a>. For more details see the <b><tt>INSTALL</tt></b> file which is included in the  S<span style="font-size:x-small">HARC</span>&nbsp;distribution.
<div class="p"><!----></div>
     <a id="tth_sEc2.3.2"></a><h3>
2.3.2&nbsp;&nbsp;Test Suite</h3>
<div class="p"><!----></div>
After the installation, it is advisable to first execute the test suite of  S<span style="font-size:x-small">HARC</span>, which will test the fundamental functionality of SHARC.
Change to an empty directory and execute
<tt>$SHARC/tests.py</tt>
The interactive script will first verify the Python installation (no message will appear if the Python installation is fine). Subsequently, the script prompts the user to enter which tests should be executed. Their is at least one test for each of the auxiliary scripts and interfaces. Tests whose names start with <b><tt>scripts_</tt></b> test the functionality of the auxiliary programs in the  S<span style="font-size:x-small">HARC</span>&nbsp;suite. Tests whose names start with <b><tt>Analytical_</tt></b>, <b><tt>COLUMBUS_</tt></b>, <b><tt>MOLCAS_</tt></b> or <b><tt>MOLPRO_</tt></b> run short trajectories, testing whether the main dynamics code, the interfaces and the quantum chemistry programs work together correctly.
<div class="p"><!----></div>
If the installation was successful and Python is installed correctly, the tests named <b><tt>scripts_&lt;NAME&#62;</tt></b> and <b><tt>Analytical_overlap</tt></b> should execute without error. 
<div class="p"><!----></div>
The test calculations involving the quantum chemistry programs ( C<span style="font-size:x-small">OLUMBUS</span>,  M<span style="font-size:x-small">OLCAS</span>,  M<span style="font-size:x-small">OLPRO</span>) can be used to check that  S<span style="font-size:x-small">HARC</span>&nbsp;can correctly call these programs and that they are installed correctly.
<div class="p"><!----></div>
If any of the tests show differences between output and reference output, it is advisable to check the respective files. Note that small differences in the output can already occur when using a different version of the quantum chemistry programs, and that these small differences can add up during the simulations.
<div class="p"><!----></div>
     <a id="tth_sEc2.3.3"></a><h3>
2.3.3&nbsp;&nbsp;Additional Programs</h3>
<div class="p"><!----></div>
For full functionality of the  S<span style="font-size:x-small">HARC</span>&nbsp;suite, several additional programs are recommended:
<ul>
<li> The Python package <a href="http://www.numpy.org/"> N<span style="font-size:x-small">UM</span>P<span style="font-size:x-small">Y</span></a>.
<div class="p"><!----></div>
</li>
<li> The <a href="http://www.gnuplot.info/"> G<span style="font-size:x-small">NUPLOT</span></a> plotting software.
<div class="p"><!----></div>
</li>
<li> A program for molecular visualization, able to read files in the xyz file format (e.g.&nbsp;<a href="http://www.cmbi.ru.nl/molden/molden.html"> M<span style="font-size:x-small">OLDEN</span></a>, <a href="http://gabedit.sourceforge.net/"> G<span style="font-size:x-small">ABEDIT</span></a>, <a href="http://molekel.cscs.ch/wiki/pmwiki.php"> M<span style="font-size:x-small">OLEKEL</span></a> or <a href="http://www.ks.uiuc.edu/Research/vmd/">VMD</a>)
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
Optimally, within your Python installation the  N<span style="font-size:x-small">UM</span>P<span style="font-size:x-small">Y</span> package (which provides many numerical methods, e.g., matrix diagonalization) should be available. If  N<span style="font-size:x-small">UM</span>P<span style="font-size:x-small">Y</span> is not available, the  S<span style="font-size:x-small">HARC</span>&nbsp;suite is still functional, and the affected scripts will fall back to use a small Fortran code (front-end for LAPACK) within the  S<span style="font-size:x-small">HARC</span>&nbsp;package. Since in the Python scripts no large-scale matrix calculations are carried out, there should be no significant performance loss if  N<span style="font-size:x-small">UM</span>P<span style="font-size:x-small">Y</span> is not available.
<div class="p"><!----></div>
 G<span style="font-size:x-small">NUPLOT</span> is not strictly necessary, since all output files could be plotted using other plotting programs. However, a number of scripts from the  S<span style="font-size:x-small">HARC</span>&nbsp;suite automatically generate  G<span style="font-size:x-small">NUPLOT</span> scripts after data processing, allowing to quickly plot the output files.
<div class="p"><!----></div>
<div class="p"><!----></div>
     <a id="tth_sEc2.3.4"></a><h3>
2.3.4&nbsp;&nbsp;Quantum Chemistry Programs</h3>
<div class="p"><!----></div>
Even though  S<span style="font-size:x-small">HARC</span>&nbsp;comes with an interface for analytical potentials (and hence can be used without any quantum chemistry program), the main application of  S<span style="font-size:x-small">HARC</span>&nbsp;is certainly on-the-fly ab initio dynamics. Hence, one of the following interfaced quantum chemistry programs is necessary:
<ul>
<li> <a href="http://www.molpro.net/"> M<span style="font-size:x-small">OLPRO</span></a> (this release was checked against  M<span style="font-size:x-small">OLPRO</span> 2010 and 2012).
<div class="p"><!----></div>
</li>
<li> <a href="http://http://molcas.org/"> M<span style="font-size:x-small">OLCAS</span></a> (this release was checked against  M<span style="font-size:x-small">OLCAS</span> 7.8 and 8.0).
<ul>
<li> <a href="http://www.univie.ac.at/columbus/docs_COL70/documentation_main.html"> C<span style="font-size:x-small">OLUMBUS</span> 7</a>, interfaced to <a href="http://http://molcas.org/"> M<span style="font-size:x-small">OLCAS</span></a>, for correlated multi-reference wavefunctions. 
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
See the relevant sections in chapter&nbsp;<a href="#chap:interfaces">6</a> for a description of the quantum chemical methods available with each of these programs.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_chAp3"></a><h1>
Chapter 3 Execution</h1>
<div class="p"><!----></div>
The  S<span style="font-size:x-small">HARC</span>&nbsp;suite consists of the main dynamics code <b><tt>sharc.x</tt></b> and a number of auxiliary programs, like setup scripts and analyse tools. Additionally, the suite comes with interfaces to suitable quantum chemistry software, e.g.&nbsp; M<span style="font-size:x-small">OLPRO</span>,  M<span style="font-size:x-small">OLCAS</span> or  C<span style="font-size:x-small">OLUMBUS</span>. 
<div class="p"><!----></div>
In the following, first it is explained how to run a single trajectory by setting up all necessary input for the dynamics code <b><tt>sharc.x</tt></b> manually. Afterwards, the usage of the auxiliary scripts is explained. Detailed infos on the  S<span style="font-size:x-small">HARC</span>&nbsp;input files is given in chapter&nbsp;<a href="#chap:input">4</a> and on the auxiliary scripts in chapter&nbsp;<a href="#chap:aux">7</a>. The interfaces are described in chapter&nbsp;<a href="#chap:interfaces">6</a>.
<div class="p"><!----></div>
 <a id="tth_sEc3.1"></a><h2>
3.1&nbsp;&nbsp;Running a single trajectory</h2>
<div class="p"><!----></div>
     <a id="tth_sEc3.1.1"></a><h3>
3.1.1&nbsp;&nbsp;Input files</h3>
<div class="p"><!----></div>
 S<span style="font-size:x-small">HARC</span>&nbsp;requires a number of input files, which contain the settings for the dynamics simulation (<b><tt>input</tt></b>), the initial geometry (<b><tt>geom</tt></b>), the initial velocity (<b><tt>veloc</tt></b>), the initial coefficients (<b><tt>coeff</tt></b>) and the laser field (<b><tt>laser</tt></b>). Only the first two (<b><tt>input</tt></b>, <b><tt>geom</tt></b>) are mandatory, the others are optional. The necessary files are shown in figure&nbsp;<a href="#fig:dir_traj"> 3.1</a>. 
The content of the main input file is explained in detail in section&nbsp;<a href="#sec:inputfile">4.1</a>, the geometry file is specified in section&nbsp;<a href="#sec:geomfile">4.2</a>. The specifications of the velocity, coefficient and laser files are given in sections&nbsp;<a href="#sec:velocfile">4.3</a>, <a href="#sec:coefffile">4.4</a> and <a href="#sec:laserfile">4.5</a>, respectively.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_fIg3.1">
</a>   <div style="text-align:center">  <img src="http://sharc-md.org/wp-content/uploads/2014/10/dir_traj.png">  
<div style="text-align:center">Figure 3.1: Input files for a  S<span style="font-size:x-small">HARC</span>&nbsp;dynamics simulation. Directories are in blue, executable scripts in green, regular files in white and optional files in grey.</div>
  <a id="fig:dir_traj">
</a>
</div>
<div class="p"><!----></div>
Additionally, the directory <b><tt>QM/</tt></b> and the script <b><tt>QM/runQM.sh</tt></b> need to be present, since the on-the-fly ab initio calculations are implemented through these files. The script <b><tt>QM/runQM.sh</tt></b> is called each time  S<span style="font-size:x-small">HARC</span>&nbsp;performs an on-the-fly calculation of electronic properties (usually by a quantum chemistry program). In order to do so,  S<span style="font-size:x-small">HARC</span>&nbsp;first writes the request for the calculation to <b><tt>QM/QM.in</tt></b>, then calls <b><tt>QM/runQM.sh</tt></b>, waits for the script to finish and then reads the requested quantities from <b><tt>QM/QM.out</tt></b>. The script <b><tt>QM/runQM.sh</tt></b> is fully responsible to generate the requested results from the provided input. 
In virtually all cases, this task is handled by the  S<span style="font-size:x-small">HARC</span>-quantum chemistry interfaces (see chapter&nbsp;<a href="#chap:interfaces">6</a>), so that the script <b><tt>QM/runQM.sh</tt></b> has a particularly simple form:
<tt>cd&nbsp;QM/</tt>
<div class="p"><!----></div>
<tt>$SHARC/&lt;INTERFACE&gt;&nbsp;QM.in&nbsp;</tt>
with the corresponding interface name given. Note that the interfaces in all cases need additional input files, which must be present in <b><tt>QM/</tt></b>. Those input files contain the specifications for the quantum chemistry information, e.g., basis set, active and reference space, memory settings, path to the quantum chemistry program, path to scratch directories; or for <b><tt>SHARC_Analytical.py</tt></b>, the expressions for the analytical potentials. For each interface, the input files are slightly different. See sections&nbsp;<a href="#sec:int:molpro">6.2</a>, <a href="#sec:int:molcas">6.3</a>, <a href="#sec:int:columbus">6.4</a> or <a href="#sec:int:analytical">6.5</a> for the necessary information.
<div class="p"><!----></div>
     <a id="tth_sEc3.1.2"></a><h3>
3.1.2&nbsp;&nbsp;Running the dynamics code</h3>
<div class="p"><!----></div>
Given the necessary input files,  S<span style="font-size:x-small">HARC</span>&nbsp;can be started by executing
<tt>user@host&gt;&nbsp;$SHARC/sharc.x&nbsp;input</tt>
Note that besides the input file, at least the geometry file needs to be present (see in the input section for details).
<div class="p"><!----></div>
     <a id="tth_sEc3.1.3"></a><h3>
3.1.3&nbsp;&nbsp;Output files</h3>
<div class="p"><!----></div>
Figure&nbsp;<a href="#fig:dir_traj_after"> 3.2</a> shows the content of a trajectory directory after the execution of  S<span style="font-size:x-small">HARC</span>. There will be six new files. These files are <b><tt>output.log</tt></b>, <b><tt>output.lis</tt></b>, <b><tt>output.dat</tt></b> and <b><tt>output.xyz</tt></b>, as well as <b><tt>restart.ctrl</tt></b> and <b><tt>restart.traj</tt></b>.
<div class="p"><!----></div>
The file <b><tt>output.log</tt></b> contains mainly a listing of the chosen options and the resulting dynamics settings. At higher print levels, the log file contains also information per timestep (useful for debugging). <b><tt>output.lis</tt></b> contains a table with one line per timestep, giving active states, energies and expectation values. <b><tt>output.dat</tt></b> contains a list of all important matrices and vectors at each timestep. This information can be extracted with <b><tt>data_extractor.x</tt></b> to yield plottable table files. <b><tt>output.xyz</tt></b> contains the geometries of all timesteps (the comments to each geometry give the active state).
For details about the content of the output files, see chapter&nbsp;<a href="#chap:output">5</a>.
<div class="p"><!----></div>
The restart files contain the full state of a trajectory and its control variables from the last successful timestep. These files are needed in order to restart a trajectory at this timestep (either because the calculation failed, or in order to extend the simulation time beyond the original maximum simulation time). 
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_fIg3.2">
</a>   <div style="text-align:center">  <img src="http://sharc-md.org/wp-content/uploads/2014/10/dir_traj_after.png">  
<div style="text-align:center">Figure 3.2: Files of a  S<span style="font-size:x-small">HARC</span>&nbsp;dynamics simulation after running. Directories are in blue, executable scripts in green, regular files in white and optional files in grey. Output files are in yellow.</div>
  <a id="fig:dir_traj_after">
</a>
</div>
<div class="p"><!----></div>
 <a id="tth_sEc3.2"></a><h2>
3.2&nbsp;&nbsp;Typical workflow for an ensemble of trajectories</h2>
<div class="p"><!----></div>
Usually, one is not interested in running only a single trajectory, since a single trajectory cannot reproduce the branching of a wavepacket into different reaction channels. In order to do so, within surface hopping an ensemble of independent trajectories is employed. 
<div class="p"><!----></div>
When dealing with a (possibly large) ensemble of trajectories, setup and analysis need to be automatized. Hence, the  S<span style="font-size:x-small">HARC</span>&nbsp;suite contains a number of scripts fulfilling different tasks in the usual workflow of setting up ensembles of trajectories.
The typical workflow is given schematically in figure&nbsp;<a href="#fig:workflow"> 3.3</a>.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_fIg3.3">
</a>   <div style="text-align:center">  <img src="http://sharc-md.org/wp-content/uploads/2014/10/prepare.png">  
<div style="text-align:center">Figure 3.3: Typical workflow for conducting excited-state dynamics simulations with  S<span style="font-size:x-small">HARC</span>.</div>
  <a id="fig:workflow">
</a>
</div>
<div class="p"><!----></div>
     <a id="tth_sEc3.2.1"></a><h3>
3.2.1&nbsp;&nbsp;Initial condition generation</h3>
<div class="p"><!----></div>
In the typical workflow, the user will first create a set of suitable initial conditions. In the context of the  S<span style="font-size:x-small">HARC</span>&nbsp;package, an initial condition is a set of an initial geometry, initial velocity, initial occupied state and initial wavefunction coefficients. 
Many such sets are needed in order to setup physically sound dynamics simulations.
<div class="p"><!----></div>
<b>Generation of initial geometries and velocities&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Currently, within the  S<span style="font-size:x-small">HARC</span>&nbsp;suite, initial geometries and velocities can be generated based on a quantum harmonic oscillator Wigner distribution. The theoretical background is given in section&nbsp;<a href="#met:wigner">8.12</a>. The calculation is performed by <b><tt>wigner.py</tt></b>, which is explained in section&nbsp;<a href="#sec:wigner.py">7.1</a>. 
<div class="p"><!----></div>
As given in figure&nbsp;<a href="#fig:workflow"> 3.3</a>, <b><tt>wigner.py</tt></b> needs as input the result of a frequency calculation in  M<span style="font-size:x-small">OLDEN</span> format. The calculation can be performed by any quantum chemistry program and any method the user sees fit. 
<b><tt>wigner.py</tt></b> produces the file <b><tt>initconds</tt></b>, which contains a list of initial conditions ready for further processing.
<div class="p"><!----></div>
<b>Generation of initial coefficients and states&nbsp;&nbsp;</b>
<div class="p"><!----></div>
In the second preparation step, for each of the sampled initial geometries it has to be decided which excited state should be the initial one. In simple cases, the user may manually choose the initial excited state using <b><tt>excite.py</tt></b> (see&nbsp;<a href="#sec:excite.py">7.3</a>). Alternatively, the selection of initial states can be performed based on the excitation energies and oscillator strengths of the excited states at each initial geometry (this approximately simulates a delta-pulse excitation). 
<div class="p"><!----></div>
The latter option makes it necessary to carry out vertical excitation calculation before the selection of the initial states.
The calculations can be set up with <b><tt>setup_init.py</tt></b> (see section&nbsp;<a href="#sec:setup_init.py">7.2</a>). This script prepares for each initial condition in the <b><tt>initconds</tt></b> file a directory with the necessary input to perform the calculation. The user should then execute the run script (<b><tt>run.sh</tt></b>) in each of the directories (either manually or through a batch queueing system).
<div class="p"><!----></div>
After the vertical excitation calculations are completed, the vertical excitation energies and oscillator strengths of each calculation are collected by <b><tt>excite.py</tt></b> (see&nbsp;<a href="#sec:excite.py">7.3</a>). The same script then performs the selection of the initial electronic state for each initial geometry. The results are written to a new file, <b><tt>initconds.excited</tt></b>. This file contains all information needed to setup the ensemble. 
<div class="p"><!----></div>
Additionally, <b><tt>spectrum.py</tt></b> (<a href="#sec:spectrum.py">7.6</a>) can calculate absorption spectra based on the <b><tt>initconds.excited</tt></b> file. This may be useful to verify that the level of theory chosen is appropriate (e.g., by comparing to an experimental spectrum), or to choose a suitable excitation window for the determination of the initial state.
<div class="p"><!----></div>
     <a id="tth_sEc3.2.2"></a><h3>
3.2.2&nbsp;&nbsp;Running the dynamics simulations</h3>
<div class="p"><!----></div>
Based on the initial conditions given in <b><tt>initconds.excited</tt></b>, the input for all trajectories in the ensemble can be setup by <b><tt>setup_traj.py</tt></b> (see section&nbsp;<a href="#sec:setup_traj.py">7.4</a>). The script produces one directory for each trajectory, containing the input files for  S<span style="font-size:x-small">HARC</span>&nbsp;and the selected interface.
<div class="p"><!----></div>
In order to run a particular trajectory, the user should execute the run script (<b><tt>run.sh</tt></b>) in the directory of the trajectory. Since those calculations can run between minutes and several weeks (depending on the level of theory used and the number of timesteps), it is advisable to submit the run scripts to a batch queueing system. 
<div class="p"><!----></div>
The progress of the simulations can be monitored most conveniently in the <b><tt>output.lis</tt></b> files. If the calculations are running in some temporary directory, the output files can be copied to the local directory (where they were setup) with the <b><tt>scp</tt></b> wrapper <b><tt>retrieve.sh</tt></b> (see <a href="#sec:retrieve">7.7</a>). This allows to perform ensemble analysis while the trajectories are still running.
<div class="p"><!----></div>
If a trajectory fails, the temporary directory where the calculation is running is not deleted. The file <b><tt>README</tt></b> will be created in the trajectory's directory, giving the time of the failure and the location of the temporary data, so that the case can be investigated. 
<div class="p"><!----></div>
     <a id="tth_sEc3.2.3"></a><h3>
3.2.3&nbsp;&nbsp;Analysis of the dynamics results</h3>
<div class="p"><!----></div>
Each trajectory can be analyzed independently by inspecting the output files (see chapter&nbsp;<a href="#chap:output">5</a>). Most importantly, calling <b><tt>data_extractor.x</tt></b> (<a href="#sec:data_extractor.x">7.8</a>) on the <b><tt>output.dat</tt></b> file of a trajectory creates a number of formatted files which can be plotted with the help of <b><tt>make_gnuscript.py</tt></b> (<a href="#sec:make_gnuscript.py">7.9</a>) and  G<span style="font-size:x-small">NUPLOT</span>.
The nuclear geometries in <b><tt>output.xyz</tt></b> file can be analyzed in terms of internal coordinates (bond lengths, angles, ring conformations, etc.) using <b><tt>geo.py</tt></b> (<a href="#sec:geo.py">7.12</a>).
<div class="p"><!----></div>
For the complete ensemble, the script <b><tt>populations.py</tt></b> (section&nbsp;<a href="#sec:populations.py">7.10</a> can calculate average excited-state populations. The script&nbsp;<b><tt>crossing.py</tt></b> (<a href="#sec:crossing.py">7.11</a>) can find and extract notable geometries, e.g., those geometries where a surface hop between two particular states occured.
<div class="p"><!----></div>
 <a id="tth_sEc3.3"></a><h2>
3.3&nbsp;&nbsp;Auxilliary Programs and Scripts</h2>
<div class="p"><!----></div>
The following tables list the auxiliary programs in the  S<span style="font-size:x-small">HARC</span>&nbsp;suite. The rightmost column gives the section where the program is documented.
<div class="p"><!----></div>
     <a id="tth_sEc3.3.1"></a><h3>
3.3.1&nbsp;&nbsp;Setup</h3>
<div class="p"><!----></div>
<table>
<tr><td align="left">wigner.py             </td><td width="375">Creates initial conditions from Wigner distribution.                   </td><td align="right"><a href="#sec:wigner.py">7.1</a></td></tr>
<tr><td align="left">setup_init.py        </td><td width="375">Sets up initial vertical excitation calculations.                              </td><td align="right"><a href="#sec:setup_init.py">7.2</a></td></tr>
<tr><td align="left">excite.py             </td><td width="375">Generates excited state lists for initial conditions and selects initial states.                                            </td><td align="right"><a href="#sec:excite.py">7.3</a></td></tr>
<tr><td align="left">setup_traj.py        </td><td width="375">Sets up the dynamics simulations based on the initial conditions.      </td><td align="right"><a href="#sec:setup_traj.py">7.4</a></td></tr>
<tr><td align="left">laser.x               </td><td width="375">Prepares files containing laser fields.                                </td><td align="right"><a href="#sec:laser.x">7.5</a></td></tr>
<tr><td align="left">molpro_input.py      </td><td width="375">Prepares  M<span style="font-size:x-small">OLPRO</span> input files for common jobs.                  </td><td align="right"><a href="#sec:molpro_input.py">6.2.5</a></td></tr>
<tr><td align="left">molcas_input.py      </td><td width="375">Prepares template files for the  M<span style="font-size:x-small">OLCAS</span> interface.             </td><td align="right"><a href="#sec:molcas_input.py">6.3.3</a></td></tr>
<tr><td align="left">diagonalizer.x        </td><td width="375">Helper program for <b><tt>excite.py</tt></b>. Only required if  N<span style="font-size:x-small">UM</span>P<span style="font-size:x-small">Y</span> is not available.            </td><td align="right"><a href="#sec:diagonalizer.x">7.13</a></td></tr></table>
<div class="p"><!----></div>
     <a id="tth_sEc3.3.2"></a><h3>
3.3.2&nbsp;&nbsp;Analysis</h3>
<div class="p"><!----></div>
<table>
<tr><td align="left">spectrum.py           </td><td width="375">Generates absorption spectra from initial conditions files.            </td><td align="right"><a href="#sec:spectrum.py">7.6</a></td></tr>
<tr><td align="left">retrieve.sh           </td><td width="375"><b><tt>scp</tt></b> wrapper to retrieve dynamics output during the simulation.   </td><td align="right"><a href="#sec:retrieve">7.7</a></td></tr>
<tr><td align="left">data_extractor.x     </td><td width="375">Extracts plottable results from the  S<span style="font-size:x-small">HARC</span>&nbsp;output data file.          </td><td align="right"><a href="#sec:data_extractor.x">7.8</a></td></tr>
<tr><td align="left">make_gnuscript.py    </td><td width="375">Creates gnuplot scripts for a given number of states.                  </td><td align="right"><a href="#sec:make_gnuscript.py">7.9</a></td></tr>
<tr><td align="left">populations.py        </td><td width="375">Calculates ensemble populations.                                       </td><td align="right"><a href="#sec:populations.py">7.10</a></td></tr>
<tr><td align="left">crossing.py           </td><td width="375">Extracts specific geometries from ensembles.                                          </td><td align="right"><a href="#sec:crossing.py">7.11</a></td></tr>
<tr><td align="left">geo.py                </td><td width="375">Calculates internal coordinates from xyz files.              </td><td align="right"><a href="#sec:geo.py">7.12</a></td></tr></table>
<div class="p"><!----></div>
     <a id="tth_sEc3.3.3"></a><h3>
3.3.3&nbsp;&nbsp;Interfaces</h3>
<div class="p"><!----></div>
<table>
<tr><td align="left">SHARC_MOLPRO.py      </td><td width="375">Allows for the calculation of SOC, gradients, non-adiabatic couplings, time derivatives, overlaps, dipole moments and angular momentum expectation values at the CASSCF level of theory. Symmetry or RASSCF are not supported. Only segmented basis sets are possible.   </td><td align="right"><a href="#sec:int:molpro">6.2</a></td></tr>
<tr><td align="left">SHARC_MOLCAS.py      </td><td width="375">Allows for the calculation of SOC, gradients, overlaps and dipole moments at the CASSCF and RASSCF level of theory. Symmetry is not supported.   </td><td align="right"><a href="#sec:int:molcas">6.3</a></td></tr>
<tr><td align="left">SHARC_COLUMBUS.py    </td><td width="375">Allows for the calculation of SOC, gradients, overlaps, dipole moments and Dyson norms at the CASSCF, RASSCF, MRCISD and LRT-MRAQCC levels of theory. Symmetry is not supported. Only works with the  C<span style="font-size:x-small">OLUMBUS</span>- M<span style="font-size:x-small">OLCAS</span> interface.                  </td><td align="right"><a href="#sec:int:columbus">6.4</a></td></tr>
<tr><td align="left">SHARC_Analytical.py  </td><td width="375">Allows to calculate SOC, gradients, overlaps, dipole moments and dipole moment gradients based on analytical expressions of diabatic matrix elements. Works only with cartesian coordinates.       </td><td align="right"><a href="#sec:int:analytical">6.5</a></td></tr></table>
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_chAp4"></a><h1>
Chapter 4 Input files</h1><a id="chap:input">
</a>
<div class="p"><!----></div>
In this chapter, the format of all  S<span style="font-size:x-small">HARC</span>&nbsp;input files are presented. Those are the main input file (here called <b><tt>input</tt></b>), the geometry file, the velocity file, the coefficients file and the laser file. Only the first two are mandatory, the others are optional input files. All input files are ASCII text files.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc4.1"></a><h2>
4.1&nbsp;&nbsp;Main input file</h2><a id="sec:inputfile">
</a>
<div class="p"><!----></div>
This section presents the format and all input keywords for the main  S<span style="font-size:x-small">HARC</span>&nbsp;input. Note that when using <b><tt>setup_traj.py</tt></b>, full knowledge of the  S<span style="font-size:x-small">HARC</span>&nbsp;input keywords is not required.
<div class="p"><!----></div>
     <a id="tth_sEc4.1.1"></a><h3>
4.1.1&nbsp;&nbsp;General remarks</h3>
<div class="p"><!----></div>
The input file has a relatively flexible structure. With very few exceptions, each single line is independent. An input line starts with a keyword, followed optionally by a number of arguments to this keyword. Example:
<div class="p"><!----></div>
      <tt>stepsize&nbsp;0.5</tt>
<div class="p"><!----></div>
Here, <b><tt>stepsize</tt></b> is the keyword, referring to the size of the timesteps for the nuclear motion in the dynamics. <b><tt>0.5</tt></b> gives the size of this timestep, in this example 0.5&nbsp;fs.
<div class="p"><!----></div>
A number of keywords have no arguments and act as simple switches (e.g., <b><tt>restart</tt></b>, <b><tt>gradcorrect</tt></b>, <b><tt>grad_select</tt></b>, <b><tt>nac_select</tt></b>, <b><tt>ionization</tt></b>, <b><tt>track_phase</tt></b>, <b><tt>dipole_gradient</tt></b>). Those keywords can be prefixed with <b><tt>no</tt></b> to explicitly deactivate the option (e.g., <b><tt>norestart</tt></b> deactivates restarts).
<div class="p"><!----></div>
In each line a trailing comment can be added in the input file, by using the special character <b><tt>#</tt></b>. Everything after <b><tt>#</tt></b> is ignored by the input parser of  S<span style="font-size:x-small">HARC</span>. The input file also can contain arbitrary blank lines and lines containing only comments. All input is case-insensitive.
<div class="p"><!----></div>
The input file is read by  S<span style="font-size:x-small">HARC</span>&nbsp;by subsequently searching the file for all known keywords. Hence, unknown or misspelled keywords are ignored. Also, the order of the keywords is completely arbitray. Note however, that if a keyword is repeated in the input only the <i>first</i> instance is used by the program. 
<div class="p"><!----></div>
     <a id="tth_sEc4.1.2"></a><h3>
4.1.2&nbsp;&nbsp;Input keywords</h3>
<div class="p"><!----></div>
In Table&nbsp;<a href="#tab:input"> 4.1</a>, all input keywords for the  S<span style="font-size:x-small">HARC</span>&nbsp;input file are listed.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb4.1">
</a> 
<div style="text-align:center">      
<table border="1">
<tr><td colspan="3" align="left"><div style="text-align:center">Table 4.1: Input keywords. The first column gives the name of the keyword, the second lists possible arguments and the third line provides an explanation. Defaults are marked like <b><span style="color:#00BF28">this</span></b>. $n denotes the n-th argument to the keyword.</div></td></tr><a id="tab:input">
</a>
<tr><td align="left"></td></tr>
<tr><td align="left"><span class="roman">Keyword     </td><td align="left">Arguments    </td><td width="276">Explanation</td></tr>
<tr><td align="left"></td></tr>
<tr><td align="left">
<div class="p"><!----></div>
<div class="p"><!----></div>
<div class="p"><!----></div>
<div class="p"><!----></div>
<div class="p"><!----></div>
  printlevel            </td><td align="left"><b>integer</b>                    </td><td width="276">Controls the verbosity of the log file.</td></tr>
<tr><td align="left"></td><td align="left">$1=0                               </td><td width="276"><span class="footnotesize">Log file is empty</span></td></tr>
<tr><td align="left"></td><td align="left">$1=1                               </td><td width="276"><span class="footnotesize">+ List of internal steps</span></td></tr>
<tr><td align="left"></td><td align="left">$1<b><span style="color:#00BF28">=2</span></b>                     </td><td width="276"><span class="footnotesize">+ Input parsing information</span></td></tr>
<tr><td align="left"></td><td align="left">$1=3                               </td><td width="276"><span class="footnotesize">+ Some information per timestep</span></td></tr>
<tr><td align="left"></td><td align="left">$1=4                               </td><td width="276"><span class="footnotesize">+ More information per timestep</span></td></tr>
<tr><td align="left"></td><td align="left">$1=5                               </td><td width="276"><span class="footnotesize">+ Much information per timestep</span></td></tr>
<tr><td align="left">restart               </td><td align="left"></td><td width="276">Dynamics is resumed from restart files.</td></tr>
<tr><td align="left"><b><span style="color:#00BF28">norestart</span></b>    </td><td align="left"></td><td width="276">Dynamics is initialized from input files.</td></tr>
<tr><td align="left"></td><td align="left"></td><td width="276"><span class="footnotesize"><b><tt>norestart</tt></b> takes precedence.</span></td></tr>
<tr><td align="left">nstates               </td><td align="left">list of <b>integer</b>s           </td><td width="276">Number of states per multiplicity.</td></tr>
<tr><td align="left"></td><td align="left">$1 (<b><span style="color:#00BF28">1</span></b>)                   </td><td width="276"><span class="footnotesize">Number of singlet states</span></td></tr>
<tr><td align="left"></td><td align="left">$2 (<b><span style="color:#00BF28">0</span></b>)                   </td><td width="276"><span class="footnotesize">Number of doublet states</span></td></tr>
<tr><td align="left"></td><td align="left">$3 (<b><span style="color:#00BF28">0</span></b>)                   </td><td width="276"><span class="footnotesize">Number of triplet states</span></td></tr>
<tr><td align="left"></td><td align="left">$... (<b><span style="color:#00BF28">0</span></b>)               </td><td width="276"><span class="footnotesize">Number of states of higher multiplicities</span></td></tr>
<tr><td align="left">actstates             </td><td align="left">list of <b>integer</b>s           </td><td width="276">Number of active states per multiplicity.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">same as <b><tt>nstates</tt></b></span></b>     </td><td width="276"><span class="footnotesize">By default, all states are active.</span></td></tr>
<tr><td align="left">state                 </td><td align="left"><b>integer</b>, <b>string</b>   </td><td width="276">Specifies the initial state (no default;  S<span style="font-size:x-small">HARC</span>&nbsp;exits if <b><tt>state</tt></b> is missing).</td></tr>
<tr><td align="left"></td><td align="left">$1                                 </td><td width="276"><span class="footnotesize">Initial state.</span></td></tr>
<tr><td align="left"></td><td align="left">$2=MCH                             </td><td width="276"><span class="footnotesize">Initial state and coefficients are given in MCH representation.</span></td></tr>
<tr><td align="left"></td><td align="left">$2=diag                            </td><td width="276"><span class="footnotesize">Initial state and coefficients are given in diagonal representation.</span></td></tr>
<tr><td align="left">coeff                 </td><td align="left"><b>string</b>                     </td><td width="276">Sets the wavefunction coefficients.</td></tr>
<tr><td align="left"></td><td align="left">$1<b><span style="color:#00BF28">=auto</span></b>                  </td><td width="276"><span class="footnotesize">Initial coefficient are determined automatically from initial state.</span></td></tr>
<tr><td align="left"></td><td align="left">$1=external                        </td><td width="276"><span class="footnotesize">Initial coefficients are read from file.</span></td></tr>
<tr><td align="left">coefffile             </td><td align="left"><b>quoted string</b>              </td><td width="276">File containing the initial wavefunction coefficients.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">"coeff"</span></b>                   </td><td width="276"></td></tr>
<tr><td align="left">geomfile              </td><td align="left"><b>quoted string</b>              </td><td width="276">File name containing the initial geometry.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">"geom"</span></b>                    </td><td width="276"></td></tr>
<tr><td align="left">veloc                 </td><td align="left"><b>string</b>                     </td><td width="276">Sets the initial velocities.</td></tr>
<tr><td align="left"></td><td align="left">$1<b><span style="color:#00BF28">=zero</span></b>                  </td><td width="276"><span class="footnotesize">Initial velocities are zero.</span></td></tr>
<tr><td align="left"></td><td align="left">$1=random $2 <b>float</b>       </td><td width="276"><span class="footnotesize">Initial velocities are determined randomly with $2 eV kinetic energy per atom.</span></td></tr>
<tr><td align="left"></td><td align="left">$1=external                        </td><td width="276"><span class="footnotesize">Initial velocities are read from file.</span></td></tr>
<tr><td align="left">velocfile             </td><td align="left"><b>quoted string</b>              </td><td width="276">File containing the initial velocities.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">"veloc"</span></b>                   </td><td width="276"></td></tr>
<tr><td align="left">laser                 </td><td align="left"><b>string</b>                     </td><td width="276">Sets the laser field.</td></tr>
<tr><td align="left"></td><td align="left">$1<b><span style="color:#00BF28">=none</span></b>                  </td><td width="276"><span class="footnotesize">No laser field is applied.</span></td></tr>
<tr><td align="left"></td><td align="left">$1=internal                        </td><td width="276"><span class="footnotesize">Laser field is calculated at each timestep from internal function.</span></td></tr>
<tr><td align="left"></td><td align="left">$1=external                        </td><td width="276"><span class="footnotesize">Laser field for each timestep is read during initialization.</span></td></tr>
<tr><td align="left">laserfile             </td><td align="left"><b>quoted string</b>              </td><td width="276">File containing the laser field.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">"laser"</span></b>                   </td><td width="276"></td></tr>
<tr><td align="left">laserwidth            </td><td align="left"><b>float</b>                      </td><td width="276">Laser bandwidth used to detect induced hops.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">1.0 eV</span></b>                    </td><td width="276"></td></tr>
<tr><td align="left">stepsize              </td><td align="left"><b>float</b>                      </td><td width="276">Length of the nuclear dynamics timesteps in fs.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">0.5 fs</span></b>                    </td><td width="276"></td></tr>
<tr><td align="left">nsubsteps             </td><td align="left"><b>integer</b>                    </td><td width="276">Number of substeps for the integration of the electronic equation of motion.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">25</span></b>                        </td><td width="276"></td></tr>
<tr><td align="left">nsteps                </td><td align="left"><b>integer</b>                    </td><td width="276">Number of simulation steps.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">3</span></b>                         </td><td width="276"></td></tr>
<tr><td align="left">tmax                  </td><td align="left"><b>float</b>                      </td><td width="276">Total length of the simulation in fs.</td></tr>
<tr><td align="left"></td><td align="left"></td><td width="276"><span class="footnotesize">No effect if <b><tt>nsteps</tt></b> is present.</span></td></tr>
<tr><td align="left">killafter             </td><td align="left"><b>float</b>                      </td><td width="276">Terminates the trajectory after $1 fs in the lowest state. If $1 &lt; 0, trajectories are never killed.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">-1</span></b>                        </td><td width="276"></td></tr>
<tr><td align="left">surf                  </td><td align="left"><b>string</b>                     </td><td width="276">Chooses the potential energy surfaces used in surface hopping.</td></tr>
<tr><td align="left"></td><td align="left">$1<b><span style="color:#00BF28">=sharc</span></b>                 </td><td width="276"><span class="footnotesize">Uses the diagonal potentials.</span></td></tr>
<tr><td align="left"></td><td align="left">$1=fish                            </td><td width="276"><span class="footnotesize">Uses the MCH potentials.</span></td></tr>
<tr><td align="left">coupling              </td><td align="left"><b>string</b>                     </td><td width="276">Chooses the quantities describing the non-adiabatic couplings.</td></tr>
<tr><td align="left"></td><td align="left">$1<b><span style="color:#00BF28">=ddr</span></b>                   </td><td width="276"><span class="footnotesize">Uses vectorial non-adiabatic couplings &#9001;&#968;<sub>&#945;</sub>&#124;&#8706;/&#8706;R&#124;&#968;<sub>&#946;</sub>&#9002;.</span></td></tr>
<tr><td align="left"></td><td align="left">$1=ddt                             </td><td width="276"><span class="footnotesize">Uses temporal non-adiabatic couplings &#9001;&#968;<sub>&#945;</sub>&#124;&#8706;/&#8706;t&#124;&#968;<sub>&#946;</sub>&#9002;.</span></td></tr>
<tr><td align="left"></td><td align="left">$1=overlap                         </td><td width="276"><span class="footnotesize">Uses the overlaps &#9001;&#968;<sub>&#945;</sub>(t<sub>0</sub>)&#124;&#968;<sub>&#946;</sub>(t)&#9002; (Local Diabatization).</span></td></tr>
<tr><td align="left">gradcorrect           </td><td align="left"></td><td width="276">Includes (E<sub>&#945;</sub>&#8722;E<sub>&#946;</sub>)&#9001;&#968;<sub>&#945;</sub>&#124;&#8706;/&#8706;R&#124;&#968;<sub>&#946;</sub>&#9002; in the gradient transformation.</td></tr>
<tr><td align="left"><b><span style="color:#00BF28">nogradcorrect</span></b></td><td align="left"></td><td width="276">Transforms only the gradients itself.</td></tr>
<tr><td align="left">ekincorrect           </td><td align="left"><b>string</b>                     </td><td width="276">Adjustment of the kinetic energy after a surface hop.</td></tr>
<tr><td align="left"></td><td align="left">$1=none                            </td><td width="276"><span class="footnotesize">Kinetic energy is not adjusted. Jumps are never frustrated.</span></td></tr>
<tr><td align="left"></td><td align="left">$1<b><span style="color:#00BF28">=parallel_vel</span></b>         </td><td width="276"><span class="footnotesize">Velocity is rescaled to adjust kinetic energy.</span></td></tr>
<tr><td align="left"></td><td align="left">$1=parallel_nac                   </td><td width="276"><span class="footnotesize">Only the velocity component in the direction of &#9001;&#968;<sub>&#945;</sub>&#124;&#8706;/&#8706;R&#124;&#968;<sub>&#946;</sub>&#9002; is rescaled.</span></td></tr>
<tr><td align="left">grad_select          </td><td align="left"></td><td width="276">Only some gradients are calculated at every timestep.</td></tr>
<tr><td align="left"><b><span style="color:#00BF28">grad_all</span></b>   </td><td align="left"></td><td width="276">All gradients are calculated at every timestep (Alias: <b><tt>nograd_select</tt></b>).</td></tr>
<tr><td align="left"></td><td align="left"></td><td width="276"><span class="footnotesize"><b><tt>grad_all</tt></b> takes precedence.</span></td></tr>
<tr><td align="left">nac_select           </td><td align="left"></td><td width="276">Only some &#9001;&#968;<sub>&#945;</sub>&#124;&#8706;/&#8706;R&#124;&#968;<sub>&#946;</sub>&#9002; are calculated at every timestep.</td></tr>
<tr><td align="left"><b><span style="color:#00BF28">nac_all</span></b>    </td><td align="left"></td><td width="276">All &#9001;&#968;<sub>&#945;</sub>&#124;&#8706;/&#8706;R&#124;&#968;<sub>&#946;</sub>&#9002; are calculated at every timestep (Alias: <b><tt>nonac_select</tt></b>).</td></tr>
<tr><td align="left"></td><td align="left"></td><td width="276"><span class="footnotesize"><b><tt>nac_all</tt></b> takes precedence.</span></td></tr>
<tr><td align="left">eselect               </td><td align="left"><b>float</b>                      </td><td width="276">Parameter for selection of gradients and non-adiabatic couplings (in eV).</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">0.5 eV</span></b>                    </td><td width="276"></td></tr>
<tr><td align="left">select_directly      </td><td align="left"></td><td width="276">Selection of gradients and NACs in one call.</td></tr>
<tr><td align="left">ezero                 </td><td align="left"><b>float</b>                      </td><td width="276">Energy shift for the diagonal elements of the Hamiltonian (in hartree).</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">0.0</span></b>                       </td><td width="276"><span class="footnotesize">Is not determined automatically.</span></td></tr>
<tr><td align="left">scaling               </td><td align="left"><b>float</b>                      </td><td width="276">Scaling factor for the Hamiltonian matrix and the gradients.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">1.0</span></b>                       </td><td width="276"><span class="footnotesize">0. &lt; $1</span></td></tr>
<tr><td align="left">dampeddyn             </td><td align="left"><b>float</b>                      </td><td width="276">Scaling factor for the kinetic energy at each timestep.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">1.0</span></b>                       </td><td width="276"><span class="footnotesize">0. &#8804; $1 &#8804; 1.</span></td></tr>
<tr><td align="left">rngseed               </td><td align="left"><b>integer</b>                    </td><td width="276">Seed for the random number generator.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">10997279</span></b>                  </td><td width="276"></td></tr>
<tr><td align="left">decoherence           </td><td align="left"></td><td width="276">Applies decoherence correction.</td></tr>
<tr><td align="left"><b><span style="color:#00BF28">nodecoherence</span></b></td><td align="left"></td><td width="276">No decoherence correction.</td></tr>
<tr><td align="left"></td><td align="left"></td><td width="276"><span class="footnotesize"><b><tt>nodecoherence</tt></b> takes precedence.</span></td></tr>
<tr><td align="left">decoherence_param    </td><td align="left"><b>float</b>                      </td><td width="276">The value &#945; in the decoherence correction (in Hartree).</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">0.1</span></b>                       </td><td width="276"><span class="footnotesize">0. &lt; $1</span></td></tr>
<tr><td align="left">ionization            </td><td align="left"></td><td width="276">Calculates ionization probabilities on-the-fly.</td></tr>
<tr><td align="left"><b><span style="color:#00BF28">noionization</span></b></td><td align="left"></td><td width="276">No ionization probabilities.</td></tr>
<tr><td align="left">ionization_step      </td><td align="left"><b>integer</b>                    </td><td width="276">Calculates ionization probabilities every $1 timestep.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">1</span></b>                          </td><td width="276">By default calculated every timestep (if at all).</td></tr>
<tr><td align="left"><b><span style="color:#00BF28">track_phase</span></b></td><td align="left"></td><td width="276">Follows the phase of the transformation matrix <b>U</b>.</td></tr>
<tr><td align="left">notrack_phase      </td><td align="left"></td><td width="276">No phase following of <b>U</b> (not recommended, only for debugging).</td></tr>
<tr><td align="left">dipole_gradient              </td><td align="left"></td><td width="276">Include the derivatives of the dipole moments in the gradients.</td></tr>
<tr><td align="left"><b><span style="color:#00BF28">nodipole_gradient</span></b>  </td><td align="left"></td><td width="276">Neglect the derivatives of the dipole moments.
</td></tr></span></table>
</div>
<div class="p"><!----></div>
     <a id="tth_sEc4.1.3"></a><h3>
4.1.3&nbsp;&nbsp;Detailed Description of the Keywords</h3><a id="ssec:input:keywords">
</a>
<div class="p"><!----></div>
<b>Printlevel&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The <b><tt>printlevel</tt></b> keyword controls the verbosity of the log file. The data output file (<b><tt>output.dat</tt></b>) and the listing file (<b><tt>output.lis</tt></b>) are not affected by the printlevel. The printlevels are described in section&nbsp;<a href="#sec:logfile">5.1</a>.
<div class="p"><!----></div>
<b>Restart&nbsp;&nbsp;</b>
<div class="p"><!----></div>
There are two keywords controlling trajectory restarting. The keyword <b><tt>restart</tt></b> enables restarting, while <b><tt>norestart</tt></b> disables restart. If both keywords are present, <b><tt>norestart</tt></b> takes precedence. The default is no restart.
<div class="p"><!----></div>
When restarting, all control variables are read from the restart file instead of the input file. The only exceptions are <b><tt>nsteps</tt></b> and <b><tt>tmax</tt></b>. In this way, a trajectory which ran for the full simulation time can easily be restarted to extend the simulation time.
<div class="p"><!----></div>
<b>Number of States and Active States&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The keyword <b><tt>nstates</tt></b> controls how many states are taken into account in the dynamics. The keyword arguments specify the number of singlet, doublet, triplet, etc.&nbsp;states. There is no hard-coded maximum multiplicity in the  S<span style="font-size:x-small">HARC</span>&nbsp;code, however, some interfaces may restrict the maximum multiplicity. 
<div class="p"><!----></div>
Using the <b><tt>actstates</tt></b> keyword, the dynamics can be restricted to some lowest states in each multiplicity. For each multiplicity, the number of active states must not be larger than the number of states. All couplings between the active states and the frozen states are deleted. These couplings include off-diagonal elements in the H<sup>MCH</sup> matrix, in the overlap matrix and in the matrix containing the non-adiabatic couplings. Freezing states can be useful if transient absorption spectra are to be calculated without increasing computational cost due to the large number of states.
<div class="p"><!----></div>
Note that the initial state must not be frozen.
<div class="p"><!----></div>
<b>Initial State&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The initial state can be given either in MCH or diagonal representation. The keyword <b><tt>state</tt></b> is followed by an integer specifying the initial state and either the string <b><tt>mch</tt></b> or <b><tt>diag</tt></b>. For the MCH representations, states are enumerated according to the canonical state ordering, see&nbsp;<a href="#met:ordering">8.16</a>. The diagonal states are ordered according to energy. Note that the initial state must be active. 
<div class="p"><!----></div>
If the initial state is given in the MCH basis, determination of the initial diagonal state is carried out after the initial QM calculation.
<div class="p"><!----></div>
<b>Initial Coefficients&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The initial coefficients can be read from a file. The default filename is <b><tt>coeff</tt></b>, but the filename can be given with the keyword <b><tt>coefffile</tt></b>. Note that the filename has to be enclosed in single or double quotes. The file must contain the real and imaginary part of the initial coefficients, one line per state with no blank lines inbetween. These coefficients are interpreted to be in the same representation as the initial state, i.e.&nbsp;the <b><tt>state</tt></b> keyword influences the initial coefficients. For details on the file format, see section&nbsp;<a href="#sec:coefffile">4.4</a>.
<div class="p"><!----></div>
Alternatively, the initial coefficients can be determined automatically from the initial state, using <b><tt>coeff auto</tt></b> in the input file. If the initial state is given in the diagonal representation as i, the initial coefficients are c<sup>diag</sup><sub>j</sub>=&#948;<sub>ij</sub>. If the initial state is, however, given in the MCH representation, then c<sup>MCH</sup><sub>j</sub>=&#948;<sub>ij</sub> and the determination of <b>c</b><sup>diag</sup>=<b>U</b><sup>&#8224;</sup><b>c</b><sup>MCH</sup> is carried out after the initial QM calculation. 
<div class="p"><!----></div>
<b>Geometry Input&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The initial geometry must be given in a second file in the  <a href="http://www.univie.ac.at/columbus/docs_COL70/documentation_main.html">input format also used by C<span style="font-size:x-small">OLUMBUS</span></a>. The default name for this file is <b><tt>geom</tt></b>. The geometry filename can be given in the input file with the <b><tt>geomfile</tt></b> keyword. Note that the filename has to be enclosed in single or double quotes. See section&nbsp;<a href="#sec:geomfile">4.2</a> for more details.
<div class="p"><!----></div>
<b>Velocity Input&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Using the <b><tt>veloc</tt></b> keyword, the initial velocities can be either set to zero, determined randomly or read from a file. Random determination of the velocities is such that each atom has the same kinetic energy, which must be specified after <b><tt>veloc random</tt></b> in units of eV. Determination of the random velocities is detailed in&nbsp;<a href="#met:veloc">8.10</a>. Note that after the initial velocities are generated, the RNG is reseeded (i.e., the sequence of random numbers in the surface hopping procedure is independent of whether random initial velocities are used).
<div class="p"><!----></div>
Alternatively, the initial velocities can be read from a file. 
The default velocity filename is <b><tt>veloc</tt></b>, but the filename can be specified with the <b><tt>velocfile</tt></b> keyword. Note that the filename has to be enclosed in single or double quotes. The file must contain the cartesian components of the velocity for each atom on a new line, in the same order as in the geomety file. The velocity is interpreted in terms of atomic units (bohr/atu). See section&nbsp;<a href="#sec:velocfile">4.3</a> for more details.
<div class="p"><!----></div>
<b>Laser Input&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The keyword <b><tt>laser</tt></b> controls whether a laser field is included in the dynamics (influencing the coefficient propagation and the energies/gradients by means of the Stark effect). 
<div class="p"><!----></div>
The input of an external laser field uses the file <b><tt>laser</tt></b>. This file is specified in <a href="#sec:laserfile">4.5</a>.
<div class="p"><!----></div>
<b>Laser Width&nbsp;&nbsp;</b>
<div class="p"><!----></div>
In order to detect laser-induced hops,  S<span style="font-size:x-small">HARC</span>&nbsp;compares the instantaneous central laser energy with the energy gap between the old and new states. If the difference between the laser energy and the energy gap is smaller than the laser bandwidth, the hop is classified as laser-induced. Those hops are never frustrated and the kinetic energy is not scaled to preserve total energy (instead, the kinetic energy is preserved).
<div class="p"><!----></div>
<b>Simulation Timestep&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The keyword <b><tt>stepsize</tt></b> controls the length of a timestep (in fs) for the dynamics. The nuclear motion is integrated using the Velocity-Verlet algorithm with this timestep. Surface hopping is performed once per timestep and 1-3 quantum chemistry calculations are performed per timestep (depending on the selection schedule). Each timestep is divided in <b><tt>nsubsteps</tt></b> substeps for the integration of the electronic equation-of-motion. Since integration is performed in the MCH representation, the default of 25 substeps is usually sufficient, even if very small potential couplings are encountered.
<div class="p"><!----></div>
<b>Simulation Time&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The keyword <b><tt>nsteps</tt></b> controls the total length of the simulation. The total simulation time is <b><tt>nsteps</tt></b> times <b><tt>stepsize</tt></b>. <b><tt>nsteps</tt></b> does not include the initial quantum chemistry calculation. Instead of the number of steps the total simulation time can be given directly (in fs) using the keyword <b><tt>tmax</tt></b>. In this case, <b><tt>nsteps</tt></b> is calculated as <b><tt>tmax</tt></b> divided by <b><tt>stepsize</tt></b>. If both keywords (<b><tt>nsteps</tt></b> and <b><tt>tmax</tt></b>) are present, <b><tt>nsteps</tt></b> is used.
<div class="p"><!----></div>
Using the keyword <b><tt>killafter</tt></b>, the dynamics can be terminated before the full simulation time. <b><tt>killafter</tt></b> specifies (in fs) the time the trajectory can move in the lowest-energy state before the simulation is terminated. By default, simulations always run to the full simulation time and are not terminated prematurely.
<div class="p"><!----></div>
<b>Surface Treatment&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The keyword <b><tt>surf</tt></b> controls whether the dynamics runs on diagonal potential energy surfaces (which makes it a  S<span style="font-size:x-small">HARC</span>&nbsp;simulation) or on the MCH PESs (which corresponds to a spin-diabatic dynamics <a href="#Granucci2012JCP" class="tth_citeref">[24</a>] or FISH <a href="#Mitric2009PRA" class="tth_citeref">[23</a>] simulation). Internally, dynamics on the MCH potentials is conducted by setting the U matrix equal to the unity matrix at each timestep. 
<div class="p"><!----></div>
<b>Description of Non-adiabatic Coupling&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The code allows to propagate the electronic wavefunction using three different quantities describing non-adiabatic effects, see&nbsp;<a href="#met:propagate">8.19</a>. The keyword <b><tt>coupling</tt></b> controls which of these quantities is requested from the QM interfaces and used in the propagation. The default is <b><tt>ddr</tt></b>, which requires the non-adiabatic coupling vectors &#9001;&#968;<sub>&#945;</sub>&#124;&#8706;/&#8706;<b>R</b>&#124;&#968;<sub>&#946;</sub>&#9002;. For the wavefunction propagation, the scalar product of these vectors and the nuclear velocity is calculated to obtain the matrix &#9001;&#968;<sub>&#945;</sub>&#124;&#8706;/&#8706;t&#124;&#968;<sub>&#946;</sub>&#9002;. During the propagation, this matrix is interpolated linearly within each classical timestep.
<div class="p"><!----></div>
Alternatively, some interfaces can directly calculate the matrix elements &#9001;&#968;<sub>&#945;</sub>&#124;&#8706;/&#8706;t&#124;&#968;<sub>&#946;</sub>&#9002;, which can be used for the propagation. The corresponding argument to <b><tt>coupling</tt></b> is <b><tt>ddt</tt></b>. In this case, the matrix is taken as constant throughout each classical timestep.
<div class="p"><!----></div>
The third possibility is the use of the overlap matrix, requested with <b><tt>coupling overlaps</tt></b>. The overlap matrix is used subsequently in the Local Diabatization algorithm for the wavefunction propagation.
<div class="p"><!----></div>
<b>Correction to the Gradients&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The correct transformation of the gradients to the diagonal representation includes contributions from the non-adiabatic coupling vectors. Using <b><tt>gradcorrect true</tt></b>, these contributions are included. In this case  S<span style="font-size:x-small">HARC</span>&nbsp;will request the calculation of the non-adiabatic coupling vectors, even if they are not used in the wavefunction propagation. 
<div class="p"><!----></div>
<b>Frustrated Hops and Adjustment of the Kinetic Energy&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The keyword <b><tt>ekincorrect</tt></b> controls how the kinetic energy is adjusted after a surface hop to preserve total energy. <b><tt>ekincorrect none</tt></b> deactivates the adjustment, so that the total energy is not preserved after a hop. Using this option, jumps can never be frustrated and are always performed according to the hopping probabilities. 
Using <b><tt>ekincorrect parallel_vel</tt></b>, the kinetic energy is adjusted by simply rescaling the nuclear velocities so that the new kinetic energy is E<sub>tot</sub>&#8722;E<sub>pot</sub>. Jumps are frustrated if the new potential energy would exceed the total energy.
Finally, using <b><tt>ekincorrect parallel_nac</tt></b>, the kinetic energy is adjusted by rescaling the component of the nuclear velocities parallel to the non-adiabatic coupling vector between the old and new state. The hop is frustrated if there is not enough kinetic energy in this direction to conserve total energy. Note that <b><tt>ekincorrect parallel_nac</tt></b> implies the calculation of the non-adiabatic coupling vector, even if they are not used for the wavefunction propagation.
<div class="p"><!----></div>
<b>Selection of Gradients and Non-Adiabatic Couplings&nbsp;&nbsp;</b>
<div class="p"><!----></div>
 S<span style="font-size:x-small">HARC</span>&nbsp;allows to selectively calculate only certain gradients and non-adiabatic coupling vectors at each timestep. Those gradients and non-adiabatic coupling vectors not selected are not requested from the interfaces, thus decreasing the computational cost. The selection procedure is detailed in&nbsp;<a href="#met:selection">8.15</a>.
Selection of gradients is activated by <b><tt>grad_select</tt></b>, selection for non-adiabatic couplings by <b><tt>nac_select</tt></b>. Selection is turned off by default. 
<div class="p"><!----></div>
The selection procedure picks only states which are closer in energy to the classically occupied state than a given threshold. The threshold is 0.5&nbsp;eV by default and can be adjusted using the <b><tt>eselect</tt></b> keyword.
<div class="p"><!----></div>
By default, if  S<span style="font-size:x-small">HARC</span>&nbsp;performs such selection it will do two quantum chemistry calls per timestep. In the first call, all quantities are requested except for the ones to be selected. The energies are used to determine which gradients and NACs to calculate in a second quantum chemistry call. The keyword <b><tt>select_directly</tt></b> tells  S<span style="font-size:x-small">HARC</span>&nbsp;instead to use the energies of the last timestep, so that only one call per timestep is necessary.
<div class="p"><!----></div>
<b>Reference Energy&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The keyword <b><tt>ezero</tt></b> gives the energy shift for the diagonal elements of the Hamiltonian. The shift should be chosen so that the shifted diagonal elements are reasonably small (large diagonal elements in the Hamiltonian lead to rapidly changing coefficients, requiring extremely short subtimesteps). 
<div class="p"><!----></div>
Note that the energy shift default is 0, i.e.,  S<span style="font-size:x-small">HARC</span>&nbsp;does not choose an energy shift based on the energies at the first time step (this would lead to each trajectory having a different energy shift).
<div class="p"><!----></div>
<b>Scaling and Damping&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The scaling factor for the energies and gradients must be positive (not zero), see section&nbsp;<a href="#met:scaling">8.13</a>.
<div class="p"><!----></div>
The damping factor must be in the interval [0,1] (first, since the kinetic energy is always positive; second, because a damping factor larger than 1 would lead to exponentially growing kinetic energy). Also see section&nbsp;<a href="#met:damping">8.3</a>.
<div class="p"><!----></div>
<b>RNG Seed&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The RNG seed is used to initialize the random number generator, which provides the random numbers for the surface hopping procedure. For details how the seed is used internally, see section&nbsp;<a href="#met:seed">8.14</a>.
<div class="p"><!----></div>
<b>Decoherence&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The decoherence correction according to Granucci et al.&nbsp;<a href="#Granucci2010JCP" id="CITEGranucci2010JCP" class="tth_citation">[50</a>] can be applied to the diagonal coefficients by using the keyword <b><tt>decoherence</tt></b>. By default, no decoherence correction is applied. However, the keyword <b><tt>nodecoherence</tt></b> can be used to explicitly turn decoherence off. 
<div class="p"><!----></div>
The keyword <b><tt>decoherence_param</tt></b> can be used to change the parameter &#945; (see&nbsp;<a href="#met:decoherence">8.4</a>). The default is 0.1&nbsp;Hartree, which is the value recommended by Granucci et al.&nbsp;<a href="#Granucci2010JCP" class="tth_citeref">[50</a>].
<div class="p"><!----></div>
<b>Ionization&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The keyword <b><tt>ionization</tt></b> activates the on-the-fly calculation of ionization transition properties. If the keyword is given, by default these properties are calculated every timestep. The keyword <b><tt>ionization_step</tt></b> can be used to calculate these properties only every n-th timestep. 
If the keyword is given,  S<span style="font-size:x-small">HARC</span>&nbsp;will request the calculation of the ionization properties from the interface, which needs to be able to calculate them (currently only the  C<span style="font-size:x-small">OLUMBUS</span> interface allows to perform these calculations in combination with a program which computes the Dyson norms from  C<span style="font-size:x-small">OLUMBUS</span> output).
<div class="p"><!----></div>
<b>Phase Tracking&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Using the keywords <b><tt>track_phase</tt></b> and <b><tt>no_track_phase</tt></b>, the tracking of the eigenvector phases of the transformation matrix <b>U</b> 
can be switched on or off. However, it is usually not a good idea to deactivate the phase tracking, since this might lead to spurious behaviour in the wavefunction propagation and the surface hopping.
<div class="p"><!----></div>
<b>Dipole Moment Gradients&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The derivatives of the dipole moments can be included in the gradients. This can be activated with the keyword <b><tt>dipole_gradient</tt></b>. Currently, only the analytical interface can deliver these quantities.
<div class="p"><!----></div>
     <a id="tth_sEc4.1.4"></a><h3>
4.1.4&nbsp;&nbsp;Example</h3>
<div class="p"><!----></div>
The following input sample shows a typical input for excited-state dynamics including IC within a singlet manifold plus intersystem crossing to triplet states. It includes a large number of excited singlet states in order to calculate transient absorption spectra. Only the lowest three singlet states actually participate in the dynamics. 
<div class="p"><!----></div>
<pre>
nstates&nbsp;&nbsp;&nbsp;8&nbsp;0&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;many&nbsp;singlet&nbsp;states&nbsp;for&nbsp;transient&nbsp;absorption
actstates&nbsp;3&nbsp;0&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;only&nbsp;few&nbsp;states&nbsp;to&nbsp;reduce&nbsp;cost
stepsize&nbsp;0.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;typical&nbsp;timestep&nbsp;for&nbsp;a&nbsp;molecule&nbsp;containing&nbsp;H
tmax&nbsp;1000.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;one&nbsp;ps
surf&nbsp;sharc
state&nbsp;3&nbsp;mch&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;start&nbsp;on&nbsp;the&nbsp;S2&nbsp;singlet&nbsp;state
coeff&nbsp;auto&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;coefficient&nbsp;of&nbsp;S2&nbsp;will&nbsp;be&nbsp;set&nbsp;to&nbsp;one
coupling&nbsp;ddr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;\
decoherence&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;|&nbsp;typical&nbsp;settings
ekincorrect&nbsp;parallel_vel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;/
grad_select&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;\
nac_select&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;|&nbsp;improve&nbsp;performance
eselect&nbsp;0.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;/
veloc&nbsp;external&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;velocity&nbsp;comes&nbsp;from&nbsp;file&nbsp;"veloc"
velocfile&nbsp;"veloc"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#
RNGseed&nbsp;65435
ezero&nbsp;-399.41494751&nbsp;&nbsp;&nbsp;#&nbsp;ground&nbsp;state&nbsp;energy&nbsp;of&nbsp;molecule
&nbsp;&nbsp;
</pre>
<div class="p"><!----></div>
 <a id="tth_sEc4.2"></a><h2>
4.2&nbsp;&nbsp;Geometry file</h2><a id="sec:geomfile">
</a>
<div class="p"><!----></div>
The geometry file (default file name is <b><tt>geom</tt></b>) contains the initial coordinates of all atoms. This file must be present when starting a new trajectory.
<div class="p"><!----></div>
It uses the <a href="http://www.univie.ac.at/columbus/docs_COL70/documentation_main.html"> C<span style="font-size:x-small">OLUMBUS</span> geometry file format</a> (however, ). For each atom, the file contains one line, giving the chemical symbol (a string), the atomic number (a real number), the x, y and z coordinates of the atom in Bohrs (three real numbers), and the relative atomic weight of the atom (a real number). The six items must be separated by spaces. The real numbers are read in using Fortran list-directed I/O, and hence are free format (can have any numbers of decimals, exponential notation, etc.). Element symbols can have at most 2 characters.
<div class="p"><!----></div>
The following is an example of a <b><tt>geom</tt></b> file for CH2:
<pre>
C&nbsp;6.0&nbsp;&nbsp;0.0&nbsp;0.0&nbsp;&nbsp;0.0&nbsp;12.000
H&nbsp;1.0&nbsp;&nbsp;1.7&nbsp;0.0&nbsp;-1.2&nbsp;&nbsp;1.008
H&nbsp;1.0&nbsp;&nbsp;1.7&nbsp;0.0&nbsp;&nbsp;3.7&nbsp;&nbsp;1.008
&nbsp;&nbsp;
</pre>
<div class="p"><!----></div>
 <a id="tth_sEc4.3"></a><h2>
4.3&nbsp;&nbsp;Velocity file</h2><a id="sec:velocfile">
</a>
<div class="p"><!----></div>
The velocity file (default <b><tt>veloc</tt></b>) contains the initial nuclear velocities (e.g., from a Wigner distribution sampling). This file is optional (the velocities can be initialized with the <b><tt>veloc</tt></b> input keyword). 
<div class="p"><!----></div>
The file contains one line of input for each atom, where the order of atoms must be the same as in the <b><tt>geom</tt></b> file. Each line consists of three items, separated by spaces, where the first is the x component of the nuclear velocity, followed by the y and z components (three real numbers). The input is interpreted in atomic units (Bohr/atu).
<div class="p"><!----></div>
The following is an example of a <b><tt>veloc</tt></b> file:
<pre>
&nbsp;0.0001&nbsp;&nbsp;0.0000&nbsp;&nbsp;0.0002
-0.0002&nbsp;&nbsp;0.0000&nbsp;&nbsp;0.0012
-0.0003&nbsp;&nbsp;0.0000&nbsp;-0.0007
&nbsp;&nbsp;
</pre>
<div class="p"><!----></div>
 <a id="tth_sEc4.4"></a><h2>
4.4&nbsp;&nbsp;Coefficient file</h2><a id="sec:coefffile">
</a>
<div class="p"><!----></div>
The coefficient file contains the initial wavefunction coefficients. The file contains one line per state (total number of states, i.e., multiplets count multiple times). Each line specifies the initial coefficient of one state. If the initial state is specified in the MCH representation (input keyword <b><tt>state</tt></b>), then the order of the initial coefficients must be as given by the canonical ordering (see section&nbsp;<a href="#met:ordering">8.16</a>). If the initial state is given in diagonal representation, then the initial coefficients correspond to the states given in energetic ordering, starting with the lowest state.
Each line contains two real numbers, giving first the real and then the imaginary part of the initial coefficient of the respective state.
<div class="p"><!----></div>
Example:
<pre>
0.0&nbsp;0.0
1.0&nbsp;0.0
0.0&nbsp;0.0
&nbsp;&nbsp;
</pre>
<div class="p"><!----></div>
 <a id="tth_sEc4.5"></a><h2>
4.5&nbsp;&nbsp;Laser file</h2><a id="sec:laserfile">
</a>
<div class="p"><!----></div>
The laser file contains a table with the amplitude of the laser field &#1013;(t) at each timestep of the <i>electronic</i> propagation. Given a laser field of the general form:
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-0.png">
each line consists of 8 elements: t (in fs), &#8476;(&#1013;<sub>x</sub>(t)), &#8465;(&#1013;<sub>x</sub>(t)), &#8476;(&#1013;<sub>y</sub>(t)), &#8465;(&#1013;<sub>y</sub>(t)), &#8476;(&#1013;<sub>z</sub>(t)), &#8465;(&#1013;<sub>z</sub>(t)), (all in atomic units), and finally the instantaneous central frequency (also atomic units).
<div class="p"><!----></div>
The timestep in the laser file must exactly match the timestep used for the electronic propagation, which is the timestep used for the nuclear propagation (keyword <b><tt>stepsize</tt></b>) divided by the number of substeps (keyword <b><tt>nsubsteps</tt></b>). The first line of the laser file must correspond to t=0 fs.
<div class="p"><!----></div>
<pre>
0.00E+00&nbsp;-0.68E-03&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.31E+00
0.10E-02&nbsp;-0.77E-02&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.33E+00
0.20E-02&nbsp;-0.13E-01&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.35E+00
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...
</pre>
<div class="p"><!----></div>
 <a id="tth_chAp5"></a><h1>
Chapter 5 Output files</h1><a id="chap:output">
</a>
<div class="p"><!----></div>
This chapter documents the content of the output files of  S<span style="font-size:x-small">HARC</span>. Those output files are <b><tt>output.log</tt></b>, <b><tt>output.lis</tt></b>, <b><tt>output.dat</tt></b> and <b><tt>output.xyz</tt></b>.
<div class="p"><!----></div>
 <a id="tth_sEc5.1"></a><h2>
5.1&nbsp;&nbsp;Log file</h2><a id="sec:logfile">
</a>
<div class="p"><!----></div>
The log file <b><tt>output.log</tt></b> contains general information about all steps of the  S<span style="font-size:x-small">HARC</span>&nbsp;simulation, e.g., about the parsing of the input files, results of quantum chemistry calls, internal matrices and vectors, etc. The content of the log file can be controlled with the keyword <b><tt>printlevel</tt></b> in the  S<span style="font-size:x-small">HARC</span>&nbsp;main input file.
<div class="p"><!----></div>
In the following, all printlevels are explained.
<div class="p"><!----></div>
<b>Printlevel 0&nbsp;&nbsp;</b>
<div class="p"><!----></div>
At printlevel 0, only the execution infos (date, host and working directory at execution start) and build infos (compiler, compile date, building host and working directory) are given.
<div class="p"><!----></div>
<b>Printlevel 1&nbsp;&nbsp;</b>
<div class="p"><!----></div>
At printlevel 1, also the content of the input file (cleaned of comments and blank lines) is echoed in the log file. Also, the start of each timestep is given.
<div class="p"><!----></div>
<b>Printlevel 2&nbsp;&nbsp;</b>
<div class="p"><!----></div>
At printlevel 2, the log file also contains information about the parsing of the input files (echoing all enabled options, initial geometry, velocity and coefficients, etc.) and about the initialization of the coefficients after the first quantum chemistry calculation. This printlevel is recommended, since it is the highest printlevel where no output per timestep is written to the log file.
<div class="p"><!----></div>
<b>Printlevel 3&nbsp;&nbsp;</b>
<div class="p"><!----></div>
This and higher printlevels add output per timestep to the log file. At printlevel 3, the log file contains at each timestep the data from the velocity-Verlet algorithm (old and new acceleration, velocity and geometry), the old and new coefficients, the surface hopping probabilities and random number, the occupancies before and after decoherence correction as well as the kinetic, potential and total energies.
<div class="p"><!----></div>
<b>Printlevel 4&nbsp;&nbsp;</b>
<div class="p"><!----></div>
At printlevel 4, additionally the log file contains information on the quantum chemistry calls (file names, which quantities were read, gradient and non-adiabatic coupling vector selection) and the propagator matrix.
<div class="p"><!----></div>
<b>Printlevel 5&nbsp;&nbsp;</b>
<div class="p"><!----></div>
At printlevel 5, additionally the log file contains the results of each quantum chemistry calls (all matrices and vectors), all matrices involved in the propagation as well as the matrices involved in the gradient transformation. This is the highest printlevel currently implemented.
<div class="p"><!----></div>
 <a id="tth_sEc5.2"></a><h2>
5.2&nbsp;&nbsp;Listing file</h2><a id="sec:lisfile">
</a>
<div class="p"><!----></div>
The listing file <b><tt>output.lis</tt></b> is a tabular summary of the progress of the dynamics simulation. At the end of each timestep (including the initial timestep), one line with 11 elements is printed. These are, from left to right:
<ol type="1">
<li> current step (counting starts at zero for the initial step),
<div class="p"><!----></div>
</li>
<li> current simulation time (fs),
<div class="p"><!----></div>
</li>
<li> current state in the diagonal representation,
<div class="p"><!----></div>
</li>
<li> approximate corresponding MCH state (see subsection&nbsp;<a href="#ssec:state_transform">8.11.1</a>),
<div class="p"><!----></div>
</li>
<li> kinetic energy (eV),
<div class="p"><!----></div>
</li>
<li> potential energy (eV),
<div class="p"><!----></div>
</li>
<li> total energy (eV),
<div class="p"><!----></div>
</li>
<li> current gradient norm (in eV/&#197;),
<div class="p"><!----></div>
</li>
<li> current expectation values of the state dipole moment (Debye),
<div class="p"><!----></div>
</li>
<li> current expectation values of total spin,
<div class="p"><!----></div>
</li>
<li> wallclock time needed for the timestep.
<div class="p"><!----></div>
</li>
</ol>
The listing file also contains one extra line for each surface hopping event. For accepted hops, the old and new states (in diagonal representation) and the random number are given. Frustrated hops and resonant hops are also mentioned. Note that the extra line for surface hopping occurs before the regular line for the timestep. 
<div class="p"><!----></div>
The listing file can be plotted with standard tools like  G<span style="font-size:x-small">NUPLOT</span>. 
<div class="p"><!----></div>
<b>Energies&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The kinetic energy is calculated at the end of each time step (i.e., after surface hopping events and the corresponding adjustments). The potential energy is the energy of the currently active diagonal state. The total energy is the sum of those two.
<div class="p"><!----></div>
<b>Expectation values&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The gradient norms given in the listing file is calculated as follows:
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-1.png">
which is then transformed to eV/&#197;.
<div class="p"><!----></div>
The expectation values of the dipole moment for the active state &#946; is calculated from:
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-2.png">
<div class="p"><!----></div>
The expectation value of the total spin of the active state &#946; is calculated as follows:
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-3.png">
where S<sub>&#945;</sub> is the total spin of the MCH state with index &#945;.
<div class="p"><!----></div>
 <a id="tth_sEc5.3"></a><h2>
5.3&nbsp;&nbsp;Data file</h2><a id="sec:datfile">
</a>
<div class="p"><!----></div>
The data file <b><tt>output.dat</tt></b> contains all relevant data from the simulation for all timesteps, in ASCII format. Accordingly, this file can become quite large for long trajectories or if many states are included, but for most file systems it is easier to deal with a single large file than with many small files.
<div class="p"><!----></div>
Usually, after the simulation is finished the data file is processed by <b><tt>data_extractor.x</tt></b> to obtain a number of tabular files which can be plotted. For this, see sections&nbsp;<a href="#sec:diagonalizer.x">7.13</a> for the data extractor and&nbsp;<a href="#sec:make_gnuscript.py">7.9</a> for plotting.
<div class="p"><!----></div>
     <a id="tth_sEc5.3.1"></a><h3>
5.3.1&nbsp;&nbsp;Specification of the data file</h3>
<div class="p"><!----></div>
The data file contains a short header followed by the data per timestep. All quantities are commented in the data file.
<div class="p"><!----></div>
The header contains:
<ol type="1">
<li> maximum multiplicity,
<div class="p"><!----></div>
</li>
<li> number of states per multiplicity,
<div class="p"><!----></div>
</li>
<li> number of atoms,
<div class="p"><!----></div>
</li>
<li> timestep,
<div class="p"><!----></div>
</li>
<li> energy shift,
<div class="p"><!----></div>
</li>
<li> flag (overlap matrices),
<div class="p"><!----></div>
</li>
<li> flag (laser field),
<div class="p"><!----></div>
</li>
<li> number of steps,
<div class="p"><!----></div>
</li>
<li> number of substeps,
<div class="p"><!----></div>
</li>
<li> full laser field for all substeps (only if flag is set).
<div class="p"><!----></div>
</li>
</ol>
<div class="p"><!----></div>
The entry for each timestep contains:
<ol type="1">
<li> step index
<div class="p"><!----></div>
</li>
<li> Hamiltonian in MCH representation,
<div class="p"><!----></div>
</li>
<li> transformation matrix <b>U</b>,
<div class="p"><!----></div>
</li>
<li> MCH dipole moment matrices (x, y, z),
<div class="p"><!----></div>
</li>
<li> overlap matrix in MCH representation (only if flag is set),
<div class="p"><!----></div>
</li>
<li> coefficients in the diagonal representation,
<div class="p"><!----></div>
</li>
<li> hopping probablities in the diagonal representation
<div class="p"><!----></div>
</li>
<li> kinetic energy,
<div class="p"><!----></div>
</li>
<li> currently active state in diagonal representation and approximate state in MCH representation,
<div class="p"><!----></div>
</li>
<li> random number for surface hopping,
<div class="p"><!----></div>
</li>
<li> wallclock time (in seconds)
<div class="p"><!----></div>
</li>
<li> geometry (Bohrs),
<div class="p"><!----></div>
</li>
<li> velocities (atomic units),
<div class="p"><!----></div>
</li>
<li> property matrix.
<div class="p"><!----></div>
</li>
</ol>
<div class="p"><!----></div>
 <a id="tth_sEc5.4"></a><h2>
5.4&nbsp;&nbsp;XYZ file</h2><a id="sec:xyzfile">
</a>
<div class="p"><!----></div>
The file <b><tt>output.xyz</tt></b> contains the geometries of all timesteps in standard xyz file format. It can be used with visualization programs like  M<span style="font-size:x-small">OLDEN</span>,  G<span style="font-size:x-small">ABEDIT</span> or  M<span style="font-size:x-small">OLEKEL</span> to create movies of the molecular motion, or with <b><tt>geo.py</tt></b> (see&nbsp;<a href="#sec:geo.py">7.12</a>) to calculate internal coordinates for each timestep.
<div class="p"><!----></div>
The comments of the geometries (given in the second line of each geometry block) contain information about the simulation time and the active state (first in diagonal basis, then in MCH basis).
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_chAp6"></a><h1>
Chapter 6 Interfaces</h1><a id="chap:interfaces">
</a>
<div class="p"><!----></div>
This chapter describes the interface between  S<span style="font-size:x-small">HARC</span>&nbsp;and quantum chemistry programs. In the first section, the interface is specified (e.g., for users who attempt to create their own interfaces). The description of the currently existing interfaces takes the remainder of this chapter.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc6.1"></a><h2>
6.1&nbsp;&nbsp;Interface Specifications</h2>
<div class="p"><!----></div>
From the  S<span style="font-size:x-small">HARC</span>&nbsp;point of view, quantum chemical calculation proceeds as follows in the <b><tt>QM</tt></b> directory:
<ol type="1">
<li> write a file called <b><tt>QM/QM.in</tt></b>
<div class="p"><!----></div>
</li>
<li> call a script called <b><tt>QM/runQM.sh</tt></b>
<div class="p"><!----></div>
</li>
<li> read the output from a file called <b><tt>QM/QM.out</tt></b>
<div class="p"><!----></div>
</li>
</ol>
For specifications of the formats of these two files (<b><tt>QM.in</tt></b> and <b><tt>QM.out</tt></b>) see below. The executable script <b><tt>QM/runQM.sh</tt></b> must accomplish that all necessary quantum chemical output is available in <b><tt>QM/QM.out</tt></b>.
<div class="p"><!----></div>
     <a id="tth_sEc6.1.1"></a><h3>
6.1.1&nbsp;&nbsp;<b><tt>QM.in</tt></b> Specification</h3><a id="intf:qmin">
</a>
<div class="p"><!----></div>
The <b><tt>QM.in</tt></b> file is written by  S<span style="font-size:x-small">HARC</span>&nbsp;every time a quantum chemistry calculation is necessary. It contains all information available to  S<span style="font-size:x-small">HARC</span>. This information includes the current geometry (and velocity), the timestep, the number of states, the timestep and the unit used to specify the atomic coordinates. The file also contains <i>control</i> keywords and <i>request</i> keywords. 
<div class="p"><!----></div>
The file format is consistent with a standard xyz file. The first line contains the number of atoms, the second line is a comment.  S<span style="font-size:x-small">HARC</span>&nbsp;writes the trajectory ID (a hash of all  S<span style="font-size:x-small">HARC</span>&nbsp;input files) to this line. The following lines specify the atom positions. As a fourth, fifth and sixth column, these lines may contain the atomic velocities.
All following lines contain keywords, one per line and possibly with arguments. Comments can be inserted with '#', and empty lines are permissible. Comments and empty lines are only permissible below the xyz file part.
An examplary <b><tt>QM.in</tt></b> file is given in the following:
<pre>
3
Jobname
S&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;&nbsp;0.000&nbsp;&nbsp;-0.020&nbsp;&nbsp;&nbsp;0.002
H&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.2&nbsp;&nbsp;&nbsp;&nbsp;0.000&nbsp;&nbsp;-0.030&nbsp;&nbsp;&nbsp;0.000
H&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;&nbsp;-0.9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.2&nbsp;&nbsp;&nbsp;&nbsp;0.000&nbsp;&nbsp;&nbsp;0.010&nbsp;&nbsp;-0.000
#&nbsp;This&nbsp;is&nbsp;a&nbsp;comment
Init
States&nbsp;3&nbsp;0&nbsp;2
Unit&nbsp;Angstrom
SOC
DM
GRAD&nbsp;1&nbsp;2
OVERLAP
NACDR&nbsp;select
&nbsp;&nbsp;1&nbsp;2
&nbsp;&nbsp;end
&nbsp;&nbsp;
</pre>
<div class="p"><!----></div>
There exist two types of keywords, <i>control</i> keywords and <i>request</i> keywords. Control keywords pass some information to the interface. Request keywords tell the interface to provide a quantity in the <b><tt>QM.out</tt></b> file. Table&nbsp;<a href="#tab:int_ctrl"> 6.1</a> contains all control keywords while table&nbsp;<a href="#tab:int_req"> 6.2</a> lists all request keywords.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb6.1">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 6.1: Control keywords for  S<span style="font-size:x-small">HARC</span>&nbsp;interfaces. These keywords pass information from  S<span style="font-size:x-small">HARC</span>&nbsp;to the interface.</div>
  <a id="tab:int_ctrl">
</a>
<table>
<tr><td align="left">
  Keyword       </td><td width="474">Description</td></tr>
<tr><td align="left">
  init            </td><td width="474">Specifies that this is the first calculation. The interface should create a save directory to save all information necessary for a restart. </td></tr>
<tr><td align="left">samestep        </td><td width="474">Specifies that this is an additional calculation at the same geometry/timestep. </td></tr>
<tr><td align="left">cleanup         </td><td width="474">Specifies that all output files of the interface (except <b><tt>QM.out</tt></b>) should be deleted (including the save directory).</td></tr>
<tr><td align="left">unit            </td><td width="474">Specifies in which unit the atomic coordinates are to be interpreted. Possible arguments are "angstrom" and "bohr".</td></tr>
<tr><td align="left">states          </td><td width="474">Gives the number of excited states per multiplicity (singlets, doublet, triplets, ...).</td></tr>
<tr><td align="left">dt              </td><td width="474">Gives the time between the last calculation and the current calculation in atomic units.</td></tr>
<tr><td align="left">savedir         </td><td width="474">Gives a path to the directory where the interface should save files needed for restart and between timesteps. If the interface-specific input files also have this keyword,  S<span style="font-size:x-small">HARC</span>&nbsp;assumes that the path in <b><tt>QM.in</tt></b> takes precedence.</td></tr>
<tr><td align="left">
  </td></tr></table>
</div>
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb6.2">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 6.2: Request keywords for  S<span style="font-size:x-small">HARC</span>&nbsp;interfaces.</div>
  <a id="tab:int_req">
</a>
<table>
<tr><td align="left">
  Keyword       </td><td width="474">Description</td></tr>
<tr><td align="left">
  H               </td><td width="474">Calculate the molecular Hamiltonian (diagonal matrix with the energies of the states of the model space).</td></tr>
<tr><td align="left">SOC             </td><td width="474">Calculate the molecular Hamiltonian including the SOCs (not diagonal anymore within the model space).</td></tr>
<tr><td align="left">DM              </td><td width="474">Calculate the state dipole moments and transition dipole moments between all states.</td></tr>
<tr><td align="left">ION             </td><td width="474">Calculate transition properties between neutral and ionic wavefunctions.</td></tr>
<tr><td align="left">GRAD            </td><td width="474">Calculate gradients for all states. If followed by a list of states, calculate only gradients for the specified states.</td></tr>
<tr><td align="left">NACDT           </td><td width="474">Calculate the time-derivatives &#9001;&#936;<sub>1</sub>&#124;&#8706;/&#8706;t&#124;&#936;<sub>2</sub>&#9002; by finite differences between the last timestep and the current timestep</td></tr>
<tr><td align="left">NACDR           </td><td width="474">Calculate non-adiabatic coupling vectors &#9001;&#936;<sub>1</sub>&#124;&#8706;/&#8706;<b>R</b>&#124;&#936;<sub>2</sub>&#9002; between all pairs of states. If followed by "select", read the list of pairs on the following lines until "end" and calculate non-adiabatic coupling vectors between the specified pairs of states.</td></tr>
<tr><td align="left">OVERLAP         </td><td width="474">Calculate overlaps &#9001;&#936;<sub>1</sub>(t<sub>0</sub>)&#124;&#936;<sub>2</sub>(t)&#9002; between all pairs of states (between the last and current timestep). If followed by "select", read the list of pairs on the following lines until "end" and calculate overlaps between the specified pairs of states.</td></tr>
<tr><td align="left">DMDR            </td><td width="474">Calculate the cartesian gradients of the dipole moments and transition dipole moments of all states.</td></tr>
<tr><td align="left">
  </td></tr></table>
</div>
<div class="p"><!----></div>
     <a id="tth_sEc6.1.2"></a><h3>
6.1.2&nbsp;&nbsp;<b><tt>QM.out</tt></b> Specification</h3><a id="intf:qmout">
</a>
<div class="p"><!----></div>
The <b><tt>QM.out</tt></b> file communicates back the results of the quantum chemistry calculation to the dynamics code. After  S<span style="font-size:x-small">HARC</span>&nbsp;called <b><tt>QM/runQM.sh</tt></b>, it expects that the file <b><tt>QM/QM.out</tt></b> exists and contains the relevant data.
<div class="p"><!----></div>
The following quantities are expected in the file (depending whether the corresponding keyword is in the <b><tt>QM.in</tt></b> file): Hamiltonian matrix, dipole matrices, gradients, non-adiabatic couplings (either NACDR or NACDT), overlaps, wavefunction phases, property matrices. The format of <b><tt>QM.out</tt></b> is described in the following. 
<div class="p"><!----></div>
Each quantity is given as a data block, which has a fixed format. The order of the blocks is arbitrary, and between blocks arbitrary lines can be written. However, within a block no extraneous lines are allowed. Each data block starts with a exclamation mark <b><tt>!</tt></b>, followed by whitespace and an integer flag which specifies the type of data:
<div class="p"><!----></div>
<table>
<tr><td align="left">1       </td><td align="left">Hamiltonian matrix</td></tr>
<tr><td align="left">2       </td><td align="left">Dipole matrices</td></tr>
<tr><td align="left">3       </td><td align="left">Gradients</td></tr>
<tr><td align="left">4       </td><td align="left">Non-adiabatic couplings (NACDT)</td></tr>
<tr><td align="left">5       </td><td align="left">Non-adiabatic couplings (NACDR)</td></tr>
<tr><td align="left">6       </td><td align="left">Overlap matrix</td></tr>
<tr><td align="left">7       </td><td align="left">Wavefunction phases(optional)</td></tr>
<tr><td align="left">8       </td><td align="left">Wallclock time for QM calculation (optional)</td></tr>
<tr><td align="left">11      </td><td align="left">Property matrix (e.g. ionization probabilities)</td></tr>
<tr><td align="left">12      </td><td align="left">Dipole moment gradients</td></tr></table>
<div class="p"><!----></div>
On the next line, two integers are expected giving the dimensions of the following matrix. Note, that all these matrices must be square matrices. On the following lines, the matrix or vector follows. Matrices are in general complex, and real and imaginary part of each element is given as a pair of floating point numbers.
<div class="p"><!----></div>
The following shows an example of a 4&times;4 Hamiltonian matrix. Note that the imaginary parts directly follow the real parts (in this example, the Hamiltonian is real).
<pre>
&nbsp;&nbsp;!&nbsp;1
&nbsp;&nbsp;4&nbsp;4
&nbsp;-548.6488&nbsp;0.0000&nbsp;&nbsp;&nbsp;&nbsp;0.0000&nbsp;0.0000&nbsp;&nbsp;&nbsp;&nbsp;0.0003&nbsp;0.0000&nbsp;&nbsp;&nbsp;&nbsp;0.0003&nbsp;0.0000
&nbsp;&nbsp;&nbsp;&nbsp;0.0000&nbsp;0.0000&nbsp;-548.6170&nbsp;0.0000&nbsp;&nbsp;&nbsp;&nbsp;0.0003&nbsp;0.0000&nbsp;&nbsp;&nbsp;&nbsp;0.0003&nbsp;0.0000
&nbsp;&nbsp;&nbsp;&nbsp;0.0003&nbsp;0.0000&nbsp;&nbsp;&nbsp;&nbsp;0.0003&nbsp;0.0000&nbsp;-548.5986&nbsp;0.0000&nbsp;&nbsp;&nbsp;&nbsp;0.0000&nbsp;0.0000
&nbsp;&nbsp;&nbsp;&nbsp;0.0003&nbsp;0.0000&nbsp;&nbsp;&nbsp;&nbsp;0.0003&nbsp;0.0000&nbsp;&nbsp;&nbsp;&nbsp;0.0000&nbsp;0.0000&nbsp;-548.5912&nbsp;0.0000
&nbsp;&nbsp;
</pre>
<div class="p"><!----></div>
The three dipole moment matrices (x, y and z polarization) must follow directly after each other, where the dimension specifier must be present for each matrix. The dipole matrices are also expected to be complex-valued.
<pre>
&nbsp;&nbsp;!&nbsp;2
&nbsp;&nbsp;2&nbsp;2
&nbsp;&nbsp;0.1320&nbsp;0.0000&nbsp;-0.0020&nbsp;0.0000
&nbsp;-0.0020&nbsp;0.0000&nbsp;-1.1412&nbsp;0.0000
&nbsp;&nbsp;2&nbsp;2
&nbsp;&nbsp;0.0000&nbsp;0.0000&nbsp;&nbsp;0.0000&nbsp;0.0000
&nbsp;&nbsp;0.0000&nbsp;0.0000&nbsp;&nbsp;0.0000&nbsp;0.0000
&nbsp;&nbsp;2&nbsp;2
&nbsp;&nbsp;2.1828&nbsp;0.0000&nbsp;&nbsp;0.0000&nbsp;0.0000
&nbsp;&nbsp;0.0000&nbsp;0.0000&nbsp;&nbsp;0.6422&nbsp;0.0000
&nbsp;&nbsp;
</pre>
<div class="p"><!----></div>
Gradient and non-adiabatic couplings vectors are written as 3&times;n<sub>atom</sub> matrices, with the x, y and z components of one atom per line. These vectors are expected to be real valued. Each vector is preceeded by its dimensions.
<pre>
6&nbsp;3&nbsp;
&nbsp;0.0000&nbsp;-6.5429&nbsp;-8.1187
&nbsp;0.0000&nbsp;&nbsp;5.8586&nbsp;&nbsp;8.0160
&nbsp;0.0000&nbsp;&nbsp;6.8428&nbsp;&nbsp;1.0265
&nbsp;0.0000&nbsp;&nbsp;6.5429&nbsp;&nbsp;8.1187
&nbsp;0.0000&nbsp;-5.8586&nbsp;-8.0160
&nbsp;0.0000&nbsp;-6.8428&nbsp;-1.0265
&nbsp;&nbsp;
</pre>
If gradients are requested,  S<span style="font-size:x-small">HARC</span>&nbsp;expects every gradient to be present, even if only some gradients are requested. The gradients are expected in the canonical ordering (see section&nbsp;<a href="#met:ordering">8.16</a>), which implies that for higher multiplets the same gradient has to be present several times. For example, with 3 singlets and 3 triplets,  S<span style="font-size:x-small">HARC</span>&nbsp;expects 12 gradients in the <b><tt>QM.out</tt></b> file (each triplet has three components with M<sub>s</sub>= -1, 0 or 1).
<div class="p"><!----></div>
Similarly, for non-adiabatic coupling vectors,  S<span style="font-size:x-small">HARC</span>&nbsp;expects all pairs, even between states of different multiplicity. The vectors are also in canonical ordering, where the inner loop goes over the ket states. For example, with 3 singlets and 3 triplets (12 states),  S<span style="font-size:x-small">HARC</span>&nbsp;expects 144 (12<sup>2</sup>) non-adiabatic coupling vectors in the <b><tt>QM.out</tt></b> file.
<pre>
!&nbsp;5&nbsp;Non-adiabatic&nbsp;couplings&nbsp;(ddr)&nbsp;(2x2x1x3,&nbsp;real)
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;1&nbsp;ms1&nbsp;0&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;1&nbsp;ms2&nbsp;0
&nbsp;0.0e+0&nbsp;&nbsp;0.0e+0&nbsp;&nbsp;0.0e+0&nbsp;
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;1&nbsp;ms1&nbsp;0&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;2&nbsp;ms2&nbsp;0
+2.0e+0&nbsp;&nbsp;0.0e+0&nbsp;&nbsp;0.0e+0&nbsp;
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;2&nbsp;ms1&nbsp;0&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;1&nbsp;ms2&nbsp;0
-2.0e+0&nbsp;&nbsp;0.0e+0&nbsp;&nbsp;0.0e+0&nbsp;
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;2&nbsp;ms1&nbsp;0&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;2&nbsp;ms2&nbsp;0
&nbsp;0.0e+0&nbsp;&nbsp;0.0e+0&nbsp;&nbsp;0.0e+0&nbsp;
&nbsp;&nbsp;
</pre>
<div class="p"><!----></div>
The non-adiabatic coupling matrix (NACDT keyword), the overlap matrix and the property matrix are single n&times;n matrices (n is the total number of states), respectively, like the Hamiltonian. 
<div class="p"><!----></div>
The wavefunction phases are a vector of complex numbers.
<div class="p"><!----></div>
The wallclock time is a single real number. 
<div class="p"><!----></div>
The dipole moment gradients are a list of 3&times;n<sub>atom</sub> vectors, each specifying the gradient of one polarization of one dipole moment matrix element. In the outmost loop, the bra index is counted, then the ket index, then the polarization. Hence, the respective entry in <b><tt>QM.out</tt></b> would look like (for 2 states and 1 atom):
<pre>
!&nbsp;12&nbsp;Dipole&nbsp;moment&nbsp;derivatives&nbsp;(2x2x3x1x3,&nbsp;real)
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;1&nbsp;ms1&nbsp;0&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;1&nbsp;ms2&nbsp;0&nbsp;&nbsp;&nbsp;pol&nbsp;0
&nbsp;0.000000000000E+000&nbsp;&nbsp;0.000000000000E+000&nbsp;&nbsp;0.000000000000E+000&nbsp;
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;1&nbsp;ms1&nbsp;0&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;1&nbsp;ms2&nbsp;0&nbsp;&nbsp;&nbsp;pol&nbsp;1
&nbsp;0.000000000000E+000&nbsp;&nbsp;0.000000000000E+000&nbsp;&nbsp;0.000000000000E+000&nbsp;
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;1&nbsp;ms1&nbsp;0&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;1&nbsp;ms2&nbsp;0&nbsp;&nbsp;&nbsp;pol&nbsp;2
&nbsp;0.000000000000E+000&nbsp;&nbsp;0.000000000000E+000&nbsp;&nbsp;0.000000000000E+000&nbsp;
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;1&nbsp;ms1&nbsp;0&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;2&nbsp;ms2&nbsp;0&nbsp;&nbsp;&nbsp;pol&nbsp;0
&nbsp;1.000000000000E+000&nbsp;&nbsp;0.000000000000E+000&nbsp;&nbsp;0.000000000000E+000&nbsp;
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;1&nbsp;ms1&nbsp;0&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;2&nbsp;ms2&nbsp;0&nbsp;&nbsp;&nbsp;pol&nbsp;1
&nbsp;0.000000000000E+000&nbsp;&nbsp;0.000000000000E+000&nbsp;&nbsp;0.000000000000E+000&nbsp;
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;1&nbsp;ms1&nbsp;0&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;2&nbsp;ms2&nbsp;0&nbsp;&nbsp;&nbsp;pol&nbsp;2
&nbsp;0.000000000000E+000&nbsp;&nbsp;0.000000000000E+000&nbsp;&nbsp;0.000000000000E+000&nbsp;
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;2&nbsp;ms1&nbsp;0&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;1&nbsp;ms2&nbsp;0&nbsp;&nbsp;&nbsp;pol&nbsp;0
&nbsp;1.000000000000E+000&nbsp;&nbsp;0.000000000000E+000&nbsp;&nbsp;0.000000000000E+000&nbsp;
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;2&nbsp;ms1&nbsp;0&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;1&nbsp;ms2&nbsp;0&nbsp;&nbsp;&nbsp;pol&nbsp;1
&nbsp;0.000000000000E+000&nbsp;&nbsp;0.000000000000E+000&nbsp;&nbsp;0.000000000000E+000&nbsp;
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;2&nbsp;ms1&nbsp;0&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;1&nbsp;ms2&nbsp;0&nbsp;&nbsp;&nbsp;pol&nbsp;2
&nbsp;0.000000000000E+000&nbsp;&nbsp;0.000000000000E+000&nbsp;&nbsp;0.000000000000E+000&nbsp;
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;2&nbsp;ms1&nbsp;0&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;2&nbsp;ms2&nbsp;0&nbsp;&nbsp;&nbsp;pol&nbsp;0
&nbsp;0.000000000000E+000&nbsp;&nbsp;0.000000000000E+000&nbsp;&nbsp;0.000000000000E+000&nbsp;
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;2&nbsp;ms1&nbsp;0&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;2&nbsp;ms2&nbsp;0&nbsp;&nbsp;&nbsp;pol&nbsp;1
&nbsp;0.000000000000E+000&nbsp;&nbsp;0.000000000000E+000&nbsp;&nbsp;0.000000000000E+000&nbsp;
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;2&nbsp;ms1&nbsp;0&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;2&nbsp;ms2&nbsp;0&nbsp;&nbsp;&nbsp;pol&nbsp;2
&nbsp;0.000000000000E+000&nbsp;&nbsp;0.000000000000E+000&nbsp;&nbsp;0.000000000000E+000&nbsp;
&nbsp;&nbsp;
</pre>
<div class="p"><!----></div>
     <a id="tth_sEc6.1.3"></a><h3>
6.1.3&nbsp;&nbsp;Further Specifications</h3>
<div class="p"><!----></div>
The interfaces may require additional input files beyond <b><tt>QM.in</tt></b>, which contain static information. This may include paths to the executable quantum chemistry program, paths to scratch directories or input templates for the quantum chemistry calculation (e.g.&nbsp;active space specifications, basis sets, etc.).
The dynamics code does not depend on these additional files.
<div class="p"><!----></div>
     <a id="tth_sEc6.1.4"></a><h3>
6.1.4&nbsp;&nbsp;Save Directory Specification</h3>
<div class="p"><!----></div>
The interfaces must be able to save all information necessary for restart to a given directory. The absolute path is written to <b><tt>QM.in</tt></b> by  S<span style="font-size:x-small">HARC</span>. Hence, for the trajectories the path to the save directory is always a subdirectory of the working directory of  S<span style="font-size:x-small">HARC</span>.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc6.2"></a><h2>
6.2&nbsp;&nbsp;MOLPRO Interface</h2><a id="sec:int:molpro">
</a>
<div class="p"><!----></div>
The  S<span style="font-size:x-small">HARC</span>- M<span style="font-size:x-small">OLPRO</span> interface allows to run  S<span style="font-size:x-small">HARC</span>&nbsp;dynamics with  M<span style="font-size:x-small">OLPRO</span>'s CASSCF wavefunctions. RASSCF is not supported, since on RASSCF level state-averaging over different multiplicities is not possible. The interface uses  M<span style="font-size:x-small">OLPRO</span>'s CI program in order to calculate transition dipole moments and spin-orbit couplings. Gradients and non-adiabatic coupling vectors are calculated using  M<span style="font-size:x-small">OLPRO</span>'s CADPACK code (hence no generally contracted basis sets can be used). Time derivatives and overlaps are obtained with the DDR prodecure. Hence, all types of couplings usable by  S<span style="font-size:x-small">HARC</span>&nbsp;are available through this interface. The interface also allows to calculate the expectation value of the angular momentum operators.
<div class="p"><!----></div>
The  S<span style="font-size:x-small">HARC</span>- M<span style="font-size:x-small">OLPRO</span> interface needs two additional input files, which should be present in <b><tt>QM/</tt></b>. Those input files are <b><tt>SH2PRO.inp</tt></b>, which contains the paths to  M<span style="font-size:x-small">OLPRO</span> and the scratch directory, and <b><tt>MOLPRO.template</tt></b>, which is a minimal input from which the full input can be built. If <b><tt>QM/wf.init</tt></b> is present, it will be used as a  M<span style="font-size:x-small">OLPRO</span> wavefunction file containing the initial MOs.
<div class="p"><!----></div>
     <a id="tth_sEc6.2.1"></a><h3>
6.2.1&nbsp;&nbsp;Interface specific input file: <b><tt>SH2PRO.inp</tt></b></h3>
<div class="p"><!----></div>
The interface requires some additional information beyond the content of <b><tt>QM.in</tt></b>. This information is given in the file <b><tt>SH2PRO.inp</tt></b>, which must reside in the directory where the interface is started. This file uses a simple "<b><tt>keyword argument</tt></b>" syntax. Comments using # and blank lines are possible, the order of keywords is arbitrary. Lines with unknown keywords are ignored, since the interface just searches the file for certain keywords.
<div class="p"><!----></div>
Table&nbsp;<a href="#tab:molpro_sh2"> 6.3</a> lists the existing keywords.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb6.3">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 6.3: Keywords for the <b><tt>SH2PRO.inp</tt></b> file.</div>
  <a id="tab:molpro_sh2">
</a>
<table>
<tr><td align="left">
  Keyword       </td><td width="474">Description</td></tr>
<tr><td align="left">
  molpro          </td><td width="474">Is followed by a string giving the path to the  M<span style="font-size:x-small">OLPRO</span> executable. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used.</td></tr>
<tr><td align="left">scratchdir      </td><td width="474">Is a path to the temporary directory. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. If the directory does not exist, the interface will create it. In any case, the interface will delete this directory after the calculation.</td></tr>
<tr><td align="left">gradaccudefault </td><td width="474">(float) Default accuracy for CP-MCSCF.</td></tr>
<tr><td align="left">gradaccumax     </td><td width="474">(float) Worst acceptable accuracy for CP-MCSCF (see below).</td></tr>
<tr><td align="left">checknacs       </td><td width="474">(boolean) Use the MRCI overlaps to check whether the time derivatives and overlap matrices are correct.</td></tr>
<tr><td align="left">correctnacs     </td><td width="474">(boolean) Replace bad time derivatives with the scalar product of non-adiabatic coupling vectors and velocities.</td></tr>
<tr><td align="left">checknacs_mrcio </td><td width="474">(float) Threshold for the MRCI overlaps to be considered bad.</td></tr>
<tr><td align="left">checknacs_ediff </td><td width="474">(float, eV) If MRCI overlaps indicate inaccurate couplings, set to zero couplings between states which are farther apart than this value.</td></tr>
<tr><td align="left">
  </td></tr></table>
</div>
<div class="p"><!----></div>
Note that only the first two keywords are mandatory. The last four keywords are only used for calculations with time derivatives or overlaps. The checking and correction of these couplings has to be considered experimental. Normally, <b><tt>checknacs</tt></b> should be "False" (in this case the other three keywords are not necessary).
<div class="p"><!----></div>
     <a id="tth_sEc6.2.2"></a><h3>
6.2.2&nbsp;&nbsp;Template file: <b><tt>MOLPRO.template</tt></b></h3>
<div class="p"><!----></div>
The template file is a  M<span style="font-size:x-small">OLPRO</span> input file specifying a state-averaged CASSCF calculation. There must not be any <b><tt>file</tt></b> specifications and no geometry input in this file. It should contain memory specifications, basis set, and optionally settings like Douglas-Kroll.
<div class="p"><!----></div>
Most importantly, it has to contain a CASSCF input block with the number of frozen, closed-shell and occupied orbitals. Additionally, all wavefunctions for the state-averaging have to be defined. For each multiplicity, the <b><tt>wf</tt></b>, <b><tt>state</tt></b> and <b><tt>weight</tt></b> keywords must be present. The following shows an example input for CASSCF(12,9) with 4 singlets and 3 triplets in the state-averaging.
<pre>
***,Example
memory,100,M
dkroll=1
dkho=2
basis=6-31G*
{casscf
frozen,0
closed,23
occ,32
wf,58,1,0
state,4
weight,1,1,1,1
wf,58,1,2
state,3
weight,1,1,1
};
&nbsp;&nbsp;
</pre>
<div class="p"><!----></div>
     <a id="tth_sEc6.2.3"></a><h3>
6.2.3&nbsp;&nbsp;Error checking</h3>
<div class="p"><!----></div>
The interface is written such that the output of  M<span style="font-size:x-small">OLPRO</span> is checked for commonly occuring errors, mostly bad convergence in the MCSCF or CP-MCSCF parts. In these cases, the input is adjusted and  M<span style="font-size:x-small">OLPRO</span> restarted. This will be done until all calculations are finished or an unrecoverable error is detected.
The interface will try to solve the following error messages:
<div class="p"><!----></div>
<b>EXCESSIVE GRADIENT IN CI&nbsp;&nbsp;</b> This error message can occur in the MCSCF part. The calculation is restarted with a P-space threshold (see  M<span style="font-size:x-small">OLPRO</span> manual) of 1. If the error remains, the threshold is quadrupled until the calculation converges or the threshold is above 100.
<div class="p"><!----></div>
<b>NO CONVERGENCE IN REFERENCE CI&nbsp;&nbsp;</b> The error occurs in the CI part. The calculation is restarted with a P-space threshold (see  M<span style="font-size:x-small">OLPRO</span> manual) of 1. If the error remains, the threshold is quadrupled until the calculation converges or the threshold is above 100.
<div class="p"><!----></div>
<b>NO CONVERGENCE OF CP-MCSCF&nbsp;&nbsp;</b> This error occurs when solving the linear equations needed for the calculation of MCSCF gradients or non-adiabatic coupling vectors. In this case, the interface finds in the output the value of closest convergence and restarts the calculation with the value found as the new convergence criterion. This ensures that the CP-MCSCF calculation converges, albeit with lower accuracy for this gradient for this timestep.
<div class="p"><!----></div>
This error check is controlled by two keywords in the <b><tt>SH2PRO.inp</tt></b> file. The interface first tries to converge the CP-MCSCF calculation to <b><tt>gradaccudefault</tt></b>. If this fails, it tries to converge to the best value possible within 900 iterations. <b><tt>gradaccumax</tt></b> defines the worst accuracy accepted by the interface. If a CP-MCSCF calculation cannot be converged below <b><tt>gradaccumax</tt></b> then the interface exits with an error, leading to the abortion of the trajectory.
<div class="p"><!----></div>
     <a id="tth_sEc6.2.4"></a><h3>
6.2.4&nbsp;&nbsp;Things to keep in mind</h3>
<div class="p"><!----></div>
<b>Initial orbital guess&nbsp;&nbsp;</b>
<div class="p"><!----></div>
For CASSCF calculations it is always a good idea to start from converged MOs from a nearby geometry. For the first timestep, if a file <b><tt>QM/wf.init</tt></b> is present, the  S<span style="font-size:x-small">HARC</span>- M<span style="font-size:x-small">OLPRO</span> interface will take this file for the starting orbitals. In subsequent calculations, the MOs from the previous step will be used.
<div class="p"><!----></div>
<b>CP-MCSCF calculations vs.&nbsp;DDR calculations&nbsp;&nbsp;</b>
<div class="p"><!----></div>
In the current version of the interface, the keywords <b><tt>grad</tt></b> and <b><tt>nacdr</tt></b> cannot be combined with the keywords <b><tt>nacdt</tt></b> and <b><tt>overlap</tt></b>. This is related to the way the interface allocates the records for gradients in the wavefunction file of <b><tt>Molpro</tt></b>. This issue might be resolved in future releases.
<div class="p"><!----></div>
This has the consequence that for trajectories using time derivatives or overlaps the gradient selection <i>must</i> be activated (though the selection criterion can be chosen arbitrarily high). Also, the <b><tt>select_directly</tt></b> keyword is not compatible with time derivatives and overlaps. <b><tt>setup_traj.py</tt></b> automatically takes care of this constraints.
<div class="p"><!----></div>
<b>Basis sets&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Note that <b><tt>Molpro</tt></b> cannot calculation SA-CASSCF gradients for generally contracted basis sets (like Dunning's "cc" basis sets or Roos' "ANO" basis sets). Only segmented basis sets are allowed, like the Pople basis sets and the "def" family from  T<span style="font-size:x-small">URBOMOLE</span>.
<div class="p"><!----></div>
     <a id="tth_sEc6.2.5"></a><h3>
6.2.5&nbsp;&nbsp;Molpro input generator: <b><tt>molpro_input.py</tt></b></h3><a id="sec:molpro_input.py">
</a>
<div class="p"><!----></div>
In order to quickly setup simple calculations using  M<span style="font-size:x-small">OLPRO</span>, the  S<span style="font-size:x-small">HARC</span>&nbsp;suite contains a small script called <b><tt>molpro_input.py</tt></b>. It can be used to setup singlepoint calculations, optimizations and frequency calculations on the HF, DFT, MP2 and CASSCF level of theory. Of course,  M<span style="font-size:x-small">OLPRO</span> has far more capabilities, but these are not covered by <b><tt>molpro_input.py</tt></b>. However, <b><tt>molpro_input.py</tt></b> can also prepare template files which are compatible with the  S<span style="font-size:x-small">HARC</span>-<span class="roman">Molpro</span> interface.
<div class="p"><!----></div>
The script interactively asks the user to specify the calculation and afterwards writes an input file and optionally a run script.
<div class="p"><!----></div>
<h4>Input</h4>
<div class="p"><!----></div>
<b>Type of calculation&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Choose to either perform a single-point calculation or an optimization (including optionally frequency calculation), or to generate a template file. In the latter case, no geometry file is needed. The script looks for a <b><tt>MOLPRO.input</tt></b> in the same directory and allows to copy the settings. 
<div class="p"><!----></div>
For single-point calculations, optimizations and frequency calculations, files in  M<span style="font-size:x-small">OLDEN</span> format called <b><tt>geom.molden</tt></b>, <b><tt>opt.molden</tt></b> or <b><tt>freq.molden</tt></b>, respectively, are created (containing the orbitals, optimization steps and normal modes, respectively). The file <b><tt>freq.molden</tt></b> can be used to generate initial conditions with <b><tt>wigner.py</tt></b>.
<div class="p"><!----></div>
<b>Geometry&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Specify the geometry file in xyz format. Number of atoms and total nuclear charge is detected automatically. After the user inputs the total charge, the number of electrons is calculated automatically.
<div class="p"><!----></div>
In the case of the generation of a template file, instead only the number of electrons is required.
<div class="p"><!----></div>
<b>Non-default atomic masses&nbsp;&nbsp;</b>
<div class="p"><!----></div>
If a frequency calculation is requested, the user may modify the mass of specific atoms (e.g.&nbsp;to investigate isotopic effects). In the following menu, the user can add or remove atoms with their mass to a list containing all atoms with non-default masses. Each atom is referred to by its number as in the geometry file. Using the command <b><tt>show</tt></b> the user can display the list of atoms with non-default masses. Typing <b><tt>end</tt></b> confirms the list.
<div class="p"><!----></div>
Note that when using the produced  M<span style="font-size:x-small">OLDEN</span> file later with <b><tt>wigner.py</tt></b>, the user has to enter the same non-default masses again, since the  M<span style="font-size:x-small">OLDEN</span> file does not contain the masses and <b><tt>wigner.py</tt></b> has no way to retrieve these numbers.
<div class="p"><!----></div>
<b>Level of theory&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Supported are Hartree-Fock (HF), Density Functional Theory (DFT), M&#248;ller-Plesset perturbation theory (MP2) and CASSCF (either single-state or state-averaged). All methods are compatible with odd-electron wavefunctions (<b><tt>molpro_input.py</tt></b> will use the corresponding UHF, UMP2 and UKS keywords in the input file, if necessary).
<div class="p"><!----></div>
For template generation state-average CASSCF is automatically chosen. All methods can be combined with optimizations and frequency calculations, however, the frequency calculation is much more efficient with HF or SS-CASSCF. 
<div class="p"><!----></div>
<b>DFT functional&nbsp;&nbsp;</b>
<div class="p"><!----></div>
For DFT calculations, enter a functional and choose whether dispersion correction should be applied. Note that the functional is just a string which is not checked by <b><tt>molpro_input.py</tt></b>. 
<div class="p"><!----></div>
<b>Basis set&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The basis set is just a string which is not checked by <b><tt>molpro_input.py</tt></b>. 
<div class="p"><!----></div>
<b>CASSCF settings&nbsp;&nbsp;</b>
<div class="p"><!----></div>
For CASSCF calculations, enter the number of active electrons and orbitals. 
<div class="p"><!----></div>
For SS-CASSCF, only the multiplicity needs to be specified. For SA-CASSCF, specify the number of states per multiplicity to be included. Note that  M<span style="font-size:x-small">OLPRO</span> allows to average over states with different numbers of electrons. This feature is not supported in <b><tt>molpro_input.py</tt></b>. However, the user can generate a closely-matching input and simply add the missing states to the CASSCF block manually. 
<div class="p"><!----></div>
For optimizations at SA-CASSCF level, the state to be optimized has to be given.
<div class="p"><!----></div>
<b>Memory&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Enter the amount of memory for  M<span style="font-size:x-small">OLPRO</span>. Note that values smaller than 50 MB are ignored, and 50 MB are used in this case.
<div class="p"><!----></div>
<b>Run script&nbsp;&nbsp;</b>
<div class="p"><!----></div>
If requested, the script also generates a simple Bash script (<b><tt>run_molpro.sh</tt></b>) to directly execute  M<span style="font-size:x-small">OLPRO</span>. The user has to enter the path to  M<span style="font-size:x-small">OLPRO</span> and the path to a suitable (fast) scratch directory. 
<div class="p"><!----></div>
Note that the scratch directory will be deleted after the calculation, only the wavefunction file <b><tt>wf</tt></b> will be copied back to the main directory.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc6.3"></a><h2>
6.3&nbsp;&nbsp;MOLCAS Interface</h2><a id="sec:int:molcas">
</a>
<div class="p"><!----></div>
The  S<span style="font-size:x-small">HARC</span>- M<span style="font-size:x-small">OLCAS</span> interface can be used to conduct excited-state dynamics based on  M<span style="font-size:x-small">OLCAS</span>' CASSCF wavefunctions. RASSCF wavefunctions are not supported currently. The interface uses the modules GATEWAY, SEWARD (integrals), RASSCF (wavefunction, energies), RASSI (transition dipole moments, spin-orbit couplings, overlaps), MCLR and ALASKA (gradients). Since  M<span style="font-size:x-small">OLCAS</span> is not able to calculate the full non-adiabatic coupling vectors, only wavefunction overlaps are currently implemented in the interface.
<div class="p"><!----></div>
<div class="p"><!----></div>
The interface needs two additional input files, a template file for the quantum chemistry (file name is <b><tt>MOLCAS.template</tt></b>) and a general input file (<b><tt>SH2CAS.inp</tt></b>). If <b><tt>QM/MOLCAS.&lt;i&#62;.JobIph.old</tt></b> files are present, they are used as initial wavefunction files, where <b><tt>&lt;i&#62;</tt></b> is the multiplicity. 
<div class="p"><!----></div>
     <a id="tth_sEc6.3.1"></a><h3>
6.3.1&nbsp;&nbsp;Interface specific input file: <b><tt>SH2CAS.inp</tt></b></h3>
<div class="p"><!----></div>
The file <b><tt>SH2CAS.inp</tt></b> contains mainly paths (to the  M<span style="font-size:x-small">OLCAS</span> executables, to the scratch directory, etc.). This file must reside in the same directory where the interface is started. It uses a simple "<b><tt>keyword argument</tt></b>" syntax. Comments using # and blank lines are possible, the order of keywords is arbitrary. Lines with unknown keywords are ignored, since the interface just searches the file for certain keywords.
<div class="p"><!----></div>
Table&nbsp;<a href="#tab:molcas_sh2"> 6.4</a> lists the existing keywords.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb6.4">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 6.4: Keywords for the <b><tt>SH2CAS.inp</tt></b> file.</div>
  <a id="tab:molcas_sh2">
</a>
<table>
<tr><td align="left">
  Keyword       </td><td width="474">Description</td></tr>
<tr><td align="left">
molcas          </td><td width="474">Is the path to the  M<span style="font-size:x-small">OLCAS</span> installation. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. The interface will set <b><tt>$MOLCAS</tt></b> to this path. If this keyword is not present in <b><tt>SH2CAS.inp</tt></b>, the interface will use the environment variable <b><tt>$MOLCAS</tt></b>, if it is set.</td></tr>
<tr><td align="left">scratchdir      </td><td width="474">Is a path to the temporary directory. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. If it does not exist, the interface will create it. In any case, the interface will delete this directory after the calculation.</td></tr>
<tr><td align="left">memory          </td><td width="474">The memory usable by  M<span style="font-size:x-small">OLCAS</span>. The interface will set <b><tt>$MOLCASMEM</tt></b> to this value. The default is 10&nbsp;MB.</td></tr>
<tr><td align="left">project         </td><td width="474">Can be used to set a  M<span style="font-size:x-small">OLCAS</span> project name (<b><tt>$Project</tt></b>). If not used, the interface will generate a default project name.</td></tr>
<tr><td align="left">
  </td></tr></table>
</div>
<div class="p"><!----></div>
Note that the interface sets all environment variables necessary to run  M<span style="font-size:x-small">OLCAS</span> (e.g., <b><tt>$MOLCAS</tt></b>, <b><tt>$MOLCASMEM</tt></b>, <b><tt>$WorkDir</tt></b> ,<b><tt>$Project</tt></b>) automatically, based on the paths to  M<span style="font-size:x-small">OLCAS</span> and the scratch directory from <b><tt>SH2CAS.inp</tt></b>.
<div class="p"><!----></div>
     <a id="tth_sEc6.3.2"></a><h3>
6.3.2&nbsp;&nbsp;Template file: <b><tt>MOLCAS.template</tt></b></h3>
<div class="p"><!----></div>
This file contains the specifications for the wavefunction. Note that this is not a valid  M<span style="font-size:x-small">OLCAS</span> input file. No sections like <b><tt>$GATEWAY</tt></b>, etc., can be used. The file only contains a number of keywords, given in table&nbsp;<a href="#tab:molcas_temp"> 6.5</a>.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb6.5">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 6.5: Keywords for the <b><tt>MOLACS.template</tt></b> file.</div>
  <a id="tab:molcas_temp">
</a>
<table>
<tr><td align="left">
  Keyword       </td><td width="474">Description</td></tr>
<tr><td align="left">
basis           </td><td width="474">The basis set used. Note that some basis sets (e.g., Pople basis sets) do not work, since the spin-orbit integrals cannot be calculated.</td></tr>
<tr><td align="left">ras2            </td><td width="474">Number of active orbitals for CASSCF.</td></tr>
<tr><td align="left">nactel          </td><td width="474">Number of active electrons for CASSCF.</td></tr>
<tr><td align="left">inactive        </td><td width="474">Number of inactive orbitals.</td></tr>
<tr><td align="left">spin            </td><td width="474">The full line reads as <b><tt>spin s roots r</tt></b> and specifies the number of roots for the given multiplicity. This influences only the number of states in the state-averaging procedure. The number of states in the dynamics must not be larger than the number of states given here.</td></tr>
<tr><td align="left">
  </td></tr></table>
</div>
<div class="p"><!----></div>
The template file can be setup with the tool <b><tt>molcas_input.py</tt></b>.
<div class="p"><!----></div>
     <a id="tth_sEc6.3.3"></a><h3>
6.3.3&nbsp;&nbsp;Template file generator: <b><tt>molcas_input.py</tt></b></h3><a id="sec:molcas_input.py">
</a>
<div class="p"><!----></div>
This is a small interactive script to generate template files for the  S<span style="font-size:x-small">HARC</span>- M<span style="font-size:x-small">OLCAS</span> interface. It simply queries the user for some input parameters and then writes the file <b><tt>SH2CAS.inp</tt></b>, which can be used to run  S<span style="font-size:x-small">HARC</span>&nbsp;simulations with the  S<span style="font-size:x-small">HARC</span>- M<span style="font-size:x-small">OLCAS</span> interface.
<div class="p"><!----></div>
<b>Geometry file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The geometry file is only used to calculate the nuclear charge.
<div class="p"><!----></div>
<b>Charge&nbsp;&nbsp;</b>
<div class="p"><!----></div>
This is the overall charge of the molecule. This number is used with the nuclear charge to calculate the number of electrons.
<div class="p"><!----></div>
<b>Basis set&nbsp;&nbsp;</b>
<div class="p"><!----></div>
This is simply a string, which is <i>not</i> checked by the script to be a valid basis set of the  M<span style="font-size:x-small">OLCAS</span> library.
<div class="p"><!----></div>
<b>Number of active electrons and orbitals&nbsp;&nbsp;</b>
<div class="p"><!----></div>
These settings are necessary for the definition of the CASSCF wavefunction. The number of inactive orbitals is automatically calculated from the total number of electrons and the number of active electrons.
<div class="p"><!----></div>
<b>States for state-averaging&nbsp;&nbsp;</b>
<div class="p"><!----></div>
For each multiplicity, the number of states for the state-averaging procedure must be equal or larger than the number of states used in the dynamics.
<div class="p"><!----></div>
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc6.4"></a><h2>
6.4&nbsp;&nbsp;COLUMBUS Interface</h2><a id="sec:int:columbus">
</a>
<div class="p"><!----></div>
The  S<span style="font-size:x-small">HARC</span>- C<span style="font-size:x-small">OLUMBUS</span> interface allows to run  S<span style="font-size:x-small">HARC</span>&nbsp;dynamics based on  C<span style="font-size:x-small">OLUMBUS</span>' CASSCF, RASSCF, MRCI and LRT-MRAQCC wavefunctions. The interface is compatible to  C<span style="font-size:x-small">OLUMBUS</span> calculations utilizing the  C<span style="font-size:x-small">OLUMBUS</span>- M<span style="font-size:x-small">OLCAS</span> interface only ( S<span style="font-size:x-small">EWARD</span> integrals and  A<span style="font-size:x-small">LASKA</span> gradients). Unfortunately, time derivatives and non-adiabatic coupling vectors cannot be calculated with this setup, only wavefunction overlaps can be obtained. The interface utilizes the <b><tt>cioverlap</tt></b> program by Jiri Pittner <a href="#Pittner2009CP" class="tth_citeref">[27</a>] to calculate the overlap matrices needed for local diabatization propagation. The interface can also calculate Dyson norms between neutral and ionic wavefunctions using a suitable user-supplied code.
<div class="p"><!----></div>
The interface needs as additional input the file <b><tt>QM/SH2COL.inp</tt></b> and a template directory containing all input files needed for the  C<span style="font-size:x-small">OLUMBUS</span> calculations. Additionally, initial MOs can be given in the file <b><tt>QM/mocoef_mc.init</tt></b>.
<div class="p"><!----></div>
     <a id="tth_sEc6.4.1"></a><h3>
6.4.1&nbsp;&nbsp;Template input</h3>
<div class="p"><!----></div>
The interface does not generate the full  C<span style="font-size:x-small">OLUMBUS</span> input on-the-fly. Instead, the interface uses an existing set of input files and performs only necessary modifications (e.g., the number of states). The set of input files must be provided by the user. Please see the <a href="http://www.univie.ac.at/columbus/docs_COL70/documentation_main.html"> C<span style="font-size:x-small">OLUMBUS</span> online documentation</a> and, most importantly, the 
<a href="http://www.univie.ac.at/columbus/docs_COL70/tutorial-SO.pdf"> C<span style="font-size:x-small">OLUMBUS</span> SOCI tutorial</a> for a documentation of the necessary input.
<div class="p"><!----></div>
Generally, the input consists of a directory with one subdirectory with input for each multiplicity (singlets, doublets, triplets, ...). However, even-electron wavefunctions of different multiplicities can be computed together in the same job if spin-orbit couplings are desired. Otherwise independent multiple-DRT inputs (ISC keyword) are also acceptable. Note that symmetry is not allowed when using the interface.
<div class="p"><!----></div>
The path to the template directory must be given in <b><tt>SH2COL.inp</tt></b>.
<div class="p"><!----></div>
<b>Integral input&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The interface is only able to use input for calculations using  M<span style="font-size:x-small">OLPRO</span>/S<span style="font-size:x-small">EWARD</span> integrals. Also make sure that you include scalar-relativistic (Douglas-Kroll-Hess) and spin-orbit (AMFI) effects in the integral input.
<div class="p"><!----></div>
It is important to make sure that <b>the order of atoms</b> in the template input files and in the  S<span style="font-size:x-small">HARC</span>&nbsp;input <b>is consistent</b>.
<div class="p"><!----></div>
<b>MCSCF input&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The MCSCF section can use any desired state-averaging scheme. However, frozen core orbitals in the MCSCF step are not possible (since otherwise gradients cannot be computed). Prepare the MCSCF input for CI gradients. It is advisable to use very tight MCSCF convergence criteria.
<div class="p"><!----></div>
<b>MRCI input&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Either prepare a single-DRT input without SOCI (to cover a single multiplicity), a single-DRT input with SOCI and a sufficient maximum multiplicity for spin-orbit couplings or a independent multiple-DRT input (ISC case). Make sure that all multiplicities are covered with all input directories.
<div class="p"><!----></div>
In the MRCI input, make sure to use sequential <b><tt>ciudg</tt></b>. Also take care to setup gradient input on MRCI level.
<div class="p"><!----></div>
<b>Job control&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Setup a single-point calculation with the following steps:
<ul>
<li> SCF
<div class="p"><!----></div>
</li>
<li> MCSCF
<div class="p"><!----></div>
</li>
<li> MR-CISD (serial operation) or SO-CI coupled to non-rel CI (for SOCI DRT inputs)
<div class="p"><!----></div>
</li>
<li> one-electron properties for all methods
<div class="p"><!----></div>
</li>
<li> transition moments for MR-CISD
<div class="p"><!----></div>
</li>
<li> nonadiabatic couplings (and/or gradients)
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
Request first transition moments and interstate couplings in the following dialogues. Analysis in internal coordinates and intersection slope analysis are not required.
<div class="p"><!----></div>
     <a id="tth_sEc6.4.2"></a><h3>
6.4.2&nbsp;&nbsp;Interface specific input file: <b><tt>SH2COL.inp</tt></b></h3>
<div class="p"><!----></div>
Beyond the information from <b><tt>QM.in</tt></b> the interface needs additional input, which is read from the file <b><tt>SH2COL.inp</tt></b>. Table&nbsp;<a href="#tab:columbus_sh2"> 6.6</a> lists the keywords which can be given in the file.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb6.6">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 6.6: Keywords for the <b><tt>SH2COL.inp</tt></b> file.</div>
  <a id="tab:columbus_sh2">
</a>
<table>
<tr><td align="left">
  Keyword       </td><td width="474">Description</td></tr>
<tr><td align="left">
columbus        </td><td width="474">Is followed by a string giving the path to the  C<span style="font-size:x-small">OLUMBUS</span> main directory. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used.</td></tr>
<tr><td align="left">molcas          </td><td width="474">Is followed by a string giving the path to the  M<span style="font-size:x-small">OLCAS</span> main directory.  Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. This path is only used for overlap calculations (since in this case the interface calls  M<span style="font-size:x-small">OLCAS</span> explicitly). Otherwise  C<span style="font-size:x-small">OLUMBUS</span> will use the path to  M<span style="font-size:x-small">OLCAS</span> specified during the installation of  C<span style="font-size:x-small">OLUMBUS</span>.</td></tr>
<tr><td align="left">scratchdir      </td><td width="474">Is a path to the temporary directory. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. If it does not exist, the interface will create it. In any case, the interface will delete this directory after the calculation.</td></tr>
<tr><td align="left">savedir         </td><td width="474">Is a path to another temporary directory.  Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. The interface will store files needed for restart there.</td></tr>
<tr><td align="left">dyson           </td><td width="474">Path to the dyson code. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. Only necessary if Dyson norms are calculated. Needs a suitable code that computes Dyson norms.</td></tr>
<tr><td align="left">civecconsolidate</td><td width="474">Path to the civecconsolidate code suitable for preparation of input for the Dyson program (CI vectors in terms of determinants). Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. Only used if Dyson norms are calculated. If not present, the civecconsolidate code in the <b><tt>$COLUMBUS</tt></b> directory is used. Note that in the current version of  C<span style="font-size:x-small">OLUMBUS</span> (Oct. 2014) civecconsolidate is not compatible with the calculation of Dyson norms.</td></tr>
<tr><td align="left">memory          </td><td width="474">(integer, MB) Memory for  C<span style="font-size:x-small">OLUMBUS</span>. Note that the maximum amount of memory used by cioverlaps cannot be controlled with this keyword.</td></tr>
<tr><td align="left">ciothres        </td><td width="474">(float) Threshold for including a pair of determinants in the cioverlaps program.</td></tr>
<tr><td align="left">dysonthres      </td><td width="474">(float) Threshold for including a pair of determinants in the calculation of Dyson norms.</td></tr>
<tr><td align="left">nooverlap       </td><td width="474">(no argument) Do not keep the binary files necessary to calculate wavefunction overlaps in the next timestep.</td></tr>
<tr><td align="left">template        </td><td width="474">Is followed by the path to the directory containing the template subdirectories. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used.</td></tr>
<tr><td align="left">DIR             </td><td width="474">See <a href="#int:col:template">6.4.3</a>.</td></tr>
<tr><td align="left">MOCOEF          </td><td width="474">See <a href="#int:col:template">6.4.3</a>.</td></tr>
<tr><td align="left">
  </td></tr></table>
</div>
<div class="p"><!----></div>
     <a id="tth_sEc6.4.3"></a><h3>
6.4.3&nbsp;&nbsp;Template setup</h3><a id="int:col:template">
</a>
<div class="p"><!----></div>
The template directory contains several subdirectories with input for different multiplicities. An example is given in figure&nbsp;<a href="#fig:dirs_COLtemp"> 6.1</a>. In <b><tt>SH2COL.inp</tt></b>, the user has to associate each multiplicity to a subdirectory. The line "<b><tt>DIR 1 Sing_Trip</tt></b>" would make the interface use the input files from the subdirectory <b><tt>Sing_Trip</tt></b> when calculating singlet states (the <b><tt>1</tt></b> refers to singlet calculations). All calculations using a particular input subdirectory are called a job.
<div class="p"><!----></div>
Additionally, the user must specify which job(s) provide the MO coefficients (e.g., the calculation for doublet states could be based on the same MOs as the singlet and triplet calculation). The line "<b><tt>MOCOEF Doub_Quar Sing_Trip</tt></b>" would tell the interface to do a MCSCF calculation in the <b><tt>Sing_Trip</tt></b> job, and reuse the MOs when doing the <b><tt>Doub_Quar</tt></b> job without reoptimizing the MOs.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_fIg6.1">
</a>   <div style="text-align:center">  <img src="http://sharc-md.org/wp-content/uploads/2014/10/dirs_COLtemp.png">  
<div style="text-align:center">Figure 6.1: Example directory structure of the  C<span style="font-size:x-small">OLUMBUS</span> template directory</div>
  <a id="fig:dirs_COLtemp">
</a>
</div>
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc6.5"></a><h2>
6.5&nbsp;&nbsp;Analytical PESs Interface</h2><a id="sec:int:analytical">
</a>
<div class="p"><!----></div>
The  S<span style="font-size:x-small">HARC</span>&nbsp;suite also contains an interface which allows to run dynamics simulations on PESs expressed with analytical functions.
In order to allow dynamics simulations in the same way as it is done on-the-fly, the interface uses two kinds of potential couplings:
<ul>
<li> couplings that are pre-diagonalized in the interface (yielding the equivalent of the MCH basis),
<div class="p"><!----></div>
</li>
<li> couplings given by the interface to  S<span style="font-size:x-small">HARC</span>&nbsp;as off-diagonal elements.
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
The interface needs one additional input file, called <b><tt>SH2Ana.inp</tt></b>, which contains the definitions of all analytical expressions.
<div class="p"><!----></div>
     <a id="tth_sEc6.5.1"></a><h3>
6.5.1&nbsp;&nbsp;Parametrization</h3>
<div class="p"><!----></div>
The interface has to be provided with analytical expressions for all matrix elements of the following matrices in the diabatic basis:
<ul>
<li> Hamiltonian: <b>H</b>
<div class="p"><!----></div>
</li>
<li> Derivative of the Hamiltonian with respect to each atomic coordinate: <b>H</b><sub>x<sub>i</sub></sub>
<div class="p"><!----></div>
</li>
<li> (Transition) dipole matrices for each polarization direction: <b>M</b><sub>i</sub>
<div class="p"><!----></div>
</li>
<li> Real and imaginary part of the SOC matrix: &#931;
<div class="p"><!----></div>
</li>
<li> (Optionally) the derivatives of the transition dipole matrices: <b>D</b><sub>i,x<sub>j</sub></sub>
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
The diabatic Hamiltonian is diagonalized:
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-4.png">
<div class="p"><!----></div>
Then the following calculations lead to the MCH matrices which are passed to  S<span style="font-size:x-small">HARC</span>:
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-5.png">
The MCH Hamiltonian is the diagonalized diabatic Hamiltonian plus the SO matrix transformed into the MCH basis. The gradients in the MCH basis are obtained by transforming the derivative matrices into the MCH basis. The dipole matrices are also simply transformed into the MCH basis. The overlap matrix is the overlap of old and new transformation matrix.
<div class="p"><!----></div>
     <a id="tth_sEc6.5.2"></a><h3>
6.5.2&nbsp;&nbsp;Interface-specific input file</h3>
<div class="p"><!----></div>
The interface-specific input file is called <b><tt>SH2Ana.inp</tt></b>. It contains the analytical expressions for all matrix elements mentioned above. All analytical expressions in this file are evaluated considering the atomic coordinates read from <b><tt>QM.in</tt></b>.
<div class="p"><!----></div>
The file consists of a file header and the file body. The file body consists of variable definition blocks and matrix blocks.
<div class="p"><!----></div>
<b>Header&nbsp;&nbsp;</b> 
<div class="p"><!----></div>
The header looks similar to an xyz file:
<pre>
2
2
I&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0
Br&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xBr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0
&nbsp;&nbsp;
</pre>
Here, the first line gives the number of atoms and the second line the number of states. 
<div class="p"><!----></div>
On the remaining lines, each cartesian component of the atomic coordinates is associated to a variable name, which can be used in the analytical expressions. If a zero (<b><tt>0</tt></b>) is given instead of a variable name, then the corresponding cartesian coordinate is neglected. In the above example, the variable name <b><tt>xI</tt></b> is associated with the x coordinate of the first atom given in <b><tt>QM.in</tt></b>. The y and z coordinates of the first atom are neglected.
<div class="p"><!----></div>
All variable names must be <a href="https://docs.python.org/2/reference/lexical_analysis.html#identifiers">valid Python identifiers</a> and must not start with an underscore. Hence, all strings starting with a letter, followed by an arbitrary number of letters, digits and underscores, are valid. It is not allowed to use a variable name twice.
<div class="p"><!----></div>
Note that the file header also contains the atom labels, which are just used for cross-checking against the atom labels in <b><tt>QM.in</tt></b>.
<div class="p"><!----></div>
The file header must not contain comments, neither at the end of a line nor separate lines. Also, blank lines are not allowed in the header. After the last line of the header (where the variables for the n<sub>atom</sub>-th atom are defined), blank lines and comments can be used freely (except in matrix blocks).
<div class="p"><!----></div>
<b>Variable definition blocks&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Variable definition blocks can be used to store additional numerical values (beyond the atomic coordinates) in variables, which can then be used in the equations in the matrix blocks. The most obvious use for this is of course to define values which will appear several times in the equations.
<div class="p"><!----></div>
A variable definition block looks like:
<pre>
Variables
A1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.067
g1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.996&nbsp;&nbsp;&nbsp;#&nbsp;Trailing&nbsp;comment
#&nbsp;Blank&nbsp;line&nbsp;with&nbsp;comment&nbsp;only
R1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4.666
End
&nbsp;&nbsp;
</pre>
Each block starts with the keyword "Variables" and is terminated with "End". Inbetween, on each line a variable name and the corresponding numerical value (separated by blanks) can be given. Note that the naming conventions given above also apply to variables defined in these blocks. 
<div class="p"><!----></div>
There can be any number of complete variable definitions blocks in the input file. All blocks are read first, before any matrix expressions are evaluated. Hence, the relative order of the variable blocks and the matrix blocks does not matter. Also, note that variable names must not appear twice, so variables cannot be redefined halfway through the file.
<div class="p"><!----></div>
<b>Matrix blocks&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The most important information in the input file are of course contained in the expressions in the matrix blocks. In general, a matrix block has the following format:
<pre>
Matrix_Identifier
V11
V12,&nbsp;&nbsp;&nbsp;&nbsp;V22
V13,&nbsp;&nbsp;&nbsp;&nbsp;V23,&nbsp;&nbsp;&nbsp;&nbsp;V33
...
&nbsp;&nbsp;
</pre>
The first line identifies the type of matrix. Those are valid identifiers:
<div class="p"><!----></div>
<table>
<tr><td width="197"><b><tt>Hamiltonian</tt></b>                               </td><td width="355">Defines the Hamiltonian including the diabatic potential couplings.</td></tr>
<tr><td width="197"><b><tt>Derivatives</tt></b> followed by a variable name   </td><td width="355">Derivative of the Hamiltonian with respect to the given variable.</td></tr>
<tr><td width="197"><b><tt>Dipole</tt></b> followed by 1, 2 or 3              </td><td width="355">(Transition) dipole moment matrix for cartesian direction x, y or z, respectively.</td></tr>
<tr><td width="197"><b><tt>Dipolederivatives</tt></b> followed by 1, 2 or 3 followed by a variable name       </td><td width="355">Derivative of the respective dipole moment matrix.</td></tr>
<tr><td width="197"><b><tt>SpinOrbit</tt></b> followed by <b><tt>R</tt></b> or <b><tt>I</tt></b>  </td><td width="355">Real or Imaginary (respectively) part of the spin-orbit coupling matrix &#931;.</td></tr></table>
<div class="p"><!----></div>
Since the interface searches the file for these identifiers starting from the top until it is found, for each matrix only the first block takes effect. Note that the Hamiltonian and all relevant derivatives must be present. If dipole matrix, dipole derivative matrix or SO matrix definitions are missing, they will be assumed zero.
<div class="p"><!----></div>
In the lines after the identifier, the expressions for each matrix element are given. Note the lower triangular format (all matrices are assumed symmetric, except the imaginary part of the SO matrix, which is assumed antisymmetric). Matrix elements must be separated by commas (so that whitespace can be used inside the expressions). There must be at least as many lines as the number of states (additional lines are neglected). If any line or matrix element is missing, the interface will abort.
<div class="p"><!----></div>
An examplary block looks like:
<pre>
Hamiltonian
A1*(&nbsp;(1.-math.exp(g1*(R1-xI+xBr)))**2-1.),
0.0006,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3e-5*(xI-xBr)**2
&nbsp;&nbsp;
</pre>
It is important to understand that the expressions are directly evaluated by the Python interpreter, hence all expressions must be valid Python expressions which evaluate to numeric (integer or float) values. Only the variables defined above can be used. 
<div class="p"><!----></div>
Note that exponentiation in Python is <b><tt>**</tt></b>. In order to provide most usual mathematical functions, the <a href="https://docs.python.org/2/library/math.html"><b><tt>math</tt></b> module</a> is available. Among others, the <b><tt>math</tt></b> module provides the following functions:
<ul>
<li> <b><tt>math.exp(x)</tt></b>: Exponential function
<div class="p"><!----></div>
</li>
<li> <b><tt>math.log(x)</tt></b>: Natural logarithm
<div class="p"><!----></div>
</li>
<li> <b><tt>math.pow(x,y)</tt></b>: x<sup>y</sup>
<div class="p"><!----></div>
</li>
<li> <b><tt>math.sqrt(x)</tt></b>: &#8730;x
<div class="p"><!----></div>
</li>
<li> <b><tt>math.cos(x)</tt></b>, <b><tt>math.sin(x)</tt></b>, <b><tt>math.tan(x)</tt></b>
<div class="p"><!----></div>
</li>
<li> <b><tt>math.acos(x)</tt></b>, <b><tt>math.asin(x)</tt></b>, <b><tt>math.atan(x)</tt></b>
<div class="p"><!----></div>
</li>
<li> <b><tt>math.atan2(y,x)</tt></b>: tan<sup>&#8722;1</sup>([y/x]), as in many programming languages (takes care of phases)
<div class="p"><!----></div>
</li>
<li> <b><tt>math.pi</tt></b>, <b><tt>math.e</tt></b>: &#960; and Euler's number
<div class="p"><!----></div>
</li>
<li> <b><tt>math.cosh(x)</tt></b>, <b><tt>math.sinh(x)</tt></b>: Hyperbolic functions (also tanh, acosh, asinh, atanh are available)
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_chAp7"></a><h1>
Chapter 7 Auxilliary Scripts</h1><a id="chap:aux">
</a>
<div class="p"><!----></div>
In this chapter, all auxiliary scripts and programs are documented. Input generators (currently <b><tt>molpro_input.py</tt></b> and <b><tt>molcas_input.py</tt></b>) are documented in the relevant interface sections.
<div class="p"><!----></div>
All auxiliary scripts are either interactive - prompting user input from stdin in order to setup a certain task - or non-interactive, meaning they are controlled by command-line arguments and options, in the same way as many command-line tools work.
<div class="p"><!----></div>
All interactive scripts sequentially ask a number of questions to the user. In many cases, a default value is presented, which is either preset or detected by the scripts based on the availability of certain files. Furthermore, the scripts feature auto-completion of paths and filenames (use TAB), which is active only in questions where auto-completion is relevant.
<div class="p"><!----></div>
All interactive scripts write a file called <b><tt>KEYSTROKES.&lt;script_name&#62;</tt></b> which contains the user input from the last completed session. These files can be piped to the interactive scripts to perform the same task again, for example:
<pre>
user@host&#62;&nbsp;cat&nbsp;KEYSTROKES.excite&nbsp;-&nbsp;|&nbsp;$SHARC/excite.py
</pre>
Note the <b><tt>-</tt></b>, which tells <b><tt>cat</tt></b> to switch to stdin after the file ends, so that the user can proceed if the script asks for more input than contained in the <b><tt>KEYSTROKES</tt></b> file.
<div class="p"><!----></div>
All non-interactive scripts can be called with the <b><tt>-h</tt></b> option to obtain a short description, usage information and a list of the command line options.
<div class="p"><!----></div>
All scripts can be safely killed during a run by using <b><tt>CTRL+C</tt></b>. In the case of interactive scripts, a <b><tt>KEYSTROKES.tmp</tt></b> file remains, containing the user input made so far.
<div class="p"><!----></div>
 <a id="tth_sEc7.1"></a><h2>
7.1&nbsp;&nbsp;Wigner Distribution Sampling: <b><tt>wigner.py</tt></b></h2><a id="sec:wigner.py">
</a>
<div class="p"><!----></div>
The first step in preparing the dynamics calculation is to obtain a set of physically reasonable initial conditions. Each initial condition is a set of initial atomic coordinates, initial atomic velocities and initial electronic state. The initial geometry and velocities can be obtained in different ways. With  S<span style="font-size:x-small">HARC</span>, usually sampling of a quantum-harmonic Wigner distribution is performed. 
<div class="p"><!----></div>
The sampling is carried out with the non-interactive Python script <b><tt>wigner.py</tt></b>. The theoretical background is summarized in section&nbsp;<a href="#met:wigner">8.12</a>.
<div class="p"><!----></div>
     <a id="tth_sEc7.1.1"></a><h3>
7.1.1&nbsp;&nbsp;Usage</h3>
<div class="p"><!----></div>
The general usage is 
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/wigner.py&nbsp;[options]&nbsp;filename.molden
</pre>
<b><tt>wigner.py</tt></b> takes exactly one command-line argument (the input file with the frequencies and normal modes), plus some options. Usually, the <b><tt>-n</tt></b> option is necessary, since by default only 3 initial conditions are created.
<div class="p"><!----></div>
The argument is the filename of the file containing the information about the vibrational frequencies and normal modes. The file is by default assumed to be in the <a href="http://www.cmbi.ru.nl/molden/molden_format.html"> M<span style="font-size:x-small">OLDEN</span> format</a>. For usage with <b><tt>wigner.py</tt></b>, only the following blocks have to be present:
<div class="p"><!----></div>
<table border="0"><tr><td></td><td><table border="0"><tr><td>
<ul>
<li> [FREQ]
<div class="p"><!----></div>
</li>
<li> [FR-COORD]
<div class="p"><!----></div>
</li>
<li> [FR-NORM-COORD]
<div class="p"><!----></div>
</li>
</ul>
</td></tr></table><!--vbox-->
</td><td></td></tr></table><!--hboxt-->Alternatively, the information about the vibrational frequencies and normal modes can be read directly from a  M<span style="font-size:x-small">OLPRO</span> output file of a frequency calculation. In this case, in addition to the filename also the switch <b><tt>-M</tt></b> has to be given:
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/wigner.py&nbsp;-M&nbsp;MOLPRO.out
</pre>
<div class="p"><!----></div>
The script accepts a number of command-line options, specified in table&nbsp;<a href="#tab:wigner_opts"> 7.1</a>.
<div class="p"><!----></div>
<a id="tth_tAb7.1">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 7.1: Command-line options for script <b><tt>wigner.py</tt></b>.</div>
  <a id="tab:wigner_opts">
</a>
<table>
<tr><td align="left">
    <span class="roman">Option        </td><td align="left">Description      </td><td align="left">Default</td></tr>
<tr><td align="left">
    -h                  </td><td align="left">Display help message and quit.             </td><td align="left">-                             </td></tr>
<tr><td align="left">-m                  </td><td align="left">Modify atom masses                         </td><td align="left">Most common isotope.           </td></tr>
<tr><td align="left">-M                  </td><td align="left">Assume a  M<span style="font-size:x-small">OLPRO</span> input file.       </td><td align="left">Assume a  M<span style="font-size:x-small">OLDEN</span> file. </td></tr>
<tr><td align="left">-n  INTEGER         </td><td align="left">Number of initial conditions to generate.  </td><td align="left">3                              </td></tr>
<tr><td align="left">-o  FILENAME        </td><td align="left">Output filename.                           </td><td align="left"><b><tt>initconds</tt></b>                </td></tr>
<tr><td align="left">-r  INTEGER         </td><td align="left">Seed for random number generator.          </td><td align="left">16661                          </td></tr>
<tr><td align="left">-s  FLOAT           </td><td align="left">Scaling factor for the frequencies.        </td><td align="left">1.0                            </td></tr>
<tr><td align="left">
  </td></tr></span></table>
</div>
<div class="p"><!----></div>
     <a id="tth_sEc7.1.2"></a><h3>
7.1.2&nbsp;&nbsp;Output</h3>
<div class="p"><!----></div>
The script <b><tt>wigner.py</tt></b> generates a single output file, by default called <b><tt>initconds</tt></b>. All information about the initial conditions is stored in this file. Later steps in the preparation of the initial conditions add information about the excited states to this file. The file is formatted in a human-readable form.
<div class="p"><!----></div>
The <b><tt>initconds</tt></b> file format is specified in section&nbsp;<a href="#sec:initcondsfile">7.3.5</a>.
<div class="p"><!----></div>
     <a id="tth_sEc7.1.3"></a><h3>
7.1.3&nbsp;&nbsp;Non-default Masses</h3>
<div class="p"><!----></div>
When the <b><tt>-m</tt></b> option is used, the script will ask the user to interactively modify the atom masses. For each atom (referred to by the atom index as in the  M<span style="font-size:x-small">OLDEN</span> file), a mass can be given (relative atomic weights). Note that the frequency calculation which produces the  M<span style="font-size:x-small">OLDEN</span> or  M<span style="font-size:x-small">OLPRO</span> file should be done with the same atomic masses.
<div class="p"><!----></div>
 <a id="tth_sEc7.2"></a><h2>
7.2&nbsp;&nbsp;Setup of Initial Calculations: <b><tt>setup_init.py</tt></b></h2><a id="sec:setup_init.py">
</a>
<div class="p"><!----></div>
The interactive script <b><tt>setup_init.py</tt></b> creates input for singlepoint calculations at the initial geometries given in an <b><tt>initconds</tt></b> file. These calculations might be necessary for some schemes to select the initial electronic state of the trajectory, based on the excitation energies and oscillator strength of the transitions from ground state to the excited state under consideration. 
<div class="p"><!----></div>
There are other choices of the initial state possible, which do not require singlepoint calculations at all initial geometries. See the description of <b><tt>excite.py</tt></b> (section&nbsp;<a href="#sec:excite.py">7.3</a>). In this case, <b><tt>setup_init.py</tt></b> can be used to set up only the calculation at the equilibrium geometry (see below at "Range of Initial Conditions").
<div class="p"><!----></div>
     <a id="tth_sEc7.2.1"></a><h3>
7.2.1&nbsp;&nbsp;Usage</h3>
<div class="p"><!----></div>
The script is interactive, and can be started by simply typing 
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/setup_init.py
</pre>
Please be aware that the script will setup the calculations in the directory where it was started, so the user should <b><tt>cd</tt></b> to the desired directory before executing the script.
<div class="p"><!----></div>
Please note that the script does not expand <b><tt> </tt></b> or shell variables, except where noted otherwise.
<div class="p"><!----></div>
     <a id="tth_sEc7.2.2"></a><h3>
7.2.2&nbsp;&nbsp;Input</h3>
<div class="p"><!----></div>
The script will prompt the user for the input. In the following, all input parameters are documented:
<div class="p"><!----></div>
<b>Initial Conditions File&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Enter the filename of the initial conditions file, which was generated beforehand with <b><tt>wigner.py</tt></b>. If the script finds a file called <b><tt>initconds</tt></b>, the user is asked whether to use this file, otherwise the user has to enter an appropriate filename. The script detects the number of initial conditions and number of atoms automatically from the initial conditions file.
<div class="p"><!----></div>
<b>Range of Initial Conditions&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The initial conditions in <b><tt>initconds</tt></b> are indexed, starting with the index 1. In order to prepare ab initio calculations for a subset of all initial conditions, enter a range of indices, e.g.&nbsp;a and b. This will prepare all initial conditions with indices in the interval [a,b]. In any case, the script will additionally prepare a calculation for the equilibrium geometry (except if a finished calculation for the equilibrium geometry was found).
<div class="p"><!----></div>
If the interval [0,0] is given, the script will only setup the calculation at the equilibrium geometry.
<div class="p"><!----></div>
<b>Number of states&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Here the user can specify the number of excited states to be calculated. Note that the ground state has to be counted as well, e.g.&nbsp;if 4 singlet states are specified, the calculation will involve the S<sub>0</sub>, S<sub>1</sub>, S<sub>2</sub> and S<sub>3</sub>. Also states of higher multiplicity can be given, e.g.&nbsp;triplet or quintett states. 
For even-electron molecules, including odd-electron states (e.g.&nbsp;doublets) is only useful if transition properties for ionization can be computed (e.g.&nbsp;Dyson norms with the  C<span style="font-size:x-small">OLUMBUS</span> interface). These transition properties can be used to calculate ionization spectra or to obtain initial conditions for dynamics after ionization.
<div class="p"><!----></div>
<b>Spin-orbit calculation&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Usually it is sufficient to calculate the spin-free excitation energies and oscillator strengths in order to decide for the initial state. However, using this option, the effects of spin-orbit coupling on the excitation energies and oscillator strengths can be included. Note that the script will never calculate spin-orbit couplings if only singlet states are included in the calculation.
<div class="p"><!----></div>
<b>Interface&nbsp;&nbsp;</b>
<div class="p"><!----></div>
In this point, choose any of the displayed interfaces to carry out the ab initio calculations. Enter the corresponding number. 
<div class="p"><!----></div>
The following input section depends on the chosen interface.
<div class="p"><!----></div>
     <a id="tth_sEc7.2.3"></a><h3>
7.2.3&nbsp;&nbsp;Input for  M<span style="font-size:x-small">OLPRO</span></h3><a id="sec:setup_init.py:molpro">
</a>
<div class="p"><!----></div>
<b>Path to  M<span style="font-size:x-small">OLPRO</span>&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Here the user is prompted to provide the path to the  M<span style="font-size:x-small">OLPRO</span> executable. 
<div class="p"><!----></div>
Note that the setup script will not expand the user (<b><tt> </tt></b>) and shell variables (since the calculations might be running on a different machine than the one used for setup, so the meaning of shell variables could be different). <b><tt> </tt></b> and shell variables will only be expanded by the interfaces during the actual calculation.
<div class="p"><!----></div>
<b>Scratch directory&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The script takes the string without any checking. Each individual initial condition uses a subdirectory <b><tt>ICOND_%05i</tt></b> with the appropriate number. <b><tt> </tt></b> and shell variables will only be expanded by the interface during the actual calculation.
<div class="p"><!----></div>
Note that you can use, e.g., <b><tt>./temp/</tt></b> as scratch directory, which is a subdirectory of the working directory of the interface. Using <b><tt>./</tt></b> as scratch directory is not recommended, since the interface will delete the scratch directory.
<div class="p"><!----></div>
<b>Template file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Enter the filename for the  M<span style="font-size:x-small">OLPRO</span> template input. This file contains the details of the ab initio calculation, like basis set, active orbitals and electrons, number of electrons and number of states for state-averaging. For  M<span style="font-size:x-small">OLPRO</span>, it also contains the memory usage. For details, see the section about the  S<span style="font-size:x-small">HARC</span>- M<span style="font-size:x-small">OLPRO</span> interface (<a href="#sec:int:molpro">6.2</a>). The setup script will check whether the template file contains the necessary entries. 
<div class="p"><!----></div>
<b>Initial wavefunction file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
You can provide an initial wavefunction (with an appropriate MO guess) to  M<span style="font-size:x-small">OLPRO</span>. This usually provides a drastic speedup for the CASSCF calculations and helps in ensuring that all calculations are based on the same active space. In simple cases it might be acceptable to not provide an initial wavefunction.
<div class="p"><!----></div>
     <a id="tth_sEc7.2.4"></a><h3>
7.2.4&nbsp;&nbsp;Input for  C<span style="font-size:x-small">OLUMBUS</span></h3>
<div class="p"><!----></div>
<b>Path to  C<span style="font-size:x-small">OLUMBUS</span>&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Here the user is prompted to provide the path to the  C<span style="font-size:x-small">OLUMBUS</span> directory. Note that the script will not expand the user (<b><tt> </tt></b>) and shell variables (since possibly the ab initio calculations are running on a different machine than the one used for setup). <b><tt> </tt></b> and shell variables will only be expanded by the interfaces during the actual calculation.
<div class="p"><!----></div>
Note that <b><tt>$COLUMBUS</tt></b> does not have to be defined on the setup host, but it has to be defined on the hosts running the calculations.
<div class="p"><!----></div>
<b>Scratch directory&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The script takes the string without any checking. Each individual initial condition uses a subdirectory <b><tt>ICOND_%05i</tt></b> with the appropriate number. <b><tt> </tt></b> and shell variables will only be expanded by the interface during the actual calculation.
<div class="p"><!----></div>
Note that you can use, e.g., <b><tt>./temp/</tt></b> as scratch directory, which is a subdirectory of the working directory of the interface. Using <b><tt>./</tt></b> as scratch directory is not recommended, since the interface will delete the scratch directory.
<div class="p"><!----></div>
<b>Template directory&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Enter the path to a directory containing subdirectories with  C<span style="font-size:x-small">OLUMBUS</span> input files necessary for the calculations. The setup script will expand <b><tt> </tt></b> and shell variables and will pass the absolute path to the calculations.
<div class="p"><!----></div>
The script will auto-detect (based on the <b><tt>cidrtin</tt></b> files) which subdirectory contains the input for each multiplicity. The user has to check in the following dialog whether the association of multiplicities with job directories is correct. Additionally, the association of MO coefficient files to the jobs has to be checked. See the section on the  S<span style="font-size:x-small">HARC</span>- C<span style="font-size:x-small">OLUMBUS</span> interface (<a href="#sec:int:columbus">6.4</a>) for further details. 
<div class="p"><!----></div>
Note that the setup script does not check any content of the input files beyond the multiplicity. Note that <b><tt>transmomin</tt></b> and <b><tt>control.run</tt></b> do not need to be present (and that their content has no effect on the calculation), since these files are written on-the-fly by the interface. 
<div class="p"><!----></div>
<b>Initial orbital coefficient file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
You can provide initial MO coefficients for the  C<span style="font-size:x-small">OLUMBUS</span> calculation. This usually provides a drastic speedup for the CASSCF calculations and helps to ensure that all calculations are based on the same active space. In simple cases it might be acceptable to not provide an initial wavefunction.
<div class="p"><!----></div>
<b>Memory&nbsp;&nbsp;</b>
<div class="p"><!----></div>
For  C<span style="font-size:x-small">OLUMBUS</span>, the available memory must be given here. 
<div class="p"><!----></div>
     <a id="tth_sEc7.2.5"></a><h3>
7.2.5&nbsp;&nbsp;Input for  M<span style="font-size:x-small">OLCAS</span></h3>
<div class="p"><!----></div>
<b>Path to  M<span style="font-size:x-small">OLCAS</span>&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The script will first look for a shell variable <b><tt>$MOLCAS</tt></b>. The user can either confirm that <b><tt>$MOLCAS</tt></b> is the correct executable, or enter the correct path. Note that the setup script will not expand the user (<b><tt> </tt></b>) and shell variables (since possibly the ab initio calculations are running on a different machine than the one used for setup). The  S<span style="font-size:x-small">HARC</span>- M<span style="font-size:x-small">OLCAS</span> interface will expand <b><tt> </tt></b> and shell variables.
<div class="p"><!----></div>
<b>Scratch directory&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The script takes the string without any checking. Each individual initial condition uses a subdirectory <b><tt>ICOND_%05i</tt></b> with the appropriate number. <b><tt> </tt></b> and shell variables will only be expanded by the interface during the actual calculation.
<div class="p"><!----></div>
Note that you can use, e.g., <b><tt>./temp/</tt></b> as scratch directory, which is a subdirectory of the working directory of the interface. Using <b><tt>./</tt></b> as scratch directory is not recommended, since the interface will delete the scratch directory.
<div class="p"><!----></div>
<b>Template file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Enter the filename for the  M<span style="font-size:x-small">OLCAS</span> template input. This file contains the details of the ab initio calculation, like basis set, active orbitals and electrons, number of electrons and number of states for state-averaging. For details, see the section about the  S<span style="font-size:x-small">HARC</span>- M<span style="font-size:x-small">OLCAS</span> interface (<a href="#sec:int:molcas">6.3</a>). The setup script will check whether the template file contains the necessary entries. 
<div class="p"><!----></div>
<b>Initial wavefunction file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
You can provide initial MO coefficients to  M<span style="font-size:x-small">OLCAS</span>. This usually provides a drastic speedup for the CASSCF calculations and helps in ensuring that all calculations are based on the same active space. In simple cases it might be acceptable to not provide an initial wavefunction. For  M<span style="font-size:x-small">OLCAS</span>, you have to specify one file for each multiplicity.
<div class="p"><!----></div>
     <a id="tth_sEc7.2.6"></a><h3>
7.2.6&nbsp;&nbsp;Input for analytical potentials</h3><a id="sec:setup_init.py:analytical">
</a>
<div class="p"><!----></div>
<b>Template file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Enter the filename for the template input specifying the analytical potentials. For details, see the section about the  S<span style="font-size:x-small">HARC</span>-Analytical interface (<a href="#sec:int:analytical">6.5</a>). The setup script will check whether the template file is valid. 
<div class="p"><!----></div>
     <a id="tth_sEc7.2.7"></a><h3>
7.2.7&nbsp;&nbsp;Input for Run Scripts</h3><a id="sec:setup_init.py:run">
</a>
<div class="p"><!----></div>
<b>Run script mode&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The script <b><tt>setup_init.py</tt></b> generates a run script (Bash) for each initial condition calculation. Due to the large variety of cluster architectures, these run scripts might not work in every case. It is the user's responsibility to adapt the generated run scripts to his needs.
<div class="p"><!----></div>
<b><tt>setup_init.py</tt></b> can generate run scripts for two different schemes how to execute the calculations. With the first scheme, the ab initio calculations are performed in the directory where they were setup (subdirectories of the directory where <b><tt>setup_init.py</tt></b> was started). Note that the interfaces will still use their scratch directories to perform the actual quantum chemistry calculations.
<div class="p"><!----></div>
With the second option, the run scripts will transfer the input files for each ab initio calculation to a temporary directory, where the interface is started. After the interface finishes all calculations, the results files are transferred back to the primary directory and the temporary directory is deleted. Note that <b><tt>setup_init.py</tt></b> in any case creates the directory structure in the directory where it was started. The name of the temporary directory can contain shell variables, which will be expanded when the script is running (on the compute host).
<div class="p"><!----></div>
<b>Submission script&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The setup script can also create a Bash script for the submission of all ab initio calculations to a queueing system. The user has to provide a submission command for that, including any options which might be necessary. This submission script might not work with all queueing systems.
<div class="p"><!----></div>
<b>Project name&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The user can enter a project name. This is used currently only for the job names of submitted jobs (<b><tt>-N</tt></b> option for queueing system).
<div class="p"><!----></div>
     <a id="tth_sEc7.2.8"></a><h3>
7.2.8&nbsp;&nbsp;Output</h3>
<div class="p"><!----></div>
<b><tt>setup_init.py</tt></b> will create for each initial condition in the given range a directory whose names follow the format <b><tt>ICOND_%05i</tt></b>, where <b><tt>%05i</tt></b> is the index of the initial condition padded with zeroes to 5 digits. Additionally, the directory <b><tt>ICOND_00000</tt></b> is created for the calculation of the excitation energies at the equilibrium geometry.
<div class="p"><!----></div>
To each directory, the following files will be added:
<ul>
<li> <b><tt>QM.in</tt></b>: Main input file for the interface, contains the geometry and the control keywords (to specify which quantities need to be calculated).
<div class="p"><!----></div>
</li>
<li> <b><tt>run.sh</tt></b>: Run script, which can be started interactively in order to perform the ab initio calculation in this directory. Can also be adapted to a batch script for submission to a queue
<div class="p"><!----></div>
</li>
<li> Interface-specific files: Usually a template file, a file containing additional input for the interface, and an initial wavefunction.
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
The calculations in each directory can be simply executed by starting <b><tt>run.sh</tt></b> in each directory. In order to perform this task consecutively on a single machine, the script <b><tt>all_run.sh</tt></b> can be executed. The file <b><tt>DONE</tt></b> contains the progress of this calculation.
Alternatively, each run script can be sent to a queueing system (you might need to adapt this script to you cluster system).
<div class="p"><!----></div>
In figure&nbsp;<a href="#fig:dirs_init"> 7.1</a>, the directory tree structure setup by <b><tt>setup_init.py</tt></b> is given.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_fIg7.1">
</a>   <div style="text-align:center">  <img src="http://sharc-md.org/wp-content/uploads/2014/10/dirs_init.png">  
<div style="text-align:center">Figure 7.1: Directory structure created by <b><tt>setup_init.py</tt></b>. Directories are in blue, executable scripts in green and regular files in black and white. Interface files usually include initial MO coefficients, template files and interface input files.</div>
  <a id="fig:dirs_init">
</a>
</div>
<div class="p"><!----></div>
After all calculations are finished, <b><tt>excite.py</tt></b> can be used to collect the results.
<div class="p"><!----></div>
 <a id="tth_sEc7.3"></a><h2>
7.3&nbsp;&nbsp;Excitation Selection: <b><tt>excite.py</tt></b></h2><a id="sec:excite.py">
</a>
<div class="p"><!----></div>
<b><tt>excite.py</tt></b> has two tasks: adding excited-state information to the <b><tt>initconds</tt></b> file, and deciding which excited state for which initial condition is a valid initial state for the dynamics.
<div class="p"><!----></div>
     <a id="tth_sEc7.3.1"></a><h3>
7.3.1&nbsp;&nbsp;Usage</h3>
<div class="p"><!----></div>
The script is interactive, and can be started by simply typing 
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/excite.py
</pre>
<div class="p"><!----></div>
     <a id="tth_sEc7.3.2"></a><h3>
7.3.2&nbsp;&nbsp;Input</h3>
<div class="p"><!----></div>
<b>Initial condition file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Enter the path to the initial conditions file, to which <b><tt>excite.py</tt></b> will add excited-state information. This file can already contain excited-state information (in this case this information can be reused).
<div class="p"><!----></div>
<b>Generate excited state list&nbsp;&nbsp;</b>
<div class="p"><!----></div>
There are three possibilities to add excited-state information to the <b><tt>initconds</tt></b> file:
<ol type="1">
<li> generate a list of dummy excited states,
<div class="p"><!----></div>
</li>
<li> read excited-state information from the output of the initial ab initio calculations (prepare the calculations with <b><tt>setup_init.py</tt></b>),
<div class="p"><!----></div>
</li>
<li> keep the existing excited-state information in the <b><tt>initconds</tt></b> file.
<div class="p"><!----></div>
</li>
</ol>
The first option is mainly used if no initial ab initio calculations need to be performed (e.g., the initial state is known). 
<div class="p"><!----></div>
In order to use the second option, one should first setup initial excited-state calculations using <b><tt>setup_init.py</tt></b> (see&nbsp;<a href="#sec:setup_init.py">7.2</a>) and run the calculations. <b><tt>excite.py</tt></b> can then read the output of the initial calculations and calculate excitation energies and oscillator strengths.
<div class="p"><!----></div>
The third option can be used to reuse the information in the <b><tt>initconds</tt></b> file, e.g., to apply a different selection scheme to the states or to just read the number of states.
<div class="p"><!----></div>
<b>Path to ab initio results&nbsp;&nbsp;</b>
<div class="p"><!----></div>
If <b><tt>excite.py</tt></b> will read the excited-state information from the ab initio calculation results, here the user has to provide the path to the directory containing the <b><tt>ICOND_%05i</tt></b> subdirectories.
<div class="p"><!----></div>
<b>Number of states&nbsp;&nbsp;</b>
<div class="p"><!----></div>
If a dummy list of states will be generated, the user has to provide the number of states per multiplicity. Note that a singlet ground state has to be counted as well, e.g.&nbsp;if 4 singlet states are specified, the calculation will involve the S<sub>0</sub>, S<sub>1</sub>, S<sub>2</sub> and S<sub>3</sub>. Also states of higher multiplicity can be given, e.g.&nbsp;doublet or triplet states (e.g., <b><tt>2 2 1</tt></b> for two singlets, two doublets and one triplet).
<div class="p"><!----></div>
If the ab initio results are read the number of states will be automatically determined from the results.
<div class="p"><!----></div>
<b>Excited-state representation&nbsp;&nbsp;</b>
<div class="p"><!----></div>
When generating new lists of excited states (either dummy states or from ab initio results), the user has to specify the representation of the excited states (either MCH or diagonal representation). The MCH representation is spin-free, meaning that transition dipole moments are only allowed between states of the same multiplicity. For molecules without heavy atoms, this option is sufficient. For heavier atoms, the diagonal representation can be used, which includes the effects of spin-orbit coupling on the excitation energies and oscillator strengths. 
<div class="p"><!----></div>
When reading ab initio results, <b><tt>excite.py</tt></b> will diagonalize the Hamiltonian and transform the transition dipole matrices for each initial condition to obtain the diagonal representation. 
<div class="p"><!----></div>
When a dummy state list is generated, the representation will only be written to the output file <b><tt>initconds.excited</tt></b> (but has no actual numeric effect for <b><tt>excite.py</tt></b>). Note that the representation which is declared in the <b><tt>initconds.excited</tt></b> file influences how  S<span style="font-size:x-small">HARC</span>&nbsp;determines the initial coefficients (see the paragraph on initial coefficients in&nbsp;&nbsp;<a href="#ssec:input:keywords">4.1.3</a>).
<div class="p"><!----></div>
Note that the representation cannot be changed if existing excited-state information is kept. 
<div class="p"><!----></div>
Hint: If the <b><tt>ICOND_%05i</tt></b> directories need to be deleted (e.g., due to disk space restrictions), making one read-out with <b><tt>excite.py</tt></b> for each representation and saving the results to two different files will preserve all necessary information.
<div class="p"><!----></div>
<b>Ionization probabilities&nbsp;&nbsp;</b>
<div class="p"><!----></div>
If <b><tt>excite.py</tt></b> detects that the ab initio results contain ionization probabilities, then those can be used instead of the transition dipole moments. Note that in this case the transition dipole moments are not written to the <b><tt>initconds.excited</tt></b> file. 
<div class="p"><!----></div>
<b>Reference energy&nbsp;&nbsp;</b>
<div class="p"><!----></div>
<b><tt>excite.py</tt></b> can read the reference energy (ground state equilibrium energy) directly from the ab initio results. If the ab initio data is read anyways, <b><tt>excite.py</tt></b> already knows the relevant path. If a dummy list of states is generated, the user can provide just the path to the <b><tt>QM.out</tt></b> file of the ab initio calculation for the equilibrium geometry. Otherwise, <b><tt>excite.py</tt></b> will prompt the user to enter a reference energy manually (in hartree).
<div class="p"><!----></div>
<b>Initial state selection&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Every excited state of each initial condition has a flag specifying it either as a valid initial state or not. <b><tt>excite.py</tt></b> has four modes how to flag the excited states:
<ol type="1">
<li> Unselect all excited states,
<div class="p"><!----></div>
</li>
<li> User provides a list of initial states,
<div class="p"><!----></div>
</li>
<li> States are selected stochastically based on excitation energies and oscillator strengths,
<div class="p"><!----></div>
</li>
<li> Keep all existing flags.
<div class="p"><!----></div>
</li>
</ol>
The first option can be used if <b><tt>excite.py</tt></b> is only used to read the ab initio results for the generation of an absorption spectrum (using <b><tt>spectrum.py</tt></b>). 
<div class="p"><!----></div>
The second option can be used to directly specify a list of initial states, if the initial state is known (e.g., starting in the ground state and exciting with an explicit laser field). In this case, the given states of <i>all</i> initial conditions are flagged as initial states.
<div class="p"><!----></div>
The third option is only available if excited-state information exists (i.e., if no dummy list is generated). For details on the stochastic selection procedure, see section&nbsp;<a href="#met:exc_selection">8.5</a>. 
<div class="p"><!----></div>
The fourth option can only be used if the existing state information is kept. In this case <b><tt>excite.py</tt></b> does nothing except counting the number of flagged initial states.
<div class="p"><!----></div>
<b>Excitation window&nbsp;&nbsp;</b>
<div class="p"><!----></div>
This option allows to exclude excited states from the selection procedure if they are outside a given energy window. This option is only available if excited state information exists, but not if a dummy list of states is generated (because the dummy states have no defined excitation energy).
<div class="p"><!----></div>
For the stochastic selection procedure, states outside the excitation window do not count for the determination of p<sub>max</sub> (see equation&nbsp;). This allows to excite, e.g., to a dark n&#960;<sup>*</sup> state despite the presence of a much brighter &#960;&#960;<sup>*</sup> state.
<div class="p"><!----></div>
For the keep-flags option, this option can be used to count the number of excited states in the energy window.
<div class="p"><!----></div>
<b>Considered states&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Here the user can specify the list of desired initial states. 
For the stochastic selection procedure, the user can instead exclude certain states from the procedure. Excluded states do not count for the determination of p<sub>max</sub> (see equation&nbsp;).
<div class="p"><!----></div>
If the number of states per multiplicity is known, <b><tt>excite.py</tt></b> will print a table giving for each state index the multiplicity, quantum number and M<sub>s</sub> value.
<div class="p"><!----></div>
<b>Random number generator seed&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The random number generator in <b><tt>excite.py</tt></b> is used in the stochastic selection procedure. Instead of typing an integer, typing "<b><tt>!</tt></b>" will initialize the RNG from the system time. Note that this will not be reproducible, i.e.&nbsp;repeating the <b><tt>excite.py</tt></b> run with "<b><tt>!</tt></b>" as random seed will give a different selection in each run.
<div class="p"><!----></div>
     <a id="tth_sEc7.3.3"></a><h3>
7.3.3&nbsp;&nbsp;Matrix diagonalization</h3>
<div class="p"><!----></div>
When using the diagonal representation, <b><tt>excite.py</tt></b> needs to diagonalize and multiply matrices. By default, the Python package  N<span style="font-size:x-small">UM</span>P<span style="font-size:x-small">Y</span> is used, if available. If the script does not find a  N<span style="font-size:x-small">UM</span>P<span style="font-size:x-small">Y</span> installation, it will use a small Fortran code which comes with the  S<span style="font-size:x-small">HARC</span>&nbsp;suite. In order for this to work, you need to set the environment variable <b><tt>$SHARC</tt></b> to the <b><tt>bin/</tt></b> directory within your  S<span style="font-size:x-small">HARC</span>&nbsp;installation. See section&nbsp;<a href="#sec:diagonalizer.x">7.13</a> for more details.
<div class="p"><!----></div>
     <a id="tth_sEc7.3.4"></a><h3>
7.3.4&nbsp;&nbsp;Output</h3>
<div class="p"><!----></div>
<b><tt>excite.py</tt></b> writes all output to a file <b><tt>&lt;BASE&#62;.excited</tt></b>, where <b><tt>&lt;BASE&#62;</tt></b> is the name of the initial conditions file used as input. The output file is also an initial conditions file, but contains additional information regarding the excited states, the reference energy and the representation of the excited states. An initial conditions file with excited-state information is needed for the final preparatory step: setting up the dynamics with <b><tt>setup_traj.py</tt></b>.
Additionally, <b><tt>spectrum.py</tt></b> can calculate absorption spectra from excited-state initial condition files.
<div class="p"><!----></div>
     <a id="tth_sEc7.3.5"></a><h3>
7.3.5&nbsp;&nbsp;Specification of the <b><tt>initconds.excited</tt></b> file format</h3><a id="sec:initcondsfile">
</a>
<div class="p"><!----></div>
The initial conditions files <b><tt>initconds</tt></b> and <b><tt>initconds.excited</tt></b> contain lists of initial conditions, which are needed for the setup of trajectories. An initial condition is a set of initial coordinates of all atoms and corresponding initial velocities of each atom, and optionally a list of excited state informations. In the following, the format of this file is specified.
<div class="p"><!----></div>
The file contains of a header, followed by the body of the file containing a list of the initial conditions. 
<div class="p"><!----></div>
<b>File header&nbsp;&nbsp;</b>
<div class="p"><!----></div>
An examplary header looks like:
<span class="footnotesize">
<pre>
SHARC&nbsp;Initial&nbsp;conditions&nbsp;file,&nbsp;version&nbsp;0.2&nbsp;&nbsp;&nbsp;&lt;Excited&#62;
Ninit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;100
Natom&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2
Repr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MCH
Eref&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-0.50
Eharm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.04
States&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;0&nbsp;1&nbsp;
Equilibrium
&nbsp;H&nbsp;&nbsp;&nbsp;1.0&nbsp;&nbsp;0.0&nbsp;&nbsp;0.0&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;1.00782503&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;0.0&nbsp;&nbsp;0.0
&nbsp;H&nbsp;&nbsp;&nbsp;1.0&nbsp;&nbsp;1.5&nbsp;&nbsp;0.0&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;1.00782503&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;0.0&nbsp;&nbsp;0.0
</pre>
  </span>
The first line must read <b><tt>SHARC Initial conditions file, version &lt;VERSION&#62;</tt></b>, with the correct version string followed. The string <b><tt>Excited</tt></b> is optional, and marks an initial conditions file as being an output file of <b><tt>excite.py</tt></b> (<b><tt>setup_traj.py</tt></b> will only accept files marked like this). The following lines contain:
<ol type="1">
<li> the number of initial conditions,
<div class="p"><!----></div>
</li>
<li> the number of atoms,
<div class="p"><!----></div>
</li>
<li> the electronic state representation (a string which is <b><tt>None</tt></b>, <b><tt>MCH</tt></b> or <b><tt>diag</tt></b>),
<div class="p"><!----></div>
</li>
<li> the reference energy (hartree),
<div class="p"><!----></div>
</li>
<li> the harmonic energy (zero point energy in the harmonic approximation, hartree),
<div class="p"><!----></div>
</li>
<li> optionally the number of states per multiplicity.
<div class="p"><!----></div>
</li>
</ol>
<div class="p"><!----></div>
After the header, first the equilibrium geometry is expected. It is demarked with the keyword <b><tt>Equilibrium</tt></b>, followed by n<sub>atom</sub> lines, each specifying one atom. Unlike the actual initial conditions, the equilibrium geometry does not have a list of excited states or defined energies.
<div class="p"><!----></div>
<b>File body&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The file body contains a list of initial conditions. Each initial condition is specified by a block starting with a line containing the string <b><tt>Index</tt></b> and the number of the initial condition. In the file, the initial conditions are expected to appear in order.
<div class="p"><!----></div>
A block specifying an initial condition looks like:
<span class="footnotesize">
<pre>
Index&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1
Atoms
&nbsp;H&nbsp;&nbsp;&nbsp;1.0&nbsp;&nbsp;-0.02&nbsp;&nbsp;0.0&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;1.00782503&nbsp;&nbsp;-0.001&nbsp;&nbsp;0.0&nbsp;&nbsp;0.0
&nbsp;H&nbsp;&nbsp;&nbsp;1.0&nbsp;&nbsp;&nbsp;1.52&nbsp;&nbsp;0.0&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;1.00782503&nbsp;&nbsp;&nbsp;0.001&nbsp;&nbsp;0.0&nbsp;&nbsp;0.0
States
001&nbsp;&nbsp;&nbsp;&nbsp;-0.49&nbsp;&nbsp;&nbsp;&nbsp;-0.49&nbsp;&nbsp;-0.16&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;-0.03&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;0.05&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;0.00&nbsp;False
002&nbsp;&nbsp;&nbsp;&nbsp;-0.25&nbsp;&nbsp;&nbsp;&nbsp;-0.49&nbsp;&nbsp;&nbsp;0.02&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;0.43&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;-1.77&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;6.5&nbsp;&nbsp;&nbsp;0.53&nbsp;True
003&nbsp;&nbsp;&nbsp;&nbsp;-0.40&nbsp;&nbsp;&nbsp;&nbsp;-0.49&nbsp;&nbsp;&nbsp;0.00&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;0.00&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;0.00&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;2.5&nbsp;&nbsp;&nbsp;0.00&nbsp;False
004&nbsp;&nbsp;&nbsp;&nbsp;-0.40&nbsp;&nbsp;&nbsp;&nbsp;-0.49&nbsp;&nbsp;&nbsp;0.00&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;0.00&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;0.00&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;2.5&nbsp;&nbsp;&nbsp;0.00&nbsp;False
005&nbsp;&nbsp;&nbsp;&nbsp;-0.40&nbsp;&nbsp;&nbsp;&nbsp;-0.49&nbsp;&nbsp;&nbsp;0.00&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;0.00&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;0.00&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;2.5&nbsp;&nbsp;&nbsp;0.00&nbsp;False
Ekin&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.004&nbsp;a.u.
Epot_harm&nbsp;&nbsp;&nbsp;0.026&nbsp;a.u.
Epot&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.013&nbsp;a.u.
Etot_harm&nbsp;&nbsp;&nbsp;0.030&nbsp;a.u.
Etot&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.018&nbsp;a.u.
</pre>
  </span>
The formal structure of such a block is as follows. After the line containing the keyword <b><tt>Index</tt></b> and the index number, the keyword <b><tt>Atoms</tt></b> indicates the start of the list of atoms. Each atom is specified on one line:
<ol type="1">
<li> symbol,
<div class="p"><!----></div>
</li>
<li> nuclear charge,
<div class="p"><!----></div>
</li>
<li> x, y, z coordinate in Bohrs,
<div class="p"><!----></div>
</li>
<li> atomic mass,
<div class="p"><!----></div>
</li>
<li> x, y and z component of nuclear velocity in atomic units.
<div class="p"><!----></div>
</li>
</ol>
<div class="p"><!----></div>
After the atom list, the keyword <b><tt>States</tt></b> indicates the list of electronic states. This list consists of one line per electronic state, but can be empty, if no information of the electronic states is available. Each line consists of: 
<ol type="1">
<li> state number (starting with 1),
<div class="p"><!----></div>
</li>
<li> state energy in Hartree,
<div class="p"><!----></div>
</li>
<li> reference energy in Hartree (usually the energy of the lowest state),
<div class="p"><!----></div>
</li>
<li> six numbers defining the transition dipole moment to the reference state (usually the lowest state),
<div class="p"><!----></div>
</li>
<li> the excitation energy in eV,
<div class="p"><!----></div>
</li>
<li> the oscillator strength,
<div class="p"><!----></div>
</li>
<li> a string which is either <b><tt>True</tt></b> or <b><tt>False</tt></b>, specifying whether the electronic state was selected by <b><tt>excite.py</tt></b> as initial electronic state.
<div class="p"><!----></div>
</li>
</ol>
The transition dipole moments are specified by six floating point numbers, which are real part of the x component, imaginary part of the x component, then the real and imaginary parts for the y and finally the z component (the transition dipole moments can be complex in the diagonal representation). 
<div class="p"><!----></div>
The electronic state list is terminated with the keyword <b><tt>Ekin</tt></b>, which at the same time gives the kinetic energy of all atoms. The remaining entries give the potential energy in the harmonic approximation and the actual potential energy, as well as the total energy.
<div class="p"><!----></div>
 <a id="tth_sEc7.4"></a><h2>
7.4&nbsp;&nbsp;Setup of Trajectories: <b><tt>setup_traj.py</tt></b></h2><a id="sec:setup_traj.py">
</a>
<div class="p"><!----></div>
This interactive script prepares the input for the excited-state dynamics simulations with  S<span style="font-size:x-small">HARC</span>. It works similarly to <b><tt>setup_init.py</tt></b>, reading an initial conditions file, prompting the user for a number of input parameters, and finally prepares one directory per trajectory. However, the <b><tt>setup_traj.py</tt></b> input section is noticeably longer, because many options for the dynamics are covered.
<div class="p"><!----></div>
     <a id="tth_sEc7.4.1"></a><h3>
7.4.1&nbsp;&nbsp;Input</h3>
<div class="p"><!----></div>
<b>Initial conditions file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Please be aware that <b><tt>setup_traj.py</tt></b> needs an initial conditions file generated by <b><tt>excite.py</tt></b> (Files generated by <b><tt>wigner.py</tt></b> are not allowed). The script reads the number of initial states, the representation and the reference energy automatically from the file.
<div class="p"><!----></div>
<b>Number of states&nbsp;&nbsp;</b>
<div class="p"><!----></div>
This is the total number of states per multiplicity included in the dynamics calculation. Affects the keyword <b><tt>nstates</tt></b> in the  S<span style="font-size:x-small">HARC</span>&nbsp;input file.
<div class="p"><!----></div>
Only advanced users should use here a different number of states than given to <b><tt>setup_init.py</tt></b>. In this case, the excited-state information in the initial conditions file might be inconsistent. For example, if 10 singlets and 10 triplets were included in the initial calculations, but only 5 singlets and 5 triplets in the dynamics, then the sixth entry in the initial conditions file corresponds to S<sub>5</sub>, while <b><tt>setup_traj.py</tt></b> assumes the sixth entry to correspond to T<sub>1</sub>.
<div class="p"><!----></div>
<b>Active states&nbsp;&nbsp;</b>
<div class="p"><!----></div>
States can be frozen for the dynamics calculation here. See section&nbsp;<a href="#met:activestates">8.2</a> for a general description of state freezing in  S<span style="font-size:x-small">HARC</span>. Only the highest states in each multiplicity can be frozen, it is not possible to, e.g., freeze the ground state in simulations where ground state relaxation is negligible. Affects the keyword <b><tt>actstates</tt></b>.
<div class="p"><!----></div>
<b>Contents of the initial conditions file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Optionally, a map of the contents of the initial conditions file can be displayed during the execution of <b><tt>setup_traj.py</tt></b>, showing for each state which initial conditions were selected (and which initial conditions do not have the necessary excited-state information). For each state, a table is given, where each symbol represents one initial condition. A dot "<b><tt>.</tt></b>" represents an initial condition where information about the current excited state is available, but which is not selected for dynamics. A hash mark "<b><tt>#</tt></b>" represents an initial condition which is selected for dynamics. A question mark "<b><tt>?</tt></b>" represents initial conditions for which no information about the excited state is available (e.g.&nbsp;if the initial excited-state calculation failed). The tutorial shows an example of this output.
<div class="p"><!----></div>
The content of the initial conditions file is also summarized in a table giving the number of initial conditions selected per state. 
<div class="p"><!----></div>
<b>Initial states for dynamics setup&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The user has to input all states from which trajectories should be launched. The numbers must be entered according to the above table giving the number of selected initial conditions per state. It is not allowed to specify inactive states as initial states. The script will give the number of trajectories which can be setup with the specified set of states. If no trajectories can be setup, the user has to specify another set of initial states. The initial state will be written to the  S<span style="font-size:x-small">HARC</span>&nbsp;input, specified in the same representation as given in the initial conditions file. The initial coefficients will be determined automatically by  S<span style="font-size:x-small">HARC</span>, according to the description in section&nbsp;<a href="#ssec:input:keywords">4.1.3</a>.
<div class="p"><!----></div>
<b>Starting index for dynamics setup&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Specifies the first initial condition within the initial condition file to be included in the setup. This is useful, for example, if the user might setup 50 trajectories starting with index 1. <b><tt>setup_traj.py</tt></b> reports afterwards the last initial condition to be used for setup, e.g.&nbsp;index 90. Later, the user can setup additional trajectories, starting with index 91.
<div class="p"><!----></div>
<b>Random number generator seed&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The random number generator in <b><tt>setup_traj.py</tt></b> is used to randomly generate RNG seeds for the  S<span style="font-size:x-small">HARC</span>&nbsp;input. Instead of typing an integer, typing "<b><tt>!</tt></b>" will initialize the RNG from the system time. Note that this will not be reproducible, i.e.&nbsp;repeating the <b><tt>setup_traj.py</tt></b> run (with the same input) with "<b><tt>!</tt></b>" as random seed will give for the same trajectories different RNG seeds. Affects the keyword <b><tt>RNGseed</tt></b>.
<div class="p"><!----></div>
<b>Interface&nbsp;&nbsp;</b>
<div class="p"><!----></div>
In this point, choose any of the displayed interfaces to carry out the ab initio calculations. Enter the corresponding number. The choice of the interface influences some dynamics options which can be set in the next section of the <b><tt>setup_traj.py</tt></b> input.
<div class="p"><!----></div>
<b>Simulation Time&nbsp;&nbsp;</b>
<div class="p"><!----></div>
This is the maximum time that  S<span style="font-size:x-small">HARC</span>&nbsp;will run the dynamics simulation. If trajectories need to be run for longer time, it is recommended to first let the simulation finish. Afterwards, increase the simulation time in the corresponding  S<span style="font-size:x-small">HARC</span>&nbsp;input file (keyword <b><tt>tmax</tt></b>) and add the restart keyword (also make sure that the <b><tt>norestart</tt></b> keyword is not present). Then the simulation can be restarted by running again the <b><tt>run.sh</tt></b> script. Sets the keyword <b><tt>tmax</tt></b> in the  S<span style="font-size:x-small">HARC</span>&nbsp;input files.
<div class="p"><!----></div>
<b>Simulation Timestep&nbsp;&nbsp;</b>
<div class="p"><!----></div>
This gives the timestep for the dynamics. The on-the-fly ab initio calculations are performed with this timestep, as is the propagation of the nuclear coordinates. A shorter timestep gives more accurate results, especially if light atoms (hydrogen) are subjected to high kinetic energies or steep gradients. Of course a shorter timestep is computationally more expensive. A good compromise in many situations is 0.5&nbsp;fs. Sets the keyword <b><tt>stepsize</tt></b> in the  S<span style="font-size:x-small">HARC</span>&nbsp;input files.
<div class="p"><!----></div>
<b>Number of substeps&nbsp;&nbsp;</b>
<div class="p"><!----></div>
This gives the number of substeps for the interpolation of the Hamiltonian for the propagation of the electronic wavefunction. Usually, 25 substeps are sufficient. In cases where the diagonal elements of the Hamiltonian are very large (very large excitation energies or a badly chosen reference energy) more substeps are necessary. Sets the keyword <b><tt>nsubsteps</tt></b> in the  S<span style="font-size:x-small">HARC</span>&nbsp;input files.
<div class="p"><!----></div>
<b>Prematurely terminate trajectories&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Usually, trajectories which relaxed to the ground state do not recross to an excited state, but vibrate indefinitely in the ground state. If the user is not interested in these vibrations, such trajectories can be terminated prematurely in order to save computational ressources. A threshold of 10-20&nbsp;fs is usually a good choice to safely detect ground state relaxation. Sets the keyword <b><tt>killafter</tt></b> in the  S<span style="font-size:x-small">HARC</span>&nbsp;input files.
<div class="p"><!----></div>
<b>Representation for the dynamics&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Either the diagonal representation can be chosen (by typing "<b><tt>yes</tt></b>") to perform dynamics with the  S<span style="font-size:x-small">HARC</span>&nbsp;methodology, or the dynamics can be performed on the MCH states (spin-diabatic dynamics <a href="#Granucci2012JCP" class="tth_citeref">[24</a>], FISH <a href="#Mitric2009PRA" class="tth_citeref">[23</a>]). Sets the keyword <b><tt>surf</tt></b> in the  S<span style="font-size:x-small">HARC</span>&nbsp;input files.
<div class="p"><!----></div>
<b>Non-adiabatic couplings&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Electronic propagation can be performed with temporal derivatives, non-adiabatic coupling vectors or overlap matrices (Local diabatization). Enter the corresponding number. Note that depending on the chosen interface, some options might not be available, as displayed by <b><tt>setup_traj.py</tt></b>. Sets the keyword <b><tt>coupling</tt></b> in the  S<span style="font-size:x-small">HARC</span>&nbsp;input files.
<div class="p"><!----></div>
<b>Gradient transformation&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The non-adiabatic coupling vectors can be used to correctly transform the gradients to the diagonal representation. If non-adiabatic coupling vectors are used anyways, this option is strongly recommended, since it gives more accurate gradients for no additional cost. Sets the keyword <b><tt>gradcorrect</tt></b> in the  S<span style="font-size:x-small">HARC</span>&nbsp;input files. If the dynamics uses the MCH representation, this question is not asked. 
<div class="p"><!----></div>
<b>Surface hop treatment&nbsp;&nbsp;</b>
<div class="p"><!----></div>
This option determines how the total energy is conserved after a surface hop. Sets the keyword <b><tt>ekincorrect</tt></b> in the  S<span style="font-size:x-small">HARC</span>&nbsp;input files.
<div class="p"><!----></div>
<b>Decoherence correction&nbsp;&nbsp;</b>
<div class="p"><!----></div>
For most applications, a decoherence correction should be enabled. Requesting decoherence correction here leads to the addition of the keyword <b><tt>decoherence</tt></b> to the  S<span style="font-size:x-small">HARC</span>&nbsp;input files. 
<div class="p"><!----></div>
Note that <b><tt>setup_traj.py</tt></b> does not allow to modify the &#945; value. In order to change the keyword <b><tt>decoherence_param</tt></b>, the user has to manually edit the  S<span style="font-size:x-small">HARC</span>&nbsp;input files.
<div class="p"><!----></div>
<b>Scaling and Damping&nbsp;&nbsp;</b>
<div class="p"><!----></div>
These two prompts set the keywords <b><tt>scaling</tt></b> and <b><tt>damping</tt></b> in the  S<span style="font-size:x-small">HARC</span>&nbsp;input files. The scaling parameter has to be positive, and the damping parameter has to be in the interval [0,1].
<div class="p"><!----></div>
<b>Gradient and non-adiabatic coupling selection&nbsp;&nbsp;</b>
<div class="p"><!----></div>
For dynamics in the MCH representation, selection of gradients is used by default, and only one gradient (of the current state) is calculated. Selection of non-adiabatic couplings is only relevant if they are used (for propagation, gradient correction or rescaling of the velocities after a surface hop). For the selection threshold, usually 0.5&nbsp;eV is sufficient, except if spin-orbit coupling is very strong and hence the gradients mix strongly.
Sets the keywords <b><tt>grad_select</tt></b> and <b><tt>nac_select</tt></b> in the  S<span style="font-size:x-small">HARC</span>&nbsp;input files.
<div class="p"><!----></div>
<b>Laser file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The user can specify to use an external laser field during the dynamics, and has to provide the path to the laser file (see section&nbsp;<a href="#sec:laser.x">7.5</a> and&nbsp;<a href="#sec:laserfile">4.5</a>). <b><tt>setup_traj.py</tt></b> will check whether the number of steps and the timesteps are compatible to the dynamics. If the interface can provide dipole moment gradients, <b><tt>setup_traj.py</tt></b> will also ask whether dipole moment gradients should be included in the simulations.
<div class="p"><!----></div>
     <a id="tth_sEc7.4.2"></a><h3>
7.4.2&nbsp;&nbsp;Interface-specific input</h3>
<div class="p"><!----></div>
This input section is basically the same as for <b><tt>setup_init.py</tt></b> (sections&nbsp;<a href="#sec:setup_init.py:molpro">7.2.3</a> to&nbsp;<a href="#sec:setup_init.py:analytical">7.2.6</a>). Note that for the dynamics simulations an initial wavefunction file is even more strongly recommended than for the initial excited-state calculations.
<div class="p"><!----></div>
For MRCI dynamics using the  C<span style="font-size:x-small">OLUMBUS</span> interface, for performance reasons it is strongly advisable to obtain the <b><tt>excitlistfiles</tt></b> before starting the dynamics. 
<div class="p"><!----></div>
     <a id="tth_sEc7.4.3"></a><h3>
7.4.3&nbsp;&nbsp;Run script setup</h3>
<div class="p"><!----></div>
Also this input section is very similar to the one in <b><tt>setup_init.py</tt></b> (see section&nbsp;<a href="#sec:setup_init.py">7.2</a>).
<div class="p"><!----></div>
     <a id="tth_sEc7.4.4"></a><h3>
7.4.4&nbsp;&nbsp;Output</h3>
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_fIg7.2">
</a>   <div style="text-align:center">  <img src="http://sharc-md.org/wp-content/uploads/2014/10/dirs_traj.png">  
<div style="text-align:center">Figure 7.2: Directory structure created by <b><tt>setup_traj.py</tt></b>. Directories are in blue, executable scripts in green and regular files in black and white. Interface files usually include initial MO coefficients, template files and interface input files.</div>
  <a id="fig:dirs_traj">
</a>
</div>
<div class="p"><!----></div>
<b><tt>setup_traj.py</tt></b> will create for each initial state a directory where all trajectories starting in this state will be put. If the initial conditions file specified that the initial conditions are in the MCH representation, then the initial states will be assumed to be in the MCH representation as well. In this case, the directories will be named <b><tt>Singlet_0</tt></b>, <b><tt>Singlet_1</tt></b>, ..., <b><tt>Doublet_0</tt></b>, <b><tt>Triplet_1</tt></b>, ... If the initial states are in the diagonal representation, then the directories are simply called <b><tt>X_1</tt></b>, ... since they do not have a definite spin.
<div class="p"><!----></div>
In each directory, subdirectories called <b><tt>TRAJ_%05i</tt></b> are created, where <b><tt>%05i</tt></b> is the initial condition index, padded to 5 digits with zeroes. In each trajectory's directory, an  S<span style="font-size:x-small">HARC</span>&nbsp;input file called <b><tt>input</tt></b> will be created, which contains all the dynamics options chosen during the <b><tt>setup_traj.py</tt></b> run. Also, files <b><tt>geom</tt></b> and <b><tt>veloc</tt></b> will be created. For trajectories setup with <b><tt>setup_traj.py</tt></b>, the determination of the initial wavefunction coefficients is done by  S<span style="font-size:x-small">HARC</span>.
Furthermore, in each trajectory directory a subdirectory <b><tt>QM</tt></b> is created, where the <b><tt>runQM.sh</tt></b> script containing the call to the interface is put. In the directory <b><tt>QM</tt></b> also all interface-specific input files will be copied.
<div class="p"><!----></div>
For each trajectory, a <b><tt>run.sh</tt></b> script will be created, which can be executed to run the dynamics simulation. You might need to adapt the run script to your cluster setup.
<div class="p"><!----></div>
Optionally, <b><tt>setup_traj.py</tt></b> also creates a script <b><tt>all_qsub.sh</tt></b>, which can be executed to submit all trajectories to a queueing system. You might need to adapt also this script to your cluster setup.
<div class="p"><!----></div>
The full directory structure created by <b><tt>setup_traj.py</tt></b> is given in figure&nbsp;<a href="#fig:dirs_traj"> 7.2</a>.
<div class="p"><!----></div>
 <a id="tth_sEc7.5"></a><h2>
7.5&nbsp;&nbsp;Laser field generation: <b><tt>laser.x</tt></b></h2><a id="sec:laser.x">
</a>
<div class="p"><!----></div>
The Fortran code <b><tt>laser.x</tt></b> can generate files containing laser fields which can be used with  S<span style="font-size:x-small">HARC</span>. It is possible to superimpose several lasers, use different polarizations and apply a number of chirp parameters.
<div class="p"><!----></div>
     <a id="tth_sEc7.5.1"></a><h3>
7.5.1&nbsp;&nbsp;Usage</h3>
<div class="p"><!----></div>
The program is simply called by 
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/laser.x
</pre>
It will interactively ask for the laser parameters. After input is complete, it writes the laser field to the file <b><tt>laser</tt></b> in the format which  S<span style="font-size:x-small">HARC</span>&nbsp;expects (see&nbsp;<a href="#sec:laserfile">4.5</a>).
<div class="p"><!----></div>
Similar to the interactive Python scripts, <b><tt>laser.x</tt></b> will also write the user input to <b><tt>KEYSTROKES.laser</tt></b>. After modifying this file, it can be used to directly execute <b><tt>laser.x</tt></b> without doing the interactive input again:
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/laser.x&nbsp;&lt;&nbsp;KEYSTROKES.laser
</pre>
<div class="p"><!----></div>
     <a id="tth_sEc7.5.2"></a><h3>
7.5.2&nbsp;&nbsp;Input</h3>
<div class="p"><!----></div>
The first four options are global and need to be entered only once, all remaining input options need to be given for every laser pulse. For the definition of laser fields see section&nbsp;<a href="#met:laser_field">8.8</a>.
<div class="p"><!----></div>
<b>Number of lasers&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Any number of lasers can be used. The output file will contain the sum of all laser pulses defined.
<div class="p"><!----></div>
<b>Real-valued field&nbsp;&nbsp;</b>
<div class="p"><!----></div>
If this is true, the output file will only contain the real parts of the laser field, while the columns defining the imaginary part of the field will be zero. Note, however, that  S<span style="font-size:x-small">HARC</span>&nbsp;will anyways only use the real part of the field in the simulations.
<div class="p"><!----></div>
<b>Time interval and steps&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The definitions of the starting time, end time and time step of the laser field must exactly match the simulation time and time substeps of the  S<span style="font-size:x-small">HARC</span>&nbsp;simulation. Note, that the laser field must always start at t=0 fs to be used with  S<span style="font-size:x-small">HARC</span>. The end time for the laser field must therefore coincide with the total simulation time given in the  S<span style="font-size:x-small">HARC</span>&nbsp;input. The number of time steps for the laser field is t<sub>total</sub>/&#8710;t<sub>sub</sub> +1.
<div class="p"><!----></div>
<b>Files for debugging&nbsp;&nbsp;</b>
<div class="p"><!----></div>
This option is normally not needed, and can be set to False. If set to True, the chirped and unchirped laser fields in both time and frequency domain will be written to files called <b><tt>DEBUG_... </tt></b>.
<div class="p"><!----></div>
<b>Polarization vector&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The polarization vector <b>p</b> (will be normalized).
<div class="p"><!----></div>
<b>Type of envelope&nbsp;&nbsp;</b>
<div class="p"><!----></div>
There are two options possible for the envelope function <i>E</i>(t), either a Gaussian envelope or a sinusoidal one (see&nbsp;<a href="#met:laser_field">8.8</a>).
<div class="p"><!----></div>
<b>Field strength&nbsp;&nbsp;</b>
<div class="p"><!----></div>
There are two input lines for the field strength <i>E</i><sub>0</sub>, the first defining the unit in which the field strength is defined, the second gives the corresponding number. Field strength can be read in in GV/m, TW/cm<sup>&#8722;2</sup> or atomic units.
<div class="p"><!----></div>
<b>FWHM and time intervals&nbsp;&nbsp;</b>
<div class="p"><!----></div>
This option depends on the type of envelope chosen. While in both cases all 5 numbers need to be entered, for a Gaussian pulse only the first and third number have an effect. For a sinusoidal pulse all but the first number has an effect.
<div class="p"><!----></div>
For a Gaussian pulse, the first argument corresponds to FWHM in equation&nbsp; and the third argument to t<sub>c</sub> in &nbsp;.
<div class="p"><!----></div>
For a sinusoidal pulse, the second, third, fourth and fifth argument correspond to t<sub>0</sub>, t<sub>c</sub>, t<sub>c2</sub> and t<sub>e</sub>, respectively, in equation&nbsp;.
<div class="p"><!----></div>
<b>Central frequency&nbsp;&nbsp;</b>
<div class="p"><!----></div>
There are two input lines for the central frequency &#969;<sub>0</sub>. The first defines the unit (wavelength in nm, energy in eV, or atomic units). The second line gives the value.
<div class="p"><!----></div>
<b>Phase&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The total phase &#981; is given in multiples of &#960;. For example, the input "<b><tt>1.5</tt></b>" gives a phase of [(3&#960;)/2].
<div class="p"><!----></div>
<b>Chirp parameters&nbsp;&nbsp;</b>
<div class="p"><!----></div>
There are four lines giving the chirp parameters b<sub>1</sub>, b<sub>2</sub>, b<sub>3</sub> and b<sub>4</sub>. See equation&nbsp; for the meaning of these parameters.
<div class="p"><!----></div>
 <a id="tth_sEc7.6"></a><h2>
7.6&nbsp;&nbsp;Calculation of Absorption Spectra: <b><tt>spectrum.py</tt></b></h2><a id="sec:spectrum.py">
</a>
<div class="p"><!----></div>
Aside from setting up trajectories, the <b><tt>initconds.excited</tt></b> files can also be used to generate absorption spectra based on the excitation energies and oscillator strengths in the file. The script <b><tt>spectrum.py</tt></b> calculates Gaussian or Lorentzian convolutions of these data in order to obtain spectra. See section&nbsp;<a href="#met:spectrum">8.1</a> for further details.
<div class="p"><!----></div>
<b><tt>spectrum.py</tt></b> evaluates the absorption spectrum on a grid for all states it finds in an initial conditions file. Using command-line options, some initial conditions can be omitted in the convolution, see table&nbsp;<a href="#tab:spectrum_opts"> 7.2</a>.
<div class="p"><!----></div>
     <a id="tth_sEc7.6.1"></a><h3>
7.6.1&nbsp;&nbsp;Input</h3>
<div class="p"><!----></div>
The script is executed with the initial conditions file as argument:
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/spectrum.py&nbsp;[OPTIONS]&nbsp;initconds.excited
</pre>
<div class="p"><!----></div>
The script accepts a number of command-line options, which are given in table&nbsp;<a href="#tab:spectrum_opts"> 7.2</a>.
<div class="p"><!----></div>
<a id="tth_tAb7.2">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 7.2: Command-line options for script <b><tt>spectrum.py</tt></b>.</div>
  <a id="tab:spectrum_opts">
</a>
<table>
<tr><td align="left">
    <span class="roman">Option        </td><td align="left">Description      </td><td align="left">Default</td></tr>
<tr><td align="left">
    -h                  </td><td align="left">Display help message and quit.         </td><td align="left">-        </td></tr>
<tr><td align="left">-o FILENAME         </td><td align="left">Output filename (for the spectrum)     </td><td align="left"><b><tt>spectrum.out</tt></b></td></tr>
<tr><td align="left">-n INTEGER          </td><td align="left">Number of grid points                  </td><td align="left">500       </td></tr>
<tr><td align="left">-e FLOAT FLOAT      </td><td align="left">Energy range (eV) for the spectrum     </td><td align="left">1 to 10 eV</td></tr>
<tr><td align="left">-i INTEGER INTEGER  </td><td align="left">Index range for the initial conditions </td><td align="left">1 to 1000</td></tr>
<tr><td align="left">-f FLOAT            </td><td align="left">FWHM (eV) for the spectrum             </td><td align="left">0.1 eV</td></tr>
<tr><td align="left">-G                  </td><td align="left">Gaussian convolution                   </td><td align="left">Gaussian</td></tr>
<tr><td align="left">-L                  </td><td align="left">Lorentzian convolution                 </td><td align="left">Gaussian</td></tr>
<tr><td align="left">-s                  </td><td align="left">Use only selected initial conditions   </td><td align="left">Use all</td></tr>
<tr><td align="left">-l                  </td><td align="left">Make a line spectrum                   </td><td align="left">Convolution</td></tr>
<tr><td align="left">--gnuplot FILENAME  </td><td align="left">Write a  G<span style="font-size:x-small">NUPLOT</span> script        </td><td align="left">No  G<span style="font-size:x-small">NUPLOT</span> script</td></tr>
<tr><td align="left">
  </td></tr></span></table>
</div>
<div class="p"><!----></div>
     <a id="tth_sEc7.6.2"></a><h3>
7.6.2&nbsp;&nbsp;Output</h3>
<div class="p"><!----></div>
The script writes the absorption spectrum to a file (by default <b><tt>spectrum.out</tt></b>). Using the <b><tt>-o</tt></b> option, the user can redirect the output to a suitable file. The output is a table containing n+2 columns, where n is the number of states found in the initial conditions file. The first column gives the energy in eV, within the given energy interval. In columns 2 to n+1 the state-wise absorption spectra are given. The last column contains the total absorption spectrum, i.e., the sum over all states. The table has n<sub>grid</sub>+1 rows. For line spectra the output format is exactly the same, however, the file will contain one row for each excited state of each initial condition in the initial conditions file.
<div class="p"><!----></div>
Additionally, the script writes some information about the calculation to standard output, among these the maximum of the spectrum, which can be used in order to normalize the spectrum. The reported maximum is simply the largest value in the last column of the spectrum. 
<div class="p"><!----></div>
If requested, the script generates a  G<span style="font-size:x-small">NUPLOT</span> script, which can be used to directly plot the spectrum. 
<div class="p"><!----></div>
 <a id="tth_sEc7.7"></a><h2>
7.7&nbsp;&nbsp;File transfer: <b><tt>retrieve.sh</tt></b></h2><a id="sec:retrieve">
</a>
<div class="p"><!----></div>
Usually,  S<span style="font-size:x-small">HARC</span>&nbsp;will run on some temporary directory, and not in the directory where the trajectories have been submitted from. The shell script <b><tt>retrieve.sh</tt></b> is a simple <b><tt>scp</tt></b> wrapper, which can be executed (in a directory where a trajectory has been sent from) in order to retrieve the output files of this trajectory. This might not work for every cluster setup.
<div class="p"><!----></div>
It relies on the presence of the file <b><tt>host_infos</tt></b>. All trajectories set up with <b><tt>setup_traj.py</tt></b> create this file after the trajectory has been started with <b><tt>run.sh</tt></b>. <b><tt>retrieve.sh</tt></b> reads <b><tt>host_infos</tt></b> to determine the hostname and working directory of the trajectory and then uses <b><tt>scp</tt></b> to retrieve the output and restart files.
<div class="p"><!----></div>
The script can be called with the option "<b><tt>-lis</tt></b>" in order to only retrieve the <b><tt>output.lis</tt></b> file, but not the other output files.
<div class="p"><!----></div>
If the script is called with the option "<b><tt>-res</tt></b>" then also the restart files and the content of the <b><tt>restart/</tt></b> directory are copied.
<div class="p"><!----></div>
It is advisable to configure public-key authentification for the hosts running the trajectories, so that not for every execution of <b><tt>retrieve.sh</tt></b> a password has to be entered.
<div class="p"><!----></div>
 <a id="tth_sEc7.8"></a><h2>
7.8&nbsp;&nbsp;Data Extractor: <b><tt>data_extractor.x</tt></b></h2><a id="sec:data_extractor.x">
</a>
<div class="p"><!----></div>
The output of  S<span style="font-size:x-small">HARC</span>&nbsp;is mainly written to <b><tt>output.dat</tt></b>. In order to obtain plottable files in tabular format, the Fortran program <b><tt>data_extractor.x</tt></b> is used.
<div class="p"><!----></div>
     <a id="tth_sEc7.8.1"></a><h3>
7.8.1&nbsp;&nbsp;Usage</h3>
<div class="p"><!----></div>
The <b><tt>data_extractor.x</tt></b> is a command line tool, and is called with the <b><tt>output.dat</tt></b> file as an argument.
<pre>
user@host&#62;&nbsp;$SHARC/data_extractor.x&nbsp;output.dat
</pre>
The program will create a directory <b><tt>output_data/</tt></b> in the current working directory (not necessarily in the directory where <b><tt>output.dat</tt></b> resides). In this directory, several files are written, containing e.g.&nbsp;the potential energies depending on time, etc.
<div class="p"><!----></div>
The program will extract the complete <b><tt>output.dat</tt></b> file until it reaches the EOF. No further input except for the data file can be given.
<div class="p"><!----></div>
     <a id="tth_sEc7.8.2"></a><h3>
7.8.2&nbsp;&nbsp;Output</h3>
<div class="p"><!----></div>
After the program finishes, the directory <b><tt>output_data/</tt></b> contains a number of files. In each file, the number of columns is dependent in the total number n of states i &#8712; {1...n}. The content of the files is listed in Table&nbsp;<a href="#tab:outputdata"> 7.3</a>.
<div class="p"><!----></div>
The file <b><tt>expec.out</tt></b> contains the information of <b><tt>energy.out</tt></b>, <b><tt>spin.out</tt></b> and <b><tt>fosc.out</tt></b> in one file. The content of <b><tt>expec.out</tt></b> can be conveniently plotted by using <b><tt>make_gnuscript.py</tt></b> to generate a  G<span style="font-size:x-small">NUPLOT</span> script.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb7.3">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 7.3: Content of the files written by <b><tt>data_extractor.x</tt></b>. n is the total number of states, j is a state index (j &#8712; {1..n}).</div>
  <a id="tab:outputdata">
</a>
<table>
<tr><td align="left">
    File  </td><td align="center"># Columns     </td><td colspan="2" align="left">Columns</td></tr>
<tr><td align="left">
    coeff_diag.out       </td><td align="center">2+2n
      </td><td align="left">1 </td><td align="left">Time t (fs)</td></tr>
<tr><td align="left"></td><td align="center"></td><td align="left">2 </td><td align="left">Norm of wavefunction &#8721;<sub>j</sub> &#124;c<sub>j</sub><sup>diag</sup>&#124;<sup>2</sup></td></tr>
<tr><td align="left"></td><td align="center"></td><td align="left">1+2j </td><td align="left">&#8476;(c<sub>j</sub><sup>diag</sup>)</td></tr>
<tr><td align="left"></td><td align="center"></td><td align="left">2+2j </td><td align="left">&#8465;(c<sub>j</sub><sup>diag</sup>)</td></tr>
<tr><td align="left">coeff_MCH.out       </td><td align="center">2+2n
      </td><td align="left">1 </td><td align="left">Time t (fs)</td></tr>
<tr><td align="left"></td><td align="center"></td><td align="left">2 </td><td align="left">Norm of wavefunction &#8721;<sub>j</sub> &#124;c<sub>j</sub><sup>MCH</sup>&#124;<sup>2</sup></td></tr>
<tr><td align="left"></td><td align="center"></td><td align="left">1+2j </td><td align="left">&#8476;(c<sub>j</sub><sup>MCH</sup>)</td></tr>
<tr><td align="left"></td><td align="center"></td><td align="left">2+2j </td><td align="left">&#8465;(c<sub>j</sub><sup>MCH</sup>)</td></tr>
<tr><td align="left">energy.out       </td><td align="center">4+n
      </td><td align="left">1 </td><td align="left">Time t (fs)</td></tr>
<tr><td align="left"></td><td align="center"></td><td align="left">2 </td><td align="left">Kinetic energy (eV)</td></tr>
<tr><td align="left"></td><td align="center"></td><td align="left">3 </td><td align="left">Potential energy (eV) of active state</td></tr>
<tr><td align="left"></td><td align="center"></td><td align="left">4 </td><td align="left">Total energy (eV)</td></tr>
<tr><td align="left"></td><td align="center"></td><td align="left">4+j </td><td align="left">Potential energy (eV) of state j</td></tr>
<tr><td align="left">fosc.out       </td><td align="center">2+n
      </td><td align="left">1 </td><td align="left">Time t (fs)</td></tr>
<tr><td align="left"></td><td align="center"></td><td align="left">2 </td><td align="left">Oscillator strength of active state</td></tr>
<tr><td align="left"></td><td align="center"></td><td align="left">2+j </td><td align="left">Oscillator strength of state j</td></tr>
<tr><td align="left">spin.out       </td><td align="center">2+n
      </td><td align="left">1 </td><td align="left">Time t (fs)</td></tr>
<tr><td align="left"></td><td align="center"></td><td align="left">2 </td><td align="left">Total spin expectation value of active state</td></tr>
<tr><td align="left"></td><td align="center"></td><td align="left">2+j </td><td align="left">Total spin expectation value of state j</td></tr>
<tr><td align="left">prob.out       </td><td align="center">2+n
      </td><td align="left">1 </td><td align="left">Time t (fs)</td></tr>
<tr><td align="left"></td><td align="center"></td><td align="left">2 </td><td align="left">Random number from surface hopping</td></tr>
<tr><td align="left"></td><td align="center"></td><td align="left">2+j </td><td align="left">Cumulated hopping probability &#8721;<sub>k=1</sub><sup>j</sup> P<sub>k</sub></td></tr>
<tr><td align="left">expec.out      </td><td align="center">4+3n
      </td><td align="left">1 </td><td align="left">Time t (fs)</td></tr>
<tr><td align="left"></td><td align="center"></td><td align="left">2 </td><td align="left">Kinetic energy (eV)</td></tr>
<tr><td align="left"></td><td align="center"></td><td align="left">3 </td><td align="left">Potential energy (eV) of active state</td></tr>
<tr><td align="left"></td><td align="center"></td><td align="left">4 </td><td align="left">Total energy (eV)</td></tr>
<tr><td align="left"></td><td align="center"></td><td align="left">4+j </td><td align="left">Potential energy (eV) of state j</td></tr>
<tr><td align="left"></td><td align="center"></td><td align="left">4+n+j </td><td align="left">Total spin expectation value of state j</td></tr>
<tr><td align="left"></td><td align="center"></td><td align="left">4+2n+j </td><td align="left">Oscillator strength of state j</td></tr>
<tr><td align="left">
  </td></tr></table>
</div>
<div class="p"><!----></div>
 <a id="tth_sEc7.9"></a><h2>
7.9&nbsp;&nbsp;Plotting the Extracted Data: <b><tt>make_gnuscript.py</tt></b></h2><a id="sec:make_gnuscript.py">
</a>
<div class="p"><!----></div>
The contents of the output files of <b><tt>data_extractor.x</tt></b> can be plotted with  G<span style="font-size:x-small">NUPLOT</span>. In order to quickly generate an appropriate  G<span style="font-size:x-small">NUPLOT</span> script, <b><tt>make_gnuscript.py</tt></b> can be used. The usage is:
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/make_gnuscript.py&nbsp;&lt;S&#62;&nbsp;[&lt;D&#62;&nbsp;[&lt;T&#62;&nbsp;[&lt;Q&#62;&nbsp;...&nbsp;]&nbsp;]&nbsp;]
</pre>
<b><tt>make_gnuscript.py</tt></b> takes between 1 and 8 integers as command-line arguments, specifying the number of singlet, doublet, triplet, etc.&nbsp;states. It writes an appropriate  G<span style="font-size:x-small">NUPLOT</span> script to standard out, hence redirect the output to a file, e.g.:
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/make_gnuscript.py&nbsp;3&nbsp;0&nbsp;2&nbsp;&#62;&nbsp;gnuscript.gp
</pre>
<div class="p"><!----></div>
Then,  G<span style="font-size:x-small">NUPLOT</span> can be run in the <b><tt>output_data</tt></b> directory of a trajectory:
<pre>
user@host&#62;&nbsp;gnuplot&nbsp;gnuscript.gp
</pre>
This can also be accomplished in one step using a pipe, e.g.:
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/make_gnuscript.py&nbsp;3&nbsp;0&nbsp;2&nbsp;|&nbsp;gnuplot
</pre>
<div class="p"><!----></div>
The created plot script generates four different plots (press ENTER in the command-line where you started  G<span style="font-size:x-small">NUPLOT</span> to go to the next plot). The first plot shows the potential energy of all states in the dynamics over time in the diagonal representation. The currently occupied state is marked with black circles. A thin black line gives the total energy (sum of the kinetic energy and the potential energy of the currently occupied state). Each state is colored, with one color as contour and one color at the core of the line. The contour color represents the total spin expectation value of the state. The core color represents the oscillator strength of the state with the lowest state. See figure&nbsp;<a href="#fig:colors"> 7.3</a> for the relevant color code.
<div class="p"><!----></div>
<a id="tth_fIg7.3">
</a>   <div style="text-align:center">  <img src="http://sharc-md.org/wp-content/uploads/2014/10/colors.png">  
<div style="text-align:center">Figure 7.3: Color code for plots generated with the use of <b><tt>make_gnuscript.py</tt></b>.</div>
  <a id="fig:colors">
</a>
</div>
<div class="p"><!----></div>
Note that by definition the "oscillator strength" of the lowest state with itself is exactly zero, hence the lowest state is also light grey. This dual coloring allows for a quick recognition of different types of states in the dynamics, e.g.&nbsp;singlets vs.&nbsp;triplets or n&#960;<sup>*</sup> vs.&nbsp;&#960;&#960;<sup>*</sup> states.
<div class="p"><!----></div>
The second plot shows the population &#124;c<sub>i</sub><sup>MCH</sup>&#124;<sup>2</sup> of the MCH electronic states over time. The line colors are auto-generated in order to give a large spread of all colors over the excited states, but the colors might be sub-optimal, e.g.&nbsp;for printing. In this cases, the user should manually adjust the colors in the generated script.
<div class="p"><!----></div>
The third plot shows the population &#124;c<sub>i</sub><sup>diag</sup>&#124;<sup>2</sup> of the diagonal electronic states over time. These are the populations which are actually used for surface hopping. However, since these states are spin-mixed, it is usually difficult to interpret these populations.
<div class="p"><!----></div>
The fourth plot shows the surface hopping probabilities over time. The plot is setup in such a way that the visible area corresponding to a certain state is proportional to the probability to hop into the state. Hence, if for a given timestep the random number (black circles) lies within a colored area, a surface hop to the corresponding state is performed.
<div class="p"><!----></div>
 <a id="tth_sEc7.10"></a><h2>
7.10&nbsp;&nbsp;Calculation of Ensemble Populations: <b><tt>populations.py</tt></b></h2><a id="sec:populations.py">
</a>
<div class="p"><!----></div>
For an ensemble of trajectories, usually one of the most relevant results are ensemble-averaged populations. The interactive script <b><tt>populations.py</tt></b> collects these populations from a set of trajectories. 
<div class="p"><!----></div>
Different methods to obtain populations or quantities approximating populations can be collected, as described below.
<div class="p"><!----></div>
     <a id="tth_sEc7.10.1"></a><h3>
7.10.1&nbsp;&nbsp;Usage</h3>
<div class="p"><!----></div>
The script is interactive, simply start it with no command-line arguments or options:
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/populations.py
</pre>
<div class="p"><!----></div>
Depending on the analysis mode (see below) it might be necessary to run <b><tt>data_extractor.x</tt></b> for each trajectory prior to running <b><tt>populations.py</tt></b>. 
<div class="p"><!----></div>
<b>Paths to trajectories&nbsp;&nbsp;</b>
<div class="p"><!----></div>
First the script asks the user to specify all directories for whose content the analysis should be performed. Enter one directory path at a time, and finish the directory input section by typing "<b><tt>end</tt></b>". Please do not specify each trajectory directory separately, but specify their parent directories, e.g.&nbsp;the directories <b><tt>Singlet_1</tt></b> and <b><tt>Singlet_2</tt></b>. <b><tt>populations.py</tt></b> will automatically include all trajectories contained in these directories.
<div class="p"><!----></div>
If you want to exclude certain trajectories from the analysis, it is sufficient to create an empty file called <b><tt>CRASHED</tt></b> or <b><tt>RUNNING</tt></b> in the corresponding trajectory directory. <b><tt>populations.py</tt></b> will ignore all directories containing one of these files.
<div class="p"><!----></div>
<b>Analysis mode&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Using <b><tt>populations.py</tt></b>, there are two basic ways in obtaining the excited-state populations. The first way is to count the number of trajectories for which a certain condition holds. For example, the number of trajectories in each classical state can be obtained in this way. However, it is also possible to count the number of trajectories for which the total spin expectation value is within a certain interval. 
The second way to obtain populations is to obtain the sum of the absolute squares of the quantum amplitudes over all trajectories. Table&nbsp;<a href="#tab:Populations_modes"> 7.4</a> contains a list of all possible analysis modes.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb7.4">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 7.4: Analysis modes for <b><tt>populations.py</tt></b>. The last column indicates whether <b><tt>data_extractor.x</tt></b> has to be run prior to the ensemble analysis.</div>
  <a id="tab:Populations_modes">
</a>
<table>
<tr><td align="left">
    Mode        </td><td width="237">Description    </td><td align="left"><span class="roman">From which     </td><td align="center">Extract?</td></tr>
<tr><td align="left"></td><td width="237"></td><td align="left"><span class="roman">file?          </td><td align="center"></td></tr>
<tr><td align="left">
    1   </td><td width="237">For each diagonal state count how many trajectories have this state as active state. </td><td align="left">output.lis  </td><td align="center">No</td></tr>
<tr><td align="left">2   </td><td width="237">For each MCH state count how many trajectories have this state as approximate active state (see section&nbsp;<a href="#ssec:state_transform">8.11.1</a>). </td><td align="left">output.lis  </td><td align="center">No</td></tr>
<tr><td align="left">3   </td><td width="237">For each MCH state count how many trajectories have this state as approximate active state (see section&nbsp;<a href="#ssec:state_transform">8.11.1</a>). Multiplet components are summed up. </td><td align="left">output.lis  </td><td align="center">No</td></tr>
<tr><td align="left">4   </td><td width="237">Generate a histogram with definable bins (variable width). Bin the trajectories according to their total spin expectation value (of the currently active diagonal state).   </td><td align="left">output.lis </td><td align="center">No</td></tr>
<tr><td align="left">5   </td><td width="237">Generate a histogram with definable bins (variable width). Bin the trajectories according to their state dipole moment expectation value (of the currently active diagonal state).   </td><td align="left">output.lis </td><td align="center">No</td></tr>
<tr><td align="left">6   </td><td width="237">Generate a histogram with definable bins (variable width). Bin the trajectories according to the oscillator strength between lowest and currently active diagonal states.        </td><td align="left">output_data/fosc.out  </td><td align="center">Yes</td></tr>
<tr><td align="left">7   </td><td width="237">Calculate the sum of the absolute squares of the diagonal coefficients for each state.       </td><td align="left">output_data/coeff_diag.out</td><td align="center">Yes</td></tr>
<tr><td align="left">8   </td><td width="237">Calculate the sum of the absolute squares of the MCH coefficients for each state.       </td><td align="left">output_data/coeff_MCH.out</td><td align="center">Yes</td></tr>
<tr><td align="left">9   </td><td width="237">Calculate the sum of the absolute squares of the MCH coefficients for each state. Multiplet components are summed up.       </td><td align="left">output_data/coeff_MCH.out</td><td align="center">Yes</td></tr>
<tr><td align="left">10   </td><td width="237">Calculate the sum of the absolute squares of the diabatic coefficients for each state (Only for trajectories with local diabatization).      </td><td align="left">output_data/coeff_diab.out</td><td align="center">Yes</td></tr>
<tr><td align="left">
  </td></tr></span></span></table>
</div>
<div class="p"><!----></div>
<b>Run data extractor&nbsp;&nbsp;</b>
<div class="p"><!----></div>
For analysis modes 6, 7, 8, 9 and 10 it is necessary to first run the data extractor (see section&nbsp;<a href="#sec:data_extractor.x">7.8</a>). This task can be accomplished by <b><tt>populations.py</tt></b>. However, for a large ensemble or for long trajectories this may take some time. Hence, it is not necessary to perform this step each time <b><tt>populations.py</tt></b> is run. 
<div class="p"><!----></div>
<b><tt>populations.py</tt></b> will detect whether the file <b><tt>output.dat</tt></b> or the content of <b><tt>output_data/</tt></b> is more recent. Only if <b><tt>output.dat</tt></b> is newer the <b><tt>data_extractor.x</tt></b> will be run for this trajectory.
<div class="p"><!----></div>
Note that mode 10 can only be used for trajectories using local diabatization propagation (keyword <b><tt>coupling overlap</tt></b> in  S<span style="font-size:x-small">HARC</span>&nbsp;input file).
<div class="p"><!----></div>
<b>Number of states&nbsp;&nbsp;</b>
<div class="p"><!----></div>
For analysis modes 1, 2, 3, 7, 8 and 9 it is necessary to specify the number of states in each multiplicity. The number is auto-detected from the input file of one of the trajectories.
<div class="p"><!----></div>
<b>Intervals&nbsp;&nbsp;</b>
<div class="p"><!----></div>
For analysis modes 4, 5 and 6 the user must specify the intervals for the classification of the trajectories. The user has to input a list of interval borders, e.g.:
<pre>
Please&nbsp;enter&nbsp;the&nbsp;interval&nbsp;limits,&nbsp;all&nbsp;on&nbsp;one&nbsp;line.
Interval&nbsp;limits:&nbsp;1e-3&nbsp;0.01&nbsp;0.1&nbsp;1
</pre>
<div class="p"><!----></div>
Note that scientific notation can be used. Based on this input, for each timestep a histogram is created with the number of trajectories in each interval. The histogram bins are:
<ol type="1">
<li> x &#8804; 10<sup>&#8722;3</sup>
<div class="p"><!----></div>
</li>
<li> 10<sup>&#8722;3</sup> &lt; x &#8804; 10<sup>&#8722;2</sup>
<div class="p"><!----></div>
</li>
<li> 10<sup>&#8722;2</sup> &lt; x &#8804; 10<sup>&#8722;1</sup>
<div class="p"><!----></div>
</li>
<li> 10<sup>&#8722;2</sup> &lt; x &#8804; 10<sup>0</sup>
<div class="p"><!----></div>
</li>
<li> 10<sup>0</sup> &lt; x
<div class="p"><!----></div>
</li>
</ol>
Note that there is always one more bin that interval borders entered.
<div class="p"><!----></div>
<b>Normalization&nbsp;&nbsp;</b>
<div class="p"><!----></div>
If desired, <b><tt>populations.py</tt></b> can normalize the populations by dividing the populations by the number of trajectories. 
<div class="p"><!----></div>
<b>Maximum simulation time&nbsp;&nbsp;</b>
<div class="p"><!----></div>
This gives the maximum simulation time until which the populations are analyzed. For trajectories which are shorter than this value, the last population information is used to make the trajectory long enough. Trajectories which are longer are not analyzed to the end. <b><tt>populations.py</tt></b> prints the length of the shortest and longest trajectories after the analysis.
<div class="p"><!----></div>
<b>Gnuplot script&nbsp;&nbsp;</b>
<div class="p"><!----></div>
<b><tt>populations.py</tt></b> can generate an appropriate  G<span style="font-size:x-small">NUPLOT</span> script for the performed population analysis. 
<div class="p"><!----></div>
     <a id="tth_sEc7.10.2"></a><h3>
7.10.2&nbsp;&nbsp;Output</h3>
<div class="p"><!----></div>
By default, <b><tt>populations.py</tt></b> writes the resulting populations to <b><tt>pop.out</tt></b>. If the file already exists, the user is ask whether it shall be overwritten, or to provide an alternative filename. Note that the output file is checked only after the analysis is completed, so the program might run for a considerable amount of time before asking for the output file.
<div class="p"><!----></div>
 <a id="tth_sEc7.11"></a><h2>
7.11&nbsp;&nbsp;Obtaining special geometries: <b><tt>crossing.py</tt></b></h2><a id="sec:crossing.py">
</a>
<div class="p"><!----></div>
In many cases, it is also important to obtain certain special geometries from the trajectories. The script <b><tt>crossing.py</tt></b> extracts geometries fulfilling special conditions from an ensemble of trajectories. 
<div class="p"><!----></div>
Currently, <b><tt>crossing.py</tt></b> finds geometries where the approximate MCH state (see section&nbsp;<a href="#ssec:state_transform">8.11.1</a>) of the last timestep is different from the MCH state of the current timestep (i.e.&nbsp;<b><tt>crossing.py</tt></b> finds geometries where surface hops occured). 
<div class="p"><!----></div>
     <a id="tth_sEc7.11.1"></a><h3>
7.11.1&nbsp;&nbsp;Usage</h3>
<div class="p"><!----></div>
The script is interactive, simply start it with no command-line arguments or options:
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/crossing.py
</pre>
<div class="p"><!----></div>
The input to the script is very similar to the one of <b><tt>populations.py</tt></b>. 
<div class="p"><!----></div>
<b>Paths to trajectories&nbsp;&nbsp;</b>
<div class="p"><!----></div>
First the script asks the user to specify all directories for whose content the analysis should be performed. Enter one directory path at a time, and finish the directory input section by typing "<b><tt>end</tt></b>". Please do not specify each trajectory directory separately, but specify their parent directories, e.g.&nbsp;the directories <b><tt>Singlet_1</tt></b> and <b><tt>Singlet_2</tt></b>. <b><tt>crossing.py</tt></b> will automatically include all trajectories contained in these directories.
<div class="p"><!----></div>
If you want to exclude certain trajectories from the analysis, it is sufficient to create an empty file called <b><tt>CRASHED</tt></b> or <b><tt>RUNNING</tt></b> in the corresponding trajectory directory. <b><tt>crossing.py</tt></b> will ignore all directories containing one of these files.
<div class="p"><!----></div>
<b>Analysis mode&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Currently, <b><tt>crossing.py</tt></b> only supports one analysis mode, where <b><tt>crossing.py</tt></b> is scanning for each trajectory the file <b><tt>output.lis</tt></b>. If the occupied MCH state (column 4 in output file <b><tt>output.lis</tt></b>) changes from one timestep to the next, it is checked whether the old and new MCH states are the ones specified by the user. If this is the case, the geometry corresponding to the new timestep (t) is retrieved from <b><tt>output.xyz</tt></b> (lines t(n<sub>atom</sub>+2)+1 to t(n<sub>atom</sub>+2)+n<sub>atom</sub>). 
<div class="p"><!----></div>
<b>States involved in surface hop&nbsp;&nbsp;</b>
<div class="p"><!----></div>
First, the user has to specify the permissible old MCH state. The state has to be specified with two integers, the first giving the multiplicity (<b><tt>1</tt></b>=singlet, ...), the second the state within the multiplicity (<b><tt>1 1</tt></b>=S<sub>0</sub>, <b><tt>1 2</tt></b>=S<sub>1</sub>, etc.). If a state of higher multiplicity is given, <b><tt>crossing.py</tt></b> will report all geometries where the old MCH state is any of the multiplet components. 
<div class="p"><!----></div>
For the new MCH state, the same is valid.
<div class="p"><!----></div>
Third, the direction of the surface hop has to be specified. Choosing "Backwards" has the same effect as exchanging the old and new MCH states. 
<div class="p"><!----></div>
     <a id="tth_sEc7.11.2"></a><h3>
7.11.2&nbsp;&nbsp;Output</h3>
<div class="p"><!----></div>
All geometries are in the end written to an output file, by default <b><tt>crossing.xyz</tt></b>. The file is in standard xyz format. The comment of each geometry gives the path to the trajectory where this geometry was extracted, the simulation time and the diagonal and MCH states at this simulation time. 
<div class="p"><!----></div>
 <a id="tth_sEc7.12"></a><h2>
7.12&nbsp;&nbsp;Internal Coordinates Analysis: <b><tt>geo.py</tt></b></h2><a id="sec:geo.py">
</a>
<div class="p"><!----></div>
 S<span style="font-size:x-small">HARC</span>&nbsp;writes at every timestep the molecular geometry to the file <b><tt>output.xyz</tt></b>. The non-interactive script <b><tt>geo.py</tt></b> can be used in order to extract internal coordinates from xyz files. The usage is:
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/geo.py&nbsp;[options]&nbsp;&lt;&nbsp;Geo.inp&nbsp;&#62;&nbsp;Geo.out
</pre>
By default, the coordinates are read from <b><tt>output.xyz</tt></b>, but this can be changed with the <b><tt>-g</tt></b> option (see table&nbsp;<a href="#tab:Geo_options"> 7.6</a>). Note that the internal coordinate specifications are read from standard input and the result table is written to standard out. 
<div class="p"><!----></div>
     <a id="tth_sEc7.12.1"></a><h3>
7.12.1&nbsp;&nbsp;Input</h3>
<div class="p"><!----></div>
The specifications for the desired internal coordinates are read from standard input. It follows a simple syntax, where each internal coordinate is specified by a single line of input. Each line starts with a one-letter key which specifies the type of internal coordinate (e.g.&nbsp;bond length, angle, dihedral, ...). The key is followed by a list of integers, specifying which atoms should be measured. As a simple example, <b><tt>r 1 2</tt></b> specifies the bond length (<b><tt>r</tt></b> is the key for bond lengths) between atoms 1 and 2. Note that the numbering of the atoms starts with 1. Each line of input is checked for consistency (whether any atom index is larger than the number of atoms, repeated atom indices, misspelled keys, wrong number of atom indices, ...), and erroneous lines are ignored (this is indicate by an error message).
<div class="p"><!----></div>
Table&nbsp;<a href="#tab:Geo_input"> 7.5</a> lists the available types of internal coordinates. The output is a table, where the first column is the time (Actually, the geometries are just enumerated starting with zero, and the number multiplied by the timestep from the <b><tt>-t</tt></b> option). The successive columns in the output table list the results of the internal coordinates calculations. Each request generates at least one column, see table&nbsp;<a href="#tab:Geo_input"> 7.5</a>. 
<div class="p"><!----></div>
Note that for most internal coordinates, the order of the atoms is crucial, since e.g.&nbsp;a<sub>123</sub> &#8800; a<sub>213</sub>. This also holds for the Cremer-Pople parameter requests. For these input lines, the atoms should be listed in the order they appear in the ring (clockwise or counter-clockwise).
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb7.5">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 7.5: Possible types of internal coordinates in <b><tt>geo.py</tt></b>. </div>
  <a id="tab:Geo_input">
</a>
<table>
<tr><td align="center">
    <span class="roman">Key         </td><td align="right"><span class="roman"><span class="roman">Atom      </td><td align="left">Description    </td><td align="left">Output columns</td></tr>
<tr><td align="center"></td><td align="right"><span class="roman"><span class="roman">Indices   </td><td align="left"></td><td align="left"></td></tr>
<tr><td align="center">
    x   </td><td align="right">a              </td><td align="left">x coordinate of atom <b><tt>a</tt></b>         </td><td align="left">x</td></tr>
<tr><td align="center">y   </td><td align="right">a              </td><td align="left">y coordinate of atom <b><tt>a</tt></b>         </td><td align="left">y</td></tr>
<tr><td align="center">z   </td><td align="right">a              </td><td align="left">z coordinate of atom <b><tt>a</tt></b>         </td><td align="left">z</td></tr>
<tr><td align="center">r   </td><td align="right">a b            </td><td align="left">Bond length between <b><tt>a</tt></b> and <b><tt>b</tt></b>        </td><td align="left">r</td></tr>
<tr><td align="center">a   </td><td align="right">a b c          </td><td align="left">Angle between <b><tt>a</tt></b>-<b><tt>b</tt></b> and <b><tt>b</tt></b>-<b><tt>c</tt></b>         </td><td align="left">a</td></tr>
<tr><td align="center">d   </td><td align="right">a b c d        </td><td align="left">Dihedral (Angle between planes (<b><tt>a,b,c</tt></b>)    </td><td align="left">d</td></tr>
<tr><td align="center"></td><td align="right"></td><td align="left">and (<b><tt>b,c,d</tt></b>))</td><td align="left"></td></tr>
<tr><td align="center">p   </td><td align="right">a b c d        </td><td align="left">Pyramidalization angle (90<sup>&#176;</sup> minus angle    </td><td align="left">p</td></tr>
<tr><td align="center"></td><td align="right"></td><td align="left">between bond <b><tt>a</tt></b>-<b><tt>b</tt></b> and plane (<b><tt>b,c,d</tt></b>))</td><td align="left"></td></tr>
<tr><td align="center">5   </td><td align="right">a b c d e      </td><td align="left">Cremer-Pople parameters for 5-membered</td><td align="left">q<sub>2</sub>, &#981;<sub>2</sub></td></tr>
<tr><td align="center"></td><td align="right"></td><td align="left">rings <a href="#Cremer1975JACS" class="tth_citeref">[40</a>].</td><td align="left"></td></tr>
<tr><td align="center">6   </td><td align="right">a b c d e f    </td><td align="left">Cremer-Pople parameters for 6-membered</td><td align="left">Q, &#981;, &#952;, Boeyens</td></tr>
<tr><td align="center"></td><td align="right"></td><td align="left">rings <a href="#Cremer1975JACS" class="tth_citeref">[40</a>] and Boeyens classification <a href="#Boeyens1976JCMS" class="tth_citeref">[41</a>].</td><td align="left"></td></tr>
<tr><td align="center">c   </td><td align="right"></td><td align="left">Writes the comment (second line of the </td><td align="left">Comment</td></tr>
<tr><td align="center"></td><td align="right"></td><td align="left">xyz format) to the table.</td><td align="left"></td></tr>
<tr><td align="center">
  </td></tr></span></span></span></span></span></table>
</div>
<div class="p"><!----></div>
As an advice, it is always a good idea to put the comment as the <i>last</i> request, if at all. Since the comment may contain blanks, having the comment not as the very last column might make it impossible to plot the resulting table.
<div class="p"><!----></div>
The Boeyens classification symbols which are output for 6-membered rings are reported in <span class="roman">L</span><sup><span class="roman">A</span></sup><span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span>&nbsp;math code. Note that in the Boeyens classification scheme a number of symbols are equivalent, and only one symbol is reported. For example, by definition the chair configuration <sup>1</sup>C<sub>4</sub> is equivalent to <sup>5</sup>C<sub>2</sub> and <sup>3</sup>C<sub>6</sub>.
<div class="p"><!----></div>
     <a id="tth_sEc7.12.2"></a><h3>
7.12.2&nbsp;&nbsp;Options</h3>
<div class="p"><!----></div>
<b><tt>geo.py</tt></b> accepts a number of command-line options, see table&nbsp;<a href="#tab:Geo_options"> 7.6</a>. All options have sensible defaults. However, especially if long comments should be written to the output file, it might be necessary to increase the field width. Note that the minimum column width is 20 so that the table header can be printed correctly.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb7.6">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 7.6: Command-line options for <b><tt>geo.py</tt></b>. </div>
  <a id="tab:Geo_options">
</a>
<table>
<tr><td align="left">
    <span class="roman">Option         </td><td align="left">Description    </td><td align="left">Default</td></tr>
<tr><td align="left">
    -h          </td><td align="left">Display help message and quit.         </td><td align="left">-        </td></tr>
<tr><td align="left">-b          </td><td align="left">Report x, y, z, r, q<sub>2</sub> and Q in Bohrs       </td><td align="left">Angstrom</td></tr>
<tr><td align="left">-r          </td><td align="left">Report a, d, p, &#981;<sub>2</sub>, &#981; and &#952; in Radians         </td><td align="left">Degrees</td></tr>
<tr><td align="left">-g FILENAME </td><td align="left">Read coordinates from the specified file       </td><td align="left"><b><tt>output.xyz</tt></b></td></tr>
<tr><td align="left">-t FLOAT    </td><td align="left">Assumed timestep between successive geometries (fs)    </td><td align="left">1.0 fs</td></tr>
<tr><td align="left">-p INTEGER  </td><td align="left">Precision (Number of decimals, max.&nbsp;width-3)         </td><td align="left">4</td></tr>
<tr><td align="left">-w INTEGER  </td><td align="left">Width of each column (min.&nbsp;20)                   </td><td align="left">20</td></tr>
<tr><td align="left">
  </td></tr></span></table>
</div>
<div class="p"><!----></div>
 <a id="tth_sEc7.13"></a><h2>
7.13&nbsp;&nbsp;Diagonalization Helper: <b><tt>diagonalizer.x</tt></b></h2><a id="sec:diagonalizer.x">
</a>
<div class="p"><!----></div>
The small program <b><tt>diagonalizer.x</tt></b> is used by the Python scripts to diagonalize matrices if the  N<span style="font-size:x-small">UM</span>P<span style="font-size:x-small">Y</span> library is not available. Currently, only <b><tt>excite.py</tt></b> and <b><tt>SHARC_Analytical.py</tt></b> need to diagonalize matrices. The program <b><tt>diagonalizer.x</tt></b> is implemented as a simple front-end to the LAPACK libary.
<div class="p"><!----></div>
The program reads from stdin. The first line consists of the letter "r" or "c", followed by two integers giving the matrix dimensions. For "r", the program assumes a real symmetric matrix, for "c" a Hermitian matrix. The matrix must be square.
The second line is a comment and is ignored.
In the following lines, the matrix elements are given. On each line one row of the matrix has to be written. If the matrix is complex, each line contains the double number of entries, where real and imaginary part are always given subsequently.
The following is an example input:
<span class="footnotesize">
<pre>
c&nbsp;2&nbsp;2
comment
1.0&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;&nbsp;2.0&nbsp;&nbsp;0.1
2.0&nbsp;-0.1&nbsp;&nbsp;&nbsp;&nbsp;6.0&nbsp;&nbsp;0.0
</pre>
  </span>
<div class="p"><!----></div>
<div class="normalsize">for the matrix 
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-6.png">
The diagonal matrix and the matrix of eigenvectors is written to stdout.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_chAp8"></a><h1>
Chapter 8 Methodology</h1>
<div class="p"><!----></div>
In this chapter different aspects of  S<span style="font-size:x-small">HARC</span>&nbsp;simulations are discussed in detail. The topics are ordered alphabetically.
<div class="p"><!----></div>
 <a id="tth_sEc8.1"></a><h2>
8.1&nbsp;&nbsp;Absorption Spectrum</h2><a id="met:spectrum">
</a>
<div class="p"><!----></div>
Using <b><tt>spectrum.py</tt></b>, an absorption spectrum can be calculated as the sum over the absorption spectra of each individual initial condition:
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-7.png">
where i runs over the initial conditions.
<div class="p"><!----></div>
The spectrum of a single initial condition is the convolution of its line spectrum, defined through a set of tuples (E<sup>&#945;</sup>,f<sub>osc</sub><sup>&#945;</sup>) for each electronic state &#945;, where E<sup>&#945;</sup> is the excitation energy and f<sub>osc</sub><sup>&#945;</sup>) is the oscillator strength.
<div class="p"><!----></div>
The convolution of the line spectrum can be performed with <b><tt>spectrum.py</tt></b> using either Gaussian or Lorentzian functions. The contribution of a state &#945; to the absorption spectrum &#963;<sup>&#945;</sup>(E) is given by:
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-8.png">
or
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-9.png">
where FWHM is the full width at half maximum.
<div class="p"><!----></div>
 <a id="tth_sEc8.2"></a><h2>
8.2&nbsp;&nbsp;Active and inactive states</h2><a id="met:activestates">
</a>
<div class="p"><!----></div>
 S<span style="font-size:x-small">HARC</span>&nbsp;allows to "freeze" certain states, which then do not participate in the dynamics. Only energies and dipole moments are calculated, but all couplings are disabled. In this way, these states are never visited (hence also no gradients and non-adiabatic couplings are calculated, making the inclusion of these states cheap). Example:
<div class="p"><!----></div>
      <tt>nstates&nbsp;2&nbsp;0&nbsp;2</tt>
<div class="p"><!----></div>
  <tt>actstates&nbsp;2&nbsp;0&nbsp;1</tt>
<div class="p"><!----></div>
In the example given, state T<sub>2</sub> is frozen. The corresponding Hamiltonian looks like:
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-10.png">
where all matrix elements marked 
<table>
<tr><td align="center">red</td></tr></table>
 are deleted, since T<sub>2</sub> is frozen. 
<div class="p"><!----></div>
The corresponding matrix elements are also deleted from the non-adiabatic coupling and overlap matrices. For propagation including laser fields, also the corresponding transition dipole moments are neglected, while the transition dipole moments still show up in the output (in order to characterize the frozen states).
<div class="p"><!----></div>
Active and frozen states are defined with the <b><tt>states</tt></b> and <b><tt>actstates</tt></b> keywords in the input file. Note that only the highest states in each multiplicity can be frozen, i.e., it is not possible to freeze the T<sub>1</sub> while having T<sub>2</sub> active. However, it is possible to freeze all states of a certain multiplicity.
<div class="p"><!----></div>
 <a id="tth_sEc8.3"></a><h2>
8.3&nbsp;&nbsp;Damping</h2><a id="met:damping">
</a>
<div class="p"><!----></div>
If damping is activated in  S<span style="font-size:x-small">HARC</span>&nbsp;(keyword <b><tt>dampeddyn</tt></b>), in each timestep the following modification to the velocity vector is made
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-11.png">
where C is the damping factor given in the input. Hence, in each timestep the kinetic energy is modified by
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-12.png">
The damping factor C must be between 0 and 1.
<div class="p"><!----></div>
 <a id="tth_sEc8.4"></a><h2>
8.4&nbsp;&nbsp;Decoherence</h2><a id="met:decoherence">
</a>
<div class="p"><!----></div>
In surface hopping, without any corrections the coherence between the states is usually too large <a href="#Granucci2007JCP" class="tth_citeref">[19</a>]. A trajectory in state &#946;, but where state &#945; has a large coefficient, will still travel according to the gradient of state &#946;. However, the gradients of state &#945; are almost certainly different to the ones of state &#946;. As a consequence, too much population of state &#945; is following the gradient of state &#946;. Decoherence corrections damp in different ways the population of all states &#945; &#8800; &#946;, so that only population of &#946; follows the gradient of state &#946;.
<div class="p"><!----></div>
The decoherence correction currently implemented in  S<span style="font-size:x-small">HARC</span>&nbsp;is based on the energies of the excited states ("energy-based decoherence", or EDC, as given in <a href="#Granucci2010JCP" class="tth_citeref">[50</a>]). After the surface hopping procedure, when the system is in state &#946;, the coefficients are updated by the following relation
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-13.png">
where C is the decoherence parameter. The decoherence correction can be activated with the keyword <b><tt>decoherence</tt></b> in the input file. The decoherence parameter C can be set with the keyword <b><tt>decoherence_param</tt></b> (the default is 0.1&nbsp;hartree, as suggested in <a href="#Granucci2010JCP" class="tth_citeref">[50</a>]).
<div class="p"><!----></div>
 <a id="tth_sEc8.5"></a><h2>
8.5&nbsp;&nbsp;Excitation Selection</h2><a id="met:exc_selection">
</a>
<div class="p"><!----></div>
<b><tt>excite.py</tt></b> can select initial active states for the dynamics based on for each initial condition k the excitation energies E<sub>k,&#945;</sub> and the oscillator strengths f<sup>osc</sup><sub>k,&#945;</sub> are known for the excited states &#945;. The procedure is based on reference&nbsp;<a href="#Barbatti2011" class="tth_citeref">[39</a>].
<div class="p"><!----></div>
First, for all excited states of all initial conditions, the maximum value p<sub>max</sub> of 
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-14.png">
is found. Then for each excited state, a random number r<sub>k,&#945;</sub> is picked from [0,1]. If
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-15.png">
then the excited state is selected for performing the dynamics. This excited-state selection scheme is taken from <a href="#Barbatti2011" class="tth_citeref">[39</a>].
<div class="p"><!----></div>
Within <b><tt>excite.py</tt></b> it is possible to restrict the selection to a subset of all excited states. In this case, also p<sub>max</sub> is only determined based on this subset of excited states.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.6"></a><h2>
8.6&nbsp;&nbsp;Internal coordinates definitions</h2><a id="met:geo">
</a>
<div class="p"><!----></div>
In this section, the internal coordinates available in <b><tt>geo.py</tt></b> are defined.
<div class="p"><!----></div>
<b>Bond length&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The bond length between two atoms a and b is:
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-16.png">
<div class="p"><!----></div>
<b>Bond angle&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The bond angle for atoms a, b and c is defined as the angle
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-17.png">
where <b>v</b><sub>ba</sub> is the vector from atom b to atom a.
<div class="p"><!----></div>
<b>Dihedral&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The dihedral angle is defined via the vectors <b>w</b><sub>1</sub> and <b>w</b><sub>2</sub>:
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-18.png">
The dihedral is given as the angle between <b>w</b><sub>1</sub> and <b>w</b><sub>2</sub> according to equation&nbsp;.
<div class="p"><!----></div>
<b>Pyramidalization angle&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The pyramidalization angle is defined via the vectors <b>v</b><sub>ba</sub> and 
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-19.png">
The pyramidalization angle is then given as 90<sup>&#176;</sup> &#8722; &#952;(<b>v</b><sub>ba</sub>,<b>w</b><sub>1</sub>).
<div class="p"><!----></div>
<b>Cremer-Pople parameters&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The definitions of the Cremer-Pople parameters for 5- and 6-membered rings is described in <a href="#Cremer1975JACS" class="tth_citeref">[40</a>].
<div class="p"><!----></div>
<b>Boeyens classification&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The Boeyens classification scheme is described in <a href="#Boeyens1976JCMS" class="tth_citeref">[41</a>].
<div class="p"><!----></div>
 <a id="tth_sEc8.7"></a><h2>
8.7&nbsp;&nbsp;Kinetic energy adjustments</h2><a id="met:ekinadj">
</a>
<div class="p"><!----></div>
There are several options how to adjust the kinetic energy after a surface hop occured. The simplest option is to not adjust the kinetic energy at all (input: <b><tt>ekincorrect none</tt></b>), but this obviously leads to violation of the conservation of total energy.
<div class="p"><!----></div>
Alternatively, the velocities of all atoms can be rescaled so that the new kinetic energy and the potential energy of the new state &#946; again sum up to the total energy.
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-20.png">
Within this methodology, when the energy of the old state &#945; was lower than the energy of the new state &#946; the kinetic energy is lowered. Since the kinetic energy must be positive, this implies that there might be states which cannot be reached (their potential energy is above the total energy). A hop to such a state is called "frustrated hop" and will be rejected by  S<span style="font-size:x-small">HARC</span>. Rescaling parallel to the nuclear velocity vector is requested with <b><tt>ekincorrect parallel_vel</tt></b>.
<div class="p"><!----></div>
Alternatively, according to Tully's original formulation of the surface hopping method <a href="#Tully1990JCP" class="tth_citeref">[14</a>], after a hop from &#945; to &#946; only the component of the velocity along the direction of the non-adiabatic coupling vector <b>K</b><sub>&#946;&#945;</sub> should be rescaled. With
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-21.png">
the available energy can be calculated:
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-22.png">
If &#8710; &lt; 0, the hop is frustrated and will be rejected. Otherwise, the scaled velocities <b>v</b>&#8242; can be calculated as
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-23.png">
This procedure can be requested with <b><tt>ekincorrect parallel_nac</tt></b>. Note that in this case  S<span style="font-size:x-small">HARC</span>&nbsp;will request the non-adiabatic coupling vectors, even if they are not used for the wavefunction propagation.
<div class="p"><!----></div>
 <a id="tth_sEc8.8"></a><h2>
8.8&nbsp;&nbsp;Laser fields</h2><a id="met:laser_field">
</a>
<div class="p"><!----></div>
The program <b><tt>laser.x</tt></b> can calculate laser fields as superpositions of several analytical, possibly chirped, laser pulses. In the following, the laser parametrization is given (see <a href="#Marquetand2007" id="CITEMarquetand2007" class="tth_citation">[51</a>] for further details).
<div class="p"><!----></div>
     <a id="tth_sEc8.8.1"></a><h3>
8.8.1&nbsp;&nbsp;Form of the laser field</h3>
<div class="p"><!----></div>
In general, the laser field &#1013;(t) is a linear superposition of a number of laser pulses l<sub>i</sub>(t):
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-24.png">
where <b>p</b><sub>i</sub> is the normalized polarization vector of pulse i.
<div class="p"><!----></div>
A pulse l(t) is formed as the product of an envelope function and a field function. 
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-25.png">
<div class="p"><!----></div>
     <a id="tth_sEc8.8.2"></a><h3>
8.8.2&nbsp;&nbsp;Envelope functions</h3>
<div class="p"><!----></div>
There are two types of envelope function defined in <b><tt>laser.x</tt></b>, which are Gaussian and sinusoidal.
<div class="p"><!----></div>
The Gaussian envelope is defined as:
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-26.png">
where <i>E</i><sub>0</sub> is the peak field strength, FWHM is the full width at half maximum and t<sub>c</sub> is the temporal center of the pulse.
<div class="p"><!----></div>
The sinusoidal envelope is defined as:
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-27.png">
where again <i>E</i><sub>0</sub> is the peak field strength, t<sub>0</sub> and t<sub>c</sub> define the interval where the field strength increases, and t<sub>c2</sub> and t<sub>e</sub> define the interval where the field strength decreases. Figure&nbsp;<a href="#fig:laser_envelope"> 8.1</a> shows the general form of the envelope functions and the meaning of the temporal parameters t<sub>0</sub>, t<sub>c</sub>, t<sub>2c</sub> and t<sub>e</sub>.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_fIg8.1">
</a>   <div style="text-align:center">  <img src="http://sharc-md.org/wp-content/uploads/2014/10/laser_envelope.png">  
<div style="text-align:center">Figure 8.1: Types of laser envelopes implemented in <b><tt>laser.x</tt></b>.</div>
  <a id="fig:laser_envelope">
</a>
</div>
<div class="p"><!----></div>
     <a id="tth_sEc8.8.3"></a><h3>
8.8.3&nbsp;&nbsp;Field functions</h3>
<div class="p"><!----></div>
The field function f(t) is defined as:
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-28.png">
where &#969;<sub>0</sub> is the central frequency and &#981; is the phase of the pulse. Even though the laser field is complex in this expression, in the propagation of the electronic wavefunction in  S<span style="font-size:x-small">HARC</span>&nbsp;only the real part is used.
<div class="p"><!----></div>
     <a id="tth_sEc8.8.4"></a><h3>
8.8.4&nbsp;&nbsp;Chirped pulses</h3>
<div class="p"><!----></div>
In order to apply a chirp to the laser pulse l(t), it is first Fourier transformed to the frequency domain, giving the function <span class="overacc1">~</span>l(&#969;). The chirp is applied by calculating:
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-29.png">
The chirped laser in the time domain l&#8242;(t) is then obtained by Fourier transform of the chirped pulse <span class="overacc1">~</span>l&#8242;(&#969;).
<div class="p"><!----></div>
     <a id="tth_sEc8.8.5"></a><h3>
8.8.5&nbsp;&nbsp;Quadratic chirp without Fourier transform</h3>
<div class="p"><!----></div>
If <b><tt>laser.x</tt></b> was compiled without the FFTW package, the only accessible chirps are quadratic chirps for Gaussian pulses:
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-30.png">
Other chirps are only possible with the Fourier transformation.
<div class="p"><!----></div>
 <a id="tth_sEc8.9"></a><h2>
8.9&nbsp;&nbsp;Laser interactions</h2><a id="met:laser">
</a>
<div class="p"><!----></div>
The laser field &#1013; is included in the propagation of the electronic wavefunction. In each substep of the propagation, the interaction of the laser field with the dipole moments is included in the Hamiltonian. The contribution <b>V</b><sub>i</sub> is in each timestep added to the Hamiltonian in equations&nbsp; or , respectively:
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-31.png">
where i, n t and &#8710;t are defined as in section <a href="#met:propagate">8.19</a>.
<div class="p"><!----></div>
     <a id="tth_sEc8.9.1"></a><h3>
8.9.1&nbsp;&nbsp;Surface Hopping with laser fields</h3>
<div class="p"><!----></div>
If laser fields are present, there can be two fundamentally different types of hops: laser-induced hops and non-adiabatic hops. The latter ones are the same hops as in the laser-free simulations, and demand that the total energy is conserved. The laser-induced hops on the other hand demand that the momentum (kinetic energy) is conserved. Hence,  S<span style="font-size:x-small">HARC</span>&nbsp;needs to decide for every hop whether it is laser-induced or not. 
<div class="p"><!----></div>
Consider a previous state &#945; and a new state &#946;. Currently, the hop is classified based on the energy gap &#8710;E=&#124;E<sub>&#946;</sub><sup>diag</sup>&#8722;E<sub>&#945;</sub><sup>diag</sup>&#124; and the instantaneous central energy of the laser pulse &#969;. 
The hop is assumed to be laser-induced if
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-32.png">
where W is a fixed parameter. W can be set using the input keyword <b><tt>laserwidth</tt></b>.
<div class="p"><!----></div>
If a hop has been classified as laser-free, the momentum is adjusted according to the equations given in section&nbsp;<a href="#met:ekinadj">8.7</a>.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.10"></a><h2>
8.10&nbsp;&nbsp;Random initial velocities</h2><a id="met:veloc">
</a>
<div class="p"><!----></div>
Random initial velocities are calculated with a given amount of kinetic energy E per atom a. For each atom, the velocity is calculated as follows, with two uniform random numbers &#952; and &#981;, from the interval [0,1[:
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-33.png">
This procedure gives a uniform probability distribution on a sphere with radius &#8730;{2E/m<sub>a</sub>}.
<div class="p"><!----></div>
Note that the translational and rotational components of random initial velocities are not projected out in the current implementation.
<div class="p"><!----></div>
Random initial velocities can be requested in the input with <b><tt>veloc random E</tt></b>, where E is a float defining the kinetic energy per atom (in eV).
<div class="p"><!----></div>
 <a id="tth_sEc8.11"></a><h2>
8.11&nbsp;&nbsp;Representations</h2><a id="sec:repr">
</a>
<div class="p"><!----></div>
Within  S<span style="font-size:x-small">HARC</span>, two different representations for the electronic states are used. The first is the so-called MCH basis, which is the basis of the eigenfunctions of the molecular Coulomb Hamiltonian. The molecular Coulomb Hamiltonian is the standard electronic Hamiltonian employed by the majority of quantum chemistry programs. It contains only the kinetic energy of the electrons and the potential energy arising from the Coulomb interaction between the electrons and nuclei.
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-34.png">
With this hamiltonian, states of the same multiplicity couple via the non-adiabatic couplings, while states of different multiplicity do not interact at all. 
<div class="p"><!----></div>
The second representation used in  S<span style="font-size:x-small">HARC</span>&nbsp;is the so-called diagonal representation. It is the basis of the eigenfunctions of the total Hamiltonian.
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-35.png">
The term <span class="overacc1">&#8743;</span>H<sub>el</sub><sup>coup</sup> contains additional couplings not contained in the molecular Coulomb Hamiltonian. The most common couplings are spin-orbit couplings and interactions with an external electric field.
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-36.png">
Both of these couplings introduce off-diagonal elements in the total Hamiltonian. Thus, the eigenfunctions of the molecular Coulomb Hamiltonian are not the eigenfunctions of the total Hamiltonian. 
<div class="p"><!----></div>
Within  S<span style="font-size:x-small">HARC</span>, usually quantum chemistry information is read in the MCH representation, while the surface hopping is performed in the diagonal one.
<div class="p"><!----></div>
     <a id="tth_sEc8.11.1"></a><h3>
8.11.1&nbsp;&nbsp;Current state in MCH representation</h3><a id="ssec:state_transform">
</a>
<div class="p"><!----></div>
Oftentimes, it is very useful to know to which MCH state the currently active diagonal state corresponds. If <span class="overacc1">&#8743;</span>H<sub>el</sub><sup>coup</sup> is small or the state separation is large, then each diagonal state approximately corresponds to one MCH state. Only in the case of large couplings and/or near-degenerate states are the MCH states strongly mixed in the diagonal states.
<div class="p"><!----></div>
In order to obtain for a given timestep from the currently active diagonal state &#946; the corresponding MCH state &#945;, a vector <b>c</b><sup>diag</sup> with c<sub>i</sub><sup>diag</sup>=&#948;<sub>i&#946;</sub> is generated. The vector is transformed into the MCH representation
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-37.png">
The corresponding MCH state &#945; is the index of the (absolute) largest element of vector <b>c</b><sup>MCH</sup>.
<div class="p"><!----></div>
 <a id="tth_sEc8.12"></a><h2>
8.12&nbsp;&nbsp;Sampling from Wigner Distribution</h2><a id="met:wigner">
</a>
<div class="p"><!----></div>
The sampling is based on references&nbsp;<a href="#Dahl1988JCP" class="tth_citeref">[37</a>,<a href="#Schinke1995" class="tth_citeref">[38</a>].
<div class="p"><!----></div>
The frequency calculation provides a set of vibrational frequencies {&#957;<sub>i</sub>} and the corresponding normal mode vectors {<b>n</b><sub>i</sub>}, where i runs from 1 to N=3n<sub>atom</sub>. It also provides the equilibrium geometry <b>R</b><sub>eq</sub>.
<div class="p"><!----></div>
In order to create an initial condition (<b>R</b>,<b>v</b>), the following procedure is applied. Initially, <b>R</b><sub>0</sub>=<b>R</b><sub>eq</sub> and <b>v</b><sub>0</sub>=0. Then, for each normal mode i, two random numbers P<sub>i</sub> and Q<sub>i</sub> are chosen uniformly from the interval [&#8722;3,3]. The value of a ground state quantum Wigner distribution for these values is calculated:
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-38.png">
W<sub>i</sub> is compared to a uniform random r<sub>i</sub> number from [0,1]. If W<sub>i</sub> &gt; r<sub>i</sub>, then P<sub>i</sub> and Q<sub>i</sub> are accepted and the coordinates and velocities are updated:
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-39.png">
The random number procedure and updates are repeated for all normal modes, until (<b>R</b><sub>N</sub>,<b>v</b>)<sub>N</sub> is obtained, which constitutes one initial condition. Finally, the center of mass is restored and translational and rotational components are projected out of <b>v</b>. The harmonic potential energy is given by:
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-40.png">
<div class="p"><!----></div>
 <a id="tth_sEc8.13"></a><h2>
8.13&nbsp;&nbsp;Scaling</h2><a id="met:scaling">
</a>
<div class="p"><!----></div>
The scaling factor (keyword <b><tt>scaling</tt></b>) applies to all energies and derivatives of energies. Hence, the full Hamiltonian is scaled, and the gradients are scaled. Nothing else is scaled (no dipole moments, non-adiabatic couplings, overlaps, etc).
<div class="p"><!----></div>
 <a id="tth_sEc8.14"></a><h2>
8.14&nbsp;&nbsp;Seeding of the RNG</h2><a id="met:seed">
</a>
<div class="p"><!----></div>
The standard Fortran 90 random number generator is seeded by a sequence of integers of length n, where n depends on the computer architecture. The input of  S<span style="font-size:x-small">HARC</span>, however, takes only a single RNG seed, which must reproducibly produce the same sequence of random numbers for the same input.
<div class="p"><!----></div>
In order to generate the seed sequence from the single input x, the following procedure is applied:
<ul>
<li> Query for the number n,
<div class="p"><!----></div>
</li>
<li> Generate a first seed sequence <b>s</b> with s<sub>i</sub>=x+37i+17i<sup>2</sup>,
<div class="p"><!----></div>
</li>
<li> Seed with the sequence <b>s</b>,
<div class="p"><!----></div>
</li>
<li> Obtain a sequence <b>r</b> of n random numbers on the interval [0,1[,
<div class="p"><!----></div>
</li>
<li> Generate a second seed sequence <b>s</b>&#8242; with s<sub>i</sub>&#8242;=int(65536(r<sub>i</sub>&#8722;[1/2])),
<div class="p"><!----></div>
</li>
<li> Reseed with the sequence <b>s</b>&#8242;.
<div class="p"><!----></div>
</li>
</ul>
The fifth step will generate a sequence of nearly uncorrelated numbers, distributed uniformly over the full range of possible integer values. 
<div class="p"><!----></div>
 <a id="tth_sEc8.15"></a><h2>
8.15&nbsp;&nbsp;Selection of gradients and non-adiabatic couplings</h2><a id="met:selection">
</a>
<div class="p"><!----></div>
In order to increase performance, it is possible to omit the calculation of certain gradients and non-adiabatic couplings. An energy-gap-based algorithm selects at each timestep a subset of all possible gradients and non-adiabatic couplings to be calculated. Given the diagonal energy E<sup>diag</sup><sub>&#958;</sub> of the current active state &#958;, the gradient <b>g</b><sup>MCH</sup><sub>&#945;</sub> of MCH state &#945; is calculated if:
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-41.png">
where &#949;<sub>grad</sub> is the selection threshold.
<div class="p"><!----></div>
Similarly, a non-adiabatic coupling vector <b>K</b><sup>MCH</sup><sub>&#946;&#945;</sub> is calculated if:
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-42.png">
with selection threshold &#949;<sub>nac</sub>.
<div class="p"><!----></div>
Neither <b>g</b><sup>MCH</sup><sub>&#945;</sub> nor <b>K</b><sup>MCH</sup><sub>&#946;&#945;</sub> are ever calculated if &#945; or &#946; are frozen states.
<div class="p"><!----></div>
There is only one keyword (<b><tt>eselect</tt></b>) to set the selection threshold, so &#949;<sub>grad</sub> and &#949;<sub>nac</sub> are the same in most cases. 
<div class="p"><!----></div>
 <a id="tth_sEc8.16"></a><h2>
8.16&nbsp;&nbsp;State ordering</h2><a id="met:ordering">
</a>
<div class="p"><!----></div>
The canonical ordering of MCH states of different S and M<sub>S</sub> in  S<span style="font-size:x-small">HARC</span>&nbsp;is as follows. In the innermost loop, the quantum number is increased; then M<sub>S</sub> and finally S. Example:
<div class="p"><!----></div>
      <tt>nstates&nbsp;3&nbsp;0&nbsp;3</tt>
<div class="p"><!----></div>
In this example, the order of states is given as:
<div class="p"><!----></div>
<table>
<tr><td align="right">  Number      </td><td align="left">Label       </td><td align="center">S </td><td align="center">M<sub>S</sub>  </td><td align="center">n</td></tr>
<tr><td align="right">
  1</td><td align="left">S<sub>0</sub>       </td><td align="center">0</td><td align="center">0</td><td align="center">1</td></tr>
<tr><td align="right">2</td><td align="left">S<sub>1</sub>       </td><td align="center">0</td><td align="center">0</td><td align="center">2</td></tr>
<tr><td align="right">3</td><td align="left">S<sub>2</sub>       </td><td align="center">0</td><td align="center">0</td><td align="center">3</td></tr>
<tr><td align="right">4</td><td align="left">T<sub>1</sub><sup>&#8722;</sup>       </td><td align="center">2</td><td align="center">-1</td><td align="center">1</td></tr>
<tr><td align="right">5</td><td align="left">T<sub>2</sub><sup>&#8722;</sup>       </td><td align="center">2</td><td align="center">-1</td><td align="center">2</td></tr>
<tr><td align="right">6</td><td align="left">T<sub>3</sub><sup>&#8722;</sup>       </td><td align="center">2</td><td align="center">-1</td><td align="center">3</td></tr>
<tr><td align="right">7</td><td align="left">T<sub>1</sub><sup>0</sup>       </td><td align="center">2</td><td align="center">0</td><td align="center">1</td></tr>
<tr><td align="right">8</td><td align="left">T<sub>2</sub><sup>0</sup>       </td><td align="center">2</td><td align="center">0</td><td align="center">2</td></tr>
<tr><td align="right">9</td><td align="left">T<sub>3</sub><sup>0</sup>       </td><td align="center">2</td><td align="center">0</td><td align="center">3</td></tr>
<tr><td align="right">10</td><td align="left">T<sub>1</sub><sup>+</sup>       </td><td align="center">2</td><td align="center">+1</td><td align="center">1</td></tr>
<tr><td align="right">11</td><td align="left">T<sub>2</sub><sup>+</sup>       </td><td align="center">2</td><td align="center">+1</td><td align="center">2</td></tr>
<tr><td align="right">12</td><td align="left">T<sub>3</sub><sup>+</sup>       </td><td align="center">2</td><td align="center">+1</td><td align="center">3</td></tr>
<tr><td align="right">
</td></tr></table>
<div class="p"><!----></div>
The canonical ordering of states is for example important in order to specify the initial state in the MCH basis (using the <b><tt>state</tt></b> keyword in the input file).
<div class="p"><!----></div>
 <a id="tth_sEc8.17"></a><h2>
8.17&nbsp;&nbsp;Surface Hopping</h2>
<div class="p"><!----></div>
Given two coefficient vectors <b>c</b><sup>diag</sup>(t) and <b>c</b><sup>diag</sup>(t+&#8710;t) and the corresponding propagator matrix <b>R</b><sup>MCH</sup>(t+&#8710;t,t), the surface hopping probabilities are given by
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-43.png">
where, however, P<sub>&#946;&#8594;&#946;</sub>=0 and all negative P<sub>&#946;&#8594;&#945;</sub> are set to zero.
<div class="p"><!----></div>
The hopping procedure itself obtains a uniform random number r from the interval [0,1]. A hop to state &#945; is performed, if
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-44.png">
See section&nbsp;<a href="#met:ekinadj">8.7</a> for further details on how frustrated hops are handled.
<div class="p"><!----></div>
 <a id="tth_sEc8.18"></a><h2>
8.18&nbsp;&nbsp;Velocity Verlet</h2>
<div class="p"><!----></div>
The nuclear coordinates of atom A are updated according to the Velocity Verlet algorithm <a href="#Verlet1967PR" id="CITEVerlet1967PR" class="tth_citation">[52</a>], based on the gradient of state &#946; at <b>R</b>(t) and <b>R</b>(t+&#8710;t):
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-45.png">
<div class="p"><!----></div>
Currently, there are no other integrators for the nuclear motion implemented in  S<span style="font-size:x-small">HARC</span>.
<div class="p"><!----></div>
 <a id="tth_sEc8.19"></a><h2>
8.19&nbsp;&nbsp;Wavefunction propagation</h2><a id="met:propagate">
</a>
<div class="p"><!----></div>
The electronic wavefunction is needed in order to carry out surface hopping. The electronic wavefunction is expanded in the basis of the so-called model space <i>S</i>, which includes the few lowest states &#124;&#968;<sup>MCH</sup><sub>&#945;</sub>&#9002; of the multiplicities under consideration (e.g.&nbsp;the 3 lowest singlet and 2 lowest triplet states). 
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-46.png">
All multiplet components are included explicitly, i.e., the inclusion of an MCH triplet state adds three explicit states to the model space (the three components of the triplet).
<div class="p"><!----></div>
Within  S<span style="font-size:x-small">HARC</span>, the wavefunction is represented just by the vector <b>c</b><sup>MCH</sup>. The Hamiltonian <b>H</b><sup>MCH</sup> is represented in matrix form with elements:
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-47.png">
<div class="p"><!----></div>
From the MCH representation, the diagonal representation can be obtained by unitary transformation within the model space <i>S</i> (<b>U</b><sup>&#8224;</sup><b>H</b><sup>MCH</sup><b>U</b>=<b>H</b><sup>diag</sup> and <b>U</b><sup>&#8224;</sup><b>c</b><sup>MCH</sup>=<b>c</b><sup>diag</sup>):
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-48.png">
and
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-49.png">
<div class="p"><!----></div>
The propagation of the electronic wavefunction from time t to t+&#8710;t can then be written as the product of a propagation matrix with the coefficients at time t:
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-50.png">
or
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-51.png">
<div class="p"><!----></div>
In order to calculate <b>R</b><sup>MCH</sup>(t+&#8710;t,t),  S<span style="font-size:x-small">HARC</span>&nbsp;uses (unitary) operator exponentials. 
<div class="p"><!----></div>
     <a id="tth_sEc8.19.1"></a><h3>
8.19.1&nbsp;&nbsp;Propagation using non-adiabatic couplings</h3>
<div class="p"><!----></div>
Here we assume that in the dynamics the interaction between the electronic states is described by a matrix of non-adiabatic couplings <b>K</b><sup>MCH</sup>(t), such that
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-52.png">
or
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-53.png">
In equation&nbsp;, the time-derivative couplings are directly calculated by the quantum chemistry program (use <b><tt>coupling ddt</tt></b> in the  S<span style="font-size:x-small">HARC</span>&nbsp;input), while in&nbsp; the matrix <b>K</b><sup>MCH</sup>(t) is obtained from the scalar product of the nuclear velocity and the non-adiabatic coupling vectors (use <b><tt>coupling ddr</tt></b> in the input).
<div class="p"><!----></div>
The propagation matrix can then be written as 
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-54.png">
with the time-ordering operator <span class="overacc1">&#8743;</span><i>T</i>. For small timesteps &#8710;t, <b>H</b><sup>MCH</sup>(&#964;) and <b>K</b><sup>MCH</sup>(&#964;) can be interpolated linearly
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-55.png">
And in order to have a sufficiently small timestep for this to work, the interval (t,t+&#8710;t) is further split into subtimesteps &#8710;&#964; = [(&#8710;t)/n]. 
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-56.png">
<div class="p"><!----></div>
     <a id="tth_sEc8.19.2"></a><h3>
8.19.2&nbsp;&nbsp;Propagation using overlap matrices</h3>
<div class="p"><!----></div>
In many situations, the non-adiabatic couplings in <b>K</b><sup>MCH</sup> are very localized on the potential hypersurfaces. If this is the case, in the dynamics very short timesteps are necessary to properly sample the non-adiabatic couplings. If too large timesteps are used, part of the coupling may be missed, leading to wrong population transfer. The local diabatization algorithm gives more numerical stability in these situations. It can be requested with the line <b><tt>coupling overlap</tt></b> in the input file.
<div class="p"><!----></div>
Within this algorithm, the change of the electronic states between timesteps is described by the overlap matrix <b>S</b><sup>MCH</sup>(t,t+&#8710;t)
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-57.png">
<div class="p"><!----></div>
With this, the propagator matrix can be written as
<div class="p"><!----></div>
<img src="http://sharc-md.org/wp-content/uploads/2014/10/equation-58.png">
<div class="p"><!----></div>
  <a id="tth_chAp9"></a><h1>
Chapter 9 Bibliography</h1>
<div class="p"><!----></div>
<h2>Bibliography</h2>
<dl>
 <dt><a href="#CITEKasha1950DFS" id="Kasha1950DFS">[1]</a></dt><dd>
M.&nbsp;Kasha:
  <a href="http://dx.doi.org/10.1039/df9500900014">"Characterization of
  electronic transitions in complex molecules"</a>. <em>Discuss. Faraday Soc.</em>,
  <b>9</b>, 14 (1950).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMarian2012WCMS" id="Marian2012WCMS">[2]</a></dt><dd>
C.&nbsp;M. Marian: <a href="http://dx.doi.org/10.1002/wcms.83">"Spin-orbit
  coupling and intersystem crossing in molecules"</a>. <em>WIREs Comput. Mol.
  Sci.</em>, <b>2</b>, 187-203 (2012).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEWilkinson2014JCP" id="Wilkinson2014JCP">[3]</a></dt><dd>
I.&nbsp;Wilkinson, A.&nbsp;E. Boguslavskiy, J.&nbsp;Mikosch, D.&nbsp;M. Villeneuve, H.-J. W&#246;rner,
  M.&nbsp;Spanner, S.&nbsp;Patchkovskii, A.&nbsp;Stolow:
  <a href="http://dx.doi.org/10.1063/1.4875035">"Non-adiabatic and
  intersystem crossing dynamics in SO<sub>2</sub> I: Bound State Relaxation Studied
  By Time-Resolved Photoelectron Photoion Coincidence Spectroscopy"</a>. <em>J.
  Chem. Phys.</em>, <b>140</b>, 204&nbsp;301 (2014).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMai2014JCP_SO2" id="Mai2014JCP_SO2">[4]</a></dt><dd>
S.&nbsp;Mai, P.&nbsp;Marquetand, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1063/1.4875036">"Non-Adiabatic Dynamics in
  SO<sub>2</sub>: II. The Role of Triplet States Studied by Surface-Hopping
  Simulations"</a>. <em>J. Chem. Phys.</em>, <b>140</b>, 204&nbsp;302 (2014).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITELeveque2014JCP_ISC" id="Leveque2014JCP_ISC">[5]</a></dt><dd>
C.&nbsp;L&#233;v&#234;que, R.&nbsp;Ta&#239;eb, H.&nbsp;K&#246;ppel:
  <a href="http://dx.doi.org/10.1063/1.4867252">"Communication:
  Theoretical prediction of the importance of the <sup>3</sup>B<sub>2</sub> state in the dynamics
  of sulfur dioxide"</a>. <em>J. Chem. Phys.</em>, <b>140</b>, 091101 (2014).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEPenfold2012JCP" id="Penfold2012JCP">[6]</a></dt><dd>
T.&nbsp;J. Penfold, R.&nbsp;Spesyvtsev, O.&nbsp;M. Kirkby, R.&nbsp;S. Minns, D.&nbsp;S.&nbsp;N. Parker, H.&nbsp;H.
  Fielding, G.&nbsp;A. Worth:
  <a href="http://dx.doi.org/10.1063/1.4767054">"Quantum dynamics study of
  the competing ultrafast intersystem crossing and internal conversion in the
  "channel 3" region of benzene"</a>. <em>J. Chem. Phys.</em>, <b>137</b>,
  204310 (2012).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEVogt2013JPC" id="Vogt2013JPC">[7]</a></dt><dd>
R.&nbsp;A. Vogt, C.&nbsp;Reichardt, C.&nbsp;E. Crespo-Hern&#225;ndez:
  <a href="http://dx.doi.org/10.1021/jp405656n">"Excited-State Dynamics in
  Nitro-Naphthalene Derivatives: Intersystem Crossing to the Triplet Manifold
  in Hundreds of Femtoseconds"</a>. <em>J. Phys. Chem.</em>, <b>117</b>,
  6580-6588 (2013).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITECrespo-Hernandez2004CR" id="Crespo-Hernandez2004CR">[8]</a></dt><dd>
C.&nbsp;E. Crespo-Hern&#225;ndez, B.&nbsp;Cohen, P.&nbsp;M. Hare, B.&nbsp;Kohler:
  <a href="http://dx.doi.org/10.1021/cr0206770">"Ultrafast Excited-State
  Dynamics in Nucleic Acids"</a>. <em>Chem. Rev.</em>, <b>104</b>, 1977-2020
  (2004).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITERichter2012JPCL" id="Richter2012JPCL">[9]</a></dt><dd>
M.&nbsp;Richter, P.&nbsp;Marquetand, J.&nbsp;Gonz&#225;lez-V&#225;zquez, I.&nbsp;Sola, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1021/jz301312h">"Femtosecond Intersystem
  Crossing in the DNA Nucleobase Cytosine"</a>. <em>J. Phys. Chem. Lett.</em>,
  <b>3</b>, 3090-3095 (2012).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMartinez-Fernandez2012CC" id="Martinez-Fernandez2012CC">[10]</a></dt><dd>
L.&nbsp;Mart&#237;nez-Fern&#225;ndez, L.&nbsp;Gonz&#225;lez, I.&nbsp;Corral:
  <a href="http://dx.doi.org/10.1039/C2CC15775F">"An Ab Initio Mechanism
  for Efficient Population of Triplet States in Cytotoxic Sulfur Substituted
  DNA Bases: The Case of 6-Thioguanine"</a>. <em>Chem. Commun.</em>, <b>48</b>,
  2134-2136 (2012).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMai2013C" id="Mai2013C">[11]</a></dt><dd>
S.&nbsp;Mai, P.&nbsp;Marquetand, M.&nbsp;Richter, J.&nbsp;Gonz&#225;lez-V&#225;zquez, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1002/cphc.201300370">"Singlet and Triplet
  Excited-State Dynamics Study of the Keto and Enol Tautomers of Cytosine"</a>.
  <em>ChemPhysChem</em>, <b>14</b>, 2920-2931 (2013).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEReichardt2010CC" id="Reichardt2010CC">[12]</a></dt><dd>
C.&nbsp;Reichardt, C.&nbsp;E. Crespo-Hern&#225;ndez:
  <a href="http://dx.doi.org/10.1039/C0CC01181A">"Ultrafast Spin Crossover
  in 4-Thiothymidine in an Ionic Liquid"</a>. <em>Chem. Commun.</em>, <b>46</b>,
  5963-5965 (2010).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITETully1971JCP" id="Tully1971JCP">[13]</a></dt><dd>
J.&nbsp;C. Tully, R.&nbsp;K. Preston:
  <a href="http://dx.doi.org/doi:10.1063/1.1675788">"Trajectory Surface
  Hopping Approach to Nonadiabatic Molecular Collisions: The Reaction of
  H<sup>+</sup> with D<sub>2</sub>"</a>. <em>J. Chem. Phys.</em>, <b>55</b>, 562-572 (1971).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITETully1990JCP" id="Tully1990JCP">[14]</a></dt><dd>
J.&nbsp;C. Tully: <a href="http://dx.doi.org/doi:10.1063/1.459170">"Molecular
  dynamics with electronic transitions"</a>. <em>J. Chem. Phys.</em>, <b>93</b>,
  1061-1071 (1990).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEBarbatti2011WCMS" id="Barbatti2011WCMS">[15]</a></dt><dd>
M.&nbsp;Barbatti: <a href="http://dx.doi.org/10.1002/wcms.64">"Nonadiabatic
  dynamics with trajectory surface hopping method"</a>. <em>WIREs Comput. Mol.
  Sci.</em>, <b>1</b>, 620-633 (2011).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEDoltsinis2006" id="Doltsinis2006">[16]</a></dt><dd>
N.&nbsp;L. Doltsinis: <em>Molecular Dynamics Beyond the Born-Oppenheimer
  Approximation: Mixed Quantum-Classical Approaches</em>, volume&nbsp;31 of <em>NIC
  Series</em>. John von Neuman Institut for Computing (2006).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEDoltsinis2002JTCC" id="Doltsinis2002JTCC">[17]</a></dt><dd>
N.&nbsp;L. Doltsinis, D.&nbsp;Marx:
  <a href="http://dx.doi.org/10.1142/S0219633602000257">"First Principles
  Molecular Dynamics Involving Excited States And Nonadiabatic Transitions"</a>.
  <em>J. Theor. Comput. Chem.</em>, <b>1</b>, 319-349 (2002).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEHammes-Schiffer1994JCP" id="Hammes-Schiffer1994JCP">[18]</a></dt><dd>
S.&nbsp;Hammes-Schiffer, J.&nbsp;C. Tully:
  <a href="http://dx.doi.org/10.1063/1.467455">"Proton transfer in
  solution: Molecular dynamics with quantum transitions"</a>. <em>J. Chem.
  Phys.</em>, <b>101</b>, 4657-4667 (1994).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEGranucci2007JCP" id="Granucci2007JCP">[19]</a></dt><dd>
G.&nbsp;Granucci, M.&nbsp;Persico:
  <a href="http://dx.doi.org/10.1063/1.2715585">"Critical appraisal of the
  fewest switches algorithm for surface hopping"</a>. <em>J. Chem. Phys.</em>,
  <b>126</b>, 134&nbsp;114 (2007).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEThachuk1996JCP" id="Thachuk1996JCP">[20]</a></dt><dd>
M.&nbsp;Thachuk, M.&nbsp;Y. Ivanov, D.&nbsp;M. Wardlaw:
  <a href="http://dx.doi.org/10.1063/1.472281">"A semiclassical approach
  to intense-field above-threshold dissociation in the long wavelength limit"</a>.
  <em>J. Chem. Phys.</em>, <b>105</b>, 4094-4104 (1996).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMaiti2004JPCA" id="Maiti2004JPCA">[21]</a></dt><dd>
B.&nbsp;Maiti, G.&nbsp;C. Schatz, G.&nbsp;Lendvay:
  <a href="http://dx.doi.org/10.1021/jp049143o">"Importance of Intersystem
  Crossing in the S(3P, 1D) + H2 &#8594; SH + H Reaction"</a>. <em>J.
  Phys. Chem. A</em>, <b>108</b>, 8772-8781 (2004).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEJones2008JPCA" id="Jones2008JPCA">[22]</a></dt><dd>
G.&nbsp;A. Jones, A.&nbsp;Acocella, F.&nbsp;Zerbetto:
  <a href="http://dx.doi.org/10.1021/jp805360v">"On-the-Fly,
  Electric-Field-Driven, Coupled Electron-Nuclear Dynamics"</a>. <em>J. Phys.
  Chem. A</em>, <b>112</b>, 9650-9656 (2008).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMitric2009PRA" id="Mitric2009PRA">[23]</a></dt><dd>
R.&nbsp;Mitri\'c, J.&nbsp;Petersen, V.&nbsp;Bonac\'c-Kouteck&#253;:
  <a href="http://dx.doi.org/10.1103/PhysRevA.79.053416">"Laser-field-induced
  surface-hopping method for the simulation and control of ultrafast
  photodynamics"</a>. <em>Phys. Rev. A</em>, <b>79</b>, 053&nbsp;416 (2009).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEGranucci2012JCP" id="Granucci2012JCP">[24]</a></dt><dd>
G.&nbsp;Granucci, M.&nbsp;Persico, G.&nbsp;Spighi:
  <a href="http://dx.doi.org/10.1063/1.4707737">"Surface hopping
  trajectory simulations with spin-orbit and dynamical couplings"</a>. <em>J.
  Chem. Phys.</em>, <b>137</b>, 22A501 (2012).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITECurchod2013C" id="Curchod2013C">[25]</a></dt><dd>
B.&nbsp;F.&nbsp;E. Curchod, T.&nbsp;J. Penfold, U.&nbsp;Rothlisberger, I.&nbsp;Tavernelli:
  <a href="http://dx.doi.org/doi:10.2533/chimia.2013.218">"Local Control
  Theory using Trajectory Surface Hopping and Linear-Response Time-Dependent
  Density Functional Theory"</a>. <em>Chimia</em>, <b>67</b>, 218-221 (2013).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITECui2014JCP" id="Cui2014JCP">[26]</a></dt><dd>
G.&nbsp;Cui, W.&nbsp;Thiel:
  <a href="http://dx.doi.org/http://dx.doi.org/10.1063/1.4894849">"Generalized
  trajectory surface-hopping method for internal conversion and intersystem
  crossing"</a>. <em>J. Chem. Phys.</em>, <b>141</b>, 124&nbsp;101 (2014).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEPittner2009CP" id="Pittner2009CP">[27]</a></dt><dd>
J.&nbsp;Pittner, H.&nbsp;Lischka, M.&nbsp;Barbatti:
  <a href="http://dx.doi.org/10.1016/j.chemphys.2008.10.013">"Optimization
  of mixed quantum-classical dynamics: Time-derivative coupling terms and
  selected couplings"</a>. <em>Chem. Phys.</em>, <b>356</b>, 147 - 152 (2009).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITERichter2011JCTC" id="Richter2011JCTC">[28]</a></dt><dd>
M.&nbsp;Richter, P.&nbsp;Marquetand, J.&nbsp;Gonz&#225;lez-V&#225;zquez, I.&nbsp;Sola, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1021/ct1007394">"SHARC: ab Initio
  Molecular Dynamics with Surface Hopping in the Adiabatic Representation
  Including Arbitrary Couplings"</a>. <em>J. Chem. Theory Comput.</em>, <b>7</b>,
  1253-1258 (2011).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMai2014SHARC" id="Mai2014SHARC">[29]</a></dt><dd>
S.&nbsp;Mai, M.&nbsp;Richter, M.&nbsp;Ruckenbauer, M.&nbsp;Oppel, P.&nbsp;Marquetand, L.&nbsp;Gonz&#225;lez:
  "SHARC: Surface Hopping Including Arbitrary Couplings - Program
  Package for Non-Adiabatic Dynamics". <a href="sharc-md.org"><tt>sharc-md.org</tt></a> (2014).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITERichter2012JCTC_erratum" id="Richter2012JCTC_erratum">[30]</a></dt><dd>
M.&nbsp;Richter, P.&nbsp;Marquetand, J.&nbsp;Gonz&#225;lez-V&#225;zquez, I.&nbsp;Sola, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1021/ct2005819">"Correction to SHARC: Ab
  Initio Molecular Dynamics with Surface Hopping in the Adiabatic
  Representation Including Arbitrary Couplings?"</a> <em>J. Chem. Theory
  Comput.</em>, <b>8</b>, 374-374 (2012).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEBajo2011JPCA" id="Bajo2011JPCA">[31]</a></dt><dd>
J.&nbsp;J. Bajo, J.&nbsp;Gonz&#225;lez-V&#225;zquez, I.&nbsp;Sola, J.&nbsp;Santamaria, M.&nbsp;Richter,
  P.&nbsp;Marquetand, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1021/jp208997r">"Mixed Quantum-Classical
  Dynamics in the Adiabatic Representation to simulate molecules driven by
  strong laser pulses"</a>. <em>J. Phys. Chem. A</em>, <b>116</b>, 2800-2807
  (2011).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMarquetand2011FD" id="Marquetand2011FD">[32]</a></dt><dd>
P.&nbsp;Marquetand, M.&nbsp;Richter, J.&nbsp;Gonz&#225;lez-V&#225;zquez, I.&nbsp;Sola, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1039/c1fd00055a">"Nonadiabatic ab initio
  molecular dynamics including spin-orbit coupling and laser fields"</a>.
  <em>Faraday Discuss.</em>, <b>153</b>, 261-273 (2011).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMai2014TCC" id="Mai2014TCC">[33]</a></dt><dd>
S.&nbsp;Mai, M.&nbsp;Richter, P.&nbsp;Marquetand, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1007/128_2014_549">"Excitation of
  Nucleobases from a Computational Perspective II: Dynamics"</a>. In
  M.&nbsp;Barbatti, A.&nbsp;C. Borin, S.&nbsp;Ullrich (editors), <em>Photoinduced Phenomena
  in Nucleic Acids</em>, Topics in Current Chemistry, Springer Berlin Heidelberg
  (2014).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEGonzalez2014" id="Gonzalez2014">[34]</a></dt><dd>
L.&nbsp;Gonz&#225;lez, P.&nbsp;Marquetand, M.&nbsp;Richter, J.&nbsp;Gonz&#225;lez-V&#225;zquez, I.&nbsp;Sola:
  <a href="http://dx.doi.org/10.1007/978-3-319-02051-8_7">"Ultrafast
  laser-induced processes described by ab initio molecular dynamics"</a>. In
  R.&nbsp;de&nbsp;Nalda, L.&nbsp;Ba&#241;ares (editors), <em>Ultrafast Phenomena in Molecular
  Sciences</em>, volume 107 of <em>Springer Series in Chemical Physics</em>,
  145-170, Springer (2014).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEGranucci2001JCP" id="Granucci2001JCP">[35]</a></dt><dd>
G.&nbsp;Granucci, M.&nbsp;Persico, A.&nbsp;Toniolo:
  <a href="http://dx.doi.org/doi:10.1063/1.1376633">"Direct semiclassical
  simulation of photochemical processes with semiempirical wave functions"</a>.
  <em>J. Chem. Phys.</em>, <b>114</b>, 10&nbsp;608-10&nbsp;615 (2001).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEPlasser2012JCP" id="Plasser2012JCP">[36]</a></dt><dd>
F.&nbsp;Plasser, G.&nbsp;Granucci, J.&nbsp;Pittner, M.&nbsp;Barbatti, M.&nbsp;Persico, H.&nbsp;Lischka:
  <a href="http://dx.doi.org/doi:10.1063/1.4738960">"Surface hopping
  dynamics using a locally diabatic formalism: Charge transfer in the ethylene
  dimer cation and excited state dynamics in the 2-pyridone dimer"</a>. <em>J.
  Chem. Phys.</em>, <b>137</b>, 22A514-22A514-13 (2012).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEDahl1988JCP" id="Dahl1988JCP">[37]</a></dt><dd>
J.&nbsp;P. Dahl, M.&nbsp;Springborg:
  <a href="http://dx.doi.org/doi:10.1063/1.453761">"The Morse oscillator
  in position space, momentum space, and phase space"</a>. <em>J. Chem. Phys.</em>,
  <b>88</b>, 4535-4547 (1988).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITESchinke1995" id="Schinke1995">[38]</a></dt><dd>
R.&nbsp;Schinke: <em>Photodissociation Dynamics: Spectroscopy and Fragmentation of
  Small Polyatomic Molecules</em>. Cambridge University Press (1995).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEBarbatti2011" id="Barbatti2011">[39]</a></dt><dd>
M.&nbsp;Barbatti, G.&nbsp;Granucci, M.&nbsp;Ruckenbauer, F.&nbsp;Plasser, J.&nbsp;Pittner, M.&nbsp;Persico,
  H.&nbsp;Lischka: "NEWTON-X: a package for Newtonian dynamics close to
  the crossing seam, version 1.2". <a href="www.newtonx.org"><tt>www.newtonx.org</tt></a> (2011).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITECremer1975JACS" id="Cremer1975JACS">[40]</a></dt><dd>
D.&nbsp;Cremer, J.&nbsp;A. Pople:
  <a href="http://dx.doi.org/10.1021/ja00839a011">"General definition of
  ring puckering coordinates"</a>. <em>J. Am. Chem. Soc.</em>, <b>97</b>,
  1354-1358 (1975).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEBoeyens1976JCMS" id="Boeyens1976JCMS">[41]</a></dt><dd>
J.&nbsp;C.&nbsp;A. Boeyens: <a href="http://dx.doi.org/10.1007/BF01200485">"The
  conformation of six-membered rings"</a>. <em>J. Cryst. Mol. Struct.</em>,
  <b>8</b>, 317 (1978).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITELischka2011WCMS" id="Lischka2011WCMS">[42]</a></dt><dd>
H.&nbsp;Lischka, T.&nbsp;M&#252;ller, P.&nbsp;G. Szalay, I.&nbsp;Shavitt, R.&nbsp;M. Pitzer, R.&nbsp;Shepard:
  <a href="http://dx.doi.org/10.1002/wcms.25">"Columbus - a program
  system for advanced multireference theory calculations."</a> <em>WIREs Comput.
  Mol. Sci.</em>, <b>1</b>, 191-199 (2011).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITELischka2012" id="Lischka2012">[43]</a></dt><dd>
H.&nbsp;Lischka, R.&nbsp;Shepard, I.&nbsp;Shavitt, R.&nbsp;M. Pitzer, M.&nbsp;Dallos, T.&nbsp;M&#252;ller, P.&nbsp;G.
  Szalay, F.&nbsp;B. Brown, R.&nbsp;Ahlrichs, H.&nbsp;J. B&#246;hm, A.&nbsp;Chang, D.&nbsp;C. Comeau,
  R.&nbsp;Gdanitz, H.&nbsp;Dachsel, C.&nbsp;Ehrhardt, M.&nbsp;Ernzerhof, P.&nbsp;H&#246;chtl, S.&nbsp;Irle,
  G.&nbsp;Kedziora, T.&nbsp;Kovar, V.&nbsp;Parasuk, M.&nbsp;J.&nbsp;M. Pepper, P.&nbsp;Scharf, H.&nbsp;Schiffer,
  M.&nbsp;Schindler, M.&nbsp;Sch&#252;ler, M.&nbsp;Seth, E.&nbsp;A. Stahlberg, J.-G. Zhao,
  S.&nbsp;Yabushita, Z.&nbsp;Zhang, M.&nbsp;Barbatti, S.&nbsp;Matsika, M.&nbsp;Schuurmann, D.&nbsp;R.
  Yarkony, S.&nbsp;R. Brozell, E.&nbsp;V. Beck, , J.-P. Blaudeau, M.&nbsp;Ruckenbauer,
  B.&nbsp;Sellner, F.&nbsp;Plasser, J.&nbsp;J. Szymczak: "COLUMBUS, an ab initio
  electronic structure program, release 7.0" (2012),
  <a href="http://www.univie.ac.at/columbus/docs_COL70/documentation_main.html"><tt>http://www.univie.ac.at/columbus/docs_COL70/documentation_main.html</tt></a>.
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEYabushita1999JPCA" id="Yabushita1999JPCA">[44]</a></dt><dd>
S.&nbsp;Yabushita, Z.&nbsp;Zhang, R.&nbsp;M. Pitzer:
  <a href="http://dx.doi.org/10.1021/jp9901242">"Spin-Orbit
  Configuration Interaction Using the Graphical Unitary Group Approach and
  Relativistic Core Potential and Spin-Orbit Operators"</a>. <em>J. Phys.
  Chem. A</em>, <b>103</b>, 5791-5800 (1999).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMai2014JCP_reindex" id="Mai2014JCP_reindex">[45]</a></dt><dd>
S.&nbsp;Mai, T.&nbsp;M&#252;ller, P.&nbsp;Marquetand, F.&nbsp;Plasser, H.&nbsp;Lischka, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1063/1.4892060">"Perturbational Treatment
  of Spin-Orbit Coupling for Generally Applicable High-Level Multi-Reference
  Methods"</a>. <em>J. Chem. Phys.</em>, <b>141</b>, 074&nbsp;105 (2014).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEWerner2012WCMS" id="Werner2012WCMS">[46]</a></dt><dd>
H.&nbsp;Werner, P.&nbsp;J. Knowles, G.&nbsp;Knizia, F.&nbsp;R. Manby, M.&nbsp;Sch&#252;tz:
  <a href="http://dx.doi.org/10.1002/wcms.82">"Molpro: a general-purpose
  quantum chemistry program package"</a>. <em>WIREs Comput. Mol. Sci.</em>,
  <b>2</b>, 242-253 (2012).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEWerner2012" id="Werner2012">[47]</a></dt><dd>
H.-J. Werner, P.&nbsp;J. Knowles, G.&nbsp;Knizia, F.&nbsp;R. Manby, M.&nbsp;Sch&#252;tz, et&nbsp;al.:
  "MOLPRO, version 2012.1, a package of ab initio programs".
  <a href="www.molpro.net"><tt>www.molpro.net</tt></a> (2012).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEKarlstrom2003CMS" id="Karlstrom2003CMS">[48]</a></dt><dd>
G.&nbsp;Karlstr&#246;m, R.&nbsp;Lindh, P.-&#197;. Malmqvist, B.&nbsp;O. Roos, U.&nbsp;Ryde,
  V.&nbsp;Veryazov, P.-O. Widmark, M.&nbsp;Cossi, B.&nbsp;Schimmelpfennig, P.&nbsp;Neogrady,
  L.&nbsp;Seijo:
  <a href="http://dx.doi.org/10.1016/S0927-0256(03)00109-5">"MOLCAS: a
  program package for computational chemistry"</a>. <em>Comput. Mater. Sci.</em>,
  <b>28</b>, 222 - 239 (2003), proceedings of the Symposium on Software
  Development for Process and Materials Design.
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEAquilante2010JCC" id="Aquilante2010JCC">[49]</a></dt><dd>
F.&nbsp;Aquilante, L.&nbsp;De&nbsp;Vico, N.&nbsp;Ferr&#233;, G.&nbsp;Ghigo, P.-&#197;. Malmqvist,
  P.&nbsp;Neogr&#225;dy, T.&nbsp;B. Pedersen, M.&nbsp;Piton&#225;k, M.&nbsp;Reiher, B.&nbsp;O. Roos,
  L.&nbsp;Serrano-Andr&#233;s, M.&nbsp;Urban, V.&nbsp;Veryazov, R.&nbsp;Lindh:
  <a href="http://dx.doi.org/10.1002/jcc.21318">"MOLCAS 7: The Next
  Generation"</a>. <em>J. Comput. Chem.</em>, <b>31</b>, 224-247 (2010),
  <a href="www.molcas.org"><tt>www.molcas.org</tt></a>.
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEGranucci2010JCP" id="Granucci2010JCP">[50]</a></dt><dd>
G.&nbsp;Granucci, M.&nbsp;Persico, A.&nbsp;Zoccante:
  <a href="http://dx.doi.org/10.1063/1.3489004">"Including quantum
  decoherence in surface hopping"</a>. <em>J. Chem. Phys.</em>, <b>133</b>,
  134&nbsp;111 (2010).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMarquetand2007" id="Marquetand2007">[51]</a></dt><dd>
P.&nbsp;Marquetand: <em>Vectorial properties and laser control of molecular
  dynamics</em>. Ph.D. thesis, University of W&#252;rzburg (2007),
  <a href="http://opus.bibliothek.uni-wuerzburg.de/volltexte/2007/2469/"><tt>http://opus.bibliothek.uni-wuerzburg.de/volltexte/2007/2469/</tt></a>.
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEVerlet1967PR" id="Verlet1967PR">[52]</a></dt><dd>
L.&nbsp;Verlet: <a href="http://dx.doi.org/10.1103/PhysRev.159.98">"Computer
  &#203;xperiments" on Classical Fluids. I. Thermodynamical Properties of
  Lennard-Jones Molecules"</a>. <em>Phys. Rev.</em>, <b>159</b>, 98-103 (1967).</dd>
</dl>
<div class="p"><!----></div>
</div>