<title> SHARC: Surface Hopping in the Adiabatic Representation Including Arbitrary Couplings---Manual</title>
<h1 align="center">SHARC: Surface Hopping in the Adiabatic Representation Including Arbitrary Couplings-Manual </h1>
<div class="p"><!----></div>
<div class="p"><!----></div>
<div class="p"><!----></div>
<div class="p"><!----></div>
<div class="p"><!----></div>
<h1>Contents </h1><a href="#tth_chAp1">1&nbsp; Introduction</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc1.1">1.1&nbsp; Capabilities</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc1.1.1">1.1.1&nbsp; New features in  S<span style="font-size:x-small">HARC</span>&nbsp;Version 2.0</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc1.2">1.2&nbsp; References</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc1.3">1.3&nbsp; Authors</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc1.4">1.4&nbsp; Suggestions and Bug Reports</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc1.5">1.5&nbsp; Notation in this Manual</a>
<a href="#tth_chAp2">2&nbsp; Installation</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.1">2.1&nbsp; How To Obtain</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.2">2.2&nbsp; Terms of Use</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.3">2.3&nbsp; Installation</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.3.1">2.3.1&nbsp;  WF<span style="font-size:x-small">OVERLAP</span> Program</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.3.2">2.3.2&nbsp; Libraries</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.3.3">2.3.3&nbsp; Test Suite</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.3.4">2.3.4&nbsp; Additional Programs</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.3.5">2.3.5&nbsp; Quantum Chemistry Programs</a>
<a href="#tth_chAp3">3&nbsp; Execution</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.1">3.1&nbsp; Running a single trajectory</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.1.1">3.1.1&nbsp; Input files</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.1.2">3.1.2&nbsp; Running the dynamics code</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.1.3">3.1.3&nbsp; Output files</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.2">3.2&nbsp; Typical workflow for an ensemble of trajectories</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.2.1">3.2.1&nbsp; Initial condition generation</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.2.2">3.2.2&nbsp; Running the dynamics simulations</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.2.3">3.2.3&nbsp; Analysis of the dynamics results</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.3">3.3&nbsp; Auxilliary Programs and Scripts</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.3.1">3.3.1&nbsp; Setup</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.3.2">3.3.2&nbsp; Analysis</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.3.3">3.3.3&nbsp; Interfaces</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.3.4">3.3.4&nbsp; Others</a>
<a href="#tth_chAp4">4&nbsp; Input files</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.1">4.1&nbsp; Main input file</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.1.1">4.1.1&nbsp; General remarks</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.1.2">4.1.2&nbsp; Input keywords</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.1.3">4.1.3&nbsp; Detailed Description of the Keywords</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.1.4">4.1.4&nbsp; Example</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.2">4.2&nbsp; Geometry file</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.3">4.3&nbsp; Velocity file</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.4">4.4&nbsp; Coefficient file</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.5">4.5&nbsp; Laser file</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.6">4.6&nbsp; Atom mask file</a>
<a href="#tth_chAp5">5&nbsp; Output files</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc5.1">5.1&nbsp; Log file</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc5.2">5.2&nbsp; Listing file</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc5.3">5.3&nbsp; Data file</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc5.3.1">5.3.1&nbsp; Specification of the data file</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc5.4">5.4&nbsp; XYZ file</a>
<a href="#tth_chAp6">6&nbsp; Interfaces</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.1">6.1&nbsp; Interface Specifications</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.1.1">6.1.1&nbsp; <b><tt>QM.in</tt></b> Specification</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.1.2">6.1.2&nbsp; <b><tt>QM.out</tt></b> Specification</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.1.3">6.1.3&nbsp; Further Specifications</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.1.4">6.1.4&nbsp; Save Directory Specification</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.2">6.2&nbsp; Overview over Interfaces</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.2.1">6.2.1&nbsp; Example Directory</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.3">6.3&nbsp; MOLPRO Interface</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.3.1">6.3.1&nbsp; Template file: <b><tt>MOLPRO.template</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.3.2">6.3.2&nbsp; Resource file: <b><tt>MOLPRO.resources</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.3.3">6.3.3&nbsp; Error checking</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.3.4">6.3.4&nbsp; Things to keep in mind</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.3.5">6.3.5&nbsp; Molpro input generator: <b><tt>molpro_input.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.4">6.4&nbsp; MOLCAS Interface</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.4.1">6.4.1&nbsp; Template file: <b><tt>MOLCAS.template</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.4.2">6.4.2&nbsp; Resource file: <b><tt>MOLCAS.resources</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.4.3">6.4.3&nbsp; Template file generator: <b><tt>molcas_input.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.4.4">6.4.4&nbsp; QM/MM key file: <b><tt>MOLCAS.qmmm.key</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.4.5">6.4.5&nbsp; QM/MM connection table file: <b><tt>MOLCAS.qmmm.table</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.5">6.5&nbsp; COLUMBUS Interface</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.5.1">6.5.1&nbsp; Template input</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.5.2">6.5.2&nbsp; Resource file: <b><tt>COLUMBUS.resources</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.5.3">6.5.3&nbsp; Template setup</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.6">6.6&nbsp; Analytical PESs Interface</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.6.1">6.6.1&nbsp; Parametrization</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.6.2">6.6.2&nbsp; Template file: <b><tt>Analytical.template</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.7">6.7&nbsp; ADF Interface</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.7.1">6.7.1&nbsp; Template file: <b><tt>ADF.template</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.7.2">6.7.2&nbsp; Resource file: <b><tt>ADF.resources</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.7.3">6.7.3&nbsp; QM/MM force field file: <b><tt>ADF.qmmm.ff</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.7.4">6.7.4&nbsp; QM/MM connection table file: <b><tt>ADF.qmmm.table</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.7.5">6.7.5&nbsp; Input file generator: <b><tt>ADF_input.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.7.6">6.7.6&nbsp; Frequencies converter: <b><tt>ADF_freq.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.8">6.8&nbsp; RICC2 Interface</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.8.1">6.8.1&nbsp; Template file: <b><tt>RICC2.template</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.8.2">6.8.2&nbsp; Resource file: <b><tt>RICC2.resources</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.9">6.9&nbsp; LVC Interface</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.9.1">6.9.1&nbsp; Input files</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.9.2">6.9.2&nbsp; Preparing Template Files: <b><tt>wigner.py</tt></b> and <b><tt>QMout2LVC.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.10">6.10&nbsp;  G<span style="font-size:x-small">AUSSIAN</span> Interface</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.10.1">6.10.1&nbsp; Template file: <b><tt>GAUSSIAN.template</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.10.2">6.10.2&nbsp; Resource file: <b><tt>GAUSSIAN.resources</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.11">6.11&nbsp; The  WF<span style="font-size:x-small">OVERLAP</span> Program</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.11.1">6.11.1&nbsp; Installation</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.12">6.12&nbsp; Getting started</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.13">6.13&nbsp; Manual installation</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.13.1">6.13.1&nbsp; Workflow</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.13.2">6.13.2&nbsp; Calling the program</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.13.3">6.13.3&nbsp; Input data</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.13.4">6.13.4&nbsp; Output</a>
<a href="#tth_chAp7">7&nbsp; Auxilliary Scripts</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.1">7.1&nbsp; Wigner Distribution Sampling: <b><tt>wigner.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.1.1">7.1.1&nbsp; Usage</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.1.2">7.1.2&nbsp; Normal mode types</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.1.3">7.1.3&nbsp; Non-default masses</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.1.4">7.1.4&nbsp; Sampling at finite temperatures</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.1.5">7.1.5&nbsp; Output</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.2">7.2&nbsp;  A<span style="font-size:x-small">MBER</span> Trajectory Sampling: <b><tt>amber_to_initconds.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.2.1">7.2.1&nbsp; Usage</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.2.2">7.2.2&nbsp; Time Step</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.2.3">7.2.3&nbsp; Atom Types and Masses</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.2.4">7.2.4&nbsp; Output</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.3">7.3&nbsp;  S<span style="font-size:x-small">HARC</span>&nbsp;Trajectory Sampling: <b><tt>sharctraj_to_initconds.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.3.1">7.3.1&nbsp; Usage</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.3.2">7.3.2&nbsp; Random Picking of Time Step</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.3.3">7.3.3&nbsp; Output</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.4">7.4&nbsp; Setup of Initial Calculations: <b><tt>setup_init.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.4.1">7.4.1&nbsp; Usage</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.4.2">7.4.2&nbsp; Input</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.4.3">7.4.3&nbsp; Interface-specific input</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.4.4">7.4.4&nbsp; Input for Run Scripts</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.4.5">7.4.5&nbsp; Output</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.5">7.5&nbsp; Excitation Selection: <b><tt>excite.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.5.1">7.5.1&nbsp; Usage</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.5.2">7.5.2&nbsp; Input</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.5.3">7.5.3&nbsp; Matrix diagonalization</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.5.4">7.5.4&nbsp; Output</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.5.5">7.5.5&nbsp; Specification of the <b><tt>initconds.excited</tt></b> file format</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.6">7.6&nbsp; Setup of Trajectories: <b><tt>setup_traj.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.6.1">7.6.1&nbsp; Input</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.6.2">7.6.2&nbsp; Interface-specific input</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.6.3">7.6.3&nbsp; Output control</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.6.4">7.6.4&nbsp; Run script setup</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.6.5">7.6.5&nbsp; Output</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.7">7.7&nbsp; Laser field generation: <b><tt>laser.x</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.7.1">7.7.1&nbsp; Usage</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.7.2">7.7.2&nbsp; Input</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.8">7.8&nbsp; Calculation of Absorption Spectra: <b><tt>spectrum.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.8.1">7.8.1&nbsp; Input</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.8.2">7.8.2&nbsp; Output</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.9">7.9&nbsp; File transfer: <b><tt>retrieve.sh</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.10">7.10&nbsp; Data Extractor: <b><tt>data_extractor.x</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.10.1">7.10.1&nbsp; Usage</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.10.2">7.10.2&nbsp; Output</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.11">7.11&nbsp; Plotting the Extracted Data: <b><tt>make_gnuscript.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.12">7.12&nbsp; Ensemble Diagnostics Tool: <b><tt>diagnostics.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.12.1">7.12.1&nbsp; Usage</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.12.2">7.12.2&nbsp; Input</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.13">7.13&nbsp; Calculation of Ensemble Populations: <b><tt>populations.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.13.1">7.13.1&nbsp; Usage</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.13.2">7.13.2&nbsp; Output</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.14">7.14&nbsp; Calculation of Numbers of Hops: <b><tt>transition.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.14.1">7.14.1&nbsp; Usage</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.15">7.15&nbsp; Fitting population data to kinetic models: <b><tt>make_fitscript.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.15.1">7.15.1&nbsp; Usage</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.15.2">7.15.2&nbsp; Input</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.15.3">7.15.3&nbsp; Output</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.16">7.16&nbsp; Estimating Errors of Fits: <b><tt>bootstrap.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.16.1">7.16.1&nbsp; Usage</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.16.2">7.16.2&nbsp; Input</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.16.3">7.16.3&nbsp; Output</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.17">7.17&nbsp; Obtaining Special Geometries: <b><tt>crossing.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.17.1">7.17.1&nbsp; Usage</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.17.2">7.17.2&nbsp; Output</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.18">7.18&nbsp; Internal Coordinates Analysis: <b><tt>geo.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.18.1">7.18.1&nbsp; Input</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.18.2">7.18.2&nbsp; Options</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.19">7.19&nbsp; Essential Dynamics Analysis: <b><tt>trajana_essdyn.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.19.1">7.19.1&nbsp; Usage</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.19.2">7.19.2&nbsp; Input</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.19.3">7.19.3&nbsp; Output</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.20">7.20&nbsp; Normal Mode Analysis: <b><tt>trajana_nma.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.20.1">7.20.1&nbsp; Usage</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.20.2">7.20.2&nbsp; Input</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.20.3">7.20.3&nbsp; Output</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.21">7.21&nbsp; General Data Analysis: <b><tt>data_collector.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.21.1">7.21.1&nbsp; Usage</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.21.2">7.21.2&nbsp; Input</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.21.3">7.21.3&nbsp; Output</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.22">7.22&nbsp; Optimizations with  O<span style="font-size:x-small">RCA</span> and  S<span style="font-size:x-small">HARC</span>: <b><tt>orca_External</tt></b> and <b><tt>setup_orca_opt.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.22.1">7.22.1&nbsp; Usage</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.22.2">7.22.2&nbsp; Input</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.22.3">7.22.3&nbsp; Output</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.22.4">7.22.4&nbsp; Description of <b><tt>orca_External</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.23">7.23&nbsp; Single Point Calculations: <b><tt>setup_single_point.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.23.1">7.23.1&nbsp; Usage</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.23.2">7.23.2&nbsp; Input</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.23.3">7.23.3&nbsp; Output</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.24">7.24&nbsp; Format Data from <b><tt>QM.out</tt></b> Files: <b><tt>QMout_print.py</tt></b></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.24.1">7.24.1&nbsp; Usage</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.24.2">7.24.2&nbsp; Output</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.25">7.25&nbsp; Diagonalization Helper: <b><tt>diagonalizer.x</tt></b></a>
<a href="#tth_chAp8">8&nbsp; Methodology</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.1">8.1&nbsp; Absorption Spectrum</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.2">8.2&nbsp; Active and inactive states</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.3">8.3&nbsp; Amdahl's Law</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.4">8.4&nbsp; Bootstrapping for Population Fits</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.5">8.5&nbsp; Damping</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.6">8.6&nbsp; Decoherence</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.6.1">8.6.1&nbsp; Energy-based decoherence</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.6.2">8.6.2&nbsp; Augmented FSSH decoherence</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.7">8.7&nbsp; Essential Dynamics Analysis</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.8">8.8&nbsp; Excitation Selection</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.8.1">8.8.1&nbsp; Excitation Selection with Diabatization</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.9">8.9&nbsp; Global fits and kinetic models</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.9.1">8.9.1&nbsp; Reaction networks</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.9.2">8.9.2&nbsp; Kinetic models</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.9.3">8.9.3&nbsp; Global fit</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.10">8.10&nbsp; Gradient transformation</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.10.1">8.10.1&nbsp; Dipole moment derivatives</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.11">8.11&nbsp; Internal coordinates definitions</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.12">8.12&nbsp; Kinetic energy adjustments</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.12.1">8.12.1&nbsp; Reflection for frustrated hops</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.13">8.13&nbsp; Laser fields</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.13.1">8.13.1&nbsp; Form of the laser field</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.13.2">8.13.2&nbsp; Envelope functions</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.13.3">8.13.3&nbsp; Field functions</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.13.4">8.13.4&nbsp; Chirped pulses</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.13.5">8.13.5&nbsp; Quadratic chirp without Fourier transform</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.14">8.14&nbsp; Laser interactions</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.14.1">8.14.1&nbsp; Surface Hopping with laser fields</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.15">8.15&nbsp; Normal Mode Analysis</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.16">8.16&nbsp; Optimization of Crossing Points</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.17">8.17&nbsp; Phase tracking</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.17.1">8.17.1&nbsp; Phase tracking of the transformation matrix</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.17.2">8.17.2&nbsp; Tracking of the phase of the MCH wave functions</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.18">8.18&nbsp; Random initial velocities</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.19">8.19&nbsp; Representations</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.19.1">8.19.1&nbsp; Current state in MCH representation</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.20">8.20&nbsp; Sampling from Wigner Distribution</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.20.1">8.20.1&nbsp; Sampling at Non-zero Temperature</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.21">8.21&nbsp; Scaling</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.22">8.22&nbsp; Seeding of the RNG</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.23">8.23&nbsp; Selection of gradients and nonadiabatic couplings</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.24">8.24&nbsp; State ordering</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.25">8.25&nbsp; Surface Hopping</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.26">8.26&nbsp; Velocity Verlet</a>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.27">8.27&nbsp; Wavefunction propagation</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.27.1">8.27.1&nbsp; Propagation using nonadiabatic couplings</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.27.2">8.27.2&nbsp; Propagation using overlap matrices</a>
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_chAp1"></a><h1>
Chapter 1 Introduction</h1>
<div class="p"><!----></div>
When a molecule is irradiated by light, a number of dynamical processes can take place, in which the molecule redistributes the energy among different electronic and vibrational degrees of freedom. Kasha's rule <a href="#Kasha1950DFS" id="CITEKasha1950DFS" class="tth_citation">[1</a>] states that radiationless transfer from higher excited singlet states to the lowest-lying excited singlet state (S<sub>1</sub>) is faster than fluorescence (F). This radiationless transfer is called internal conversion (IC) and involves a changes between electronic states of the same multiplicity. If a transition occurs between electronic states of different spin, the process is called intersystem crossing (ISC). A typical ISC process is from a singlet to a triplet state, and once the lowest triplet is populated, phosphorescence (P) can take place. In figure&nbsp;<a href="#fig:jablonski"> 1.1</a>, radiative (F and P) and radiationless (IC and ISC) processes are summarized in a so-called Jablonski diagram.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_fIg1.1">
</a>   <div style="text-align:center">  <img src="http://sharc-md.org/wp-content/uploads/2018/02/jablonski.png">  
<div style="text-align:center">Figure 1.1: Jablonski diagram showing the conceptual photophysical processes. Straight arrows show radiative processes: absorption (h&#957;), fluorescence (F), and phosphorescence (P); wavy arrows show radiationless processes: internal conversion (IC) and intersystem crossing (ISC). </div>
  <a id="fig:jablonski">
</a>
</div>
<div class="p"><!----></div>
The non-radiative IC and ISC processes are fundamental concepts which play a decisive role in photochemistry and photobiology. IC processes are present in the excited-state dynamics of many organic and inorganic molecules, whose applications range from solar energy conversion to drug therapy. Even many, very small molecules, for example O2 and O3, SO2, NO2 and other nitrous oxides, show efficient IC, which has important consequences in atmospheric chemistry and the study of the environment and pollution. IC is also the first step of the biological process of visual perception, where the retinal moiety of rhodopsin absorbs a photon and non-radiatively performs a torsion around one of the double bonds, changing the conformation of the protein and inducing a neural signal. Similarly, protection of the human body from the influence of UV light is achieved through very efficient IC in DNA, proteins and melanins. Ultrafast IC to the electronic ground state allows quickly converting the excitation energy of the UV photons into nuclear kinetic energy, which is spread harmlessly as heat to the environment.
<div class="p"><!----></div>
ISC processes are completely forbidden in the frame of the non-relativistic Schr&#246;dinger equation, but they become allowed when including spin-orbit couplings, a relativistic effect&nbsp;<a href="#Marian2012WCMS" id="CITEMarian2012WCMS" class="tth_citation">[2</a>]. Spin-orbit coupling depends on the nuclear charge and becomes stronger for heavy atoms, therefore it is typically known as a "heavy atom" effect. However, it has been recently recognized that even for molecules with only first- and second-row atoms, ISC might be relevant and can be competitive in time scales with IC. A small selection of the growing number of molecules where efficient ISC in a sub-ps time scale has been predicted are SO2&nbsp;<a href="#Wilkinson2014JCP" id="CITEWilkinson2014JCP" class="tth_citation">[3</a>,<a href="#Mai2014JCP_SO2" id="CITEMai2014JCP_SO2" class="tth_citation">[4</a>,<a href="#Leveque2014JCP_ISC" id="CITELeveque2014JCP_ISC" class="tth_citation">[5</a>], benzene&nbsp;<a href="#Penfold2012JCP" id="CITEPenfold2012JCP" class="tth_citation">[6</a>], aromatic nitrocompounds&nbsp;<a href="#Vogt2013JPC" id="CITEVogt2013JPC" class="tth_citation">[7</a>] or DNA nucleobases and derivatives&nbsp;<a href="#Crespo-Hernandez2004CR" id="CITECrespo-Hernandez2004CR" class="tth_citation">[8</a>,<a href="#Richter2012JPCL" id="CITERichter2012JPCL" class="tth_citation">[9</a>,<a href="#Martinez-Fernandez2012CC" id="CITEMartinez-Fernandez2012CC" class="tth_citation">[10</a>,<a href="#Mai2013C" id="CITEMai2013C" class="tth_citation">[11</a>,<a href="#Reichardt2010CC" id="CITEReichardt2010CC" class="tth_citation">[12</a>].
<div class="p"><!----></div>
Theoretical simulations can greatly contribute to understand non-radiative processes by following the nuclear motion on the excited-state potential energy surfaces (PES) in real time. These simulations are called excited-state dynamics simulations. 
Since the Born-Oppenheimer approximation is not applicable for this kind of dynamics, nonadiabatic effects need to be incorporated into the simulations.
<div class="p"><!----></div>
The principal methodology to tackle excited-state dynamics simulations is to numerically integrate the time-dependent Schr&#246;dinger equation, which is usually called full quantum dynamics simulations (QD). Given accurate PESs, QD is able to match experimental accuracy. However, the need for the "a priori" knowledge of the full multi-dimensional PES renders this type of simulations quickly unfeasible for more than few degrees of freedom. Several alternative methodologies are possible to alleviate this problem. One of the most popular ones is to use surface hopping nonadiabatic dynamics.
<div class="p"><!----></div>
Surface hopping was originally devised by Tully&nbsp;<a href="#Tully1971JCP" id="CITETully1971JCP" class="tth_citation">[13</a>] and greatly improved later by the "fewest-switches criterion"<a href="#Tully1990JCP" id="CITETully1990JCP" class="tth_citation">[14</a>] and it has been reviewed extensively since then, see e.g.&nbsp;<a href="#Barbatti2011WCMS" id="CITEBarbatti2011WCMS" class="tth_citation">[15</a>,<a href="#Subotnik2016ARPC" id="CITESubotnik2016ARPC" class="tth_citation">[16</a>,<a href="#Wang2016JPCL" id="CITEWang2016JPCL" class="tth_citation">[17</a>,<a href="#Doltsinis2006" id="CITEDoltsinis2006" class="tth_citation">[18</a>,<a href="#Doltsinis2002JTCC" id="CITEDoltsinis2002JTCC" class="tth_citation">[19</a>].
In surface hopping, the motion of the excited-state wave packet is approximated by the motion of an ensemble of many independent, classical trajectories. Each trajectory is at every instant of time tied to one particular PES, and the nuclear motion is integrated using the gradient of this PES. However, nonadiabatic population transfer can lead to the switching of a trajectory from one PES to another PES. This switching (also called "hopping", which is the origin of the name "surface hopping") is based on a stochastic algorithm, taking into account the change of the electronic population from one time step to the next one.
<div class="p"><!----></div>
The advantages of the surface hopping methodology and thus its popularity are well summarized in Ref.&nbsp;<a href="#Barbatti2011WCMS" class="tth_citeref">[15</a>]:
<ul>
<li> The method is conceptually simple, since it is based on classical mechanics. The nuclear propagation is based on Newton's equations and can be performed in Cartesian coordinates, avoiding any problems with curved coordinate systems as in QD.
<div class="p"><!----></div>
</li>
<li> For the propagation of the trajectories only local information of the PESs is needed. This avoids the calculation of the full, multi-dimensional PES in advance, which is the main bottleneck of QD methods. In surface hopping dynamics, all degrees of freedom can be included in the simulation. Additionally, all necessary quantities can be calculated on-demand, usually called "on-the-fly" in this context.
<div class="p"><!----></div>
</li>
<li> The independent trajectories can be trivially parallelized.
<div class="p"><!----></div>
</li>
</ul>
The strongest of these points of course is the fact that all degrees of freedom can be included easily in the calculations, allowing to describe large systems.
One should note, however, that surface hopping methods in the standard formulation&nbsp;<a href="#Tully1971JCP" class="tth_citeref">[13</a>,<a href="#Tully1990JCP" class="tth_citeref">[14</a>]-due to  the classical nature of the trajectories-do not allow to treat some purely quantum-mechanical effects like tunneling, (tunneling for selected degrees of freedom is possible <a href="#Hammes-Schiffer1994JCP" id="CITEHammes-Schiffer1994JCP" class="tth_citation">[20</a>]). Additionally, quantum coherence between the electronic states is usually described poorly, because of the independent-trajectory ansatz. This can be treated with some ad-hoc corrections, e.g., in <a href="#Granucci2007JCP" id="CITEGranucci2007JCP" class="tth_citation">[21</a>].
<div class="p"><!----></div>
In the original surface hopping method, only nonadiabatic couplings are considered, only allowing for population transfer between electronic states of the same multiplicity (IC). 
The  S<span style="font-size:x-small">HARC</span>&nbsp;methodology is a generalization of standard surface hopping since it allows to include any type of coupling. Beyond nonadiabatic couplings (for IC), spin-orbit couplings (for ISC) or interactions of dipole moments with electric fields (to explicitly describe laser-induced processes) can be included.
A number of methodologies for surface hopping including one or the other type of potential couplings have been proposed in references&nbsp;<a href="#Thachuk1996JCP" id="CITEThachuk1996JCP" class="tth_citation">[22</a>,<a href="#Maiti2004JPCA" id="CITEMaiti2004JPCA" class="tth_citation">[23</a>,<a href="#Jones2008JPCA" id="CITEJones2008JPCA" class="tth_citation">[24</a>,<a href="#Mitric2009PRA" id="CITEMitric2009PRA" class="tth_citation">[25</a>,<a href="#Granucci2012JCP" id="CITEGranucci2012JCP" class="tth_citation">[26</a>,<a href="#Curchod2013C" id="CITECurchod2013C" class="tth_citation">[27</a>,<a href="#Cui2014JCP" id="CITECui2014JCP" class="tth_citation">[28</a>], but  S<span style="font-size:x-small">HARC</span>&nbsp;can include all types of potential couplings on the same footing. 
<div class="p"><!----></div>
The  S<span style="font-size:x-small">HARC</span>&nbsp;methodology is an extension to standard surface hopping which allows to include these kinds of couplings. The central idea of  S<span style="font-size:x-small">HARC</span>&nbsp;is to obtain a fully diagonal Hamiltonian, which is adiabatic with respect to all couplings. The diagonal Hamiltonian is obtained by unitary transformation of the Hamiltonian including all couplings. Surface hopping is conducted on the transformed electronic states.
This has a number of advantages over the standard surface hopping methodology, where no diagonalization is performed:
<ul>
<li> Potential couplings (like spin-orbit couplings and laser-dipole couplings) are usually delocalized. Surface hopping, however, rests on the assumption that the couplings are localized and hence surface hops only occur in the small region where the couplings are large. Within  S<span style="font-size:x-small">HARC</span>, by transforming away the potential couplings, additional terms of nonadiabatic (kinetic) couplings arise, which are localized.
<div class="p"><!----></div>
</li>
<li> The potential couplings have an influence on the gradients acting on the nuclei. To a good approximation, within  S<span style="font-size:x-small">HARC</span>&nbsp;it is possible to include this influence in the dynamics.
<div class="p"><!----></div>
</li>
<li> When including spin-orbit couplings for states of higher multiplicity, diagonalization solves the problem of rotational invariance of the multiplet components (see&nbsp;<a href="#Granucci2012JCP" class="tth_citeref">[26</a>]).
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
The  S<span style="font-size:x-small">HARC</span>&nbsp;suite of programs is an implementation of the  S<span style="font-size:x-small">HARC</span>&nbsp;method. Besides the core dynamics code, it comes with a number of tools aiding in the setup, maintenance and analysis of the trajectories. 
<div class="p"><!----></div>
 <a id="tth_sEc1.1"></a><h2>
1.1&nbsp;&nbsp;Capabilities</h2>
<div class="p"><!----></div>
The main features of the  S<span style="font-size:x-small">HARC</span>2.0 suite are:
<ul>
<li> Non-adiabatic dynamics based on the surface hopping methodology able to describe internal conversion and intersystem crossing with any number of states (singlets, doublets, triplets, or higher multiplicities).
<div class="p"><!----></div>
</li>
<li> Algorithms for stable wave function propagation in the presence of very small or very large couplings.
<div class="p"><!----></div>
</li>
<li> Inclusion of interactions with laser fields in the long-wavelength limit. The derivatives of the dipole moments can be included in strong-field applications.
<div class="p"><!----></div>
</li>
<li> Propagation using either nonadiabatic couplings vectors &#9001;&#945;&#124;[(&#8706;)/(&#8706;<b>R</b>)]&#124;&#946;&#9002; or wave function overlaps &#9001;&#945;(t<sub>0</sub>)&#124;&#946;(t)&#9002; (via the local diabatization procedure <a href="#Granucci2007JCP" class="tth_citeref">[21</a>]).
<div class="p"><!----></div>
</li>
<li> Gradients including the effects of spin-orbit couplings (with the approximation that the diabatic spin-orbit couplings are slowly varying).
<div class="p"><!----></div>
</li>
<li> Flexible interface to quantum chemistry programs. Existing interfaces to:
<ul>
<li>  M<span style="font-size:x-small">OLPRO</span> 2010 and 2012: SA-CASSCF
<div class="p"><!----></div>
</li>
<li>  O<span style="font-size:x-small">PENMOLCAS</span> 18.0: SA-CASSCF, SS-CASPT2, MS-CASPT2, SA-CASSCF+QM/MM
<div class="p"><!----></div>
</li>
<li>  C<span style="font-size:x-small">OLUMBUS</span> 7: SA-CASSCF, SA-RASSCF, MR-CISD
<div class="p"><!----></div>
</li>
<li>  ADF 2017+: TD-DFT, TD-DFT+QM/MM
<div class="p"><!----></div>
</li>
<li>  T<span style="font-size:x-small">URBOMOLE</span> 7: ADC(2), CC2
<div class="p"><!----></div>
</li>
<li>  G<span style="font-size:x-small">AUSSIAN</span> 09 and 16: TD-DFT
<div class="p"><!----></div>
</li>
<li> Interface for analytical potentials
<div class="p"><!----></div>
</li>
<li> Interface for linear-vibronic coupling (LVC) models
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
</li>
<li> Energy-difference-based partial coupling approximation to speed up calculations <a href="#Pittner2009CP" id="CITEPittner2009CP" class="tth_citation">[29</a>].
<div class="p"><!----></div>
</li>
<li> Energy-based decoherence correction <a href="#Granucci2007JCP" class="tth_citeref">[21</a>] or augmented-FSSH decoherence correction <a href="#Jain2016JCTC" id="CITEJain2016JCTC" class="tth_citation">[30</a>].
<div class="p"><!----></div>
</li>
<li> Calculation of Dyson norms for single-photon ionization spectra (for most interfaces) <a href="#Ruckenbauer2016SR" id="CITERuckenbauer2016SR" class="tth_citation">[31</a>].
<div class="p"><!----></div>
</li>
<li> On-the-fly wave function analysis with TheoDORE <a href="#Plasser2014JCP1" id="CITEPlasser2014JCP1" class="tth_citation">[32</a>,<a href="#Plasser2014JCP2" id="CITEPlasser2014JCP2" class="tth_citation">[33</a>,<a href="#Plasser2017TheoDORE" id="CITEPlasser2017TheoDORE" class="tth_citation">[34</a>] (for some interfaces).
<div class="p"><!----></div>
</li>
<li> Suite of auxiliary Python scripts for all steps of the setup procedure and for various analysis tasks.
<div class="p"><!----></div>
</li>
<li> Comprehensive tutorial.
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
     <a id="tth_sEc1.1.1"></a><h3>
1.1.1&nbsp;&nbsp;New features in  S<span style="font-size:x-small">HARC</span>&nbsp;Version 2.0</h3>
<div class="p"><!----></div>
These features are new in  S<span style="font-size:x-small">HARC</span>&nbsp;Version 2.0 (2018):
<ul>
<li> Dynamics program <b><tt>sharc.x</tt></b>:
<ul>
<li> New methods: AFSSH for decoherence, GFSH for hopping probabilities, reflection after frustrated hop.
<div class="p"><!----></div>
</li>
<li> Atom masking for size-extensive decoherence and rescaling.
<div class="p"><!----></div>
</li>
<li> Improved wave function and <b>U</b> matrix phase tracking.
<div class="p"><!----></div>
</li>
<li> Support for on-the-fly computation of Dyson norms and  T<span style="font-size:x-small">HEO</span>DORE descriptors.
<div class="p"><!----></div>
</li>
<li> Option to gracefully stop trajectories after any time step.
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
</li>
<li> Fully integrated, efficient wave function overlap program <b><tt>wfoverlap.x</tt></b>
<div class="p"><!----></div>
</li>
<li> Quantum chemistry interfaces:
<ul>
<li>  M<span style="font-size:x-small">OLPRO</span>: overhauled, uses <b><tt>wfoverlap.x</tt></b>, gives consistent phase between CASSCF and CI wave functions, can do Dyson norms, parallelizes independent job parts.
<div class="p"><!----></div>
</li>
<li>  M<span style="font-size:x-small">OLCAS</span>: overhauled, can do (MS)-CASPT2 (only numerical gradients), QM/MM, Cholesky decomposition, Dyson norms, parallelizes independent job parts, works with  O<span style="font-size:x-small">PENMOLCAS</span> version 18.
<div class="p"><!----></div>
</li>
<li>  C<span style="font-size:x-small">OLUMBUS</span>: overhauled, uses <b><tt>wfoverlap.x</tt></b>, can use  D<span style="font-size:x-small">ALTON</span> integrals, can use  M<span style="font-size:x-small">OLCAS</span> orbitals, can do Dyson norms.
<div class="p"><!----></div>
</li>
<li>  A<span style="font-size:x-small">NALYTICAL</span>: -
<div class="p"><!----></div>
</li>
<li>  T<span style="font-size:x-small">URBOMOLE</span>: new interface, can do ADC(2) and CC2; has SOC (for ADC(2)), uses <b><tt>wfoverlap.x</tt></b>, works with  T<span style="font-size:x-small">HEO</span>DORE.
<div class="p"><!----></div>
</li>
<li>  ADF: new interface, can do TD-DFT; has SOC, uses <b><tt>wfoverlap.x</tt></b>, Dyson norms, has QM/MM, works with  T<span style="font-size:x-small">HEO</span>DORE.
<div class="p"><!----></div>
</li>
<li>  G<span style="font-size:x-small">AUSSIAN</span>: new interface, can do TD-DFT; uses <b><tt>wfoverlap.x</tt></b>, has Dyson norms, works with  T<span style="font-size:x-small">HEO</span>DORE.
<div class="p"><!----></div>
</li>
<li> LVC: new interface, can do (analytical) linear vibronic coupling models.
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
</li>
<li> Auxilliary scripts:
<ul>
<li> <b><tt>wigner.py</tt></b>: elevated temperature sampling, LVC model setup.
<div class="p"><!----></div>
</li>
<li> <b><tt>amber_to_initconds.py</tt></b>: new script, converts  A<span style="font-size:x-small">MBER</span> trajectories to  S<span style="font-size:x-small">HARC</span>&nbsp;initial conditions.
<div class="p"><!----></div>
</li>
<li> <b><tt>sharctraj_to_initconds.py</tt></b>: new script, converts  S<span style="font-size:x-small">HARC</span>&nbsp;trajectories to  S<span style="font-size:x-small">HARC</span>&nbsp;initial conditions.
<div class="p"><!----></div>
</li>
<li> <b><tt>spectrum.py</tt></b>: log-normal convolution, density of state spectra.
<div class="p"><!----></div>
</li>
<li> <b><tt>data_extractor.x</tt></b>: new quantities to extract.
<div class="p"><!----></div>
</li>
<li> <b><tt>diagnostics.py</tt></b>: new script, checks all trajectories prior to analysis.
<div class="p"><!----></div>
</li>
<li> <b><tt>populations.py</tt></b>: new analysis modes.
<div class="p"><!----></div>
</li>
<li> <b><tt>transition.py</tt></b>: new script, computes total number of hops in ensemble.
<div class="p"><!----></div>
</li>
<li> <b><tt>make_fitscript.py</tt></b>: new script, prepares kinetic model fits to obtain time constants from populations.
<div class="p"><!----></div>
</li>
<li> <b><tt>bootstrap.py</tt></b>: new script, calculates error estimates for time constants.
<div class="p"><!----></div>
</li>
<li> <b><tt>trajana_essdyn.py</tt></b>: new script, performs essential dynamics analysis.
<div class="p"><!----></div>
</li>
<li> <b><tt>trajana_nma.py</tt></b>: new script, performs normal mode analysis.
<div class="p"><!----></div>
</li>
<li> <b><tt>data_collector.py</tt></b>: new script, performs generic data analysis (collecting, smoothing, convolution, integration).
<div class="p"><!----></div>
</li>
<li> <b><tt>orca_External</tt></b>: new script, allows optimization with  O<span style="font-size:x-small">RCA</span> and  S<span style="font-size:x-small">HARC</span>.
<div class="p"><!----></div>
</li>
<li> Several input generation helpers.
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
</li>
<li> Reworked tutorial using  O<span style="font-size:x-small">PENMOLCAS</span> (which is available at no cost).
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc1.2"></a><h2>
1.2&nbsp;&nbsp;References</h2>
<div class="p"><!----></div>
The following references should be cited when using the  S<span style="font-size:x-small">HARC</span>&nbsp;suite:
<ul>
<li> <a href="#Richter2011JCTC" id="CITERichter2011JCTC" class="tth_citation">[35</a>] Richter2011JCTC.
<div class="p"><!----></div>
</li>
<li> <a href="#Mai2015IJQC" id="CITEMai2015IJQC" class="tth_citation">[36</a>] Mai2015IJQC.
<div class="p"><!----></div>
</li>
<li> <a href="#Mai2018WCMS" id="CITEMai2018WCMS" class="tth_citation">[37</a>] Mai2018WCMS.
<div class="p"><!----></div>
</li>
<li> <a href="#Mai2018SHARC" id="CITEMai2018SHARC" class="tth_citation">[38</a>] Mai2018SHARC.
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
Details can be found in the following references:
<div class="p"><!----></div>
The theoretical background of  S<span style="font-size:x-small">HARC</span>&nbsp;is described in Refs.&nbsp;<a href="#Richter2011JCTC" class="tth_citeref">[35</a>,<a href="#Richter2012JCTC_erratum" id="CITERichter2012JCTC_erratum" class="tth_citation">[39</a>,<a href="#Bajo2012JPCA" id="CITEBajo2012JPCA" class="tth_citation">[40</a>,<a href="#Marquetand2011FD" id="CITEMarquetand2011FD" class="tth_citation">[41</a>,<a href="#Mai2015IJQC" class="tth_citeref">[36</a>,<a href="#Mai2018WCMS" class="tth_citeref">[37</a>,<a href="#Mai2018" id="CITEMai2018" class="tth_citation">[42</a>].
<div class="p"><!----></div>
Applications of the  S<span style="font-size:x-small">HARC</span>&nbsp;code can be found in Refs.&nbsp;<a href="#Richter2012JPCL" class="tth_citeref">[9</a>,<a href="#Mai2013C" class="tth_citeref">[11</a>,<a href="#Mai2014TCC" id="CITEMai2014TCC" class="tth_citation">[43</a>,<a href="#Mai2014JCP_SO2" class="tth_citeref">[4</a>,<a href="#Gonzalez2014" id="CITEGonzalez2014" class="tth_citation">[44</a>,<a href="#Richter2014PCCP" id="CITERichter2014PCCP" class="tth_citation">[45</a>,<a href="#Martinez-Fernandez2014JCTC" id="CITEMartinez-Fernandez2014JCTC" class="tth_citation">[46</a>,<a href="#Corrales2014PCCP" id="CITECorrales2014PCCP" class="tth_citation">[47</a>,<a href="#Crespo-Hernandez2015JACS" id="CITECrespo-Hernandez2015JACS" class="tth_citation">[48</a>,<a href="#Marazzi2016JPCL" id="CITEMarazzi2016JPCL" class="tth_citation">[49</a>,<a href="#Richter2016JCTC" id="CITERichter2016JCTC" class="tth_citation">[50</a>,<a href="#Cao2016CP" id="CITECao2016CP" class="tth_citation">[51</a>,<a href="#Banerjee2016PCCP" id="CITEBanerjee2016PCCP" class="tth_citation">[52</a>,<a href="#Mai2016JPCL" id="CITEMai2016JPCL" class="tth_citation">[53</a>,<a href="#Mai2016NC" id="CITEMai2016NC" class="tth_citation">[54</a>,<a href="#Peccati2016PTRSA" id="CITEPeccati2016PTRSA" class="tth_citation">[55</a>,<a href="#Murillo-Sanchez2017CPL" id="CITEMurillo-Sanchez2017CPL" class="tth_citation">[56</a>,<a href="#Borin2017PCCP" id="CITEBorin2017PCCP" class="tth_citation">[57</a>,<a href="#Mai2017CP" id="CITEMai2017CP" class="tth_citation">[58</a>,<a href="#Siouri2017JPCA" id="CITESiouri2017JPCA" class="tth_citation">[59</a>,<a href="#Bellshaw2017CPL" id="CITEBellshaw2017CPL" class="tth_citation">[60</a>,<a href="#Sun2017JPCA" id="CITESun2017JPCA" class="tth_citation">[61</a>,<a href="#Rauer2016JACS" id="CITERauer2016JACS" class="tth_citation">[62</a>,<a href="#Atkins2017JPCL" id="CITEAtkins2017JPCL" class="tth_citation">[63</a>,<a href="#Schnappinger2017PCCP" id="CITESchnappinger2017PCCP" class="tth_citation">[64</a>,<a href="#Mai2017JCP" id="CITEMai2017JCP" class="tth_citation">[65</a>,<a href="#Zobel2018CEJ" id="CITEZobel2018CEJ" class="tth_citation">[66</a>,<a href="#Rauer2018MC" id="CITERauer2018MC" class="tth_citation">[67</a>,<a href="#Cao2018JMS" id="CITECao2018JMS" class="tth_citation">[68</a>,<a href="#Squibb2018NC" id="CITESquibb2018NC" class="tth_citation">[69</a>].
<div class="p"><!----></div>
Other features implemented in the  S<span style="font-size:x-small">HARC</span>&nbsp;suite are described in the following references:
<ul>
<li> Energy-based decoherence correction: <a href="#Granucci2007JCP" class="tth_citeref">[21</a>].
<div class="p"><!----></div>
</li>
<li> Augmented-FSSH decoherence correction: <a href="#Jain2016JCTC" class="tth_citeref">[30</a>].
<div class="p"><!----></div>
</li>
<li> Global flux SH: <a href="#Wang2014JCTC" id="CITEWang2014JCTC" class="tth_citation">[70</a>].
<div class="p"><!----></div>
</li>
<li> Local diabatization and wave function overlap calculation: <a href="#Granucci2001JCP" id="CITEGranucci2001JCP" class="tth_citation">[71</a>,<a href="#Plasser2012JCP" id="CITEPlasser2012JCP" class="tth_citation">[72</a>,<a href="#Plasser2016JCTC" id="CITEPlasser2016JCTC" class="tth_citation">[73</a>].
<div class="p"><!----></div>
</li>
<li> Sampling of initial conditions from a quantum-mechanical harmonic Wigner distribution: <a href="#Dahl1988JCP" id="CITEDahl1988JCP" class="tth_citation">[74</a>,<a href="#Schinke1995" id="CITESchinke1995" class="tth_citation">[75</a>,<a href="#Barbatti2016IJQC" id="CITEBarbatti2016IJQC" class="tth_citation">[76</a>].
<div class="p"><!----></div>
</li>
<li> Excited state selection for initial condition generation: <a href="#Barbatti2007JPPA" id="CITEBarbatti2007JPPA" class="tth_citation">[77</a>].
<div class="p"><!----></div>
</li>
<li> Calculation of ring puckering parameters and their classification: <a href="#Cremer1975JACS" id="CITECremer1975JACS" class="tth_citation">[78</a>,<a href="#Boeyens1976JCMS" id="CITEBoeyens1976JCMS" class="tth_citation">[79</a>].
<div class="p"><!----></div>
</li>
<li> Normal mode analysis <a href="#Kurtz2001JCP" id="CITEKurtz2001JCP" class="tth_citation">[80</a>,<a href="#Plasser2009" id="CITEPlasser2009" class="tth_citation">[81</a>] and essential dynamics analysis: <a href="#Amadei1993PSFB" id="CITEAmadei1993PSFB" class="tth_citation">[82</a>,<a href="#Plasser2009" class="tth_citeref">[81</a>].
<div class="p"><!----></div>
</li>
<li> Bootstrapping for error estimation: <a href="#Nangia2004JCP" id="CITENangia2004JCP" class="tth_citation">[83</a>].
<div class="p"><!----></div>
</li>
<li> Crossing point optimization: <a href="#Bearpark1994CPL" id="CITEBearpark1994CPL" class="tth_citation">[84</a>,<a href="#Levine2008JPCB" id="CITELevine2008JPCB" class="tth_citation">[85</a>]
<div class="p"><!----></div>
</li>
<li> Computation of ionization spectra: <a href="#Ruckenbauer2016SR" class="tth_citeref">[31</a>,<a href="#Ruckenbauer2016JCP" id="CITERuckenbauer2016JCP" class="tth_citation">[86</a>].
<div class="p"><!----></div>
</li>
<li> Wave function comparison with overlaps: <a href="#Plasser2016JCP" id="CITEPlasser2016JCP" class="tth_citation">[87</a>].
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
The quantum chemistry programs to which interfaces with  S<span style="font-size:x-small">HARC</span>&nbsp;exist are described in the following sources:
<ul>
<li>  M<span style="font-size:x-small">OLPRO</span>: <a href="#Werner2012WCMS" id="CITEWerner2012WCMS" class="tth_citation">[88</a>,<a href="#Werner2012" id="CITEWerner2012" class="tth_citation">[89</a>],
<div class="p"><!----></div>
</li>
<li>  M<span style="font-size:x-small">OLCAS</span>: <a href="#Karlstrom2003CMS" id="CITEKarlstrom2003CMS" class="tth_citation">[90</a>,<a href="#Aquilante2010JCC" id="CITEAquilante2010JCC" class="tth_citation">[91</a>,<a href="#Aquilante2015JCC" id="CITEAquilante2015JCC" class="tth_citation">[92</a>],
<div class="p"><!----></div>
</li>
<li>  C<span style="font-size:x-small">OLUMBUS</span>: <a href="#Lischka2011WCMS" id="CITELischka2011WCMS" class="tth_citation">[93</a>,<a href="#Lischka2012" id="CITELischka2012" class="tth_citation">[94</a>,<a href="#Yabushita1999JPCA" id="CITEYabushita1999JPCA" class="tth_citation">[95</a>,<a href="#Mai2014JCP_reindex" id="CITEMai2014JCP_reindex" class="tth_citation">[96</a>],
<div class="p"><!----></div>
</li>
<li>  ADF: <a href="#ADF2017" id="CITEADF2017" class="tth_citation">[97</a>],
<div class="p"><!----></div>
</li>
<li>  T<span style="font-size:x-small">URBOMOLE</span>: <a href="#TURBOMOLE70" id="CITETURBOMOLE70" class="tth_citation">[98</a>],
<div class="p"><!----></div>
</li>
<li>  G<span style="font-size:x-small">AUSSIAN</span>: <a href="#Gaussian09" id="CITEGaussian09" class="tth_citation">[99</a>,<a href="#Gaussian16" id="CITEGaussian16" class="tth_citation">[100</a>].
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
Others:
<ul>
<li>  T<span style="font-size:x-small">HEO</span>DORE: <a href="#Plasser2014JCP1" class="tth_citeref">[32</a>,<a href="#Plasser2014JCP2" class="tth_citeref">[33</a>,<a href="#Plasser2017TheoDORE" class="tth_citeref">[34</a>]
<div class="p"><!----></div>
</li>
<li>  WF<span style="font-size:x-small">OVERLAP</span>: <a href="#Plasser2016JCTC" class="tth_citeref">[73</a>,<a href="#Plasser2016JCP" class="tth_citeref">[87</a>]
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
 <a id="tth_sEc1.3"></a><h2>
1.3&nbsp;&nbsp;Authors</h2>
<div class="p"><!----></div>
The current version of the  S<span style="font-size:x-small">HARC</span>&nbsp;suite has been programmed by Sebastian Mai, Martin Richter, Moritz Heindl, Maximilian F. S. J. Menger, Andrew Atkins, Felix Plasser, and Philipp Marquetand of the AG Gonz&#225;lez of the Institute of Theoretical Chemistry of the University of Vienna with contributions from Jes&#250;s Gonz&#225;lez-V&#225;zquez, Matthias Ruckenbauer, Markus Oppel, Patrick J.&nbsp;Zobel, and Leticia Gonz&#225;lez.
<div class="p"><!----></div>
 <a id="tth_sEc1.4"></a><h2>
1.4&nbsp;&nbsp;Suggestions and Bug Reports</h2>
<div class="p"><!----></div>
Bug reports and suggestions for possible features can be submitted to <a href="mailto:sharc@univie.ac.at">sharc@univie.ac.at</a>.
<div class="p"><!----></div>
 <a id="tth_sEc1.5"></a><h2>
1.5&nbsp;&nbsp;Notation in this Manual</h2>
<div class="p"><!----></div>
<b>Names of programs&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The  S<span style="font-size:x-small">HARC</span>&nbsp;suite consists of Fortran90 programs as well as Python and Shell scripts. The executable Fortran90 programs are denoted by the extension <b><tt>.x</tt></b>, the Python scripts have the extension <b><tt>.py</tt></b> and the Shell scripts <b><tt>.sh</tt></b>. Within this manual, all program names are given in <b><tt>bold monospaced font</tt></b>.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_chAp2"></a><h1>
Chapter 2 Installation</h1>
<div class="p"><!----></div>
 <a id="tth_sEc2.1"></a><h2>
2.1&nbsp;&nbsp;How To Obtain</h2>
<div class="p"><!----></div>
 S<span style="font-size:x-small">HARC</span>&nbsp;can be obtained from the  S<span style="font-size:x-small">HARC</span>&nbsp;homepage <a href="http://sharc-md.org">www.sharc-md.org</a>. In the Download section, register with your e-mail adress and affiliation. You will receive a download link to the stated e-mail adress. Clicking on the link in the email will download the archive file containing the  S<span style="font-size:x-small">HARC</span>&nbsp;package. Note that the link is active only for 24 h and the number of downloads is limited.
<div class="p"><!----></div>
Note that you must accept the Terms of Use given in the following section in order to download  S<span style="font-size:x-small">HARC</span>.
<div class="p"><!----></div>
 <a id="tth_sEc2.2"></a><h2>
2.2&nbsp;&nbsp;Terms of Use</h2>
<div class="p"><!----></div>
 S<span style="font-size:x-small">HARC</span>&nbsp;Program Suite
<div class="p"><!----></div>
Copyright 2018, University of Vienna
<div class="p"><!----></div>
SHARC is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.
<div class="p"><!----></div>
SHARC is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.
<div class="p"><!----></div>
A copy of the GNU General Public License is given below.
It is also available at <a href="http://www.gnu.org/licenses/">www.gnu.org/licenses/</a>.
<div class="p"><!----></div>
<div class="p"><!----></div>
<div class="p"><!----></div>
<div style="text-align:center">  <b><div class="large">GNU General Public License</div></b>
</div>
<div class="p"><!----></div>
 <b>1.&nbsp;&nbsp;&nbsp; Preamble</b>
<div class="p"><!----></div>
The GNU General Public License is a free, copyleft license for
software and other kinds of works.
<div class="p"><!----></div>
The licenses for most software and other practical works are designed
to take away your freedom to share and change the works.  By contrast,
the GNU General Public License is intended to guarantee your freedom to
share and change all versions of a program-to make sure it remains free
software for all its users.  We, the Free Software Foundation, use the
GNU General Public License for most of our software; it applies also to
any other work released this way by its authors.  You can apply it to
your programs, too.
<div class="p"><!----></div>
When we speak of free software, we are referring to freedom, not
price.  Our General Public Licenses are designed to make sure that you
have the freedom to distribute copies of free software (and charge for
them if you wish), that you receive source code or can get it if you
want it, that you can change the software or use pieces of it in new
free programs, and that you know you can do these things.
<div class="p"><!----></div>
To protect your rights, we need to prevent others from denying you
these rights or asking you to surrender the rights.  Therefore, you have
certain responsibilities if you distribute copies of the software, or if
you modify it: responsibilities to respect the freedom of others.
<div class="p"><!----></div>
For example, if you distribute copies of such a program, whether
gratis or for a fee, you must pass on to the recipients the same
freedoms that you received.  You must make sure that they, too, receive
or can get the source code.  And you must show them these terms so they
know their rights.
<div class="p"><!----></div>
Developers that use the GNU GPL protect your rights with two steps:
(1) assert copyright on the software, and (2) offer you this License
giving you legal permission to copy, distribute and/or modify it.
<div class="p"><!----></div>
For the developers' and authors' protection, the GPL clearly explains
that there is no warranty for this free software.  For both users' and
authors' sake, the GPL requires that modified versions be marked as
changed, so that their problems will not be attributed erroneously to
authors of previous versions.
<div class="p"><!----></div>
Some devices are designed to deny users access to install or run
modified versions of the software inside them, although the manufacturer
can do so.  This is fundamentally incompatible with the aim of
protecting users' freedom to change the software.  The systematic
pattern of such abuse occurs in the area of products for individuals to
use, which is precisely where it is most unacceptable.  Therefore, we
have designed this version of the GPL to prohibit the practice for those
products.  If such problems arise substantially in other domains, we
stand ready to extend this provision to those domains in future versions
of the GPL, as needed to protect the freedom of users.
<div class="p"><!----></div>
Finally, every program is threatened constantly by software patents.
States should not allow patents to restrict development and use of
software on general-purpose computers, but in those that do, we wish to
avoid the special danger that patents applied to a free program could
make it effectively proprietary.  To prevent this, the GPL assures that
patents cannot be used to render the program non-free.
<div class="p"><!----></div>
The precise terms and conditions for copying, distribution and
modification follow.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <b>2.&nbsp;&nbsp;&nbsp; Terms and Conditions</b>
<div class="p"><!----></div>
<ol type="1">
<li> Definitions.
<div class="p"><!----></div>
"This License" refers to version 3 of the GNU General Public License.
<div class="p"><!----></div>
"Copyright" also means copyright-like laws that apply to other kinds of
works, such as semiconductor masks.
<div class="p"><!----></div>
"The Program" refers to any copyrightable work licensed under this
License.  Each licensee is addressed as "you".  "Licensees" and
"recipients" may be individuals or organizations.
<div class="p"><!----></div>
To "modify" a work means to copy from or adapt all or part of the work
in a fashion requiring copyright permission, other than the making of an
exact copy.  The resulting work is called a "modified version" of the
earlier work or a work "based on" the earlier work.
<div class="p"><!----></div>
A "covered work" means either the unmodified Program or a work based
on the Program.
<div class="p"><!----></div>
To "propagate" a work means to do anything with it that, without
permission, would make you directly or secondarily liable for
infringement under applicable copyright law, except executing it on a
computer or modifying a private copy.  Propagation includes copying,
distribution (with or without modification), making available to the
public, and in some countries other activities as well.
<div class="p"><!----></div>
To "convey" a work means any kind of propagation that enables other
parties to make or receive copies.  Mere interaction with a user through
a computer network, with no transfer of a copy, is not conveying.
<div class="p"><!----></div>
An interactive user interface displays "Appropriate Legal Notices"
to the extent that it includes a convenient and prominently visible
feature that (1) displays an appropriate copyright notice, and (2)
tells the user that there is no warranty for the work (except to the
extent that warranties are provided), that licensees may convey the
work under this License, and how to view a copy of this License.  If
the interface presents a list of user commands or options, such as a
menu, a prominent item in the list meets this criterion.
<div class="p"><!----></div>
</li>
<li> Source Code.
<div class="p"><!----></div>
The "source code" for a work means the preferred form of the work
for making modifications to it.  "Object code" means any non-source
form of a work.
<div class="p"><!----></div>
A "Standard Interface" means an interface that either is an official
standard defined by a recognized standards body, or, in the case of
interfaces specified for a particular programming language, one that
is widely used among developers working in that language.
<div class="p"><!----></div>
The "System Libraries" of an executable work include anything, other
than the work as a whole, that (a) is included in the normal form of
packaging a Major Component, but which is not part of that Major
Component, and (b) serves only to enable use of the work with that
Major Component, or to implement a Standard Interface for which an
implementation is available to the public in source code form.  A
"Major Component", in this context, means a major essential component
(kernel, window system, and so on) of the specific operating system
(if any) on which the executable work runs, or a compiler used to
produce the work, or an object code interpreter used to run it.
<div class="p"><!----></div>
The "Corresponding Source" for a work in object code form means all
the source code needed to generate, install, and (for an executable
work) run the object code and to modify the work, including scripts to
control those activities.  However, it does not include the work's
System Libraries, or general-purpose tools or generally available free
programs which are used unmodified in performing those activities but
which are not part of the work.  For example, Corresponding Source
includes interface definition files associated with source files for
the work, and the source code for shared libraries and dynamically
linked subprograms that the work is specifically designed to require,
such as by intimate data communication or control flow between those
subprograms and other parts of the work.
<div class="p"><!----></div>
The Corresponding Source need not include anything that users
can regenerate automatically from other parts of the Corresponding
Source.
<div class="p"><!----></div>
The Corresponding Source for a work in source code form is that
same work.
<div class="p"><!----></div>
</li>
<li> Basic Permissions.
<div class="p"><!----></div>
All rights granted under this License are granted for the term of
copyright on the Program, and are irrevocable provided the stated
conditions are met.  This License explicitly affirms your unlimited
permission to run the unmodified Program.  The output from running a
covered work is covered by this License only if the output, given its
content, constitutes a covered work.  This License acknowledges your
rights of fair use or other equivalent, as provided by copyright law.
<div class="p"><!----></div>
You may make, run and propagate covered works that you do not
convey, without conditions so long as your license otherwise remains
in force.  You may convey covered works to others for the sole purpose
of having them make modifications exclusively for you, or provide you
with facilities for running those works, provided that you comply with
the terms of this License in conveying all material for which you do
not control copyright.  Those thus making or running the covered works
for you must do so exclusively on your behalf, under your direction
and control, on terms that prohibit them from making any copies of
your copyrighted material outside their relationship with you.
<div class="p"><!----></div>
Conveying under any other circumstances is permitted solely under
the conditions stated below.  Sublicensing is not allowed; section 10
makes it unnecessary.
<div class="p"><!----></div>
</li>
<li> Protecting Users' Legal Rights From Anti-Circumvention Law.
<div class="p"><!----></div>
No covered work shall be deemed part of an effective technological
measure under any applicable law fulfilling obligations under article
11 of the WIPO copyright treaty adopted on 20 December 1996, or
similar laws prohibiting or restricting circumvention of such
measures.
<div class="p"><!----></div>
When you convey a covered work, you waive any legal power to forbid
circumvention of technological measures to the extent such circumvention
is effected by exercising rights under this License with respect to
the covered work, and you disclaim any intention to limit operation or
modification of the work as a means of enforcing, against the work's
users, your or third parties' legal rights to forbid circumvention of
technological measures.
<div class="p"><!----></div>
</li>
<li> Conveying Verbatim Copies.
<div class="p"><!----></div>
You may convey verbatim copies of the Program's source code as you
receive it, in any medium, provided that you conspicuously and
appropriately publish on each copy an appropriate copyright notice;
keep intact all notices stating that this License and any
non-permissive terms added in accord with section 7 apply to the code;
keep intact all notices of the absence of any warranty; and give all
recipients a copy of this License along with the Program.
<div class="p"><!----></div>
You may charge any price or no price for each copy that you convey,
and you may offer support or warranty protection for a fee.
<div class="p"><!----></div>
</li>
<li> Conveying Modified Source Versions.
<div class="p"><!----></div>
You may convey a work based on the Program, or the modifications to
produce it from the Program, in the form of source code under the
terms of section 4, provided that you also meet all of these conditions:
<ol type="a">
<li> The work must carry prominent notices stating that you modified
  it, and giving a relevant date.
<div class="p"><!----></div>
</li>
<li> The work must carry prominent notices stating that it is
  released under this License and any conditions added under section
  7.  This requirement modifies the requirement in section 4 to
  "keep intact all notices".
<div class="p"><!----></div>
</li>
<li> You must license the entire work, as a whole, under this
  License to anyone who comes into possession of a copy.  This
  License will therefore apply, along with any applicable section 7
  additional terms, to the whole of the work, and all its parts,
  regardless of how they are packaged.  This License gives no
  permission to license the work in any other way, but it does not
  invalidate such permission if you have separately received it.
<div class="p"><!----></div>
</li>
<li> If the work has interactive user interfaces, each must display
  Appropriate Legal Notices; however, if the Program has interactive
  interfaces that do not display Appropriate Legal Notices, your
  work need not make them do so.
<div class="p"><!----></div>
</li>
</ol>
A compilation of a covered work with other separate and independent
works, which are not by their nature extensions of the covered work,
and which are not combined with it such as to form a larger program,
in or on a volume of a storage or distribution medium, is called an
"aggregate" if the compilation and its resulting copyright are not
used to limit the access or legal rights of the compilation's users
beyond what the individual works permit.  Inclusion of a covered work
in an aggregate does not cause this License to apply to the other
parts of the aggregate.
<div class="p"><!----></div>
</li>
<li> Conveying Non-Source Forms.
<div class="p"><!----></div>
You may convey a covered work in object code form under the terms
of sections 4 and 5, provided that you also convey the
machine-readable Corresponding Source under the terms of this License,
in one of these ways:
<ol type="a">
<li> Convey the object code in, or embodied in, a physical product
  (including a physical distribution medium), accompanied by the
  Corresponding Source fixed on a durable physical medium
  customarily used for software interchange.
<div class="p"><!----></div>
</li>
<li> Convey the object code in, or embodied in, a physical product
  (including a physical distribution medium), accompanied by a
  written offer, valid for at least three years and valid for as
  long as you offer spare parts or customer support for that product
  model, to give anyone who possesses the object code either (1) a
  copy of the Corresponding Source for all the software in the
  product that is covered by this License, on a durable physical
  medium customarily used for software interchange, for a price no
  more than your reasonable cost of physically performing this
  conveying of source, or (2) access to copy the
  Corresponding Source from a network server at no charge.
<div class="p"><!----></div>
</li>
<li> Convey individual copies of the object code with a copy of the
  written offer to provide the Corresponding Source.  This
  alternative is allowed only occasionally and noncommercially, and
  only if you received the object code with such an offer, in accord
  with subsection 6b.
<div class="p"><!----></div>
</li>
<li> Convey the object code by offering access from a designated
  place (gratis or for a charge), and offer equivalent access to the
  Corresponding Source in the same way through the same place at no
  further charge.  You need not require recipients to copy the
  Corresponding Source along with the object code.  If the place to
  copy the object code is a network server, the Corresponding Source
  may be on a different server (operated by you or a third party)
  that supports equivalent copying facilities, provided you maintain
  clear directions next to the object code saying where to find the
  Corresponding Source.  Regardless of what server hosts the
  Corresponding Source, you remain obligated to ensure that it is
  available for as long as needed to satisfy these requirements.
<div class="p"><!----></div>
</li>
<li> Convey the object code using peer-to-peer transmission, provided
  you inform other peers where the object code and Corresponding
  Source of the work are being offered to the general public at no
  charge under subsection 6d.
<div class="p"><!----></div>
</li>
</ol>
<div class="p"><!----></div>
A separable portion of the object code, whose source code is excluded
from the Corresponding Source as a System Library, need not be
included in conveying the object code work.
<div class="p"><!----></div>
A "User Product" is either (1) a "consumer product", which means any
tangible personal property which is normally used for personal, family,
or household purposes, or (2) anything designed or sold for incorporation
into a dwelling.  In determining whether a product is a consumer product,
doubtful cases shall be resolved in favor of coverage.  For a particular
product received by a particular user, "normally used" refers to a
typical or common use of that class of product, regardless of the status
of the particular user or of the way in which the particular user
actually uses, or expects or is expected to use, the product.  A product
is a consumer product regardless of whether the product has substantial
commercial, industrial or non-consumer uses, unless such uses represent
the only significant mode of use of the product.
<div class="p"><!----></div>
"Installation Information" for a User Product means any methods,
procedures, authorization keys, or other information required to install
and execute modified versions of a covered work in that User Product from
a modified version of its Corresponding Source.  The information must
suffice to ensure that the continued functioning of the modified object
code is in no case prevented or interfered with solely because
modification has been made.
<div class="p"><!----></div>
If you convey an object code work under this section in, or with, or
specifically for use in, a User Product, and the conveying occurs as
part of a transaction in which the right of possession and use of the
User Product is transferred to the recipient in perpetuity or for a
fixed term (regardless of how the transaction is characterized), the
Corresponding Source conveyed under this section must be accompanied
by the Installation Information.  But this requirement does not apply
if neither you nor any third party retains the ability to install
modified object code on the User Product (for example, the work has
been installed in ROM).
<div class="p"><!----></div>
The requirement to provide Installation Information does not include a
requirement to continue to provide support service, warranty, or updates
for a work that has been modified or installed by the recipient, or for
the User Product in which it has been modified or installed.  Access to a
network may be denied when the modification itself materially and
adversely affects the operation of the network or violates the rules and
protocols for communication across the network.
<div class="p"><!----></div>
Corresponding Source conveyed, and Installation Information provided,
in accord with this section must be in a format that is publicly
documented (and with an implementation available to the public in
source code form), and must require no special password or key for
unpacking, reading or copying.
<div class="p"><!----></div>
</li>
<li> Additional Terms.
<div class="p"><!----></div>
"Additional permissions" are terms that supplement the terms of this
License by making exceptions from one or more of its conditions.
Additional permissions that are applicable to the entire Program shall
be treated as though they were included in this License, to the extent
that they are valid under applicable law.  If additional permissions
apply only to part of the Program, that part may be used separately
under those permissions, but the entire Program remains governed by
this License without regard to the additional permissions.
<div class="p"><!----></div>
When you convey a copy of a covered work, you may at your option
remove any additional permissions from that copy, or from any part of
it.  (Additional permissions may be written to require their own
removal in certain cases when you modify the work.)  You may place
additional permissions on material, added by you to a covered work,
for which you have or can give appropriate copyright permission.
<div class="p"><!----></div>
Notwithstanding any other provision of this License, for material you
add to a covered work, you may (if authorized by the copyright holders of
that material) supplement the terms of this License with terms:
<ol type="a">
<li> Disclaiming warranty or limiting liability differently from the
  terms of sections 15 and 16 of this License; or
<div class="p"><!----></div>
</li>
<li> Requiring preservation of specified reasonable legal notices or
  author attributions in that material or in the Appropriate Legal
  Notices displayed by works containing it; or
<div class="p"><!----></div>
</li>
<li> Prohibiting misrepresentation of the origin of that material, or
  requiring that modified versions of such material be marked in
  reasonable ways as different from the original version; or
<div class="p"><!----></div>
</li>
<li> Limiting the use for publicity purposes of names of licensors or
  authors of the material; or
<div class="p"><!----></div>
</li>
<li> Declining to grant rights under trademark law for use of some
  trade names, trademarks, or service marks; or
<div class="p"><!----></div>
</li>
<li> Requiring indemnification of licensors and authors of that
  material by anyone who conveys the material (or modified versions of
  it) with contractual assumptions of liability to the recipient, for
  any liability that these contractual assumptions directly impose on
  those licensors and authors.
<div class="p"><!----></div>
</li>
</ol>
<div class="p"><!----></div>
All other non-permissive additional terms are considered "further
restrictions" within the meaning of section 10.  If the Program as you
received it, or any part of it, contains a notice stating that it is
governed by this License along with a term that is a further
restriction, you may remove that term.  If a license document contains
a further restriction but permits relicensing or conveying under this
License, you may add to a covered work material governed by the terms
of that license document, provided that the further restriction does
not survive such relicensing or conveying.
<div class="p"><!----></div>
If you add terms to a covered work in accord with this section, you
must place, in the relevant source files, a statement of the
additional terms that apply to those files, or a notice indicating
where to find the applicable terms.
<div class="p"><!----></div>
Additional terms, permissive or non-permissive, may be stated in the
form of a separately written license, or stated as exceptions;
the above requirements apply either way.
<div class="p"><!----></div>
</li>
<li> Termination.
<div class="p"><!----></div>
You may not propagate or modify a covered work except as expressly
provided under this License.  Any attempt otherwise to propagate or
modify it is void, and will automatically terminate your rights under
this License (including any patent licenses granted under the third
paragraph of section 11).
<div class="p"><!----></div>
However, if you cease all violation of this License, then your
license from a particular copyright holder is reinstated (a)
provisionally, unless and until the copyright holder explicitly and
finally terminates your license, and (b) permanently, if the copyright
holder fails to notify you of the violation by some reasonable means
prior to 60 days after the cessation.
<div class="p"><!----></div>
Moreover, your license from a particular copyright holder is
reinstated permanently if the copyright holder notifies you of the
violation by some reasonable means, this is the first time you have
received notice of violation of this License (for any work) from that
copyright holder, and you cure the violation prior to 30 days after
your receipt of the notice.
<div class="p"><!----></div>
Termination of your rights under this section does not terminate the
licenses of parties who have received copies or rights from you under
this License.  If your rights have been terminated and not permanently
reinstated, you do not qualify to receive new licenses for the same
material under section 10.
<div class="p"><!----></div>
</li>
<li> Acceptance Not Required for Having Copies.
<div class="p"><!----></div>
You are not required to accept this License in order to receive or
run a copy of the Program.  Ancillary propagation of a covered work
occurring solely as a consequence of using peer-to-peer transmission
to receive a copy likewise does not require acceptance.  However,
nothing other than this License grants you permission to propagate or
modify any covered work.  These actions infringe copyright if you do
not accept this License.  Therefore, by modifying or propagating a
covered work, you indicate your acceptance of this License to do so.
<div class="p"><!----></div>
</li>
<li> Automatic Licensing of Downstream Recipients.
<div class="p"><!----></div>
Each time you convey a covered work, the recipient automatically
receives a license from the original licensors, to run, modify and
propagate that work, subject to this License.  You are not responsible
for enforcing compliance by third parties with this License.
<div class="p"><!----></div>
An "entity transaction" is a transaction transferring control of an
organization, or substantially all assets of one, or subdividing an
organization, or merging organizations.  If propagation of a covered
work results from an entity transaction, each party to that
transaction who receives a copy of the work also receives whatever
licenses to the work the party's predecessor in interest had or could
give under the previous paragraph, plus a right to possession of the
Corresponding Source of the work from the predecessor in interest, if
the predecessor has it or can get it with reasonable efforts.
<div class="p"><!----></div>
You may not impose any further restrictions on the exercise of the
rights granted or affirmed under this License.  For example, you may
not impose a license fee, royalty, or other charge for exercise of
rights granted under this License, and you may not initiate litigation
(including a cross-claim or counterclaim in a lawsuit) alleging that
any patent claim is infringed by making, using, selling, offering for
sale, or importing the Program or any portion of it.
<div class="p"><!----></div>
</li>
<li> Patents.
<div class="p"><!----></div>
A "contributor" is a copyright holder who authorizes use under this
License of the Program or a work on which the Program is based.  The
work thus licensed is called the contributor's "contributor version".
<div class="p"><!----></div>
A contributor's "essential patent claims" are all patent claims
owned or controlled by the contributor, whether already acquired or
hereafter acquired, that would be infringed by some manner, permitted
by this License, of making, using, or selling its contributor version,
but do not include claims that would be infringed only as a
consequence of further modification of the contributor version.  For
purposes of this definition, "control" includes the right to grant
patent sublicenses in a manner consistent with the requirements of
this License.
<div class="p"><!----></div>
Each contributor grants you a non-exclusive, worldwide, royalty-free
patent license under the contributor's essential patent claims, to
make, use, sell, offer for sale, import and otherwise run, modify and
propagate the contents of its contributor version.
<div class="p"><!----></div>
In the following three paragraphs, a "patent license" is any express
agreement or commitment, however denominated, not to enforce a patent
(such as an express permission to practice a patent or covenant not to
sue for patent infringement).  To "grant" such a patent license to a
party means to make such an agreement or commitment not to enforce a
patent against the party.
<div class="p"><!----></div>
If you convey a covered work, knowingly relying on a patent license,
and the Corresponding Source of the work is not available for anyone
to copy, free of charge and under the terms of this License, through a
publicly available network server or other readily accessible means,
then you must either (1) cause the Corresponding Source to be so
available, or (2) arrange to deprive yourself of the benefit of the
patent license for this particular work, or (3) arrange, in a manner
consistent with the requirements of this License, to extend the patent
license to downstream recipients.  "Knowingly relying" means you have
actual knowledge that, but for the patent license, your conveying the
covered work in a country, or your recipient's use of the covered work
in a country, would infringe one or more identifiable patents in that
country that you have reason to believe are valid.
<div class="p"><!----></div>
If, pursuant to or in connection with a single transaction or
arrangement, you convey, or propagate by procuring conveyance of, a
covered work, and grant a patent license to some of the parties
receiving the covered work authorizing them to use, propagate, modify
or convey a specific copy of the covered work, then the patent license
you grant is automatically extended to all recipients of the covered
work and works based on it.
<div class="p"><!----></div>
A patent license is "discriminatory" if it does not include within
the scope of its coverage, prohibits the exercise of, or is
conditioned on the non-exercise of one or more of the rights that are
specifically granted under this License.  You may not convey a covered
work if you are a party to an arrangement with a third party that is
in the business of distributing software, under which you make payment
to the third party based on the extent of your activity of conveying
the work, and under which the third party grants, to any of the
parties who would receive the covered work from you, a discriminatory
patent license (a) in connection with copies of the covered work
conveyed by you (or copies made from those copies), or (b) primarily
for and in connection with specific products or compilations that
contain the covered work, unless you entered into that arrangement,
or that patent license was granted, prior to 28 March 2007.
<div class="p"><!----></div>
Nothing in this License shall be construed as excluding or limiting
any implied license or other defenses to infringement that may
otherwise be available to you under applicable patent law.
<div class="p"><!----></div>
</li>
<li> No Surrender of Others' Freedom.
<div class="p"><!----></div>
If conditions are imposed on you (whether by court order, agreement or
otherwise) that contradict the conditions of this License, they do not
excuse you from the conditions of this License.  If you cannot convey a
covered work so as to satisfy simultaneously your obligations under this
License and any other pertinent obligations, then as a consequence you may
not convey it at all.  For example, if you agree to terms that obligate you
to collect a royalty for further conveying from those to whom you convey
the Program, the only way you could satisfy both those terms and this
License would be to refrain entirely from conveying the Program.
<div class="p"><!----></div>
</li>
<li> Use with the GNU Affero General Public License.
<div class="p"><!----></div>
Notwithstanding any other provision of this License, you have
permission to link or combine any covered work with a work licensed
under version 3 of the GNU Affero General Public License into a single
combined work, and to convey the resulting work.  The terms of this
License will continue to apply to the part which is the covered work,
but the special requirements of the GNU Affero General Public License,
section 13, concerning interaction through a network will apply to the
combination as such.
<div class="p"><!----></div>
</li>
<li> Revised Versions of this License.
<div class="p"><!----></div>
The Free Software Foundation may publish revised and/or new versions of
the GNU General Public License from time to time.  Such new versions will
be similar in spirit to the present version, but may differ in detail to
address new problems or concerns.
<div class="p"><!----></div>
Each version is given a distinguishing version number.  If the
Program specifies that a certain numbered version of the GNU General
Public License "or any later version" applies to it, you have the
option of following the terms and conditions either of that numbered
version or of any later version published by the Free Software
Foundation.  If the Program does not specify a version number of the
GNU General Public License, you may choose any version ever published
by the Free Software Foundation.
<div class="p"><!----></div>
If the Program specifies that a proxy can decide which future
versions of the GNU General Public License can be used, that proxy's
public statement of acceptance of a version permanently authorizes you
to choose that version for the Program.
<div class="p"><!----></div>
Later license versions may give you additional or different
permissions.  However, no additional obligations are imposed on any
author or copyright holder as a result of your choosing to follow a
later version.
<div class="p"><!----></div>
</li>
<li> Disclaimer of Warranty.
<div class="p"><!----></div>
 THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT PERMITTED BY
 APPLICABLE LAW.  EXCEPT WHEN OTHERWISE STATED IN WRITING THE
 COPYRIGHT HOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM "AS IS"
 WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED,
 INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  THE ENTIRE
 RISK AS TO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU.
 SHOULD THE PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL
 NECESSARY SERVICING, REPAIR OR CORRECTION.
<div class="p"><!----></div>
</li>
<li> Limitation of Liability.
<div class="p"><!----></div>
 IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN
 WRITING WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MODIFIES
 AND/OR CONVEYS THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR
 DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL
 DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THE PROGRAM
 (INCLUDING BUT NOT LIMITED TO LOSS OF DATA OR DATA BEING RENDERED
 INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD PARTIES OR A FAILURE
 OF THE PROGRAM TO OPERATE WITH ANY OTHER PROGRAMS), EVEN IF SUCH
 HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH
 DAMAGES.
<div class="p"><!----></div>
</li>
<li> Interpretation of Sections 15 and 16.
<div class="p"><!----></div>
If the disclaimer of warranty and limitation of liability provided
above cannot be given local legal effect according to their terms,
reviewing courts shall apply local law that most closely approximates
an absolute waiver of all civil liability in connection with the
Program, unless a warranty or assumption of liability accompanies a
copy of the Program in return for a fee.
<div class="p"><!----></div>
<div class="p"><!----></div>
<div class="p"><!----></div>
</li>
</ol>
<div class="p"><!----></div>
 <a id="tth_sEc2.3"></a><h2>
2.3&nbsp;&nbsp;Installation</h2>
<div class="p"><!----></div>
In order to install and run  S<span style="font-size:x-small">HARC</span>&nbsp;under Linux (Windows and OS X are currently not supported), you need the following:
<ul>
<li> A Fortran90 compiler (This release is tested against <a href="https://gcc.gnu.org/fortran/">GNU Fortran</a> 4.4.7 and <a href="https://software.intel.com/en-us/fortran-compilers">Intel Fortran</a> 15.0).
<div class="p"><!----></div>
</li>
<li> The <a href="http://www.netlib.org/blas/">BLAS</a>, <a href="http://www.netlib.org/lapack/">LAPACK</a> and <a href="http://http://www.fftw.org/">FFTW3</a> libraries.
<div class="p"><!----></div>
</li>
<li> <a href="https://www.python.org/downloads/release/python-278/">Python 2</a> (This release is tested against Python 2.6 and 2.7).
<div class="p"><!----></div>
</li>
<li> <b><tt>make</tt></b>.
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
The source code of the   S<span style="font-size:x-small">HARC</span>&nbsp;suite is distributed as a tar archive file. In order to install it, first extract the content of the archive to a suitable directory:
<tt>tar&nbsp;-xzvf&nbsp;sharc.tgz</tt>
This should create a new directory called <b><tt>sharc/</tt></b> which contains all the necessary subdirectories and files. 
In figure&nbsp;<a href="#fig:installation"> 2.1</a> the directory structure of the complete  S<span style="font-size:x-small">HARC</span>&nbsp;directory is shown.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_fIg2.1">
</a>   <div style="text-align:center">  <img src="http://sharc-md.org/wp-content/uploads/2018/02/dirs_SHARC.png">  
<div style="text-align:center">Figure 2.1: Directory tree containing a complete  S<span style="font-size:x-small">HARC</span>&nbsp;installation.</div>
  <a id="fig:installation">
</a>
</div>
<div class="p"><!----></div>
To compile the Fortran90 programs of the  S<span style="font-size:x-small">HARC</span>&nbsp;suite, go to the <b><tt>source/</tt></b> directory.
<tt>cd&nbsp;source/</tt>
and edit the <b><tt>Makefile</tt></b> by adjusting the <b><tt>F90</tt></b> variable to point to the Fortran compiler of your choice. 
Issuing the command:
<tt>make</tt>
will compile the source and create all the binaries.
<tt>make&nbsp;install</tt>
will copy the binary files into the <b><tt>sharc/bin/</tt></b> directory of the 
 S<span style="font-size:x-small">HARC</span>&nbsp;distribution, which already contains all the python scripts which
come with  S<span style="font-size:x-small">HARC</span>.
<div class="p"><!----></div>
In order to use the  S<span style="font-size:x-small">HARC</span>&nbsp;suite, set the environment variable <b><tt>$SHARC</tt></b> to the <b><tt>bin/</tt></b> directory of the  S<span style="font-size:x-small">HARC</span>&nbsp;installation. This ensures that all programs of the  S<span style="font-size:x-small">HARC</span>&nbsp;suite find the other executables and all calls are successful. For example, if you have unpacked  S<span style="font-size:x-small">HARC</span>&nbsp;into your home directory, 
just set: 
<tt>export&nbsp;SHARC=~/sharc/bin</tt>&nbsp;&nbsp;&nbsp; (for bourne shell users)
or
<tt>setenv&nbsp;SHARC&nbsp;$HOME/sharc/bin</tt>&nbsp;&nbsp;&nbsp; (for c-shell type users)
Note that it is advisable to put this line into your shell's login
scripts.
<div class="p"><!----></div>
     <a id="tth_sEc2.3.1"></a><h3>
2.3.1&nbsp;&nbsp; WF<span style="font-size:x-small">OVERLAP</span> Program</h3>
<div class="p"><!----></div>
The  S<span style="font-size:x-small">HARC</span>&nbsp;package contains as a submodule the program  WF<span style="font-size:x-small">OVERLAP</span>, which is necessary for many functionalities of  S<span style="font-size:x-small">HARC</span>.
In order to install and test this program, see section&nbsp;<a href="#sec:int:wfoverlap">6.11</a>.
<div class="p"><!----></div>
     <a id="tth_sEc2.3.2"></a><h3>
2.3.2&nbsp;&nbsp;Libraries</h3>
<div class="p"><!----></div>
 S<span style="font-size:x-small">HARC</span>&nbsp;requires the BLAS, LAPACK and FFTW3 libraries. During the installation, it might be necessary to alter the <b><tt>LDFLAGS</tt></b> string in the <b><tt>Makefile</tt></b>, depending on where the relevant libraries are located on your system. In this way, it is for example possible to use vendor-provided libraries like the <a href="https://software.intel.com/en-us/intel-mkl">Intel MKL</a>. For more details see the <b><tt>INSTALL</tt></b> file which is included in the  S<span style="font-size:x-small">HARC</span>&nbsp;distribution.
<div class="p"><!----></div>
     <a id="tth_sEc2.3.3"></a><h3>
2.3.3&nbsp;&nbsp;Test Suite</h3><a id="sec:tests.py">
</a>
<div class="p"><!----></div>
After the installation, it is advisable to first execute the test suite of  S<span style="font-size:x-small">HARC</span>, which will test the fundamental functionality of SHARC.
Change to an empty directory and execute
<tt>$SHARC/tests.py</tt>
The interactive script will first verify the Python installation (no message will appear if the Python installation is fine). 
Subsequently, the script prompts the user to enter which tests should be executed. 
The script will also ask for a number of environment variables, which are listed in Table&nbsp;<a href="#tab:test_vars"> 2.1</a>.
<div class="p"><!----></div>
Their is at least one test for each of the auxiliary scripts and interfaces. 
Tests whose names start with <b><tt>scripts_</tt></b> test the functionality of the auxiliary programs in the  S<span style="font-size:x-small">HARC</span>&nbsp;suite.
Tests whose names start with <b><tt>ADF_</tt></b>, <b><tt>Analytical_</tt></b>, <b><tt>COLUMBUS_</tt></b>, <b><tt>GAUSSIAN_</tt></b>, <b><tt>LVC_</tt></b>, <b><tt>MOLCAS_</tt></b> <b><tt>MOLPRO_</tt></b>, or <b><tt>TURBOMOLE_</tt></b> run short trajectories, testing whether the main dynamics code, the interfaces, the quantum chemistry programs, and auxiliary programs ( T<span style="font-size:x-small">HEO</span>DORE,  WF<span style="font-size:x-small">OVERLAP</span>,  O<span style="font-size:x-small">RCA</span>,  T<span style="font-size:x-small">INKER</span>) work together correctly.
<div class="p"><!----></div>
If the installation was successful and Python is installed correctly, <b><tt>Analytical_overlap</tt></b>, <b><tt>LVC_overlap</tt></b>, and most tests named <b><tt>scripts_&lt;NAME&#62;</tt></b> should execute without error. 
<div class="p"><!----></div>
The test calculations involving the quantum chemistry programs can be used to check that  S<span style="font-size:x-small">HARC</span>&nbsp;can correctly call these programs and that they are installed correctly.
<div class="p"><!----></div>
If any of the tests show differences between output and reference output, it is advisable to check the respective files (i.e., compare <b><tt>$SHARC/../tests/RESULTS/&lt;job&#62;/</tt></b> to <b><tt>./RUNNING_TESTS/&lt;job&#62;/</tt></b>). Note that small differences (different sign of values or small numerical deviations) in the output can already occur when using a different version of the quantum chemistry programs, different compilers, different libraries, or different parallization schemes.
It should be noted that along trajectories, these small changes can add up to notably influence the trajectories, but across the ensemble these small changes will likely cancel out.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb2.1">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 2.1: Environment variables for  S<span style="font-size:x-small">HARC</span>&nbsp;test jobs. These variables need to be set before the test job execution.</div>
  <a id="tab:test_vars">
</a>
<table>
<tr><td align="left">Keyword       </td><td align="left">Description</td></tr>
<tr><td align="left">$ADF         </td><td align="left">Points to the main directory of the ADF installation, which contains the file <b><tt>adfrc.sh</tt></b>.</td></tr>
<tr><td align="left">$COLUMBUS    </td><td align="left">Points to the directory containing the  C<span style="font-size:x-small">OLUMBUS</span> executables, e.g., <b><tt>runls</tt></b>.</td></tr>
<tr><td align="left">$GAUSSIAN    </td><td align="left">Points to the main directory of the  G<span style="font-size:x-small">AUSSIAN</span> installation, which contains the  G<span style="font-size:x-small">AUSSIAN</span> executables (e.g., <b><tt>g09</tt></b>/<b><tt>g16</tt></b> or <b><tt>l9999.exe</tt></b>).</td></tr>
<tr><td align="left">$MOLCAS      </td><td align="left">Points to the main directory of the  O<span style="font-size:x-small">PENMOLCAS</span> installation, containing <b><tt>molcas.rte</tt></b> and directories <b><tt>basis_library/</tt></b> and <b><tt>bin/</tt></b>.</td></tr>
<tr><td align="left">$MOLPRO      </td><td align="left">Points to the <b><tt>bin/</tt></b> directory of the  M<span style="font-size:x-small">OLPRO</span> installation, which contains the <b><tt>molpro.exe</tt></b> file.</td></tr>
<tr><td align="left">$TURBOMOLE   </td><td align="left">Points to the main directory of the  T<span style="font-size:x-small">URBOMOLE</span> installation, which contains subdirectories like <b><tt>basen/</tt></b>, <b><tt>bin/</tt></b>, or <b><tt>scripts/</tt></b>.</td></tr>
<tr><td align="left">$ORCA        </td><td align="left">Points to the directory containing the  O<span style="font-size:x-small">RCA</span> executables, e.g., <b><tt>orca</tt></b>, <b><tt>orca_gtoint</tt></b>, or <b><tt>orca_scf</tt></b>.</td></tr>
<tr><td align="left">$THEODORE    </td><td align="left">Points to the main directory of the  T<span style="font-size:x-small">HEO</span>DORE installation. <b><tt>$THEODORE/bin/</tt></b> should contain <b><tt>analyze_tden.py</tt></b>.</td></tr>
<tr><td align="left">$TINKER      </td><td align="left">Points to the <b><tt>bin/</tt></b> directory of a  M<span style="font-size:x-small">OLCAS</span>-modified  T<span style="font-size:x-small">INKER</span> installation. It contains files like <b><tt>tkr2qm_s</tt></b>.</td></tr>
<tr><td align="left">$molcas      </td><td align="left">Should point to the same location as <b><tt>$MOLCAS</tt></b>, or another  M<span style="font-size:x-small">OLCAS</span> installation. Note that <b><tt>$molcas</tt></b> is only used by some  C<span style="font-size:x-small">OLUMBUS</span> test jobs. Also note that <b><tt>$molcas</tt></b> does not need to point to the  M<span style="font-size:x-small">OLCAS</span> installation interfaced to  C<span style="font-size:x-small">OLUMBUS</span>.</td></tr></table>
</div>
<div class="p"><!----></div>
     <a id="tth_sEc2.3.4"></a><h3>
2.3.4&nbsp;&nbsp;Additional Programs</h3>
<div class="p"><!----></div>
For full functionality of the  S<span style="font-size:x-small">HARC</span>&nbsp;suite, several additional programs are recommended (all of these programs are currently freely available, except for  A<span style="font-size:x-small">MBER</span>):
<div class="p"><!----></div>
<ul>
<li> The Python package <a href="http://www.numpy.org/"> N<span style="font-size:x-small">UM</span>P<span style="font-size:x-small">Y</span></a>.
  
  Optimally, within your Python installation the  N<span style="font-size:x-small">UM</span>P<span style="font-size:x-small">Y</span> package (which provides many numerical methods, e.g., matrix diagonalization) should be available. If  N<span style="font-size:x-small">UM</span>P<span style="font-size:x-small">Y</span> is not available, the  S<span style="font-size:x-small">HARC</span>&nbsp;suite is still functional, and the affected scripts will fall back to use a small Fortran code (front-end for LAPACK) within the  S<span style="font-size:x-small">HARC</span>&nbsp;package. Since in the Python scripts no large-scale matrix calculations are carried out, there should be no significant performance loss if  N<span style="font-size:x-small">UM</span>P<span style="font-size:x-small">Y</span> is not available.
<div class="p"><!----></div>

<div class="p"><!----></div>
</li>
<li> The Python package <a href="https://matplotlib.org/"> M<span style="font-size:x-small">ATPLOTLIB</span></a>.
  
  If the  M<span style="font-size:x-small">ATPLOTLIB</span> package, some auxiliary scripts can automatically generate certain plots.
<div class="p"><!----></div>

<div class="p"><!----></div>
</li>
<li> The <a href="http://www.gnuplot.info/"> G<span style="font-size:x-small">NUPLOT</span></a> plotting software.
  
   G<span style="font-size:x-small">NUPLOT</span> is not strictly necessary, since all output files could be plotted using other plotting programs. However, a number of scripts from the  S<span style="font-size:x-small">HARC</span>&nbsp;suite automatically generate  G<span style="font-size:x-small">NUPLOT</span> scripts after data processing, allowing to quickly plot the output files or carry out data fits.
<div class="p"><!----></div>

<div class="p"><!----></div>
</li>
<li> A molecular visualization software able to read xyz files (e.g.&nbsp;<a href="http://www.cmbi.ru.nl/molden/molden.html"> M<span style="font-size:x-small">OLDEN</span></a>, <a href="http://gabedit.sourceforge.net/"> G<span style="font-size:x-small">ABEDIT</span></a>, <a href="http://molekel.cscs.ch/wiki/pmwiki.php"> M<span style="font-size:x-small">OLEKEL</span></a> or <a href="http://www.ks.uiuc.edu/Research/vmd/">VMD</a>).
  
  Molecular visualization software is needed in order to visualize molecular motion in the dynamics.
<div class="p"><!----></div>

<div class="p"><!----></div>
</li>
<li> The <a href="http://maxima.sourceforge.net/"> M<span style="font-size:x-small">AXIMA</span></a> computer algebra system.
  
  The computer algebra system  M<span style="font-size:x-small">AXIMA</span> is necessary for the use of <b><tt>make_fitscript.py</tt></b>, a program which allows to perform global fits of chemical kinetics models to populations data.
<div class="p"><!----></div>

<div class="p"><!----></div>
</li>
<li> The <a href="http://theodore-qc.sourceforge.net/"> T<span style="font-size:x-small">HEO</span>DORE</a> wave function analysis suite.
  
  The wave function analysis package  T<span style="font-size:x-small">HEO</span>DORE allows to compute various descriptors of electronic wave functions (supported by some interfaces), which is helpful to follow the state characters along trajectories.
<div class="p"><!----></div>

<div class="p"><!----></div>
</li>
<li> The <a href="http://ambermd.org/"> A<span style="font-size:x-small">MBER</span></a> molecular dynamics package.
  
   A<span style="font-size:x-small">MBER</span> can be used to prepare initial conditions based on ground state molecular dynamics simulations (instead of using a Wigner distribution), which is especially useful for large systems.
<div class="p"><!----></div>

<div class="p"><!----></div>
</li>
<li>  The <a href="http://orcaforum.cec.mpg.de"> O<span style="font-size:x-small">RCA</span></a> ab initio package.
  
   O<span style="font-size:x-small">RCA</span> can be employed as external optimizer. In combination with the  S<span style="font-size:x-small">HARC</span>&nbsp;interfaces, it is possible to perform optimizations of minima, conical intersections, and crossing points for any method interfaced to  S<span style="font-size:x-small">HARC</span>.
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
     <a id="tth_sEc2.3.5"></a><h3>
2.3.5&nbsp;&nbsp;Quantum Chemistry Programs</h3>
<div class="p"><!----></div>
Even though  S<span style="font-size:x-small">HARC</span>&nbsp;comes with two interfaces for analytical potentials (and hence can be used without any quantum chemistry program), the main application of  S<span style="font-size:x-small">HARC</span>&nbsp;is certainly on-the-fly ab initio dynamics. Hence, one of the following interfaced quantum chemistry programs is necessary:
<ul>
<li> <a href="http://www.molpro.net/"> M<span style="font-size:x-small">OLPRO</span></a> (this release was checked against  M<span style="font-size:x-small">OLPRO</span> 2010 and 2012).
<div class="p"><!----></div>
</li>
<li> <a href="https://gitlab.com/Molcas/OpenMolcas/"> O<span style="font-size:x-small">PENMOLCAS</span></a> (this release was checked against  O<span style="font-size:x-small">PENMOLCAS</span> 18).
<ul>
<li> <a href="http://dasher.wustl.edu/tinker/"> T<span style="font-size:x-small">INKER</span></a>, <a href="http://www.molcas.org/documentation/manual/node79.html#SECTION052122010000000000000">interfaced to  O<span style="font-size:x-small">PENMOLCAS</span> 18</a>, for QM/MM dynamics.
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
</li>
<li> <a href="http://www.univie.ac.at/columbus/docs_COL70/documentation_main.html"> C<span style="font-size:x-small">OLUMBUS</span> 7</a>
<ul>
<li> <a href="http://www.univie.ac.at/columbus/docs_COL70/columbus_molcas_link.html"> C<span style="font-size:x-small">OLUMBUS</span>-M<span style="font-size:x-small">OLCAS</span> interface</a> for spin-orbit couplings.
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
</li>
<li> <a href="http://www.scm.com/ADF"> A<span style="font-size:x-small">MSTERDAM</span> D<span style="font-size:x-small">ENSITY</span> F<span style="font-size:x-small">UNCTIONAL</span></a> (ADF 2017 needed for overlaps, ADF 2018 for all QM/MM functionality)
<div class="p"><!----></div>
</li>
<li> <a href="http://www.turbomole.com"> T<span style="font-size:x-small">URBOMOLE</span></a> (this release was checked against  T<span style="font-size:x-small">URBOMOLE</span> 6.6 and 7.0; version 7.1 is currently not supported).
<ul>
<li> <a href="http://orcaforum.cec.mpg.de"> O<span style="font-size:x-small">RCA</span></a> (version 3 or 4) for spin-orbit couplings.
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
</li>
<li> <a href="http://www.gaussian.com"> G<span style="font-size:x-small">AUSSIAN</span></a> (this release was checked against  G<span style="font-size:x-small">AUSSIAN</span> 09 and 16).
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
See the relevant sections in chapter&nbsp;<a href="#chap:interfaces">6</a> for a description of the quantum chemical methods available with each of these programs.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_chAp3"></a><h1>
Chapter 3 Execution</h1>
<div class="p"><!----></div>
The  S<span style="font-size:x-small">HARC</span>&nbsp;suite consists of the main dynamics code <b><tt>sharc.x</tt></b> and a number of auxiliary programs, like setup scripts and analysis tools. Additionally, the suite comes with interfaces to several quantum chemistry software:  M<span style="font-size:x-small">OLPRO</span>,  M<span style="font-size:x-small">OLCAS</span>,  C<span style="font-size:x-small">OLUMBUS</span>,  T<span style="font-size:x-small">URBOMOLE</span>,  ADF, and  G<span style="font-size:x-small">AUSSIAN</span>. 
<div class="p"><!----></div>
In the following, first it is explained how to run a single trajectory by setting up all necessary input for the dynamics code <b><tt>sharc.x</tt></b> manually. Afterwards, the usage of the auxiliary scripts is explained. 
Detailed infos on the  S<span style="font-size:x-small">HARC</span>&nbsp;input files is given in chapter&nbsp;<a href="#chap:input">4</a>.
Chapter&nbsp;<a href="#chap:output">5</a> documents the different output files  S<span style="font-size:x-small">HARC</span>&nbsp;produces.
The interfaces are described in chapter&nbsp;<a href="#chap:interfaces">6</a> and the auxiliary scripts in chapter&nbsp;<a href="#chap:aux">7</a>. 
All relevant theoretical background is given in chapter&nbsp;<a href="#chap:met">8</a>.
<div class="p"><!----></div>
 <a id="tth_sEc3.1"></a><h2>
3.1&nbsp;&nbsp;Running a single trajectory</h2>
<div class="p"><!----></div>
     <a id="tth_sEc3.1.1"></a><h3>
3.1.1&nbsp;&nbsp;Input files</h3>
<div class="p"><!----></div>
 S<span style="font-size:x-small">HARC</span>&nbsp;requires a number of input files, which contain the settings for the dynamics simulation (<b><tt>input</tt></b>), the initial geometry (<b><tt>geom</tt></b>), the initial velocity (<b><tt>veloc</tt></b>), the initial coefficients (<b><tt>coeff</tt></b>) and the laser field (<b><tt>laser</tt></b>). Only the first two (<b><tt>input</tt></b>, <b><tt>geom</tt></b>) are mandatory, the others are optional. The necessary files are shown in figure&nbsp;<a href="#fig:dir_traj"> 3.1</a>. 
The content of the main input file is explained in detail in section&nbsp;<a href="#sec:inputfile">4.1</a>, the geometry file is specified in section&nbsp;<a href="#sec:geomfile">4.2</a>. The specifications of the velocity, coefficient and laser files are given in sections&nbsp;<a href="#sec:velocfile">4.3</a>, <a href="#sec:coefffile">4.4</a> and <a href="#sec:laserfile">4.5</a>, respectively.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_fIg3.1">
</a>   <div style="text-align:center">  <img src="http://sharc-md.org/wp-content/uploads/2018/02/dir_traj.png">  
<div style="text-align:center">Figure 3.1: Input files for a  S<span style="font-size:x-small">HARC</span>&nbsp;dynamics simulation. Directories are in blue, executable scripts in green, regular files in white and optional files in grey.</div>
  <a id="fig:dir_traj">
</a>
</div>
<div class="p"><!----></div>
Additionally, the directory <b><tt>QM/</tt></b> and the script <b><tt>QM/runQM.sh</tt></b> need to be present, since the on-the-fly ab initio calculations are implemented through these files. The script <b><tt>QM/runQM.sh</tt></b> is called each time  S<span style="font-size:x-small">HARC</span>&nbsp;performs an on-the-fly calculation of electronic properties (usually by a quantum chemistry program). In order to do so,  S<span style="font-size:x-small">HARC</span>&nbsp;first writes the request for the calculation to <b><tt>QM/QM.in</tt></b>, then calls <b><tt>QM/runQM.sh</tt></b>, waits for the script to finish and then reads the requested quantities from <b><tt>QM/QM.out</tt></b>. The script <b><tt>QM/runQM.sh</tt></b> is fully responsible to generate the requested results from the provided input. 
In virtually all cases, this task is handled by the  S<span style="font-size:x-small">HARC</span>-quantum chemistry interfaces (see chapter&nbsp;<a href="#chap:interfaces">6</a>), so that the script <b><tt>QM/runQM.sh</tt></b> has a particularly simple form:
<tt>cd&nbsp;QM/</tt>
<div class="p"><!----></div>
<tt>$SHARC/&lt;INTERFACE&gt;&nbsp;QM.in&nbsp;</tt>
with the corresponding interface name given. Note that the interfaces in all cases need additional input files, which must be present in <b><tt>QM/</tt></b>. Those input files contain the specifications for the quantum chemistry information, e.g., basis set, active and reference space, memory settings, path to the quantum chemistry program, path to scratch directories; or for <b><tt>SHARC_Analytical.py</tt></b> and <b><tt>SHARC_LVC.py</tt></b> the parameters for the analytical potentials. For each interface, the input files are slightly different. See sections&nbsp;<a href="#sec:int:molpro">6.3</a>, <a href="#sec:int:molcas">6.4</a>, <a href="#sec:int:columbus">6.5</a>, <a href="#sec:int:analytical">6.6</a>, <a href="#sec:int:ricc2">6.8</a>, <a href="#sec:int:adf">6.7</a>, <a href="#sec:int:lvc">6.9</a>, or <a href="#sec:int:gaussian">6.10</a> for the necessary information.
<div class="p"><!----></div>
     <a id="tth_sEc3.1.2"></a><h3>
3.1.2&nbsp;&nbsp;Running the dynamics code</h3>
<div class="p"><!----></div>
Given the necessary input files,  S<span style="font-size:x-small">HARC</span>&nbsp;can be started by executing
<tt>user@host&gt;&nbsp;$SHARC/sharc.x&nbsp;input</tt>
Note that besides the input file, at least the geometry file needs to be present (see chapter&nbsp;<a href="#chap:input">4</a> for details).
<div class="p"><!----></div>
A running trajectory can be stopped after the current time step by creating an empty file <b><tt>STOP</tt></b>:
<tt>user@host&gt;&nbsp;touch&nbsp;STOP</tt>
This is usually preferable to simply killing  S<span style="font-size:x-small">HARC</span>, because the current time step is properly finished and all files are correctly written for analysis and restart.
<div class="p"><!----></div>
     <a id="tth_sEc3.1.3"></a><h3>
3.1.3&nbsp;&nbsp;Output files</h3>
<div class="p"><!----></div>
Figure&nbsp;<a href="#fig:dir_traj_after"> 3.2</a> shows the content of a trajectory directory after the execution of  S<span style="font-size:x-small">HARC</span>. There will be six new files. These files are <b><tt>output.log</tt></b>, <b><tt>output.lis</tt></b>, <b><tt>output.dat</tt></b> and <b><tt>output.xyz</tt></b>, as well as <b><tt>restart.ctrl</tt></b> and <b><tt>restart.traj</tt></b>.
<div class="p"><!----></div>
The file <b><tt>output.log</tt></b> contains mainly a listing of the chosen options and the resulting dynamics settings. At higher print levels, the log file contains also information per time step (useful for debugging). <b><tt>output.lis</tt></b> contains a table with one line per time step, giving active states, energies and expectation values. <b><tt>output.dat</tt></b> contains a list of all important matrices and vectors at each time step. This information can be extracted with <b><tt>data_extractor.x</tt></b> to yield plottable table files. <b><tt>output.xyz</tt></b> contains the geometries of all time steps (the comments to each geometry give the active state).
For details about the content of the output files, see chapter&nbsp;<a href="#chap:output">5</a>.
<div class="p"><!----></div>
The restart files contain the full state of a trajectory and its control variables from the last successful time step. These files are needed in order to restart a trajectory at this time step (either because the calculation failed, or in order to extend the simulation time beyond the original maximum simulation time). 
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_fIg3.2">
</a>   <div style="text-align:center">  <img src="http://sharc-md.org/wp-content/uploads/2018/02/dir_traj_after.png">  
<div style="text-align:center">Figure 3.2: Files of a  S<span style="font-size:x-small">HARC</span>&nbsp;dynamics simulation after running. Directories are in blue, executable scripts in green, regular files in white and optional files in grey. Output files are in yellow.</div>
  <a id="fig:dir_traj_after">
</a>
</div>
<div class="p"><!----></div>
 <a id="tth_sEc3.2"></a><h2>
3.2&nbsp;&nbsp;Typical workflow for an ensemble of trajectories</h2>
<a id="sec:typical_workflow">
</a>
<div class="p"><!----></div>
Usually, one is not interested in running only a single trajectory, since a single trajectory cannot reproduce the branching of a wave packet into different reaction channels. In order to do so, within surface hopping an ensemble of independent trajectories is employed. 
<div class="p"><!----></div>
When dealing with a (possibly large) ensemble of trajectories, setup and analysis need to be automatized. Hence, the  S<span style="font-size:x-small">HARC</span>&nbsp;suite contains a number of scripts fulfilling different tasks in the usual workflow of setting up ensembles of trajectories.
The typical workflow is given schematically in figure&nbsp;<a href="#fig:workflow"> 3.3</a>.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_fIg3.3">
</a>   <div style="text-align:center">  <img src="http://sharc-md.org/wp-content/uploads/2018/02/prepare.png">  
<div style="text-align:center">Figure 3.3: Typical workflow for conducting excited-state dynamics simulations with  S<span style="font-size:x-small">HARC</span>.</div>
  <a id="fig:workflow">
</a>
</div>
<div class="p"><!----></div>
     <a id="tth_sEc3.2.1"></a><h3>
3.2.1&nbsp;&nbsp;Initial condition generation</h3>
<div class="p"><!----></div>
In the typical workflow, the user will first create a set of suitable initial conditions. In the context of the  S<span style="font-size:x-small">HARC</span>&nbsp;package, an initial condition is a set of an initial geometry, initial velocity, initial occupied state and initial wave function coefficients. 
Many such sets are needed in order to setup physically sound dynamics simulations.
<div class="p"><!----></div>
<b>Generation of initial geometries and velocities&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Currently, within the  S<span style="font-size:x-small">HARC</span>&nbsp;suite, initial geometries and velocities can be generated based on a quantum harmonic oscillator Wigner distribution. The theoretical background is given in section&nbsp;<a href="#met:wigner">8.20</a>. The calculation is performed by <b><tt>wigner.py</tt></b>, which is explained in section&nbsp;<a href="#sec:wigner.py">7.1</a>. 
<div class="p"><!----></div>
As given in figure&nbsp;<a href="#fig:workflow"> 3.3</a>, <b><tt>wigner.py</tt></b> needs as input the result of a frequency calculation in  M<span style="font-size:x-small">OLDEN</span> format. The calculation can be performed by any quantum chemistry program and any method the user sees fit (there are some scripts which can aid in the frequency calculation, see sections&nbsp;<a href="#sec:molpro_input.py">6.3.5</a>, <a href="#sec:molcas_input.py">6.4.3</a>, <a href="#sec:ADF_freq.py">6.7.6</a>). 
<b><tt>wigner.py</tt></b> produces the file <b><tt>initconds</tt></b>, which contains a list of initial conditions ready for further processing.
<div class="p"><!----></div>
Alternatively, initial geometries and velocities can be extracted from molecular dynamics simulations in the ground state.
Currently, it is possible to either convert restart files  A<span style="font-size:x-small">MBER</span> to an <b><tt>initconds</tt></b> file (using <b><tt>amber_to_initconds.py</tt></b>, see section&nbsp;<a href="#sec:amber_to_initconds.py">7.2</a>) or to randomly sample snapshots from  S<span style="font-size:x-small">HARC</span>&nbsp;trajectories (using <b><tt>sharctraj_to_initconds.py</tt></b>, see section&nbsp;<a href="#sec:sharctraj_to_initconds.py">7.3</a>).
<div class="p"><!----></div>
<b>Generation of initial coefficients and states&nbsp;&nbsp;</b>
<div class="p"><!----></div>
In the second preparation step, for each of the sampled initial geometries it has to be decided which excited state should be the initial one. In simple cases, the user may manually choose the initial excited state using <b><tt>excite.py</tt></b> (optionally after diabatization; see&nbsp;<a href="#sec:excite.py">7.5</a>). Alternatively, the selection of initial states can be performed based on the excitation energies and oscillator strengths of the excited states at each initial geometry (this approximately simulates a delta-pulse excitation). 
<div class="p"><!----></div>
The latter options (diabatization or energies/oscillator strengths) make it necessary to carry out vertical excitation calculation before the selection of the initial states.
The calculations can be set up with <b><tt>setup_init.py</tt></b> (see section&nbsp;<a href="#sec:setup_init.py">7.4</a>). This script prepares for each initial condition in the <b><tt>initconds</tt></b> file a directory with the necessary input to perform the calculation. The user should then execute the run script (<b><tt>run.sh</tt></b>) in each of the directories (either manually or through a batch queueing system).
<div class="p"><!----></div>
After the vertical excitation calculations are completed, the vertical excitation energies and oscillator strengths of each calculation are collected by <b><tt>excite.py</tt></b> (see&nbsp;<a href="#sec:excite.py">7.5</a>). The same script then performs the selection of the initial electronic state for each initial geometry. The results are written to a new file, <b><tt>initconds.excited</tt></b>. This file contains all information needed to setup the ensemble. 
<div class="p"><!----></div>
Additionally, <b><tt>spectrum.py</tt></b> (<a href="#sec:spectrum.py">7.8</a>) can calculate absorption spectra based on the <b><tt>initconds.excited</tt></b> file. This may be useful to verify that the level of theory chosen is appropriate (e.g., by comparing to an experimental spectrum), or to choose a suitable excitation window for the determination of the initial state.
<div class="p"><!----></div>
     <a id="tth_sEc3.2.2"></a><h3>
3.2.2&nbsp;&nbsp;Running the dynamics simulations</h3>
<div class="p"><!----></div>
Based on the initial conditions given in <b><tt>initconds.excited</tt></b>, the input for all trajectories in the ensemble can be setup by <b><tt>setup_traj.py</tt></b> (see section&nbsp;<a href="#sec:setup_traj.py">7.6</a>). The script produces one directory for each trajectory, containing the input files for  S<span style="font-size:x-small">HARC</span>&nbsp;and the selected interface.
<div class="p"><!----></div>
In order to run a particular trajectory, the user should execute the run script (<b><tt>run.sh</tt></b>) in the directory of the trajectory. Since those calculations can run between minutes and several weeks (depending on the level of theory used and the number of time steps), it is advisable to submit the run scripts to a batch queueing system. 
<div class="p"><!----></div>
The progress of the simulations can be monitored most conveniently in the <b><tt>output.lis</tt></b> files. If the calculations are running in some temporary directory, the output files can be copied to the local directory (where they were setup) with the <b><tt>scp</tt></b> wrapper <b><tt>retrieve.sh</tt></b> (see <a href="#sec:retrieve">7.9</a>). This allows to perform ensemble analysis while the trajectories are still running.
<div class="p"><!----></div>
If a trajectory fails, the temporary directory where the calculation is running is not deleted. The file <b><tt>README</tt></b> will be created in the trajectory's directory, giving the time of the failure and the location of the temporary data, so that the case can be investigated. 
<div class="p"><!----></div>
In order to signal  S<span style="font-size:x-small">HARC</span>&nbsp;to terminate a trajectory after the current time step is completed, the user can create a (possibly empty) file <b><tt>STOP</tt></b> in the working directory of the trajectory (the directory where <b><tt>sharc.x</tt></b> is running).
<div class="p"><!----></div>
The status of the ensemble of trajectories can be checked with <b><tt>diagnostics.py</tt></b> (section&nbsp;<a href="#sec:diagnostics.py">7.12</a>). This script checks the presence and integrity of all relevant files, the progress of all trajectories, and warns if trajectories behave unexpectedly (non-conversion of total energy, intruder states, etc).
<div class="p"><!----></div>
     <a id="tth_sEc3.2.3"></a><h3>
3.2.3&nbsp;&nbsp;Analysis of the dynamics results</h3>
<div class="p"><!----></div>
Each trajectory can be analyzed independently by inspecting the output files (see chapter&nbsp;<a href="#chap:output">5</a>). Most importantly, calling <b><tt>data_extractor.x</tt></b> (<a href="#sec:data_extractor.x">7.10</a>) on the <b><tt>output.dat</tt></b> file of a trajectory creates a number of formatted files which can be plotted with the help of <b><tt>make_gnuscript.py</tt></b> (<a href="#sec:make_gnuscript.py">7.11</a>) and  G<span style="font-size:x-small">NUPLOT</span>.
The nuclear geometries in <b><tt>output.xyz</tt></b> file can be analyzed in terms of internal coordinates (bond lengths, angles, ring conformations, etc.) using <b><tt>geo.py</tt></b> (<a href="#sec:geo.py">7.18</a>).
The manual analysis of all individual trajectories is usually a good idea to verify that the trajectories are correctly executing, and in order to find general reaction pathways.
The manual analysis often permits to formulate some hypotheses, which can then be verified with the statistical analysis tools.
<div class="p"><!----></div>
For the complete ensemble, the first step should usually be to run <b><tt>diagnostics.py</tt></b> (section&nbsp;<a href="#sec:diagnostics.py">7.12</a>).
This script will determine how long the different trajectories are, and, more importantly, will check the trajectories for file integrity, conservation of total energy, and continuity of potential/kinetic energy.
Based on a set of customizable criteria, the script determines for each trajectory a "maximum usable time".
The script then can mark all trajectories with maximum usable time below a given threshold to be excluded from analysis (by creating a file <b><tt>DONT_ANALYZE</tt></b> in the trajectory's directory).
The other analysis scripts will then ignore trajectories marked by <b><tt>diagnostics.py</tt></b>.
Trajectories can also be manually excluded from analysis, by creating a file called <b><tt>CRASHED</tt></b>, <b><tt>DEAD</tt></b>, or <b><tt>RUNNING</tt></b> in the respective directory.
<div class="p"><!----></div>
After the trajectories were checked and unsuitable ones excluded, the statistical analysis scripts can be used.
The script <b><tt>populations.py</tt></b> (section&nbsp;<a href="#sec:populations.py">7.13</a>) can calculate average excited-state populations. 
The script <b><tt>transition.py</tt></b> (section&nbsp;<a href="#sec:transition.py">7.14</a>) can analyze the total number of hops between all pairs of states in an ensemble, allowing to identify relevant relaxation routes in the dynamics.
Using the script <b><tt>make_fitscript.py</tt></b> (<a href="#sec:make_fitscript.py">7.15</a>), it is possible to make elaborate global fits of chemical kinetics models to the populations data, allowing to extract rate constants from the populations.
With <b><tt>bootstrap.py</tt></b> (<a href="#sec:bootstrap.py">7.16</a>) one can compute errors for these rate constants.
The script&nbsp;<b><tt>crossing.py</tt></b> (<a href="#sec:crossing.py">7.17</a>) can find and extract notable geometries, e.g., those geometries where a surface hop between two particular states occurred.
Using <b><tt>trajana_essdyn.py</tt></b> (<a href="#sec:trajana_essdyn.py">7.19</a>) and <b><tt>trajana_nma.py</tt></b> (<a href="#sec:trajana_nma.py">7.20</a>) it is furthermore possible to perform essential dynamics analysis and normal mode analysis.
Finally, <b><tt>data_collector.py</tt></b> can merge arbitrary tabulated data from the trajectories and perform various analysis procedures (compute mean/standard deviation, data convolution, summation, integration), which can be used to compute, e.g., time-dependent distribution functions or time-dependent spectra.
<div class="p"><!----></div>
 <a id="tth_sEc3.3"></a><h2>
3.3&nbsp;&nbsp;Auxilliary Programs and Scripts</h2>
<div class="p"><!----></div>
The following tables list the auxiliary programs in the  S<span style="font-size:x-small">HARC</span>&nbsp;suite. The rightmost column gives the section where the program is documented.
<div class="p"><!----></div>
     <a id="tth_sEc3.3.1"></a><h3>
3.3.1&nbsp;&nbsp;Setup</h3>
<div class="p"><!----></div>
<table>
<tr><td align="left">wigner.py             </td><td align="left">Creates initial conditions from Wigner distribution.                   </td><td width="414"><a href="#sec:wigner.py">7.1</a></td></tr>
<tr><td align="left">amber_to_initconds.py       </td><td align="left">Creates initial conditions from Amber restart files.           </td><td width="414"><a href="#sec:amber_to_initconds.py">7.2</a></td></tr>
<tr><td align="left">sharctraj_to_initconds.py   </td><td align="left">Creates initial conditions from  S<span style="font-size:x-small">HARC</span>&nbsp;trajectories.          </td><td width="414"><a href="#sec:sharctraj_to_initconds.py">7.3</a></td></tr>
<tr><td align="left">setup_init.py        </td><td align="left">Sets up initial vertical excitation calculations.                      </td><td width="414"><a href="#sec:setup_init.py">7.4</a></td></tr>
<tr><td align="left">excite.py             </td><td align="left">Generates excited state lists for initial conditions and selects initial states.                 </td><td width="414"><a href="#sec:excite.py">7.5</a></td></tr>
<tr><td align="left">setup_traj.py        </td><td align="left">Sets up the dynamics simulations based on the initial conditions.      </td><td width="414"><a href="#sec:setup_traj.py">7.6</a></td></tr>
<tr><td align="left">laser.x               </td><td align="left">Prepares files containing laser fields.                                </td><td width="414"><a href="#sec:laser.x">7.7</a></td></tr>
<tr><td align="left">molpro_input.py      </td><td align="left">Prepares  M<span style="font-size:x-small">OLPRO</span> input files and template files for the  M<span style="font-size:x-small">OLPRO</span> interface.                  </td><td width="414"><a href="#sec:molpro_input.py">6.3.5</a></td></tr>
<tr><td align="left">molcas_input.py      </td><td align="left">Prepares  M<span style="font-size:x-small">OLCAS</span> input files and template files for the  M<span style="font-size:x-small">OLCAS</span> interface.             </td><td width="414"><a href="#sec:molcas_input.py">6.4.3</a></td></tr>
<tr><td align="left">ADF_input.py         </td><td align="left">Prepares ADF input files.                     </td><td width="414"><a href="#sec:ADF_input.py">6.7.5</a></td></tr>
<tr><td align="left">ADF_freq.py          </td><td align="left">Converts ADF output files of frequency calculations to Molden format.                     </td><td width="414"><a href="#sec:ADF_freq.py">6.7.6</a></td></tr>
<tr><td align="left">QMout2LVC.py          </td><td align="left">Converts output from a single point calculation to template for the LVC interface.             </td><td width="414"><a href="#sec:QMout2LVC.py">6.9.2</a></td></tr></table>
<div class="p"><!----></div>
     <a id="tth_sEc3.3.2"></a><h3>
3.3.2&nbsp;&nbsp;Analysis</h3>
<div class="p"><!----></div>
<table>
<tr><td align="left">spectrum.py           </td><td align="left">Generates absorption spectra from initial conditions files.            </td><td width="414"><a href="#sec:spectrum.py">7.8</a></td></tr>
<tr><td align="left">retrieve.sh           </td><td align="left"><b><tt>scp</tt></b> wrapper to retrieve dynamics output during the simulation.   </td><td width="414"><a href="#sec:retrieve">7.9</a></td></tr>
<tr><td align="left">data_extractor.x     </td><td align="left">Extracts plottable results from the  S<span style="font-size:x-small">HARC</span>&nbsp;output data file.          </td><td width="414"><a href="#sec:data_extractor.x">7.10</a></td></tr>
<tr><td align="left">make_gnuscript.py    </td><td align="left">Creates gnuplot scripts to plot trajectory data.                       </td><td width="414"><a href="#sec:make_gnuscript.py">7.11</a></td></tr>
<tr><td align="left">diagnostics.py        </td><td align="left">Checks ensembles for integrity, progress, energy conservation.         </td><td width="414"><a href="#sec:diagnostics.py">7.12</a></td></tr>
<tr><td align="left">populations.py        </td><td align="left">Calculates ensemble populations.                                       </td><td width="414"><a href="#sec:populations.py">7.13</a></td></tr>
<tr><td align="left">transition.py         </td><td align="left">Calculates total number of hops within an ensemble.                    </td><td width="414"><a href="#sec:transition.py">7.14</a></td></tr>
<tr><td align="left">make_fitscript.py    </td><td align="left">Creates gnuplot scripts to fit kinetic models to population data.      </td><td width="414"><a href="#sec:make_fitscript.py">7.15</a></td></tr>
<tr><td align="left">bootstrap.py          </td><td align="left">Computes errors for kinetic model fits.                                </td><td width="414"><a href="#sec:bootstrap.py">7.16</a></td></tr>
<tr><td align="left">crossing.py           </td><td align="left">Extracts specific geometries from ensembles.                           </td><td width="414"><a href="#sec:crossing.py">7.17</a></td></tr>
<tr><td align="left">geo.py                </td><td align="left">Calculates internal coordinates from xyz files.                        </td><td width="414"><a href="#sec:geo.py">7.18</a></td></tr>
<tr><td align="left">trajana_essdyn.py    </td><td align="left">Performs an essential dynamics analysis for an ensemble.               </td><td width="414"><a href="#sec:trajana_essdyn.py">7.19</a></td></tr>
<tr><td align="left">trajana_nma.py       </td><td align="left">Performs a normal mode analysis for an ensemble.                       </td><td width="414"><a href="#sec:trajana_nma.py">7.20</a></td></tr>
<tr><td align="left">data_collector.py    </td><td align="left">Collects data from tabular files and performs various analyses         </td><td width="414"><a href="#sec:data_collector.py">7.21</a></td></tr></table>
<div class="p"><!----></div>
     <a id="tth_sEc3.3.3"></a><h3>
3.3.3&nbsp;&nbsp;Interfaces</h3>
<div class="p"><!----></div>
<table>
<tr><td align="left">SHARC_MOLPRO.py      </td><td align="left">Calculates SOCs, gradients, nonadiabatic couplings, overlaps,     dipole moments, and Dyson norms at the CASSCF level of theory (using  M<span style="font-size:x-small">OLPRO</span>). Symmetry or RASSCF are not supported. Only segmented basis sets are possible.   </td><td width="414"><a href="#sec:int:molpro">6.3</a></td></tr>
<tr><td align="left">SHARC_MOLCAS.py      </td><td align="left">Calculates SOCs, gradients,                         overlaps,     dipole moments,     Dyson norms, dipole moment derivatives, and spin-orbit coupling derivatives at the CASSCF and (MS-)CASPT2 level of theory (using  M<span style="font-size:x-small">OLCAS</span>). Symmetry is not supported. Numerical differentiation is used for some tasks.   </td><td width="414"><a href="#sec:int:molcas">6.4</a></td></tr>
<tr><td align="left">SHARC_COLUMBUS.py    </td><td align="left">Calculates SOCs, gradients, nonadiabatic couplings, overlaps,     dipole moments, and Dyson norms at the CASSCF, RASSCF, and MRCISD levels of theory (using  C<span style="font-size:x-small">OLUMBUS</span>). Symmetry is not supported. Works with the either  D<span style="font-size:x-small">ALTON</span> or  S<span style="font-size:x-small">EWARD</span> integrals (through the  C<span style="font-size:x-small">OLUMBUS</span>- M<span style="font-size:x-small">OLCAS</span> interface), but SOCs are only available with  S<span style="font-size:x-small">EWARD</span> integrals. Nonadiabatic couplings are only available with  D<span style="font-size:x-small">ALTON</span> integrals.                </td><td width="414"><a href="#sec:int:columbus">6.5</a></td></tr>
<tr><td align="left">SHARC_Analytical.py  </td><td align="left">Calculates SOCs, gradients,                         overlaps,     dipole moments, and              dipole moment derivatives based on analytical expressions of diabatic matrix elements defined in Cartesian coordinates.       </td><td width="414"><a href="#sec:int:analytical">6.6</a></td></tr>
<tr><td align="left">SHARC_ADF.py         </td><td align="left">Calculates SOCs, gradients,                         overlaps,     dipole moments, and Dyson norms at the TD-DFT level of theory with GGA and hybrid functionals (using  ADF). Symmetry is not supported.  </td><td width="414"><a href="#sec:int:adf">6.7</a></td></tr>
<tr><td align="left">SHARC_RICC2.py       </td><td align="left">Calculates SOCs, gradients,                         overlaps, and dipole moments at the ADC(2) and CC2 levels of theory (using  T<span style="font-size:x-small">URBOMOLE</span>). Symmetry is not supported. For SOCs, only ADC(2) can be used and  O<span style="font-size:x-small">RCA</span> has to be installed in addition to  T<span style="font-size:x-small">URBOMOLE</span>.        </td><td width="414"><a href="#sec:int:ricc2">6.8</a></td></tr>
<tr><td align="left">SHARC_LVC.py         </td><td align="left">Calculates SOCs, gradients, nonadiabatic couplings, overlaps, and dipole moments based on linear-vibronic coupling models defined in mass-weighted normal mode coordinates.         </td><td width="414"><a href="#sec:int:lvc">6.9</a></td></tr>
<tr><td align="left">SHARC_GAUSSIAN.py    </td><td align="left">Calculates       gradients,                         overlaps,     dipole moments, and Dyson norms at the TD-DFT level of theory (using Gaussian). Symmetry is not supported.  </td><td width="414"><a href="#sec:int:gaussian">6.10</a></td></tr></table>
<div class="p"><!----></div>
     <a id="tth_sEc3.3.4"></a><h3>
3.3.4&nbsp;&nbsp;Others</h3>
<div class="p"><!----></div>
<table>
<tr><td align="left">tests.py              </td><td align="left">Script to automatically run the  S<span style="font-size:x-small">HARC</span>&nbsp;test suite.                                                    </td><td width="414"><a href="#sec:tests.py">2.3.3</a></td></tr>
<tr><td align="left">wfoverlap.x           </td><td align="left">Program to compute wave function overlaps, used by most interfaces.                                    </td><td width="414"><a href="#sec:int:wfoverlap">6.11</a></td></tr>
<tr><td align="left">Orca_External        </td><td align="left">Script to carry out optimizations with  O<span style="font-size:x-small">RCA</span> as optimizer and  S<span style="font-size:x-small">HARC</span>&nbsp;as gradient provider.    </td><td width="414"><a href="#sec:Orca_External">7.22</a></td></tr>
<tr><td align="left">setup_orca_opt.py   </td><td align="left">Script to setup optimizations with  O<span style="font-size:x-small">RCA</span> as optimizer and  S<span style="font-size:x-small">HARC</span>&nbsp;as gradient provider.        </td><td width="414"><a href="#sec:Orca_External">7.22</a></td></tr>
<tr><td align="left">setup_single_point.py   </td><td align="left">Script to setup single point calculations with  S<span style="font-size:x-small">HARC</span>&nbsp;interfaces.        </td><td width="414"><a href="#sec:setup_single_point.py">7.23</a></td></tr>
<tr><td align="left">QMout_print.py       </td><td align="left">Script to convert a <b><tt>QM.out</tt></b> file to a table with energies and oscillator strengths.               </td><td width="414"><a href="#sec:QMout_print.py">7.24</a></td></tr>
<tr><td align="left">diagonalizer.x        </td><td align="left">Helper program for <b><tt>excite.py</tt></b>. Only required if  N<span style="font-size:x-small">UM</span>P<span style="font-size:x-small">Y</span> is not available.                  </td><td width="414"><a href="#sec:diagonalizer.x">7.25</a></td></tr></table>
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_chAp4"></a><h1>
Chapter 4 Input files</h1><a id="chap:input">
</a>
<div class="p"><!----></div>
In this chapter, the format of all  S<span style="font-size:x-small">HARC</span>&nbsp;input files are presented. Those are the main input file (here called <b><tt>input</tt></b>), the geometry file, the velocity file, the coefficients file, the laser file, and the atom mask file. Only the first two are mandatory, the others are optional input files. All input files are ASCII text files.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc4.1"></a><h2>
4.1&nbsp;&nbsp;Main input file</h2><a id="sec:inputfile">
</a>
<div class="p"><!----></div>
This section presents the format and all input keywords for the main  S<span style="font-size:x-small">HARC</span>&nbsp;input. Note that when using <b><tt>setup_traj.py</tt></b>, full knowledge of the  S<span style="font-size:x-small">HARC</span>&nbsp;input keywords is not required.
<div class="p"><!----></div>
     <a id="tth_sEc4.1.1"></a><h3>
4.1.1&nbsp;&nbsp;General remarks</h3>
<div class="p"><!----></div>
The input file has a relatively flexible structure. With very few exceptions, each single line is independent. An input line starts with a keyword, followed optionally by a number of arguments to this keyword. Example:
<div class="p"><!----></div>
        <tt>stepsize&nbsp;0.5</tt>
<div class="p"><!----></div>
Here, <b><tt>stepsize</tt></b> is the keyword, referring to the size of the time steps for the nuclear motion in the dynamics. <b><tt>0.5</tt></b> gives the size of this time step, in this example 0.5&nbsp;fs.
<div class="p"><!----></div>
A number of keywords have no arguments and act as simple switches (e.g., <b><tt>restart</tt></b>, <b><tt>gradcorrect</tt></b>, <b><tt>grad_select</tt></b>, <b><tt>nac_select</tt></b>, <b><tt>ionization</tt></b>, <b><tt>track_phase</tt></b>, <b><tt>dipole_gradient</tt></b>). Those keywords can be prefixed with <b><tt>no</tt></b> to explicitly deactivate the option (e.g., <b><tt>norestart</tt></b> deactivates restarts).
<div class="p"><!----></div>
In each line a trailing comment can be added in the input file, by using the special character <b><tt>#</tt></b>. Everything after <b><tt>#</tt></b> is ignored by the input parser of  S<span style="font-size:x-small">HARC</span>. The input file also can contain arbitrary blank lines and lines containing only comments. All input is case-insensitive.
<div class="p"><!----></div>
The input file is read by  S<span style="font-size:x-small">HARC</span>&nbsp;by subsequently searching the file for all known keywords. Hence, unknown or misspelled keywords are ignored. Also, the order of the keywords is completely arbitray. Note however, that if a keyword is repeated in the input only the <i>first</i> instance is used by the program. 
<div class="p"><!----></div>
     <a id="tth_sEc4.1.2"></a><h3>
4.1.2&nbsp;&nbsp;Input keywords</h3>
<div class="p"><!----></div>
In Table&nbsp;<a href="#tab:input"> 4.1</a>, all input keywords for the  S<span style="font-size:x-small">HARC</span>&nbsp;input file are listed.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb4.1">
</a> 
<div style="text-align:center">      
<table border="1">
<tr><td colspan="4" align="left"><div style="text-align:center">Table 4.1: Input keywords for <b><tt>sharc.x</tt></b>. The first column gives the name of the keyword, the second lists possible arguments and the third line provides an explanation. Defaults are marked like <b><span style="color:#00BF28">this</span></b>. $n denotes the n-th argument to the keyword. </div></td></tr><a id="tab:input">
</a>
<tr><td align="left"></td></tr>
<tr><td align="left"><span class="roman">Keyword     </td><td align="left">Arguments    </td><td align="left">Explanation</td></tr>
<tr><td align="left"></td></tr>
<tr><td align="left">
<div class="p"><!----></div>
<div class="p"><!----></div>
<div class="p"><!----></div>
<div class="p"><!----></div>
<div class="p"><!----></div>
  </td></tr>
<tr><td align="left">printlevel            </td><td align="left"><b>integer</b>                    </td><td align="left">Controls the verbosity of the log file.</td></tr>
<tr><td align="left"></td><td align="left">$1=0                               </td><td align="left"><span class="footnotesize">Log file is empty</span></td></tr>
<tr><td align="left"></td><td align="left">$1=1                               </td><td align="left"><span class="footnotesize">+ List of internal steps</span></td></tr>
<tr><td align="left"></td><td align="left">$1<b><span style="color:#00BF28">=2</span></b>                     </td><td align="left"><span class="footnotesize">+ Input parsing information</span></td></tr>
<tr><td align="left"></td><td align="left">$1=3                               </td><td align="left"><span class="footnotesize">+ Some information per time step</span></td></tr>
<tr><td align="left"></td><td align="left">$1=4                               </td><td align="left"><span class="footnotesize">+ More information per time step</span></td></tr>
<tr><td align="left"></td><td align="left">$1=5                               </td><td align="left"><span class="footnotesize">+ Much more information per time step</span></td></tr>
<tr><td align="left">restart               </td><td align="left"></td><td align="left">Dynamics is resumed from restart files.</td></tr>
<tr><td align="left"><b><span style="color:#00BF28">norestart</span></b>   </td><td align="left"></td><td align="left">Dynamics is initialized from input files.</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="left"><span class="footnotesize"><b><tt>norestart</tt></b> takes precedence.</span></td></tr>
<tr><td align="left">rngseed               </td><td align="left"><b>integer</b>                    </td><td align="left">Seed for the random number generator.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">10997279</span></b>                  </td><td align="left"><span class="footnotesize">Used for surface hopping and AFSSH decoherence.</span></td></tr>
<tr><td colspan="3" align="center">- Input file keywords -</td></tr>
<tr><td align="left">geomfile              </td><td align="left"><b>quoted string</b>              </td><td align="left">File name containing the initial geometry.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">"geom"</span></b>                    </td><td align="left"></td></tr>
<tr><td align="left">velocfile             </td><td align="left"><b>quoted string</b>              </td><td align="left">File containing the initial velocities.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">"veloc"</span></b>                   </td><td align="left"><span class="footnotesize">Only read if <b><tt>veloc external</tt></b>.</span></td></tr>
<tr><td align="left">coefffile             </td><td align="left"><b>quoted string</b>              </td><td align="left">File containing the initial wave function coefficients.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">"coeff"</span></b>                   </td><td align="left"><span class="footnotesize">Only read if <b><tt>coeff external</tt></b>.</span></td></tr>
<tr><td align="left">laserfile             </td><td align="left"><b>quoted string</b>              </td><td align="left">File containing the laser field.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">"laser"</span></b>                   </td><td align="left"><span class="footnotesize">Only read if <b><tt>laser external</tt></b>.</span></td></tr>
<tr><td align="left">atommaskfile          </td><td align="left"><b>quoted string</b>              </td><td align="left">File containing the atom mask.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">&#228;tommask"</span></b>                </td><td align="left"><span class="footnotesize">Only read if <b><tt>atommask external</tt></b>.</span></td></tr>
<tr><td colspan="3" align="center">- Trajectory initialization keywords -</td></tr>
<tr><td align="left">veloc                 </td><td align="left"><b>string</b>                     </td><td align="left">Sets the initial velocities.</td></tr>
<tr><td align="left"></td><td align="left">$1<b><span style="color:#00BF28">=zero</span></b>                  </td><td align="left"><span class="footnotesize">Initial velocities are zero.</span></td></tr>
<tr><td align="left"></td><td align="left">$1=random $2 <b>float</b>       </td><td align="left"><span class="footnotesize">Random initial velocities with $2 eV kinetic energy per atom.</span></td></tr>
<tr><td align="left"></td><td align="left">$1=external                        </td><td align="left"><span class="footnotesize">Initial velocities are read from file.</span></td></tr>
<tr><td align="left">nstates               </td><td align="left">list of <b>integer</b>s           </td><td align="left">Number of states per multiplicity.</td></tr>
<tr><td align="left"></td><td align="left">$1 (<b><span style="color:#00BF28">1</span></b>)                   </td><td align="left"><span class="footnotesize">Number of singlet states</span></td></tr>
<tr><td align="left"></td><td align="left">$2 (<b><span style="color:#00BF28">0</span></b>)                   </td><td align="left"><span class="footnotesize">Number of doublet states</span></td></tr>
<tr><td align="left"></td><td align="left">$3 (<b><span style="color:#00BF28">0</span></b>)                   </td><td align="left"><span class="footnotesize">Number of triplet states</span></td></tr>
<tr><td align="left"></td><td align="left">$... (<b><span style="color:#00BF28">0</span></b>)               </td><td align="left"><span class="footnotesize">Number of states of higher multiplicities</span></td></tr>
<tr><td align="left">actstates             </td><td align="left">list of <b>integer</b>s           </td><td align="left">Number of active states per multiplicity.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">same as <b><tt>nstates</tt></b></span></b>     </td><td align="left"><span class="footnotesize">By default, all states are active.</span></td></tr>
<tr><td align="left">state                 </td><td align="left"><b>integer</b>, <b>string</b>   </td><td align="left">Specifies the initial state.</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="left">(no default;  S<span style="font-size:x-small">HARC</span>&nbsp;exits if <b><tt>state</tt></b> is missing).</td></tr>
<tr><td align="left"></td><td align="left">$1                                 </td><td align="left"><span class="footnotesize">Initial state.</span></td></tr>
<tr><td align="left"></td><td align="left">$2=MCH                             </td><td align="left"><span class="footnotesize">Initial state and coefficients are given in MCH representation.</span></td></tr>
<tr><td align="left"></td><td align="left">$2=diag                            </td><td align="left"><span class="footnotesize">Initial state and coefficients are given in diagonal representation.</span></td></tr>
<tr><td align="left">coeff                 </td><td align="left"><b>string</b>                     </td><td align="left">Sets the wave function coefficients.</td></tr>
<tr><td align="left"></td><td align="left">$1<b><span style="color:#00BF28">=auto</span></b>                  </td><td align="left"><span class="footnotesize">Initial coefficient are determined automatically from initial state.</span></td></tr>
<tr><td align="left"></td><td align="left">$1=external                        </td><td align="left"><span class="footnotesize">Initial coefficients are read from file.</span></td></tr>
<tr><td colspan="3" align="center">- Laser field keywords -</td></tr>
<tr><td align="left">laser                 </td><td align="left"><b>string</b>                     </td><td align="left">Sets the laser field.</td></tr>
<tr><td align="left"></td><td align="left">$1<b><span style="color:#00BF28">=none</span></b>                  </td><td align="left"><span class="footnotesize">No laser field is applied.</span></td></tr>
<tr><td align="left"></td><td align="left">$1=internal                        </td><td align="left"><span class="footnotesize">Laser field is calculated at each time step from internal function.</span></td></tr>
<tr><td align="left"></td><td align="left">$1=external                        </td><td align="left"><span class="footnotesize">Laser field for each time step is read during initialization.</span></td></tr>
<tr><td align="left">laserwidth            </td><td align="left"><b>float</b>                      </td><td align="left">Laser bandwidth used to detect induced hops.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">1.0 eV</span></b>                    </td><td align="left"></td></tr>
<tr><td colspan="3" align="center">- Time step keywords -</td></tr>
<tr><td align="left">stepsize              </td><td align="left"><b>float</b>                      </td><td align="left">Length of the nuclear dynamics time steps in fs.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">0.5 fs</span></b>                    </td><td align="left"></td></tr>
<tr><td align="left">nsubsteps             </td><td align="left"><b>integer</b>                    </td><td align="left">Number of substeps for the integration of the electronic equation of motion.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">25</span></b>                        </td><td align="left"></td></tr>
<tr><td align="left">nsteps                </td><td align="left"><b>integer</b>                    </td><td align="left">Number of simulation steps.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">3</span></b>                         </td><td align="left"></td></tr>
<tr><td align="left">tmax                  </td><td align="left"><b>float</b>                      </td><td align="left">Total length of the simulation in fs.</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="left"><span class="footnotesize">No effect if <b><tt>nsteps</tt></b> is present.</span></td></tr>
<tr><td align="left">killafter             </td><td align="left"><b>float</b>                      </td><td align="left">Terminates the trajectory after $1 fs in the lowest state. </td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">-1</span></b>                        </td><td align="left"><span class="footnotesize">If $1 &lt; 0, trajectories are never killed.</span></td></tr>
<tr><td colspan="3" align="center">- Surface hopping setting keywords -</td></tr>
<tr><td align="left">surf                  </td><td align="left"><b>string</b>                     </td><td align="left">Potential energy surfaces used in surface hopping.</td></tr>
<tr><td align="left"></td><td align="left">$1<b><span style="color:#00BF28">=diagonal,sharc</span></b>        </td><td align="left"><span class="footnotesize">Uses diagonal potentials.</span></td></tr>
<tr><td align="left"></td><td align="left">$1=MCH                             </td><td align="left"><span class="footnotesize">Uses MCH potentials.</span></td></tr>
<tr><td align="left">coupling              </td><td align="left"><b>string</b>                     </td><td align="left">Quantities describing the nonadiabatic couplings.</td></tr>
<tr><td align="left"></td><td align="left">$1=ddr,nacdr                       </td><td align="left"><span class="footnotesize">Uses vectorial nonadiabatic couplings &#9001;&#968;<sub>&#945;</sub>&#124;&#8706;/&#8706;R&#124;&#968;<sub>&#946;</sub>&#9002;.</span></td></tr>
<tr><td align="left"></td><td align="left">$1=ddt,nacdt                       </td><td align="left"><span class="footnotesize">Uses temporal nonadiabatic couplings &#9001;&#968;<sub>&#945;</sub>&#124;&#8706;/&#8706;t&#124;&#968;<sub>&#946;</sub>&#9002;.</span></td></tr>
<tr><td align="left"></td><td align="left">$1=<b><span style="color:#00BF28">overlap</span></b>               </td><td align="left"><span class="footnotesize">Uses the overlaps &#9001;&#968;<sub>&#945;</sub>(t<sub>0</sub>)&#124;&#968;<sub>&#946;</sub>(t)&#9002; (local diabatization).</span></td></tr>
<tr><td align="left">gradcorrect           </td><td align="left"></td><td align="left">Include (E<sub>&#945;</sub>&#8722;E<sub>&#946;</sub>)&#9001;&#968;<sub>&#945;</sub>&#124;&#8706;/&#8706;R&#124;&#968;<sub>&#946;</sub>&#9002; in gradient transformation.</td></tr>
<tr><td align="left"><b><span style="color:#00BF28">nogradcorrect</span></b></td><td align="left"></td><td align="left">Transform only the gradient matrix.</td></tr>
<tr><td align="left">ekincorrect           </td><td align="left"><b>string</b>                     </td><td align="left">Adjustment of the kinetic energy after a surface hop.</td></tr>
<tr><td align="left"></td><td align="left">$1=none                            </td><td align="left"><span class="footnotesize">Kinetic energy is not adjusted. Jumps are never frustrated.</span></td></tr>
<tr><td align="left"></td><td align="left">$1<b><span style="color:#00BF28">=parallel_vel</span></b>         </td><td align="left"><span class="footnotesize">Velocity is rescaled to adjust kinetic energy.</span></td></tr>
<tr><td align="left"></td><td align="left">$1=parallel_nac                   </td><td align="left"><span class="footnotesize">Only the velocity component in the direction of &#9001;&#968;<sub>&#945;</sub>&#124;&#8706;/&#8706;R&#124;&#968;<sub>&#946;</sub>&#9002; is rescaled.</span></td></tr>
<tr><td align="left">reflect_frustrated   </td><td align="left"><b>string</b>                     </td><td align="left">Reflection of trajectory after frustrated hop.</td></tr>
<tr><td align="left"></td><td align="left">$1<b><span style="color:#00BF28">=none</span></b>                  </td><td align="left"><span class="footnotesize">No reflection.</span></td></tr>
<tr><td align="left"></td><td align="left">$1=parallel_vel                   </td><td align="left"><span class="footnotesize">Full velocity vector is reflected.</span></td></tr>
<tr><td align="left"></td><td align="left">$1=parallel_nac                   </td><td align="left"><span class="footnotesize">Only the velocity component in the direction of &#9001;&#968;<sub>&#945;</sub>&#124;&#8706;/&#8706;R&#124;&#968;<sub>&#946;</sub>&#9002; is reflected.</span></td></tr>
<tr><td align="left">decoherence_scheme     </td><td align="left"><b>string</b>                     </td><td align="left">Method for decoherence correction.</td></tr>
<tr><td align="left"></td><td align="left">$1<b><span style="color:#00BF28">=none</span></b>                  </td><td align="left"><span class="footnotesize">No decoherence correction.</span></td></tr>
<tr><td align="left"></td><td align="left">$1=edc                             </td><td align="left"><span class="footnotesize">Energy-difference based correction.<a href="#Granucci2010JCP" id="CITEGranucci2010JCP" class="tth_citation">[101</a>]</span></td></tr>
<tr><td align="left"></td><td align="left">$1=afssh                           </td><td align="left"><span class="footnotesize">Augmented FSSH.<a href="#Jain2016JCTC" class="tth_citeref">[30</a>]</span></td></tr>
<tr><td align="left">decoherence_param    </td><td align="left"><b>float</b>                      </td><td align="left">Value &#945; in EDC decoherence (in Hartree).</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">0.1</span></b>                       </td><td align="left"><span class="footnotesize">$1 &gt; 0.0</span></td></tr>
<tr><td align="left">decoherence           </td><td align="left"></td><td align="left">Applies decoherence correction (EDC by default).</td></tr>
<tr><td align="left"><b><span style="color:#00BF28">nodecoherence</span></b></td><td align="left"></td><td align="left">No decoherence correction.</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="left"><span class="footnotesize"><b><tt>nodecoherence</tt></b> takes precedence.</span></td></tr>
<tr><td align="left">hopping_procedure    </td><td align="left"><b>string</b>                     </td><td align="left">Method for hopping probabilities.</td></tr>
<tr><td align="left"></td><td align="left">$1=off                             </td><td align="left"><span class="footnotesize">No hops (same as <b><tt>no_hops</tt></b>).</span></td></tr>
<tr><td align="left"></td><td align="left">$1<b><span style="color:#00BF28">=sharc,standard</span></b>        </td><td align="left"><span class="footnotesize">Standard  S<span style="font-size:x-small">HARC</span>&nbsp;hopping probabilities.</span></td></tr>
<tr><td align="left"></td><td align="left">$1=gfsh                            </td><td align="left"><span class="footnotesize">Global flux SH hopping probabilities.<a href="#Wang2014JCTC" class="tth_citeref">[70</a>]</span></td></tr>
<tr><td align="left">no_hops              </td><td align="left"></td><td align="left">Disables surface hopping.</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="left"><span class="footnotesize"><b><tt>no_hops</tt></b> takes precedence.</span></td></tr>
<tr><td align="left">atommask              </td><td align="left"><b>string</b>                     </td><td align="left">Activates masking of atoms (for EDC, <b><tt>parallel_vel</tt></b>).</td></tr>
<tr><td align="left"></td><td align="left">$1<b><span style="color:#00BF28">=none</span></b>                  </td><td align="left"><span class="footnotesize">No atoms are masked.</span></td></tr>
<tr><td align="left"></td><td align="left">$1=external                        </td><td align="left"><span class="footnotesize">Atom mask is read from external file.</span></td></tr>
<tr><td colspan="3" align="center">- Energy control keywords -</td></tr>
<tr><td align="left">ezero                 </td><td align="left"><b>float</b>                      </td><td align="left">Energy shift for Hamiltonian diagonal elements (Hartree).</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">0.0</span></b>                       </td><td align="left"><span class="footnotesize">Is not determined automatically!</span></td></tr>
<tr><td align="left">scaling               </td><td align="left"><b>float</b>                      </td><td align="left">Scaling factor for Hamiltonian matrix and gradients.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">1.0</span></b>                       </td><td align="left"><span class="footnotesize">0. &lt; $1</span></td></tr>
<tr><td align="left">dampeddyn             </td><td align="left"><b>float</b>                      </td><td align="left">Scaling factor for kinetic energy at each time step.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">1.0</span></b>                       </td><td align="left"><span class="footnotesize">0. &#8804; $1 &#8804; 1.</span></td></tr>
<tr><td colspan="3" align="center">- Gradient and NAC selection keywords -</td></tr>
<tr><td align="left">grad_select          </td><td align="left"></td><td align="left">Only some gradients are calculated at every time step.</td></tr>
<tr><td align="left"><b><span style="color:#00BF28">grad_all</span></b>   </td><td align="left"></td><td align="left">All gradients are calculated at every time step (Alias: <b><tt>nograd_select</tt></b>).</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="left"><span class="footnotesize"><b><tt>grad_all</tt></b> takes precedence.</span></td></tr>
<tr><td align="left">nac_select           </td><td align="left"></td><td align="left">Only some &#9001;&#968;<sub>&#945;</sub>&#124;&#8706;/&#8706;R&#124;&#968;<sub>&#946;</sub>&#9002; are calculated at every time step.</td></tr>
<tr><td align="left"><b><span style="color:#00BF28">nac_all</span></b>    </td><td align="left"></td><td align="left">All &#9001;&#968;<sub>&#945;</sub>&#124;&#8706;/&#8706;R&#124;&#968;<sub>&#946;</sub>&#9002; are calculated at every time step (Alias: <b><tt>nonac_select</tt></b>).</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="left"><span class="footnotesize"><b><tt>nac_all</tt></b> takes precedence.</span></td></tr>
<tr><td align="left">eselect               </td><td align="left"><b>float</b>                      </td><td align="left">Parameter for selection of gradients and NACs (in eV).</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">0.5 eV</span></b>                    </td><td align="left"></td></tr>
<tr><td align="left">select_directly      </td><td align="left"></td><td align="left">Do not do a second QM calculation for gradients and NACs.</td></tr>
<tr><td colspan="3" align="center">- Phase tracking keywords -</td></tr>
<tr><td align="left"><b><span style="color:#00BF28">track_phase</span></b></td><td align="left"></td><td align="left">Track the phase of the transformation matrix <b>U</b>.</td></tr>
<tr><td align="left">notrack_phase        </td><td align="left"></td><td align="left">No phase tracking of <b>U</b> (only for debugging).</td></tr>
<tr><td align="left"><b><span style="color:#00BF28">phases_from_interface</span></b>   </td><td align="left"></td><td align="left">Request phase information from interface.</td></tr>
<tr><td align="left">nophases_from_interface           </td><td align="left"></td><td align="left">Try to recover phase information from QM data.</td></tr>
<tr><td align="left">phases_at_zero      </td><td align="left"></td><td align="left">Request phase from interface at t=0.</td></tr>
<tr><td colspan="3" align="center">- Property computation keywords -</td></tr>
<tr><td align="left"><b><span style="color:#00BF28">spinorbit</span></b>   </td><td align="left"></td><td align="left">Include spin-orbit couplings into the Hamiltonian.</td></tr>
<tr><td align="left">nospinorbit           </td><td align="left"></td><td align="left">Neglect spin-orbit couplings.</td></tr>
<tr><td align="left">dipole_gradient              </td><td align="left"></td><td align="left">Include dipole moments derivatives in the gradients.</td></tr>
<tr><td align="left"><b><span style="color:#00BF28">nodipole_gradient</span></b>  </td><td align="left"></td><td align="left">Neglect dipole moments derivatives.</td></tr>
<tr><td align="left">ionization            </td><td align="left"></td><td align="left">Calculate ionization probabilities on-the-fly.</td></tr>
<tr><td align="left"><b><span style="color:#00BF28">noionization</span></b></td><td align="left"></td><td align="left">No ionization probabilities.</td></tr>
<tr><td align="left">ionization_step      </td><td align="left"><b>integer</b>                    </td><td align="left">Calculate ionization probabilities every $1 time step.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">1</span></b>                         </td><td align="left"><span class="footnotesize">By default calculated every time step (if <b><tt>ionization</tt></b>).</span></td></tr>
<tr><td align="left">theodore              </td><td align="left"></td><td align="left">Calculate wavefunction descriptors on-the-fly.</td></tr>
<tr><td align="left"><b><span style="color:#00BF28">notheodore</span></b>  </td><td align="left"></td><td align="left">No wavefunction descriptors.</td></tr>
<tr><td align="left">theodore_step        </td><td align="left"><b>integer</b>                    </td><td align="left">Calculate wavefunction descriptors every $1 time step.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">1</span></b>                         </td><td align="left"><span class="footnotesize">By default calculated every time step (if <b><tt>theodore</tt></b>).</span></td></tr>
<tr><td align="left">n_property1d         </td><td align="left"><b>integer</b>                    </td><td align="left">Allocate for that many 1D properties.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">1</span></b>                         </td><td align="left"><span class="footnotesize"></span></td></tr>
<tr><td align="left">n_property2d         </td><td align="left"><b>integer</b>                    </td><td align="left">Allocate for that many 2D properties.</td></tr>
<tr><td align="left"></td><td align="left"><b><span style="color:#00BF28">1</span></b>                         </td><td align="left"><span class="footnotesize"></span></td></tr>
<tr><td colspan="3" align="center">- Output control keywords -</td></tr>
<tr><td align="left">write_grad                         </td><td align="left"></td><td align="left">Writes gradients to <b><tt>output.dat</tt></b>.</td></tr>
<tr><td align="left"><b><span style="color:#00BF28">nowrite_grad</span></b>             </td><td align="left"></td><td align="left"></td></tr>
<tr><td align="left">write_nacdr                        </td><td align="left"></td><td align="left">Writes NACs to <b><tt>output.dat</tt></b>.</td></tr>
<tr><td align="left"><b><span style="color:#00BF28">nowrite_nacdr</span></b>            </td><td align="left"></td><td align="left"></td></tr>
<tr><td align="left"><b><span style="color:#00BF28">write_overlap</span></b>            </td><td align="left"></td><td align="left">Writes overlaps to <b><tt>output.dat</tt></b>.</td></tr>
<tr><td align="left">nowrite_overlap                    </td><td align="left"></td><td align="left"><span class="footnotesize">Not written if not requested.</span></td></tr>
<tr><td align="left">write_property1d                   </td><td align="left"><b><span style="color:#00BF28">on if <b><tt>theodore</tt></b></span></b>                      </td><td align="left">Writes 1D properties to <b><tt>output.dat</tt></b>.</td></tr>
<tr><td align="left">nowrite_property1d                 </td><td align="left"></td><td align="left"></td></tr>
<tr><td align="left">write_property2d                   </td><td align="left"><b><span style="color:#00BF28">on if <b><tt>ionization</tt></b></span></b>                      </td><td align="left">Writes 2D properties to <b><tt>output.dat</tt></b>.</td></tr>
<tr><td align="left">nowrite_property2d                 </td><td align="left"></td><td align="left"></td></tr>
<tr><td align="left"></td></tr></span></table>
</div>
<div class="p"><!----></div>
     <a id="tth_sEc4.1.3"></a><h3>
4.1.3&nbsp;&nbsp;Detailed Description of the Keywords</h3><a id="ssec:input:keywords">
</a>
<div class="p"><!----></div>
<b>Printlevel&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The <b><tt>printlevel</tt></b> keyword controls the verbosity of the log file. The data output file (<b><tt>output.dat</tt></b>) and the listing file (<b><tt>output.lis</tt></b>) are not affected by the print level. The print levels are described in section&nbsp;<a href="#sec:logfile">5.1</a>.
<div class="p"><!----></div>
<b>Restart&nbsp;&nbsp;</b>
<div class="p"><!----></div>
There are two keywords controlling trajectory restarting. The keyword <b><tt>restart</tt></b> enables restarting, while <b><tt>norestart</tt></b> disables restart. If both keywords are present, <b><tt>norestart</tt></b> takes precedence. The default is no restart.
<div class="p"><!----></div>
When restarting, all control variables are read from the restart file instead of the input file. The only exceptions are <b><tt>nsteps</tt></b> and <b><tt>tmax</tt></b>. In this way, a trajectory which ran for the full simulation time can easily be restarted to extend the simulation time.
<div class="p"><!----></div>
Note that none of the auxiliary scripts adds the <b><tt>restart</tt></b> keyword to the input file. The user has to manually add the restart file to the input files of the relevant trajectories.
<div class="p"><!----></div>
<b>RNG Seed&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The RNG seed is used to initialize the random number generator, which provides the random numbers for the surface hopping procedure (and the AFSSH decoherence scheme). For details how the seed is used internally, see section&nbsp;<a href="#met:seed">8.22</a>.
<div class="p"><!----></div>
Note that in the case of a restart, the random number generator is seeded normally, and then the appropriate number of random numbers is drawn so that the random number sequence is consistent.
<div class="p"><!----></div>
<b>Geometry Input&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The initial geometry must be given in a second file in the  <a href="http://www.univie.ac.at/columbus/docs_COL70/documentation_main.html">input format also used by  C<span style="font-size:x-small">OLUMBUS</span></a>. The default name for this file is <b><tt>geom</tt></b>. The geometry filename can be given in the input file with the <b><tt>geomfile</tt></b> keyword. Note that the filename has to be enclosed in single or double quotes. See section&nbsp;<a href="#sec:geomfile">4.2</a> for more details.
<div class="p"><!----></div>
<b>Velocity Input&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Using the <b><tt>veloc</tt></b> keyword, the initial velocities can be either set to zero, determined randomly or read from a file. Random determination of the velocities is such that each atom has the same kinetic energy, which must be specified after <b><tt>veloc random</tt></b> in units of eV. Determination of the random velocities is detailed in&nbsp;<a href="#met:veloc">8.18</a>. Note that after the initial velocities are generated, the RNG is reseeded (i.e., the sequence of random numbers in the surface hopping procedure is independent of whether random initial velocities are used).
<div class="p"><!----></div>
Alternatively, the initial velocities can be read from a file. 
The default velocity filename is <b><tt>veloc</tt></b>, but the filename can be specified with the <b><tt>velocfile</tt></b> keyword. Note that the filename has to be enclosed in single or double quotes. The file must contain the Cartesian components of the velocity for each atom on a new line, in the same order as in the geomety file. The velocity is interpreted in terms of atomic units (bohr/atu). See section&nbsp;<a href="#sec:velocfile">4.3</a> for more details.
<div class="p"><!----></div>
<b>Number of States and Active States&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The keyword <b><tt>nstates</tt></b> controls how many states are taken into account in the dynamics. The keyword arguments specify the number of singlet, doublet, triplet, etc.&nbsp;states. There is no hard-coded maximum multiplicity in the  S<span style="font-size:x-small">HARC</span>&nbsp;code, however, some interfaces may restrict the maximum multiplicity. 
<div class="p"><!----></div>
Using the <b><tt>actstates</tt></b> keyword, the dynamics can be restricted to some lowest states in each multiplicity. For each multiplicity, the number of active states must not be larger than the number of states. All couplings between the active states and the frozen states are deleted. These couplings include off-diagonal elements in the H<sup>MCH</sup> matrix, in the overlap matrix, and in the matrix containing the nonadiabatic couplings. Freezing states can be useful if transient absorption spectra are to be calculated without increasing computational cost due to the large number of states.
<div class="p"><!----></div>
Note that the initial state must not be frozen.
<div class="p"><!----></div>
<b>Initial State&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The initial state can be given either in MCH or diagonal representation. The keyword <b><tt>state</tt></b> is followed by an integer specifying the initial state and either the string <b><tt>mch</tt></b> or <b><tt>diag</tt></b>. For the MCH representations, states are enumerated according to the canonical state ordering, see&nbsp;<a href="#met:ordering">8.24</a>. The diagonal states are ordered according to energy. Note that the initial state must be active. 
<div class="p"><!----></div>
If the initial state is given in the MCH basis but the dynamics is carried out in the diagonal basis, determination of the initial diagonal state is carried out after the initial QM calculation.
<div class="p"><!----></div>
<b>Initial Coefficients&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The initial coefficients can be determined automatically from the initial state, using <b><tt>coeff auto</tt></b> in the input file. If the initial state is given in the diagonal representation as i, the initial coefficients are c<sup>diag</sup><sub>j</sub>=&#948;<sub>ij</sub>. If the initial state is, however, given in the MCH representation, then c<sup>MCH</sup><sub>j</sub>=&#948;<sub>ij</sub> and the determination of <b>c</b><sup>diag</sup>=<b>U</b><sup>&#8224;</sup><b>c</b><sup>MCH</sup> is carried out after the initial QM calculation. 
Currently, <b><tt>coeff auto</tt></b> is always used by the automatic setup scripts.
<div class="p"><!----></div>
Besides automatic determination, the initial coefficients can be read from a file. The default filename is <b><tt>coeff</tt></b>, but the filename can be given with the keyword <b><tt>coefffile</tt></b>. Note that the filename has to be enclosed in single or double quotes. The file must contain the real and imaginary part of the initial coefficients, one line per state with no blank lines inbetween. These coefficients are interpreted to be in the same representation as the initial state, i.e.&nbsp;the <b><tt>state</tt></b> keyword influences the initial coefficients. For details on the file format, see section&nbsp;<a href="#sec:coefffile">4.4</a>.
Note that the setup scripts currently cannot setup trajectories with <b><tt>coeff external</tt></b>, so this can be considered an expert option.
<div class="p"><!----></div>
<b>Laser Input&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The keyword <b><tt>laser</tt></b> controls whether a laser field is included in the dynamics (influencing the coefficient propagation and the energies/gradients by means of the Stark effect). 
<div class="p"><!----></div>
The input of an external laser field uses the file <b><tt>laser</tt></b>. This file is specified in <a href="#sec:laserfile">4.5</a>.
<div class="p"><!----></div>
In order to detect laser-induced hops,  S<span style="font-size:x-small">HARC</span>&nbsp;compares the instantaneous central laser energy with the energy gap between the old and new states. If the difference between the laser energy and the energy gap is smaller than the laser bandwidth (given with the <b><tt>laserwidth</tt></b> keyword), the hop is classified as laser-induced. Those hops are never frustrated and the kinetic energy is not scaled to preserve total energy (instead, the kinetic energy is preserved).
<div class="p"><!----></div>
<b>Simulation Timestep&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The keyword <b><tt>stepsize</tt></b> controls the length of a time step (in fs) for the dynamics. The nuclear motion is integrated using the Velocity-Verlet algorithm with this time step. Surface hopping is performed once per time step and 1-3 quantum chemistry calculations are performed per time step (depending on the selection schedule). Each time step is divided in <b><tt>nsubsteps</tt></b> substeps for the integration of the electronic equation-of-motion. Since integration is performed in the MCH representation, the default of 25 substeps is usually sufficient, even if very small potential couplings are encountered. A larger number of substeps might be necessary if high-frequency laser fields are included or if the energy shift (<b><tt>ezero</tt></b>) is not well-chosen.
<div class="p"><!----></div>
<b>Simulation Time&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The keyword <b><tt>nsteps</tt></b> controls the total length of the simulation. The total simulation time is <b><tt>nsteps</tt></b> times <b><tt>stepsize</tt></b>. <b><tt>nsteps</tt></b> does not include the initial quantum chemistry calculation. Instead of the number of steps, the total simulation time can be given directly (in fs) using the keyword <b><tt>tmax</tt></b>. In this case, <b><tt>nsteps</tt></b> is calculated as <b><tt>tmax</tt></b> divided by <b><tt>stepsize</tt></b>. If both keywords (<b><tt>nsteps</tt></b> and <b><tt>tmax</tt></b>) are present, <b><tt>nsteps</tt></b> is used. All setup scripts will generally use the <b><tt>tmax</tt></b> keyword.
<div class="p"><!----></div>
Using the keyword <b><tt>killafter</tt></b>, the dynamics can be terminated before the full simulation time. <b><tt>killafter</tt></b> specifies (in fs) the time the trajectory can move in the lowest-energy state before the simulation is terminated. By default, simulations always run to the full simulation time and are not terminated prematurely.
<div class="p"><!----></div>
<b>Surface Treatment&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The keyword <b><tt>surf</tt></b> controls whether the dynamics runs on diagonal potential energy surfaces (which makes it a  S<span style="font-size:x-small">HARC</span>&nbsp;simulation) or on the MCH PESs (which corresponds to a spin-diabatic <a href="#Granucci2012JCP" class="tth_citeref">[26</a>] or FISH <a href="#Mitric2009PRA" class="tth_citeref">[25</a>] simulation, or a regular surface hopping simulation). Internally, dynamics on the MCH potentials is conducted by setting the U matrix equal to the unity matrix at each time step. 
<div class="p"><!----></div>
<b>Description of Non-adiabatic Coupling&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The code allows propagating the electronic wave function using three different quantities describing nonadiabatic effects, see&nbsp;<a href="#met:propagate">8.27</a>. The keyword <b><tt>coupling</tt></b> controls which of these quantities is requested from the QM interfaces and used in the propagation. The first option is <b><tt>nacdr</tt></b>, which requires the nonadiabatic coupling vectors &#9001;&#968;<sub>&#945;</sub>&#124;&#8706;/&#8706;<b>R</b>&#124;&#968;<sub>&#946;</sub>&#9002;. For the wave function propagation, the scalar product of these vectors and the nuclear velocity is calculated to obtain the matrix &#9001;&#968;<sub>&#945;</sub>&#124;&#8706;/&#8706;t&#124;&#968;<sub>&#946;</sub>&#9002;. During the propagation, this matrix is interpolated linearly within each classical time step. Currently, only few  S<span style="font-size:x-small">HARC</span>&nbsp;interfaces can provide these couplings.
<div class="p"><!----></div>
Alternatively, one can directly request the matrix elements &#9001;&#968;<sub>&#945;</sub>&#124;&#8706;/&#8706;t&#124;&#968;<sub>&#946;</sub>&#9002;, which can be used for the propagation. The corresponding argument to <b><tt>coupling</tt></b> is <b><tt>nacdt</tt></b>. In this case, the matrix is taken as constant throughout each classical time step. Currently, none of the interfaces in  S<span style="font-size:x-small">HARC</span>&nbsp;can deliver these couplings, because they are computed via overlaps, and if overlaps are known it is preferable to use local diabatization.
<div class="p"><!----></div>
The third possibility is the use of the overlap matrix, requested with <b><tt>coupling overlaps</tt></b> (this is the default). The overlap matrix is used subsequently in the local diabatization algorithm for the wave function propagation. Currently, all  S<span style="font-size:x-small">HARC</span>&nbsp;interfaces can provide these couplings.
<div class="p"><!----></div>
<b>Correction to the Diagonal Gradients&nbsp;&nbsp;</b>
<div class="p"><!----></div>
As detailed in&nbsp;<a href="#met:gradtra">8.10</a>, the correct transformation of the gradients to the diagonal representation includes contributions from the nonadiabatic coupling vectors. Using <b><tt>gradcorrect</tt></b>, these contributions are included. In this case  S<span style="font-size:x-small">HARC</span>&nbsp;will request the calculation of the nonadiabatic coupling vectors, even if they are not used in the wave function propagation. In order to explicitly turn off this gradient correction, use the <b><tt>nogradcorrect</tt></b> keyword.
<div class="p"><!----></div>
<b>Frustrated Hops and Adjustment of the Kinetic Energy&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The keyword <b><tt>ekincorrect</tt></b> controls how the kinetic energy is adjusted after a surface hop to preserve total energy. <b><tt>ekincorrect none</tt></b> deactivates the adjustment, so that the total energy is not preserved after a hop. Using this option, jumps can never be frustrated and are always performed according to the hopping probabilities. 
Using <b><tt>ekincorrect parallel_vel</tt></b>, the kinetic energy is adjusted by simply rescaling the nuclear velocities so that the new kinetic energy is E<sub>tot</sub>&#8722;E<sub>pot</sub>. Jumps are frustrated if the new potential energy would exceed the total energy.
Finally, using <b><tt>ekincorrect parallel_nac</tt></b>, the kinetic energy is adjusted by rescaling the component of the nuclear velocities parallel to the nonadiabatic coupling vector between the old and new state. The hop is frustrated if there is not enough kinetic energy in this direction to conserve total energy. Note that <b><tt>ekincorrect parallel_nac</tt></b> implies the calculation of the nonadiabatic coupling vector, even if they are not used for the wave function propagation.
<div class="p"><!----></div>
The keyword <b><tt>reflect_frustrated</tt></b> furthermore controls whether the velocities are inverted after a frustrated hop.
With <b><tt>reflect_frustrated none</tt></b> (the default), after a frustrated hop, the velocity vector is not modified.
Using <b><tt>reflect_frustrated parallel_vel</tt></b>, the full velocity vector is inverted when a frustrated hop is encountered.
With the third option, <b><tt>reflect_frustrated parallel_nac</tt></b>, only the velocity component parallel to the nonadiabatic coupling vector between the active and frustrated states is inverted. This implies the calculation of the nonadiabatic coupling vector, even if they are not used for the wave function propagation.
<div class="p"><!----></div>
<b>Decoherence Correction Scheme&nbsp;&nbsp;</b>
<div class="p"><!----></div>
There are three options for the decoherence correction (see&nbsp;<a href="#met:decoherence">8.6</a>) in  S<span style="font-size:x-small">HARC</span>, which can be selected with the <b><tt>decoherence_scheme</tt></b> keyword. 
<div class="p"><!----></div>
With the default <b><tt>decoherence_scheme none</tt></b>, no decoherence correction is applied.
The energy-difference based decoherence (EDC) scheme of Granucci et al.&nbsp;<a href="#Granucci2010JCP" class="tth_citeref">[101</a>] can be activated with <b><tt>decoherence_scheme edc</tt></b>. 
The keyword <b><tt>decoherence_param</tt></b> can be used to change the relevant parameter &#945; (see&nbsp;<a href="#met:decoherence">8.6</a>). The default is 0.1&nbsp;Hartree, which is the value recommended by Granucci et al.&nbsp;<a href="#Granucci2010JCP" class="tth_citeref">[101</a>].
Alternatively, the AFSSH (augmented fewest-switches surface hopping) scheme of Jain et al.&nbsp;<a href="#Jain2016JCTC" class="tth_citeref">[30</a>] can be employed. This scheme does not use any parameters, so the keyword <b><tt>decoherence_param</tt></b> will have no effect.
Note that in any case, the decoherence correction is applied to the states in the representation chosen with the <b><tt>surf</tt></b> keyword.
<div class="p"><!----></div>
The keywords <b><tt>decoherence</tt></b> (activates EDC decoherence) and <b><tt>nodecoherence</tt></b> are present for backwards compatibility.
<div class="p"><!----></div>
<b>Surface Hopping Scheme&nbsp;&nbsp;</b>
<div class="p"><!----></div>
There are three options for the computation of the hopping probabilities (see&nbsp;<a href="#met:hopping">8.25</a>) in  S<span style="font-size:x-small">HARC</span>, which can be selected with the <b><tt>hopping_procedure</tt></b> keyword. 
<div class="p"><!----></div>
Using <b><tt>hopping_procedure off</tt></b>, surface hopping will be disabled, such that the active state (in the representation chosen with the <b><tt>surf</tt></b> keyword) will never change.
With the default, <b><tt>hopping_procedure sharc</tt></b>, the standard hopping probability equation from Ref.&nbsp;<a href="#Mai2015IJQC" class="tth_citeref">[36</a>] will be used.
Alternatively, one can use the global flux surface hopping scheme&nbsp;<a href="#Wang2014JCTC" class="tth_citeref">[70</a>], which might be advantageous in super-exchange situations.
<div class="p"><!----></div>
One can also turn off surface hopping with the <b><tt>no_hops</tt></b> keyword.
<div class="p"><!----></div>
<b>Atom Masking&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Some of the above surface hopping settings might not be fully size consistent: (i) in <b><tt>ekincorrect parallel_vel</tt></b>, all atoms are uniformly accelerated/slowed during velocity rescaling; (ii) in <b><tt>reflect_frustrated parallel_vel</tt></b>, the velocities of all atoms are inverted; (iii) with <b><tt>decoherence_scheme edc</tt></b>, the kinetic energy of all atoms determines the decoherence rate. In large systems (e.g., in solution), these effects might be unrealistic, because, e.g., a surface hop in the chromophore should not uniformly slow down all water molecules.
<div class="p"><!----></div>
The <b><tt>atommask</tt></b> keyword can then be used to exclude certain atoms from the three mentioned procedures. With <b><tt>atommask external</tt></b>, the list of masked and active atoms is read from the file specified with the <b><tt>atommaskfile</tt></b> keyword (default <b><tt>&#228;tommask"</tt></b>). The format of this file is described in section&nbsp;<a href="#sec:atommaskfile">4.6</a>. With the other possible option, <b><tt>atommask none</tt></b> (the default), all atoms are considered for these procedures.
<div class="p"><!----></div>
Note that the <b><tt>atommask</tt></b> keyword has no effect on <b><tt>ekincorrect parallel_nac</tt></b>, <b><tt>reflect_frustrated parallel_nac</tt></b>, and <b><tt>decoherence_scheme afssh</tt></b>, because these procedures are size consistent by themselves.
<div class="p"><!----></div>
<b>Reference Energy&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The keyword <b><tt>ezero</tt></b> gives the energy shift for the diagonal elements of the Hamiltonian. The shift should be chosen so that the shifted diagonal elements are reasonably small (large diagonal elements in the Hamiltonian lead to rapidly changing coefficients, requiring extremely short subtime steps). 
<div class="p"><!----></div>
Note that the energy shift default is 0, i.e.,  S<span style="font-size:x-small">HARC</span>&nbsp;does not choose an energy shift based on the energies at the first time step (this would lead to each trajectory having a different energy shift).
<div class="p"><!----></div>
<b>Scaling and Damping&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The scaling factor for the energies and gradients must be positive (not zero), see section&nbsp;<a href="#met:scaling">8.21</a>.
<div class="p"><!----></div>
The damping factor must be in the interval [0,1] (first, since the kinetic energy is always positive; second, because a damping factor larger than 1 would lead to exponentially growing kinetic energy). Also see section&nbsp;<a href="#met:damping">8.5</a>.
<div class="p"><!----></div>
<b>Selection of Gradients and Non-Adiabatic Couplings&nbsp;&nbsp;</b>
<div class="p"><!----></div>
 S<span style="font-size:x-small">HARC</span>&nbsp;allows to selectively calculate only certain gradients and nonadiabatic coupling vectors at each time step. Those gradients and nonadiabatic coupling vectors not selected are not requested from the interfaces, thus decreasing the computational cost. The selection procedure is detailed in&nbsp;<a href="#met:selection">8.23</a>.
Selection of gradients is activated by <b><tt>grad_select</tt></b>, selection for nonadiabatic couplings by <b><tt>nac_select</tt></b>. Selection is turned off by default. 
<div class="p"><!----></div>
The selection procedure picks only states which are closer in energy to the classically occupied state than a given threshold. The threshold is 0.5&nbsp;eV by default and can be adjusted using the <b><tt>eselect</tt></b> keyword.
<div class="p"><!----></div>
By default, if  S<span style="font-size:x-small">HARC</span>&nbsp;performs such selection it will do two quantum chemistry calls per time step. In the first call, all quantities are requested except for the ones to be selected. The energies are used to determine which gradients and NACs to calculate in a second quantum chemistry call. The keyword <b><tt>select_directly</tt></b> tells  S<span style="font-size:x-small">HARC</span>&nbsp;instead to use the energies of the last time step, so that only one call per time step is necessary.
<div class="p"><!----></div>
<b>Phase Tracking&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Phase tracking is an important ingredient in  S<span style="font-size:x-small">HARC</span>. It is necessary for two reasons: (i) the columns of the transformation matrix <b>U</b> are determined only up to an arbitrary phase factor <span class="roman">e</span><sup><span class="roman">i</span>&#981;</sup> (and additional mixing angles in case of degeneracy), and (ii) the wave functions produced by any quantum chemistry code are determined only up to an arbitrary sign.
Both kind of phases need to be tracked in  S<span style="font-size:x-small">HARC</span>&nbsp;in order to obtain smoothly varying matrix elements which can be properly integrated.
<div class="p"><!----></div>
By default,  S<span style="font-size:x-small">HARC</span>&nbsp;automatically tracks the phases in the <b>U</b> matrix (explicit keyword: <b><tt>track_phase</tt></b>), because all required information is always available. This phase tracking can be deactivated with the <b><tt>notrack_phase</tt></b> keyword, but this option should only be used for debugging purposes.
<div class="p"><!----></div>
The tracking of the wave function signs depends on the interfaces, because only they have access to the explicit form of the wave functions.  S<span style="font-size:x-small">HARC</span>&nbsp;by default (explicit keyword: <b><tt>phases_from_interface</tt></b>) requests that the interface tracks the signs and reports any sign changes to  S<span style="font-size:x-small">HARC</span>. Currently, all interfaces can provide this phase information, but all of them need to perform overlap calculations to do so. The <b><tt>nophases_from_interface</tt></b> keyword can be used to deactivate these requests.
<div class="p"><!----></div>
In some situations, it might be necessary to have consistent wave function signs between different trajectories. In this case, the <b><tt>phases_at_zero</tt></b> keyword can be used to compute sign information at t=0; this requires that the relevant wave function data of the reference is already located in the <b><tt>restart/</tt></b> directory before the trajectory is started. Note that <b><tt>phases_at_zero</tt></b> is therefore an expert option.
<div class="p"><!----></div>
<b>Spin-Orbit Couplings&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Using the keyword <b><tt>nospinorbit</tt></b> the calculation of spin-orbit couplings is disabled.  S<span style="font-size:x-small">HARC</span>&nbsp;will only request the diagonal elements of the Hamiltonian from the interfaces. If the interface returns a non-diagonal Hamiltonian anyways, the off-diagonal elements are deleted.
<div class="p"><!----></div>
The keyword <b><tt>spinorbit</tt></b> (which is the default) enables spin-orbit couplings.
<div class="p"><!----></div>
<b>Dipole Moment Gradients&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The derivatives of the dipole moments can be included in the gradients. This can be activated with the keyword <b><tt>dipole_gradient</tt></b>. Currently, only the analytical and  M<span style="font-size:x-small">OLCAS</span> interfaces can deliver these quantities.
<div class="p"><!----></div>
<b>Ionization&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The keyword <b><tt>ionization</tt></b> activates (<b><tt>noionization</tt></b> deactivates) the on-the-fly calculation of ionization transition properties. If the keyword is given, by default these properties are calculated every time step. The keyword <b><tt>ionization_step</tt></b> can be used to calculate these properties only every n-th time step. 
If the keyword is given,  S<span style="font-size:x-small">HARC</span>&nbsp;will request the calculation of the ionization properties from the interface, which needs to be able to calculate them.
<div class="p"><!----></div>
The ionization probabilities are treated as one 2D property matrix, hence <b><tt>n_property2d</tt></b> should be at least 1.
<div class="p"><!----></div>
<b> T<span style="font-size:x-small">HEO</span>DORE&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The keyword <b><tt>theodore</tt></b> activates (<b><tt>notheodore</tt></b> deactivates) the on-the-fly calculation of wave function descriptors with the  T<span style="font-size:x-small">HEO</span>DORE program. This can be very useful to track the wave function character of the states on-the-fly.
The interface must be able to execute and  T<span style="font-size:x-small">HEO</span>DORE and return its output to  S<span style="font-size:x-small">HARC</span>&nbsp;(currently, the ADF,  G<span style="font-size:x-small">AUSSIAN</span>, and  T<span style="font-size:x-small">URBOMOLE</span> interfaces can do this). The keyword <b><tt>theodore_step</tt></b> can be used to calculate these descriptors only every n-th time step. 
<div class="p"><!----></div>
The  T<span style="font-size:x-small">HEO</span>DORE descriptors are treated as one 1D property vector for each descriptor, and <b><tt>n_property1d</tt></b> should be at least as large as the number of descriptors computed by the interface.
<div class="p"><!----></div>
<b>Output control&nbsp;&nbsp;</b>
<div class="p"><!----></div>
There are a number of keywords which control what information is written to the <b><tt>output.dat</tt></b> file.
These keywords are <b><tt>write_grad</tt></b>, <b><tt>write_nacdr</tt></b>, <b><tt>write_overlap</tt></b>, <b><tt>write_property1d</tt></b>, and <b><tt>write_property2d</tt></b> (and the inverse of each one, e.g., <b><tt>nowrite_grad</tt></b>).
Only <b><tt>write_overlap</tt></b> is activated by default, because it does not enlarge the data file by much, and contains important information which is read by <b><tt>data_extractor.x</tt></b>.
<b><tt>write_grad</tt></b> and <b><tt>write_nacdr</tt></b> are turned off by default; they are primarily intended for users who want to keep all quantum chemical data, e.g., for training in machine learning.
The keywords <b><tt>write_property1d</tt></b> and <b><tt>write_property2d</tt></b> are automatically activated if <b><tt>theodore</tt></b> or <b><tt>ionization</tt></b> (respectively) are activated.
<div class="p"><!----></div>
     <a id="tth_sEc4.1.4"></a><h3>
4.1.4&nbsp;&nbsp;Example</h3>
<div class="p"><!----></div>
The following input sample shows a typical input for excited-state dynamics including IC within a singlet manifold plus intersystem crossing to triplet states. It includes a large number of excited singlet states in order to calculate transient absorption spectra. Only the lowest three singlet states actually participate in the dynamics. 
<div class="p"><!----></div>
<pre>
nstates&nbsp;&nbsp;&nbsp;8&nbsp;0&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;many&nbsp;singlet&nbsp;states&nbsp;for&nbsp;transient&nbsp;absorption
actstates&nbsp;3&nbsp;0&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;only&nbsp;few&nbsp;states&nbsp;to&nbsp;reduce&nbsp;gradient&nbsp;costs
stepsize&nbsp;0.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;typical&nbsp;time&nbsp;step&nbsp;for&nbsp;a&nbsp;molecule&nbsp;containing&nbsp;H
tmax&nbsp;1000.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;one&nbsp;picosecond
surf&nbsp;diagonal
state&nbsp;3&nbsp;mch&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;start&nbsp;on&nbsp;the&nbsp;S2&nbsp;singlet&nbsp;state
coeff&nbsp;auto&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;coefficient&nbsp;of&nbsp;S2&nbsp;will&nbsp;be&nbsp;set&nbsp;to&nbsp;one
coupling&nbsp;overlap&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;\
decoherence_scheme&nbsp;edc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;|&nbsp;typical&nbsp;settings
ekincorrect&nbsp;parallel_vel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;|
gradcorrect&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;/
grad_select&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;\
nac_select&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;|&nbsp;improve&nbsp;performance
eselect&nbsp;0.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;/
veloc&nbsp;external&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;velocities&nbsp;come&nbsp;from&nbsp;file&nbsp;"veloc"
velocfile&nbsp;"veloc"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#
RNGseed&nbsp;65435
ezero&nbsp;-399.41494751&nbsp;&nbsp;&nbsp;#&nbsp;ground&nbsp;state&nbsp;energy&nbsp;of&nbsp;molecule
</pre>
<div class="p"><!----></div>
 <a id="tth_sEc4.2"></a><h2>
4.2&nbsp;&nbsp;Geometry file</h2><a id="sec:geomfile">
</a>
<div class="p"><!----></div>
The geometry file (default file name is <b><tt>geom</tt></b>) contains the initial coordinates of all atoms. This file must be present when starting a new trajectory.
<div class="p"><!----></div>
The format is based on the <a href="http://www.univie.ac.at/columbus/docs_COL70/documentation_main.html"> C<span style="font-size:x-small">OLUMBUS</span> geometry file format</a> (however,  S<span style="font-size:x-small">HARC</span>&nbsp;is more flexible with the formatting of the numbers). For each atom, the file contains one line, giving the chemical symbol (a string), the atomic number (a real number), the x, y and z coordinates of the atom in Bohrs (three real numbers), and the relative atomic weight of the atom (a real number). The six items must be separated by spaces. The real numbers are read in using Fortran list-directed I/O, and hence are free format (can have any numbers of decimals, exponential notation, etc.). Element symbols can have at most 2 characters.
<div class="p"><!----></div>
The following is an example of a <b><tt>geom</tt></b> file for CH2:
<pre>
C&nbsp;6.0&nbsp;&nbsp;0.0&nbsp;0.0&nbsp;&nbsp;0.0&nbsp;12.000
H&nbsp;1.0&nbsp;&nbsp;1.7&nbsp;0.0&nbsp;-1.2&nbsp;&nbsp;1.008
H&nbsp;1.0&nbsp;&nbsp;1.7&nbsp;0.0&nbsp;&nbsp;3.7&nbsp;&nbsp;1.008
</pre>
<div class="p"><!----></div>
 <a id="tth_sEc4.3"></a><h2>
4.3&nbsp;&nbsp;Velocity file</h2><a id="sec:velocfile">
</a>
<div class="p"><!----></div>
The velocity file (default <b><tt>veloc</tt></b>) contains the initial nuclear velocities (e.g., from a Wigner distribution sampling). This file is optional (the velocities can be initialized with the <b><tt>veloc</tt></b> input keyword). 
<div class="p"><!----></div>
The file contains one line of input for each atom, where the order of atoms must be the same as in the <b><tt>geom</tt></b> file. Each line consists of three items, separated by spaces, where the first is the x component of the nuclear velocity, followed by the y and z components (three real numbers). The input is interpreted in atomic units (Bohr/atu).
<div class="p"><!----></div>
The following is an example of a <b><tt>veloc</tt></b> file:
<pre>
&nbsp;0.0001&nbsp;&nbsp;0.0000&nbsp;&nbsp;0.0002
&nbsp;0.0002&nbsp;&nbsp;0.0000&nbsp;&nbsp;0.0012
&nbsp;0.0003&nbsp;&nbsp;0.0000&nbsp;-0.0007
</pre>
<div class="p"><!----></div>
 <a id="tth_sEc4.4"></a><h2>
4.4&nbsp;&nbsp;Coefficient file</h2><a id="sec:coefffile">
</a>
<div class="p"><!----></div>
The coefficient file contains the initial wave function coefficients. The file contains one line per state (total number of states, i.e., multiplets count multiple times). Each line specifies the initial coefficient of one state. If the initial state is specified in the MCH representation (input keyword <b><tt>state</tt></b>), then the order of the initial coefficients must be as given by the canonical ordering (see section&nbsp;<a href="#met:ordering">8.24</a>). If the initial state is given in diagonal representation, then the initial coefficients correspond to the states given in energetic ordering, starting with the lowest state.
Each line contains two real numbers, giving first the real and then the imaginary part of the initial coefficient of the respective state.
Note that after read-in, the coefficient vector is normalized to one.
<div class="p"><!----></div>
Example:
<pre>
0.0&nbsp;0.0
1.0&nbsp;0.0
0.0&nbsp;0.0
</pre>
<div class="p"><!----></div>
 <a id="tth_sEc4.5"></a><h2>
4.5&nbsp;&nbsp;Laser file</h2><a id="sec:laserfile">
</a>
<div class="p"><!----></div>
The laser file contains a table with the amplitude of the laser field &#1013;(t) at each time step of the <i>electronic</i> propagation. Given a laser field of the general form:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-0.png">
</td><td width="1%">(4.1)</td></tr></table>
each line consists of 8 elements: t (in fs), &#8476;(&#1013;<sub>x</sub>(t)), &#8465;(&#1013;<sub>x</sub>(t)), &#8476;(&#1013;<sub>y</sub>(t)), &#8465;(&#1013;<sub>y</sub>(t)), &#8476;(&#1013;<sub>z</sub>(t)), &#8465;(&#1013;<sub>z</sub>(t)), (all in atomic units), and finally the instantaneous central frequency (also atomic units).
<div class="p"><!----></div>
The time step in the laser file must exactly match the time step used for the electronic propagation, which is the time step used for the nuclear propagation (keyword <b><tt>stepsize</tt></b>) divided by the number of substeps (keyword <b><tt>nsubsteps</tt></b>). The first line of the laser file must correspond to t=0 fs.
<div class="p"><!----></div>
Example:
<pre>
0.00E+00&nbsp;-0.68E-03&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.31E+00
0.10E-02&nbsp;-0.77E-02&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.33E+00
0.20E-02&nbsp;-0.13E-01&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.00E+00&nbsp;&nbsp;0.35E+00
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...
</pre>
<div class="p"><!----></div>
 <a id="tth_sEc4.6"></a><h2>
4.6&nbsp;&nbsp;Atom mask file</h2><a id="sec:atommaskfile">
</a>
<div class="p"><!----></div>
The atom mask file contains for each atom a line with a Boolean entry ("T" or "F"), which indicates whether the atom should be considered in the relevant procedures. Specifically, the atom masking settings affect the options <b><tt>ekincorrect parallel_vel</tt></b>, <b><tt>reflect_frustrated parallel_vel</tt></b>, and <b><tt>decoherence_scheme edc</tt></b>.
In all cases, "T" indicates that the atom should be considered (as if <b><tt>atommask</tt></b> was not given), whereas "F" indicates that the atom should be ignored for these procedures.
<div class="p"><!----></div>
Example:
<pre>
&nbsp;T
&nbsp;T
&nbsp;F
&nbsp;F
...
</pre>
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_chAp5"></a><h1>
Chapter 5 Output files</h1><a id="chap:output">
</a>
<div class="p"><!----></div>
This chapter documents the content of the output files of  S<span style="font-size:x-small">HARC</span>. Those output files are <b><tt>output.log</tt></b>, <b><tt>output.lis</tt></b>, <b><tt>output.dat</tt></b> and <b><tt>output.xyz</tt></b>.
<div class="p"><!----></div>
 <a id="tth_sEc5.1"></a><h2>
5.1&nbsp;&nbsp;Log file</h2><a id="sec:logfile">
</a>
<div class="p"><!----></div>
The log file <b><tt>output.log</tt></b> contains general information about all steps of the  S<span style="font-size:x-small">HARC</span>&nbsp;simulation, e.g., about the parsing of the input files, results of quantum chemistry calls, internal matrices and vectors, etc. The content of the log file can be controlled with the keyword <b><tt>printlevel</tt></b> in the  S<span style="font-size:x-small">HARC</span>&nbsp;main input file.
<div class="p"><!----></div>
In the following, all printlevels are explained.
<div class="p"><!----></div>
<b>Printlevel 0&nbsp;&nbsp;</b>
<div class="p"><!----></div>
At printlevel 0, only the execution infos (date, host and working directory at execution start) and build infos (compiler, compile date, building host and working directory) are given.
<div class="p"><!----></div>
<b>Printlevel 1&nbsp;&nbsp;</b>
<div class="p"><!----></div>
At printlevel 1, also the content of the input file (cleaned of comments and blank lines) is echoed in the log file. Also, the start of each time step is given.
<div class="p"><!----></div>
<b>Printlevel 2&nbsp;&nbsp;</b>
<div class="p"><!----></div>
At printlevel 2, the log file also contains information about the parsing of the input files (echoing all enabled options, initial geometry, velocity and coefficients, etc.) and about the initialization of the coefficients after the first quantum chemistry calculation. This printlevel is recommended for production calculations, since it is the highest printlevel where no output per time step is written to the log file.
<div class="p"><!----></div>
<b>Printlevel 3&nbsp;&nbsp;</b>
<div class="p"><!----></div>
This and higher printlevels add output per time step to the log file. At printlevel 3, the log file contains at each time step the data from the velocity-Verlet algorithm (old and new acceleration, velocity and geometry), the old and new coefficients, the surface hopping probabilities and random number, the occupancies before and after decoherence correction as well as the kinetic, potential and total energies.
<div class="p"><!----></div>
<b>Printlevel 4&nbsp;&nbsp;</b>
<div class="p"><!----></div>
At printlevel 4, additionally the log file contains information on the quantum chemistry calls (file names, which quantities were read, gradient and nonadiabatic coupling vector selection) and the propagator matrix.
<div class="p"><!----></div>
<b>Printlevel 5&nbsp;&nbsp;</b>
<div class="p"><!----></div>
At printlevel 5, additionally the log file contains the results of each quantum chemistry calls (all matrices and vectors), all matrices involved in the propagation as well as the matrices involved in the gradient transformation. This is the highest printlevel currently implemented.
<div class="p"><!----></div>
 <a id="tth_sEc5.2"></a><h2>
5.2&nbsp;&nbsp;Listing file</h2><a id="sec:lisfile">
</a>
<div class="p"><!----></div>
The listing file <b><tt>output.lis</tt></b> is a tabular summary of the progress of the dynamics simulation. At the end of each time step (including the initial time step), one line with 11 elements is printed. These are, from left to right:
<ol type="1">
<li> current step (counting starts at zero for the initial step),
<div class="p"><!----></div>
</li>
<li> current simulation time (fs),
<div class="p"><!----></div>
</li>
<li> current state in the diagonal representation,
<div class="p"><!----></div>
</li>
<li> approximate corresponding MCH state (see subsection&nbsp;<a href="#ssec:state_transform">8.19.1</a>),
<div class="p"><!----></div>
</li>
<li> kinetic energy (eV),
<div class="p"><!----></div>
</li>
<li> potential energy (eV),
<div class="p"><!----></div>
</li>
<li> total energy (eV),
<div class="p"><!----></div>
</li>
<li> current gradient norm (in eV/&#197;),
<div class="p"><!----></div>
</li>
<li> current expectation values of the state dipole moment (Debye),
<div class="p"><!----></div>
</li>
<li> current expectation values of total spin,
<div class="p"><!----></div>
</li>
<li> wallclock time needed for the time step.
<div class="p"><!----></div>
</li>
</ol>
The listing file also contains one extra line for each surface hopping event. For accepted hops, the old and new states (in diagonal representation) and the random number are given. Frustrated hops and resonant hops are also mentioned. Note that the extra line for surface hopping occurs before the regular line for the time step. 
<div class="p"><!----></div>
The listing file can be plotted with standard tools like  G<span style="font-size:x-small">NUPLOT</span> and can be read with <b><tt>data_collector.py</tt></b>. 
<div class="p"><!----></div>
<b>Energies&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The kinetic energy is calculated at the end of each time step (i.e., after surface hopping events and the corresponding adjustments). The potential energy is the energy of the currently active diagonal state. The total energy is the sum of those two.
<div class="p"><!----></div>
<b>Expectation values&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The gradient norms given in the listing file is calculated as follows:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-1.png">
</td><td width="1%">(5.1)</td></tr></table>
which is then transformed to eV/&#197;.
<div class="p"><!----></div>
The expectation values of the dipole moment for the active state &#946; is calculated from:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-2.png">
</td><td width="1%">(5.2)</td></tr></table>
<div class="p"><!----></div>
The expectation value of the total spin of the active state &#946; is calculated as follows:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-3.png">
</td><td width="1%">(5.3)</td></tr></table>
where S<sub>&#945;</sub> is the total spin of the MCH state with index &#945;.
<div class="p"><!----></div>
 <a id="tth_sEc5.3"></a><h2>
5.3&nbsp;&nbsp;Data file</h2><a id="sec:datfile">
</a>
<div class="p"><!----></div>
The data file <b><tt>output.dat</tt></b> contains all relevant data from the simulation for all time steps, in ASCII format. Accordingly, this file can become quite large for long trajectories or if many states are included, but for most file systems it is easier to deal with a single large file than with many small files.
<div class="p"><!----></div>
Usually, after the simulation is finished the data file is processed by <b><tt>data_extractor.x</tt></b> to obtain a number of tabular files which can be plotted or post-processed (e.g., with <b><tt>data_collector.py</tt></b>). For this, see sections&nbsp;<a href="#sec:diagonalizer.x">7.25</a> for the data extractor, <a href="#sec:make_gnuscript.py">7.11</a> for plotting, and <a href="#sec:data_collector.py">7.21</a> for post-processing.
<div class="p"><!----></div>
     <a id="tth_sEc5.3.1"></a><h3>
5.3.1&nbsp;&nbsp;Specification of the data file</h3>
<div class="p"><!----></div>
The data file format was changed from the first release version of  S<span style="font-size:x-small">HARC</span>. The new format uses a different header, which is keyword-based (like the <b><tt>input</tt></b> file) and starts with <b><tt>SHARC_version 2.0</tt></b>. The general structure of the time step data is the same as in the first release version.
<div class="p"><!----></div>
The data file contains a short header followed by the data per time step. All quantities are commented in the data file.
<div class="p"><!----></div>
The header is keyword-based and contains at least the following entries:
<ol type="1">
<li> number of states per multiplicity,
<div class="p"><!----></div>
</li>
<li> number of atoms,
<div class="p"><!----></div>
</li>
<li> number of 1D properties,
<div class="p"><!----></div>
</li>
<li> number of 2D properties,
<div class="p"><!----></div>
</li>
<li> time step,
<div class="p"><!----></div>
</li>
<li> <b><tt>write_overlap</tt></b>,
<div class="p"><!----></div>
</li>
<li> <b><tt>write_grad</tt></b>,
<div class="p"><!----></div>
</li>
<li> <b><tt>write_nacdr</tt></b>,
<div class="p"><!----></div>
</li>
<li> <b><tt>write_property1d</tt></b>,
<div class="p"><!----></div>
</li>
<li> <b><tt>write_property2d</tt></b>,
<div class="p"><!----></div>
</li>
<li> information whether a laser field is included.
<div class="p"><!----></div>
</li>
</ol>
<div class="p"><!----></div>
At the end of the header, the data file contains a header array section. Currently, this includes:
<ol type="1">
<li> atomic numbers,
<div class="p"><!----></div>
</li>
<li> elements,
<div class="p"><!----></div>
</li>
<li> masses,
<div class="p"><!----></div>
</li>
<li> full laser field for all substeps (only if flag is set).
<div class="p"><!----></div>
</li>
</ol>
<div class="p"><!----></div>
The entry for each time step contains:
<ol type="1">
<li> step index
<div class="p"><!----></div>
</li>
<li> Hamiltonian in MCH representation,
<div class="p"><!----></div>
</li>
<li> transformation matrix <b>U</b>,
<div class="p"><!----></div>
</li>
<li> MCH dipole moment matrices (x, y, z),
<div class="p"><!----></div>
</li>
<li> overlap matrix in MCH representation (only if flag is set),
<div class="p"><!----></div>
</li>
<li> coefficients in the diagonal representation,
<div class="p"><!----></div>
</li>
<li> hopping probablities in the diagonal representation
<div class="p"><!----></div>
</li>
<li> kinetic energy,
<div class="p"><!----></div>
</li>
<li> currently active state in diagonal representation and approximate state in MCH representation,
<div class="p"><!----></div>
</li>
<li> random number for surface hopping,
<div class="p"><!----></div>
</li>
<li> wallclock time (in seconds)
<div class="p"><!----></div>
</li>
<li> geometry (Bohrs),
<div class="p"><!----></div>
</li>
<li> velocities (atomic units),
<div class="p"><!----></div>
</li>
<li> 2D property matrices (only if flag is set),
<div class="p"><!----></div>
</li>
<li> 1D property vectors (only if flag is set),
<div class="p"><!----></div>
</li>
<li> gradient vectors (only if flag is set),
<div class="p"><!----></div>
</li>
<li> nonadiabatic coupling vectors (only if flag is set).
<div class="p"><!----></div>
</li>
</ol>
<div class="p"><!----></div>
 <a id="tth_sEc5.4"></a><h2>
5.4&nbsp;&nbsp;XYZ file</h2><a id="sec:xyzfile">
</a>
<div class="p"><!----></div>
The file <b><tt>output.xyz</tt></b> contains the geometries of all time steps in standard xyz file format. It can be used with visualization programs like  M<span style="font-size:x-small">OLDEN</span>,  G<span style="font-size:x-small">ABEDIT</span> or  M<span style="font-size:x-small">OLEKEL</span> to create movies of the molecular motion, or with <b><tt>geo.py</tt></b> (see&nbsp;<a href="#sec:geo.py">7.18</a>) to calculate internal coordinates for each time step. Furthermore, <b><tt>trajana_nma.py</tt></b> (see&nbsp;<a href="#sec:trajana_nma.py">7.20</a>) and <b><tt>trajana_essdyn.py</tt></b> (see&nbsp;<a href="#sec:trajana_essdyn.py">7.19</a>) read this file.
<div class="p"><!----></div>
The comments of the geometries (given in the second line of each geometry block) contain information about the simulation time and the active state (first in diagonal basis, then in MCH basis).
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_chAp6"></a><h1>
Chapter 6 Interfaces</h1><a id="chap:interfaces">
</a>
<div class="p"><!----></div>
This chapter describes the interface between  S<span style="font-size:x-small">HARC</span>&nbsp;and quantum chemistry programs. In the first section, the interface is specified (e.g., for users who attempt to create their own interfaces). The description of the currently existing interfaces takes the remainder of this chapter.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc6.1"></a><h2>
6.1&nbsp;&nbsp;Interface Specifications</h2>
<div class="p"><!----></div>
From the  S<span style="font-size:x-small">HARC</span>&nbsp;point of view, quantum chemical calculation proceeds as follows in the <b><tt>QM</tt></b> directory:
<ol type="1">
<li> write a file called <b><tt>QM/QM.in</tt></b>
<div class="p"><!----></div>
</li>
<li> call a script called <b><tt>QM/runQM.sh</tt></b>
<div class="p"><!----></div>
</li>
<li> read the output from a file called <b><tt>QM/QM.out</tt></b>
<div class="p"><!----></div>
</li>
</ol>
For specifications of the formats of these two files (<b><tt>QM.in</tt></b> and <b><tt>QM.out</tt></b>) see below. The executable script <b><tt>QM/runQM.sh</tt></b> must accomplish that all necessary quantum chemical output is available in <b><tt>QM/QM.out</tt></b>.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_fIg6.1">
</a>   <div style="text-align:center">  <img src="http://sharc-md.org/wp-content/uploads/2018/02/general.png">  
<div style="text-align:center">Figure 6.1: Communication between <b><tt>sharc.x</tt></b>, the interfaces, and the quantum chemistry codes.</div>
  <a id="fig:interface_general">
</a>
</div>
<div class="p"><!----></div>
     <a id="tth_sEc6.1.1"></a><h3>
6.1.1&nbsp;&nbsp;<b><tt>QM.in</tt></b> Specification</h3><a id="intf:qmin">
</a>
<div class="p"><!----></div>
The <b><tt>QM.in</tt></b> file is written by  S<span style="font-size:x-small">HARC</span>&nbsp;every time a quantum chemistry calculation is necessary. It contains all information available to  S<span style="font-size:x-small">HARC</span>. This information includes the current geometry (and velocity), the time step, the number of states, the time step and the unit used to specify the atomic coordinates. The file also contains <i>control</i> keywords and <i>request</i> keywords. 
<div class="p"><!----></div>
The file format is consistent with a standard xyz file. The first line contains the number of atoms, the second line is a comment.  S<span style="font-size:x-small">HARC</span>&nbsp;writes the trajectory ID (a hash of all  S<span style="font-size:x-small">HARC</span>&nbsp;input files) to this line. The following lines specify the atom positions. As a fourth, fifth and sixth column, these lines may contain the atomic velocities.
All following lines contain keywords, one per line and possibly with arguments. Comments can be inserted with '#', and empty lines are permitted. Comments and empty lines are only permitted below the xyz file part.
An examplary <b><tt>QM.in</tt></b> file is given in the following:
<pre>
3
Jobname
S&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;&nbsp;0.000&nbsp;&nbsp;-0.020&nbsp;&nbsp;&nbsp;0.002
H&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.2&nbsp;&nbsp;&nbsp;&nbsp;0.000&nbsp;&nbsp;-0.030&nbsp;&nbsp;&nbsp;0.000
H&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;&nbsp;-0.9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.2&nbsp;&nbsp;&nbsp;&nbsp;0.000&nbsp;&nbsp;&nbsp;0.010&nbsp;&nbsp;-0.000
#&nbsp;This&nbsp;is&nbsp;a&nbsp;comment
Init
States&nbsp;3&nbsp;0&nbsp;2
Unit&nbsp;Angstrom
SOC
DM
GRAD&nbsp;1&nbsp;2
OVERLAP
NACDR&nbsp;select
&nbsp;&nbsp;1&nbsp;2
&nbsp;&nbsp;end
</pre>
<div class="p"><!----></div>
There exist two types of keywords, <i>control</i> keywords and <i>request</i> keywords. Control keywords pass some information to the interface. Request keywords tell the interface to provide a quantity in the <b><tt>QM.out</tt></b> file. Table&nbsp;<a href="#tab:int_ctrl"> 6.1</a> contains all control keywords while table&nbsp;<a href="#tab:int_req"> 6.2</a> lists all request keywords.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb6.1">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 6.1: Control keywords for  S<span style="font-size:x-small">HARC</span>&nbsp;interfaces. These keywords pass information from  S<span style="font-size:x-small">HARC</span>&nbsp;to the interface.</div>
  <a id="tab:int_ctrl">
</a>
<table>
<tr><td align="left">Keyword       </td><td align="left">Description</td></tr>
<tr><td align="left">init            </td><td align="left">Specifies that this is the first calculation. The interface should create a save directory (if not existing already) to save all information necessary for a restart. </td></tr>
<tr><td align="left">samestep        </td><td align="left">Specifies that this is an additional calculation at the same geometry/time step. Implies that, e.g., the converged orbitals from the savedir could be reused or that the wave function calculations could be skipped.</td></tr>
<tr><td align="left">restart         </td><td align="left">Specifies that this is a calculation after a restart of <b><tt>sharc.x</tt></b>, possibly after a crash. Implies that in the savedir some files might be incomplete, the interface should therefore act as if a new step is requested, except that the savedir files should be managed accordingly.</td></tr>
<tr><td align="left">cleanup         </td><td align="left">Specifies that all output files of the interface (except <b><tt>QM.out</tt></b>) should be deleted (including the save directory).</td></tr>
<tr><td align="left">backup          </td><td align="left">Specifies that the content of the save directory should be stored in a persistent location (such that it is not overwritten in the next time step).</td></tr>
<tr><td align="left">unit            </td><td align="left">Specifies in which unit the atomic coordinates are to be interpreted. Possible arguments are "angstrom" and "bohr".</td></tr>
<tr><td align="left">states          </td><td align="left">Gives the number of excited states per multiplicity (singlets, doublet, triplets, ...).</td></tr>
<tr><td align="left">dt              </td><td align="left">Gives the time between the last calculation and the current calculation in atomic units.</td></tr>
<tr><td align="left">savedir         </td><td align="left">Gives a path to the directory where the interface should save files needed for restart and between time steps. If the interface-specific input files also have this keyword,  S<span style="font-size:x-small">HARC</span>&nbsp;assumes that the path in <b><tt>QM.in</tt></b> takes precedence.</td></tr></table>
</div>
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb6.2">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 6.2: Request keywords for  S<span style="font-size:x-small">HARC</span>&nbsp;interfaces. See Table&nbsp;<a href="#tab:interfaces"> 6.3</a> for which interfaces can fulfill these requests.</div>
  <a id="tab:int_req">
</a>
<table>
<tr><td align="left">Keyword       </td><td align="left">Description</td></tr>
<tr><td align="left">H               </td><td align="left">Calculate the molecular Hamiltonian (diagonal matrix with the energies of the states of the model space). This request is always available.</td></tr>
<tr><td align="left">SOC             </td><td align="left">Calculate the molecular Hamiltonian including the SOCs (not diagonal anymore within the model space).</td></tr>
<tr><td align="left">DM              </td><td align="left">Calculate the state dipole moments and transition dipole moments between all states.</td></tr>
<tr><td align="left">GRAD            </td><td align="left">Calculate gradients for all states. If followed by a list of states, calculate only gradients for the specified states.</td></tr>
<tr><td align="left">NACDT           </td><td align="left">Calculate the time-derivatives &#9001;&#936;<sub>1</sub>&#124;&#8706;/&#8706;t&#124;&#936;<sub>2</sub>&#9002; by finite differences between the last time step and the current time step. This request is currently not supported by any interface.</td></tr>
<tr><td align="left">NACDR           </td><td align="left">Calculate nonadiabatic coupling vectors &#9001;&#936;<sub>1</sub>&#124;&#8706;/&#8706;<b>R</b>&#124;&#936;<sub>2</sub>&#9002; between all pairs of states. If followed by "select", read the list of pairs on the following lines until "end" and calculate nonadiabatic coupling vectors between the specified pairs of states.</td></tr>
<tr><td align="left">OVERLAP         </td><td align="left">Calculate overlaps &#9001;&#936;<sub>1</sub>(t<sub>0</sub>)&#124;&#936;<sub>2</sub>(t)&#9002; between all pairs of states (between the last and current time step). If followed by "select", read the list of pairs on the following lines until "end" and calculate overlaps between the specified pairs of states.</td></tr>
<tr><td align="left">DMDR            </td><td align="left">Calculate the Cartesian gradients of the dipole moments and transition dipole moments of all states.</td></tr>
<tr><td align="left">ION             </td><td align="left">Calculate transition properties between neutral and ionic wave functions.</td></tr>
<tr><td align="left">THEODORE        </td><td align="left">Run  T<span style="font-size:x-small">HEO</span>DORE to compute electronic descriptors for all states.</td></tr>
<tr><td align="left">MOLDEN          </td><td align="left">Generate  M<span style="font-size:x-small">OLDEN</span> files of the relevant orbitals and copy them to the savedir.</td></tr></table>
</div>
<div class="p"><!----></div>
     <a id="tth_sEc6.1.2"></a><h3>
6.1.2&nbsp;&nbsp;<b><tt>QM.out</tt></b> Specification</h3><a id="intf:qmout">
</a>
<div class="p"><!----></div>
The <b><tt>QM.out</tt></b> file communicates back the results of the quantum chemistry calculation to the dynamics code. After  S<span style="font-size:x-small">HARC</span>&nbsp;called <b><tt>QM/runQM.sh</tt></b>, it expects that the file <b><tt>QM/QM.out</tt></b> exists and contains the relevant data.
<div class="p"><!----></div>
The following quantities are expected in the file (depending whether the corresponding keyword is in the <b><tt>QM.in</tt></b> file): Hamiltonian matrix, dipole matrices, gradients, nonadiabatic couplings (either NACDR or NACDT), overlaps, wave function phases, property matrices. The format of <b><tt>QM.out</tt></b> is described in the following. 
<div class="p"><!----></div>
Each quantity is given as a data block, which has a fixed format. The order of the blocks is arbitrary, and between blocks arbitrary lines can be written. However, within a block no extraneous lines are allowed. Each data block starts with a exclamation mark <b><tt>!</tt></b>, followed by whitespace and an integer flag which specifies the type of data:
<div class="p"><!----></div>
<table>
<tr><td align="left">1       </td><td align="left">Hamiltonian matrix</td></tr>
<tr><td align="left">2       </td><td align="left">Dipole matrices</td></tr>
<tr><td align="left">3       </td><td align="left">Gradients</td></tr>
<tr><td align="left">4       </td><td align="left">Non-adiabatic couplings (NACDT)</td></tr>
<tr><td align="left">5       </td><td align="left">Non-adiabatic couplings (NACDR)</td></tr>
<tr><td align="left">6       </td><td align="left">Overlap matrix</td></tr>
<tr><td align="left">7       </td><td align="left">Wavefunction phases</td></tr>
<tr><td align="left">8       </td><td align="left">Wallclock time for QM calculation</td></tr>
<tr><td align="left">11      </td><td align="left">Property matrix (e.g., ionization probabilities) &nbsp;&nbsp;&nbsp; <b>this flag is deprecated</b></td></tr>
<tr><td align="left">12      </td><td align="left">Dipole moment gradients</td></tr>
<tr><td align="left">20      </td><td align="left">Property matrices with number and labels (e.g., ionization probabilities)</td></tr>
<tr><td align="left">21      </td><td align="left">Property vectors with number and labels (e.g.,  T<span style="font-size:x-small">HEO</span>DORE output)
</td></tr></table>
<div class="p"><!----></div>
On the next line, two integers are expected giving the dimensions of the following matrix. Note, that all these matrices must be square matrices. On the following lines, the matrix or vector follows. Matrices are in general complex, and real and imaginary part of each element is given as a pair of floating point numbers.
<div class="p"><!----></div>
The following shows an example of a 4&times;4 Hamiltonian matrix. Note that the imaginary parts directly follow the real parts (in this example, the Hamiltonian is real).
<pre>
&nbsp;&nbsp;!&nbsp;1
&nbsp;&nbsp;4&nbsp;4
&nbsp;-548.6488&nbsp;0.0000&nbsp;&nbsp;&nbsp;&nbsp;0.0000&nbsp;0.0000&nbsp;&nbsp;&nbsp;&nbsp;0.0003&nbsp;0.0000&nbsp;&nbsp;&nbsp;&nbsp;0.0003&nbsp;0.0000
&nbsp;&nbsp;&nbsp;&nbsp;0.0000&nbsp;0.0000&nbsp;-548.6170&nbsp;0.0000&nbsp;&nbsp;&nbsp;&nbsp;0.0003&nbsp;0.0000&nbsp;&nbsp;&nbsp;&nbsp;0.0003&nbsp;0.0000
&nbsp;&nbsp;&nbsp;&nbsp;0.0003&nbsp;0.0000&nbsp;&nbsp;&nbsp;&nbsp;0.0003&nbsp;0.0000&nbsp;-548.5986&nbsp;0.0000&nbsp;&nbsp;&nbsp;&nbsp;0.0000&nbsp;0.0000
&nbsp;&nbsp;&nbsp;&nbsp;0.0003&nbsp;0.0000&nbsp;&nbsp;&nbsp;&nbsp;0.0003&nbsp;0.0000&nbsp;&nbsp;&nbsp;&nbsp;0.0000&nbsp;0.0000&nbsp;-548.5912&nbsp;0.0000
</pre>
<div class="p"><!----></div>
The three dipole moment matrices (x, y and z polarization) must follow directly after each other, where the dimension specifier must be present for each matrix. The dipole matrices are also expected to be complex-valued.
<pre>
&nbsp;&nbsp;!&nbsp;2
&nbsp;&nbsp;2&nbsp;2
&nbsp;&nbsp;0.1320&nbsp;0.0000&nbsp;-0.0020&nbsp;0.0000
&nbsp;-0.0020&nbsp;0.0000&nbsp;-1.1412&nbsp;0.0000
&nbsp;&nbsp;2&nbsp;2
&nbsp;&nbsp;0.0000&nbsp;0.0000&nbsp;&nbsp;0.0000&nbsp;0.0000
&nbsp;&nbsp;0.0000&nbsp;0.0000&nbsp;&nbsp;0.0000&nbsp;0.0000
&nbsp;&nbsp;2&nbsp;2
&nbsp;&nbsp;2.1828&nbsp;0.0000&nbsp;&nbsp;0.0000&nbsp;0.0000
&nbsp;&nbsp;0.0000&nbsp;0.0000&nbsp;&nbsp;0.6422&nbsp;0.0000
</pre>
<div class="p"><!----></div>
Gradient and nonadiabatic couplings vectors are written as 3&times;n<sub>atom</sub> matrices, with the x, y and z components of one atom per line. These vectors are expected to be real valued. Each vector is preceeded by its dimensions.
<pre>
6&nbsp;3&nbsp;
&nbsp;0.0000&nbsp;-6.5429&nbsp;-8.1187
&nbsp;0.0000&nbsp;&nbsp;5.8586&nbsp;&nbsp;8.0160
&nbsp;0.0000&nbsp;&nbsp;6.8428&nbsp;&nbsp;1.0265
&nbsp;0.0000&nbsp;&nbsp;6.5429&nbsp;&nbsp;8.1187
&nbsp;0.0000&nbsp;-5.8586&nbsp;-8.0160
&nbsp;0.0000&nbsp;-6.8428&nbsp;-1.0265
</pre>
If gradients are requested,  S<span style="font-size:x-small">HARC</span>&nbsp;expects every gradient to be present, even if only some gradients are requested. The gradients are expected in the canonical ordering (see section&nbsp;<a href="#met:ordering">8.24</a>), which implies that for higher multiplets the same gradient has to be present several times. For example, with 3 singlets and 3 triplets,  S<span style="font-size:x-small">HARC</span>&nbsp;expects 12 gradients in the <b><tt>QM.out</tt></b> file (each triplet has three components with M<sub>s</sub>= -1, 0 or 1).
<div class="p"><!----></div>
Similarly, for nonadiabatic coupling vectors,  S<span style="font-size:x-small">HARC</span>&nbsp;expects all pairs, even between states of different multiplicity. The vectors are also in canonical ordering, where the inner loop goes over the ket states. For example, with 3 singlets and 3 triplets (12 states),  S<span style="font-size:x-small">HARC</span>&nbsp;expects 144 (12<sup>2</sup>) nonadiabatic coupling vectors in the <b><tt>QM.out</tt></b> file.
<pre>
!&nbsp;5&nbsp;Non-adiabatic&nbsp;couplings&nbsp;(ddr)&nbsp;(2x2x1x3,&nbsp;real)
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;1&nbsp;ms1&nbsp;0&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;1&nbsp;ms2&nbsp;0
&nbsp;0.0e+0&nbsp;&nbsp;0.0e+0&nbsp;&nbsp;0.0e+0&nbsp;
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;1&nbsp;ms1&nbsp;0&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;2&nbsp;ms2&nbsp;0
+2.0e+0&nbsp;&nbsp;0.0e+0&nbsp;&nbsp;0.0e+0&nbsp;
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;2&nbsp;ms1&nbsp;0&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;1&nbsp;ms2&nbsp;0
-2.0e+0&nbsp;&nbsp;0.0e+0&nbsp;&nbsp;0.0e+0&nbsp;
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;2&nbsp;ms1&nbsp;0&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;2&nbsp;ms2&nbsp;0
&nbsp;0.0e+0&nbsp;&nbsp;0.0e+0&nbsp;&nbsp;0.0e+0&nbsp;
</pre>
<div class="p"><!----></div>
The nonadiabatic coupling matrix (NACDT keyword), the overlap matrix and the property matrix are single n&times;n matrices (n is the total number of states), respectively, like the Hamiltonian. 
<div class="p"><!----></div>
The wave function phases are a vector of complex numbers.
<div class="p"><!----></div>
The wallclock time is a single real number. 
<div class="p"><!----></div>
The dipole moment gradients are a list of 3&times;n<sub>atom</sub> vectors, each specifying the gradient of one polarization of one dipole moment matrix element. In the outmost loop, the bra index is counted, then the ket index, then the polarization. Hence, the respective entry in <b><tt>QM.out</tt></b> would look like (for 2 states and 1 atom):
<pre>
!&nbsp;12&nbsp;Dipole&nbsp;moment&nbsp;derivatives&nbsp;(2x2x3x1x3,&nbsp;real)
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;1&nbsp;ms1&nbsp;0&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;1&nbsp;ms2&nbsp;0&nbsp;&nbsp;&nbsp;pol&nbsp;0
&nbsp;0.000000000000E+00&nbsp;&nbsp;0.000000000000E+00&nbsp;&nbsp;0.000000000000E+00&nbsp;
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;1&nbsp;ms10&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;1&nbsp;ms2&nbsp;0&nbsp;&nbsp;pol&nbsp;1
&nbsp;0.000000000000E+00&nbsp;&nbsp;0.000000000000E+00&nbsp;&nbsp;0.000000000000E+00&nbsp;
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;1&nbsp;ms10&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;1&nbsp;ms2&nbsp;0&nbsp;&nbsp;pol&nbsp;2
&nbsp;0.000000000000E+00&nbsp;&nbsp;0.000000000000E+00&nbsp;&nbsp;0.000000000000E+00&nbsp;
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;1&nbsp;ms10&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;2&nbsp;ms2&nbsp;0&nbsp;&nbsp;pol&nbsp;0
&nbsp;1.000000000000E+00&nbsp;&nbsp;0.000000000000E+00&nbsp;&nbsp;0.000000000000E+00&nbsp;
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;1&nbsp;ms10&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;2&nbsp;ms2&nbsp;0&nbsp;&nbsp;pol&nbsp;1
&nbsp;0.000000000000E+00&nbsp;&nbsp;0.000000000000E+00&nbsp;&nbsp;0.000000000000E+00&nbsp;
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;1&nbsp;ms10&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;2&nbsp;ms2&nbsp;0&nbsp;&nbsp;pol&nbsp;2
&nbsp;0.000000000000E+00&nbsp;&nbsp;0.000000000000E+00&nbsp;&nbsp;0.000000000000E+00&nbsp;
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;2&nbsp;ms10&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;1&nbsp;ms2&nbsp;0&nbsp;&nbsp;pol&nbsp;0
&nbsp;1.000000000000E+00&nbsp;&nbsp;0.000000000000E+00&nbsp;&nbsp;0.000000000000E+00&nbsp;
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;2&nbsp;ms10&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;1&nbsp;ms2&nbsp;0&nbsp;&nbsp;pol&nbsp;1
&nbsp;0.000000000000E+00&nbsp;&nbsp;0.000000000000E+00&nbsp;&nbsp;0.000000000000E+00&nbsp;
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;2&nbsp;ms10&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;1&nbsp;ms2&nbsp;0&nbsp;&nbsp;pol&nbsp;2
&nbsp;0.000000000000E+00&nbsp;&nbsp;0.000000000000E+00&nbsp;&nbsp;0.000000000000E+00&nbsp;
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;2&nbsp;ms10&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;2&nbsp;ms2&nbsp;0&nbsp;&nbsp;pol&nbsp;0
&nbsp;0.000000000000E+00&nbsp;&nbsp;0.000000000000E+00&nbsp;&nbsp;0.000000000000E+00&nbsp;
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;2&nbsp;ms10&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;2&nbsp;ms2&nbsp;0&nbsp;&nbsp;pol&nbsp;1
&nbsp;0.000000000000E+00&nbsp;&nbsp;0.000000000000E+00&nbsp;&nbsp;0.000000000000E+00&nbsp;
1&nbsp;3&nbsp;!&nbsp;m1&nbsp;1&nbsp;s1&nbsp;2&nbsp;ms10&nbsp;&nbsp;&nbsp;m2&nbsp;1&nbsp;s2&nbsp;2&nbsp;ms2&nbsp;0&nbsp;&nbsp;pol&nbsp;2
&nbsp;0.000000000000E+00&nbsp;&nbsp;0.000000000000E+00&nbsp;&nbsp;0.000000000000E+00&nbsp;
</pre>
<div class="p"><!----></div>
The section containing the 2D property matrices consists of three subsequent parts: (i) the number of property matrices contained, (ii) a label for each property matrix (as the property matrices might contain arbitrary data, depending on the interface and the requests), and (iii) the matrices (full, complex-valued matrices like above):
<pre>
!&nbsp;20&nbsp;Property&nbsp;Matrices
2&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;number&nbsp;of&nbsp;property&nbsp;matrices
!&nbsp;Property&nbsp;Matrix&nbsp;Labels&nbsp;(1&nbsp;strings)
Dyson&nbsp;norms
Example&nbsp;matrix
!&nbsp;Property&nbsp;Matrices&nbsp;(1x4x4,&nbsp;complex)
4&nbsp;4&nbsp;&nbsp;&nbsp;!&nbsp;Dyson&nbsp;norms
&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;9.663E-01&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;9.663E-01&nbsp;&nbsp;0.000E+00&nbsp;
&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;4.822E-01&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;4.822E-01&nbsp;&nbsp;0.000E+00&nbsp;
&nbsp;9.663E-01&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;4.822E-01&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;
&nbsp;9.663E-01&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;4.822E-01&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;
4&nbsp;4&nbsp;&nbsp;&nbsp;!&nbsp;Example&nbsp;matrix
&nbsp;1.000E+00&nbsp;&nbsp;1.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;
&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;2.000E+00&nbsp;&nbsp;2.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;
&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;3.000E+00&nbsp;&nbsp;3.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;
&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;0.000E+00&nbsp;&nbsp;4.000E+00&nbsp;&nbsp;4.000E+00&nbsp;
</pre>
<div class="p"><!----></div>
The section containing the 1D property vectors also consists of three subsequent parts: (i) the number of property vectors contained, (ii) a label for each property vector (as the property vectors might contain arbitrary data, depending on the interface and the requests), and (iii) the vectors (real-valued):
<pre>
!&nbsp;21&nbsp;Property&nbsp;Vectors
2&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;number&nbsp;of&nbsp;property&nbsp;vectors
!&nbsp;Property&nbsp;Vector&nbsp;Labels&nbsp;(2&nbsp;strings)
Om
PRNTO
!&nbsp;Property&nbsp;Vectors&nbsp;(9x8,&nbsp;real)
!&nbsp;TheoDORE&nbsp;descriptor&nbsp;1&nbsp;(Om)
&nbsp;0.000000000000E+000
&nbsp;4.318700000000E-001
&nbsp;2.688600000000E-001
&nbsp;2.590000000000E-002
!&nbsp;TheoDORE&nbsp;descriptor&nbsp;2&nbsp;(PRNTO)
&nbsp;0.000000000000E+000
&nbsp;2.318700000000E-001
&nbsp;1.688600000000E-001
&nbsp;1.590000000000E-002
</pre>
<div class="p"><!----></div>
     <a id="tth_sEc6.1.3"></a><h3>
6.1.3&nbsp;&nbsp;Further Specifications</h3>
<div class="p"><!----></div>
The interfaces may require additional input files beyond <b><tt>QM.in</tt></b>, which contain static information. This may include paths to the quantum chemistry executable, paths to scratch directories, or input templates for the quantum chemistry calculation (e.g.&nbsp;active space specifications, basis sets, etc.).
The dynamics code does not depend on these additional files, but they should all be stored in the <b><tt>QM/</tt></b> subdirectory.
<div class="p"><!----></div>
The current conventions in the  S<span style="font-size:x-small">HARC</span>&nbsp;suite are that the quantum chemistry interfaces use two additional input files, one specifying the level of theory (template file, e.g., <b><tt>MOLCAS.template</tt></b>, <b><tt>MOLPRO.template</tt></b>, ...) and one specifying the computational resources like paths, memory, number of CPU cores, initial orbital source (resource file, e.g., <b><tt>MOLCAS.resources</tt></b>, <b><tt>MOLPRO.resources</tt></b>, ...).
Furthermore, the current interfaces allow to read in initial orbitals (e.g., <b><tt>MOLCAS.*.RasOrb.init</tt></b>, <b><tt>mocoef.init</tt></b>, ...).
For interfaces with QM/MM capabilities, additional files could be used to specify connection table, parameters, etc.
<div class="p"><!----></div>
     <a id="tth_sEc6.1.4"></a><h3>
6.1.4&nbsp;&nbsp;Save Directory Specification</h3>
<div class="p"><!----></div>
The interfaces must be able to save all information necessary for restart to a given directory. The absolute path is written to <b><tt>QM.in</tt></b> by  S<span style="font-size:x-small">HARC</span>. Hence, for the trajectories the path to the save directory is always a subdirectory of the working directory of  S<span style="font-size:x-small">HARC</span>.
<div class="p"><!----></div>
 <a id="tth_sEc6.2"></a><h2>
6.2&nbsp;&nbsp;Overview over Interfaces</h2><a id="sec:int:overview">
</a>
<div class="p"><!----></div>
The  S<span style="font-size:x-small">HARC</span>&nbsp;suite comes with a number of interfaces to different quantum chemistry programs.
Their capabilities and usage are explained in the following sections.
Table&nbsp;<a href="#tab:interfaces"> 6.3</a> gives an overview over the capabilities of the interfaces.
Table&nbsp;<a href="#tab:interface_files"> 6.4</a> shows the file names for interface-related input files of the different interfaces.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb6.3">
</a>       <div style="text-align:center">  <div style="text-align:center">Table 6.3: Overview over capabilities of  S<span style="font-size:x-small">HARC</span>&nbsp;interfaces. For each method and program, the table shows which multiplicities (S<sup>2</sup>), which quantities, and whether QM/MM are available.</div>
  <a id="tab:interfaces">
</a>
<table>
<tr><td align="left">Method      </td><td align="left">Program              </td><td align="center">S<sup>2</sup>   </td><td align="center">SOC         </td><td align="center">TDM<sup>a</sup>     </td><td align="center">Grad.       </td><td align="center">NACDR       </td><td align="center">OVL<sup>b</sup> </td><td align="center">DMDR     </td><td align="center">ION  </td><td align="center">Theo.<sup>c</sup>   </td><td align="center">QM/MM</td></tr>
<tr><td align="left">SA-CASSCF   </td><td align="left"> M<span style="font-size:x-small">OLPRO</span>      </td><td align="center">any     </td><td align="center">&#8730;</td><td align="center">&#8730;</td><td align="center">&#8730;</td><td align="center">&#8730;</td><td align="center">&#8730;</td><td align="center"></td><td align="center">&#8730;</td><td align="center"></td><td align="center"></td></tr>
<tr><td align="left"></td><td align="left"> M<span style="font-size:x-small">OLCAS</span>      </td><td align="center">any     </td><td align="center">&#8730;</td><td align="center">&#8730;</td><td align="center">&#8730;</td><td align="center"></td><td align="center">&#8730;</td><td align="center">&#8730;<sup>d</sup> </td><td align="center">&#8730;</td><td align="center"></td><td align="center">&#8730;</td></tr>
<tr><td align="left"></td><td align="left"> C<span style="font-size:x-small">OLUMBUS</span>    </td><td align="center">any     </td><td align="center">&#8730;<sup>e</sup>    </td><td align="center">&#8730;</td><td align="center">&#8730;</td><td align="center">&#8730;<sup>e</sup>    </td><td align="center">&#8730;</td><td align="center"></td><td align="center">&#8730;</td><td align="center"></td><td align="center"></td></tr>
<tr><td align="left">MR-CISD     </td><td align="left"> C<span style="font-size:x-small">OLUMBUS</span>    </td><td align="center">any     </td><td align="center">&#8730;<sup>e</sup>    </td><td align="center">&#8730;</td><td align="center">&#8730;</td><td align="center">&#8730;<sup>e</sup>    </td><td align="center">&#8730;</td><td align="center"></td><td align="center">&#8730;</td><td align="center"></td><td align="center"></td></tr>
<tr><td align="left">MS-CASPT2   </td><td align="left"> M<span style="font-size:x-small">OLCAS</span>      </td><td align="center">any     </td><td align="center">&#8730;</td><td align="center">&#8730;</td><td align="center">&#8730;<sup>d</sup>    </td><td align="center"></td><td align="center">&#8730;</td><td align="center">&#8730;<sup>d</sup> </td><td align="center">&#8730;</td><td align="center"></td><td align="center"></td></tr>
<tr><td align="left">TD-DFT      </td><td align="left"> ADF         </td><td align="center">any     </td><td align="center">&#8730;<sup>f</sup>    </td><td align="center">&#8730;<sup>g</sup>    </td><td align="center">&#8730;</td><td align="center"></td><td align="center">&#8730;</td><td align="center"></td><td align="center">&#8730;</td><td align="center">&#8730;</td><td align="center">&#8730;</td></tr>
<tr><td align="left"></td><td align="left"> G<span style="font-size:x-small">AUSSIAN</span>    </td><td align="center">any     </td><td align="center"></td><td align="center">&#8730;<sup>g</sup>    </td><td align="center">&#8730;</td><td align="center"></td><td align="center">&#8730;</td><td align="center"></td><td align="center">&#8730;</td><td align="center">&#8730;</td><td align="center"></td></tr>
<tr><td align="left">ADC2        </td><td align="left"> T<span style="font-size:x-small">URBOMOLE</span>   </td><td align="center">S, T    </td><td align="center">&#8730;<sup>f</sup>    </td><td align="center">&#8730;</td><td align="center">&#8730;</td><td align="center"></td><td align="center">&#8730;</td><td align="center"></td><td align="center"></td><td align="center">&#8730;</td><td align="center"></td></tr>
<tr><td align="left">CC2         </td><td align="left"> T<span style="font-size:x-small">URBOMOLE</span>   </td><td align="center">S, T    </td><td align="center"></td><td align="center">&#8730;<sup>g</sup>    </td><td align="center">&#8730;</td><td align="center"></td><td align="center">&#8730;</td><td align="center"></td><td align="center"></td><td align="center">&#8730;</td><td align="center"></td></tr>
<tr><td align="left">Analytical  </td><td align="left">-                  </td><td align="center">any     </td><td align="center">&#8730;</td><td align="center">&#8730;</td><td align="center">&#8730;</td><td align="center"></td><td align="center">&#8730;</td><td align="center">&#8730;</td><td align="center"></td><td align="center"></td><td align="center"></td></tr>
<tr><td align="left">LVC         </td><td align="left">-                  </td><td align="center">any     </td><td align="center">&#8730;</td><td align="center">&#8730;</td><td align="center">&#8730;</td><td align="center">&#8730;</td><td align="center">&#8730;</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr></table>
<div class="p"><!----></div>
  <sup>a</sup> TDM: transition dipole moments;
  <sup>b</sup> OVL: wave function overlaps;
  <sup>c</sup> Theo.:  T<span style="font-size:x-small">HEO</span>DORE;
  <sup>d</sup> numerical gradients;
  <sup>e</sup> either NAC or SOC, but not both at the same time;
  <sup>f</sup> SOCs only between singlets and triplets;
  <sup>g</sup> TDMs only between S<sub>0</sub> and excited singlets.
</div>
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb6.4">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 6.4: Overview over files of  S<span style="font-size:x-small">HARC</span>&nbsp;interfaces.</div>
    <a id="tab:interface_files">
</a>  
<table>
<tr><td align="left">Interface           </td><td align="left">Template file             </td><td align="left">Resource file             </td><td align="left">Initial MOs                     </td><td align="left">QM/MM</td></tr>
<tr><td align="left"> M<span style="font-size:x-small">OLPRO</span>     </td><td align="left"><b><tt>MOLPRO.template</tt></b>     </td><td align="left"><b><tt>MOLPRO.resources</tt></b>    </td><td align="left"><b><tt>wf.init</tt></b>                   </td><td align="left"></td></tr>
<tr><td align="left"></td><td align="left"></td><td align="left"></td><td align="left"><b><tt>wf.&lt;job&#62;.init</tt></b>             </td><td align="left"></td></tr>
<tr><td align="left"> M<span style="font-size:x-small">OLCAS</span>     </td><td align="left"><b><tt>MOLCAS.template</tt></b>     </td><td align="left"><b><tt>MOLCAS.resources</tt></b>    </td><td align="left"><b><tt>MOLCAS.&lt;mult&#62;.RasOrb.init</tt></b> </td><td align="left"><b><tt>MOLCAS.qmmm.table</tt></b></td></tr>
<tr><td align="left"></td><td align="left"></td><td align="left"></td><td align="left"><b><tt>MOLCAS.&lt;mult&#62;.JobIph.init</tt></b> </td><td align="left"><b><tt>MOLCAS.qmmm.key</tt></b></td></tr>
<tr><td align="left"> C<span style="font-size:x-small">OLUMBUS</span>   </td><td align="left">a directory               </td><td align="left"><b><tt>COLUMBUS.resources</tt></b>  </td><td align="left"><b><tt>mocoef_mc.init</tt></b>           </td><td align="left"></td></tr>
<tr><td align="left"></td><td align="left"></td><td align="left"></td><td align="left"><b><tt>mocoef_mc.init.&lt;job&#62;</tt></b>     </td><td align="left"></td></tr>
<tr><td align="left"></td><td align="left"></td><td align="left"></td><td align="left"><b><tt>molcas.RasOrb.init</tt></b>        </td><td align="left"></td></tr>
<tr><td align="left"></td><td align="left"></td><td align="left"></td><td align="left"><b><tt>molcas.RasOrb.init.&lt;job&#62;</tt></b>  </td><td align="left"></td></tr>
<tr><td align="left"> ADF        </td><td align="left"><b><tt>ADF.template</tt></b>        </td><td align="left"><b><tt>ADF.resources</tt></b>       </td><td align="left"><b><tt>ADF.t21.&lt;job&#62;.init</tt></b>        </td><td align="left"><b><tt>ADF.qmmm.table</tt></b></td></tr>
<tr><td align="left"></td><td align="left"></td><td align="left"></td><td align="left"></td><td align="left"><b><tt>ADF.qmmm.ff</tt></b></td></tr>
<tr><td align="left"> G<span style="font-size:x-small">AUSSIAN</span>   </td><td align="left"><b><tt>GAUSSIAN.template</tt></b>   </td><td align="left"><b><tt>GAUSSIAN.resources</tt></b>  </td><td align="left"><b><tt>GAUSSIAN.chk.init</tt></b>         </td><td align="left"></td></tr>
<tr><td align="left"></td><td align="left"></td><td align="left"></td><td align="left"><b><tt>GAUSSIAN.chk.&lt;job&#62;.init</tt></b>   </td><td align="left"></td></tr>
<tr><td align="left"> T<span style="font-size:x-small">URBOMOLE</span>  </td><td align="left"><b><tt>RICC2.template</tt></b>      </td><td align="left"><b><tt>RICC2.resources</tt></b>     </td><td align="left"><b><tt>mos.init</tt></b>                  </td><td align="left"></td></tr>
<tr><td align="left">Analytical          </td><td align="left"><b><tt>Analytical.template</tt></b> </td><td align="left">N/A                       </td><td align="left">N/A                             </td><td align="left"></td></tr>
<tr><td align="left">LVC                 </td><td align="left"><b><tt>LVC.template</tt></b>        </td><td align="left">N/A                       </td><td align="left">N/A                             </td><td align="left"></td></tr></table>
</div>
<div class="p"><!----></div>
     <a id="tth_sEc6.2.1"></a><h3>
6.2.1&nbsp;&nbsp;Example Directory</h3>
<div class="p"><!----></div>
The directory <b><tt>$SHARC/../examples/</tt></b> contains for all quantum chemistry interfaces comprehensively commented examples of input files (template, resource files).
These example files should be regarded as supplementary files to the documentation of the interfaces.
For the interfaces without the possibility for automated template generation (e.g., <b><tt>SHARC_RICC2.py</tt></b>), it is recommended that users copy the example template file and modify it to their needs.
<div class="p"><!----></div>
However, note that it might not necessarily work to directly start the respective interface in the example directories.
In order to make the example calculations work,  some paths or variables in the resource files need to be adjusted.
If you need automatically working test calculations for  S<span style="font-size:x-small">HARC</span>, consider using <b><tt>tests.py</tt></b> instead.
<div class="p"><!----></div>
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc6.3"></a><h2>
6.3&nbsp;&nbsp;MOLPRO Interface</h2><a id="sec:int:molpro">
</a>
<div class="p"><!----></div>
The  S<span style="font-size:x-small">HARC</span>- M<span style="font-size:x-small">OLPRO</span> interface allows to run  S<span style="font-size:x-small">HARC</span>&nbsp;dynamics with  M<span style="font-size:x-small">OLPRO</span>'s CASSCF wave functions. RASSCF is not supported, since on RASSCF level state-averaging over different multiplicities is not possible. The interface uses  M<span style="font-size:x-small">OLPRO</span>'s CI program in order to calculate transition dipole moments and spin-orbit couplings. Gradients and nonadiabatic coupling vectors are calculated using  M<span style="font-size:x-small">OLPRO</span>'s CADPACK code (hence no generally contracted basis sets can be used). In the new version of the interface, overlaps are calculated using the  WF<span style="font-size:x-small">OVERLAP</span> code. 
Time-derivative couplings (NACDT) are not supported anymore in the  S<span style="font-size:x-small">HARC</span>- M<span style="font-size:x-small">OLPRO</span> interface.
Wavefunction phases between the CASSCF and MRCI wave functions are automatically adjusted.
The interface can trivially parallelize the computation of gradients and coupling vectors over several processors.
Execution of parallel  M<span style="font-size:x-small">OLPRO</span> binaries is currently not supported.
<div class="p"><!----></div>
The  S<span style="font-size:x-small">HARC</span>- M<span style="font-size:x-small">OLPRO</span> interface needs two additional input files, which should be present in <b><tt>QM/</tt></b>. Those input files are <b><tt>MOLPRO.resources</tt></b>, which contains, e.g., the paths to  M<span style="font-size:x-small">OLPRO</span> and the scratch directory, and <b><tt>MOLPRO.template</tt></b>, which is a keyword-argument input file specifying the CASSCF level of theory. 
If <b><tt>QM/wf.init</tt></b> is present, it will be used as a  M<span style="font-size:x-small">OLPRO</span> wave function file containing the initial MOs.
For calculations with several "jobs" (see below), initial orbitals can also given as <b><tt>QM/wf.&lt;job&#62;.init</tt></b>.
<div class="p"><!----></div>
     <a id="tth_sEc6.3.1"></a><h3>
6.3.1&nbsp;&nbsp;Template file: <b><tt>MOLPRO.template</tt></b></h3>
<div class="p"><!----></div>
During the rework of the  M<span style="font-size:x-small">OLPRO</span> interface, the template file structure was completely changed.
In the new version, the template file is a keyword-argument list file, similar to the template files of most other interfaces.
A fully commented template file with all possible options is located in <b><tt>$SHARC/../examples/SHARC_MOLPRO/</tt></b>.
<div class="p"><!----></div>
For simple cases, an example for the template file looks like this:
<pre>
basis&nbsp;def2-svp
dkho&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Douglas-Kroll&nbsp;second&nbsp;order
occ&nbsp;14
closed&nbsp;10
nelec&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;24
roots&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;0&nbsp;3
rootpad&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;0&nbsp;1
</pre>
This specifies a SA(4S+3T)-CASSCF(4,4)/def2-SVP calculation for 24 electrons.
Note the <b><tt>rootpad</tt></b> keyword, which adds one singlet and one triplet with zero weight to the state-averaging (so technically this is a SA(5S+4T) calculation, but the results are the same as SA(4S+3T)).
These zero-weight states are sometimes useful to improve convergence of CASSCF.
<div class="p"><!----></div>
The new interface can also be used to perform several independent CASSCF calculations for different multiplicities (e.g., one CASSCF for the neutral states and another one for the ionic states).
In this case, each independent CASSCF calculation is called a "job".
In the template, most settings can be modified independently for each job.
An example is given here:
<pre>
#&nbsp;In&nbsp;this&nbsp;way,&nbsp;users&nbsp;can&nbsp;employ&nbsp;custom&nbsp;basis&nbsp;sets
basis_external&nbsp;/path/to/basisset&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;no&nbsp;spaces&nbsp;in&nbsp;path&nbsp;allowed
dkho&nbsp;2
#&nbsp;job&nbsp;1&nbsp;for&nbsp;singlet+triplet;&nbsp;job&nbsp;2&nbsp;for&nbsp;doublets
jobs&nbsp;1&nbsp;2&nbsp;1
occ&nbsp;14&nbsp;13&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;for&nbsp;job&nbsp;1&nbsp;and&nbsp;2
closed&nbsp;11&nbsp;10&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;for&nbsp;job&nbsp;1&nbsp;and&nbsp;2
nelec&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;24&nbsp;23&nbsp;24&nbsp;&nbsp;&nbsp;#&nbsp;for&nbsp;job&nbsp;1
nelec&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;24&nbsp;23&nbsp;24&nbsp;&nbsp;&nbsp;#&nbsp;for&nbsp;job&nbsp;2
roots&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;0&nbsp;3&nbsp;&nbsp;&nbsp;#&nbsp;for&nbsp;job&nbsp;1
roots&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;2&nbsp;0&nbsp;&nbsp;&nbsp;#&nbsp;for&nbsp;job&nbsp;2
rootpad&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;0&nbsp;1&nbsp;&nbsp;&nbsp;#&nbsp;for&nbsp;job&nbsp;1
rootpad&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;2&nbsp;0&nbsp;&nbsp;&nbsp;#&nbsp;for&nbsp;job&nbsp;2
</pre>
This template specifies two jobs, where job 1 should be used to compute singlet and triplet states, and job 2 used for doublet states.
Job 1 is a SA(4S+3T)-CASSCF(2,3) computation, with singlets and triplets each having 24 electrons.
Job 2 is a SA(2D)-CASSCF(3,3) computation, with 23 electrons.
Note how for different jobs it is possible to have different active spaces and state-averaging schemes.
However, keep in mind that all states of a given multiplicity are always calculated in the same job (e.g., it is not possible to have one job for S<sub>0</sub> and another job for S<sub>1</sub> and S<sub>2</sub>).
<div class="p"><!----></div>
It is also possible to do a mixed input, for example having two jobs, but only giving one number after <b><tt>occ</tt></b> or <b><tt>closed</tt></b>.
The interface provides comprehensive error messages during the template check.
<div class="p"><!----></div>
Also note the <b><tt>basis_external</tt></b> keyword. It provides a file, whose content is used in the basis set definition (it is inserted verbatim into <b><tt>basis={...}</tt></b> in the  M<span style="font-size:x-small">OLPRO</span> input).
It is possible to use the generated input from the <a href="https://bse.pnl.gov/bse/portal">Basis Set Exchange Library</a>, but the <b><tt>basis={</tt></b> and <b><tt>}</tt></b> need to be deleted from the file.
<div class="p"><!----></div>
Remember that <b><tt>molpro_input.py</tt></b> cannot create multi-job templates or templates with the <b><tt>basis_external</tt></b> keyword.
<div class="p"><!----></div>
     <a id="tth_sEc6.3.2"></a><h3>
6.3.2&nbsp;&nbsp;Resource file: <b><tt>MOLPRO.resources</tt></b></h3>
<div class="p"><!----></div>
The interface requires some additional information beyond the content of <b><tt>QM.in</tt></b>. This information is given in the file <b><tt>MOLPRO.resources</tt></b>, which must reside in the directory where the interface is started. This file uses a simple "<b><tt>keyword argument</tt></b>" syntax. Comments using # and blank lines are possible, the order of keywords is arbitrary. Lines with unknown keywords are ignored, since the interface just searches the file for certain keywords.
<div class="p"><!----></div>
Table&nbsp;<a href="#tab:molpro_sh2"> 6.5</a> lists the existing keywords.
A fully commented resource file for this interface with all possible options is located in <b><tt>$SHARC/../examples/SHARC_MOLPRO/</tt></b>.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb6.5">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 6.5: Keywords for the <b><tt>MOLPRO.resources</tt></b> input file.</div>
  <a id="tab:molpro_sh2">
</a>
<table>
<tr><td align="left">Keyword       </td><td align="left">Description</td></tr>
<tr><td align="left">molpro          </td><td align="left">Is followed by a string giving the path to the  M<span style="font-size:x-small">OLPRO</span> executable. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. </td></tr>
<tr><td align="left">scratchdir      </td><td align="left">Is a path to the temporary directory. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. If the directory does not exist, the interface will create it. In any case, the interface will delete this directory after the calculation.</td></tr>
<tr><td align="left">savedir         </td><td align="left">Is a path to another temporary directory.  Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. The interface will store files needed for restart there.</td></tr>
<tr><td align="left">memory        </td><td align="left">(int) Memory for  M<span style="font-size:x-small">OLPRO</span> and  WF<span style="font-size:x-small">OVERLAP</span> in MB.</td></tr>
<tr><td align="left">ncpu          </td><td align="left">(int) Number of CPU cores for parallel computation of gradients/NAC vectors.</td></tr>
<tr><td align="left">delay         </td><td align="left">(float) Time in seconds between starting parallel  M<span style="font-size:x-small">OLPRO</span> runs. Useful to lessen the I/O burden when having many runs starting at the same time.</td></tr>
<tr><td align="left">gradaccudefault </td><td align="left">(float) Default accuracy for CP-MCSCF.</td></tr>
<tr><td align="left">gradaccumax     </td><td align="left">(float) Worst acceptable accuracy for CP-MCSCF (see below).</td></tr>
<tr><td align="left">always_orb_init </td><td align="left">Do not use the orbital guesses from previous calculations/time steps, but always use the provided initial orbitals.</td></tr>
<tr><td align="left">always_guess   </td><td align="left">Always use the orbital guess from  M<span style="font-size:x-small">OLPRO</span>'s guess module.</td></tr>
<tr><td align="left">wfoverlap       </td><td align="left">Is the path to the  WF<span style="font-size:x-small">OVERLAP</span> executable. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used.</td></tr>
<tr><td align="left">numfrozcore           </td><td align="left">Number of neglected core orbitals for overlap and Dyson calculations.</td></tr>
<tr><td align="left">numocc           </td><td align="left">Number of doubly occupied orbitals for Dyson calculations.</td></tr>
<tr><td align="left">nooverlap       </td><td align="left">Do not save determinant files for overlap computations.</td></tr>
<tr><td align="left">debug           </td><td align="left">Increases the verbosity of the interface.</td></tr>
<tr><td align="left">no_print       </td><td align="left">Reduces interface standard output.</td></tr></table>
</div>
<div class="p"><!----></div>
Mandatory keywords are the paths to  M<span style="font-size:x-small">OLPRO</span>, the scratch directory, and to the  WF<span style="font-size:x-small">OVERLAP</span> executable (the latter for overlap, Dyson, or NACDR calculations).
<div class="p"><!----></div>
<b>Parallel execution of MOLPRO&nbsp;&nbsp;</b>
<div class="p"><!----></div>
In the new version of the  S<span style="font-size:x-small">HARC</span>- M<span style="font-size:x-small">OLPRO</span> interface, calculations of multiple independent active spaces ("jobs"), of several gradients, and of several nonadiabatic coupling vectors are automatically parallelized over the given number of CPU cores.
<div class="p"><!----></div>
Note that in the new version of the interface,  M<span style="font-size:x-small">OLPRO</span> calls itself cannot be run with multiple CPUs.
<div class="p"><!----></div>
     <a id="tth_sEc6.3.3"></a><h3>
6.3.3&nbsp;&nbsp;Error checking</h3>
<div class="p"><!----></div>
The interface is written such that the output of  M<span style="font-size:x-small">OLPRO</span> is checked for commonly occuring errors, mostly bad convergence in the MCSCF or CP-MCSCF parts. In these cases, the input is adjusted and  M<span style="font-size:x-small">OLPRO</span> restarted. This will be done until all calculations are finished or an unrecoverable error is detected.
The interface will try to solve the following error messages:
<div class="p"><!----></div>
<b>EXCESSIVE GRADIENT IN CI&nbsp;&nbsp;</b> This error message can occur in the MCSCF part. The calculation is restarted with a P-space threshold (see  M<span style="font-size:x-small">OLPRO</span> manual) of 1. If the error remains, the threshold is quadrupled until the calculation converges or the threshold is above 100.
<div class="p"><!----></div>
<b>NO CONVERGENCE IN REFERENCE CI&nbsp;&nbsp;</b> The error occurs in the CI part. The calculation is restarted with a P-space threshold (see  M<span style="font-size:x-small">OLPRO</span> manual) of 1. If the error remains, the threshold is quadrupled until the calculation converges or the threshold is above 100.
<div class="p"><!----></div>
<b>NO CONVERGENCE OF CP-MCSCF&nbsp;&nbsp;</b> This error occurs when solving the linear equations needed for the calculation of MCSCF gradients or nonadiabatic coupling vectors. In this case, the interface finds in the output the value of closest convergence and restarts the calculation with the value found as the new convergence criterion. This ensures that the CP-MCSCF calculation converges, albeit with lower accuracy for this gradient for this time step.
<div class="p"><!----></div>
This error check is controlled by two keywords in the <b><tt>MOLPRO.resources</tt></b> file. The interface first tries to converge the CP-MCSCF calculation to <b><tt>gradaccudefault</tt></b>. If this fails, it tries to converge to the best value possible within 900 iterations. <b><tt>gradaccumax</tt></b> defines the worst accuracy accepted by the interface. If a CP-MCSCF calculation cannot be converged below <b><tt>gradaccumax</tt></b> then the interface exits with an error, leading to the abortion of the trajectory.
<div class="p"><!----></div>
     <a id="tth_sEc6.3.4"></a><h3>
6.3.4&nbsp;&nbsp;Things to keep in mind</h3>
<div class="p"><!----></div>
<b>Initial orbital guess&nbsp;&nbsp;</b>
<div class="p"><!----></div>
For CASSCF calculations it is always a good idea to start from converged MOs from a nearby geometry. For the first time step, if a file <b><tt>QM/wf.init</tt></b> is present, the  S<span style="font-size:x-small">HARC</span>- M<span style="font-size:x-small">OLPRO</span> interface will take this file for the starting orbitals. In case of multi-job calculations, separate initial orbitals can be provided with files called <b><tt>QM/wf.&lt;job&#62;.init</tt></b>, where <b><tt>&lt;job&#62;</tt></b> is an integer.
In subsequent calculations, the MOs from the previous step will be used (unless the <b><tt>always_orb_init</tt></b> keyword is used).
<div class="p"><!----></div>
<b>Basis sets&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Note that the  M<span style="font-size:x-small">OLPRO</span> interface cannot calculation SA-CASSCF gradients for generally contracted basis sets (like Dunning's "cc" basis sets or Roos' "ANO" basis sets). Only segmented basis sets are allowed, like the Pople basis sets and the "def" family from  T<span style="font-size:x-small">URBOMOLE</span>.
<div class="p"><!----></div>
In order to employ user-defined basis sets, in the template the keyword <b><tt>basis_external</tt></b>, followed by a filename, can be used.
The interface will then take the content of this file and insert it as basis set definition in the  M<span style="font-size:x-small">OLPRO</span> input files (i.e., it will add in the input <b><tt>basis={ &lt;content of the file&#62; }</tt></b>.
Note that the filename must not contain spaces.
<div class="p"><!----></div>
     <a id="tth_sEc6.3.5"></a><h3>
6.3.5&nbsp;&nbsp;Molpro input generator: <b><tt>molpro_input.py</tt></b></h3><a id="sec:molpro_input.py">
</a>
<div class="p"><!----></div>
In order to quickly setup simple inputs for  M<span style="font-size:x-small">OLPRO</span>, the  S<span style="font-size:x-small">HARC</span>&nbsp;suite contains a small script called <b><tt>molpro_input.py</tt></b>. It can be used to setup single point calculations, optimizations and frequency calculations on the HF, DFT, MP2 and CASSCF level of theory. Of course,  M<span style="font-size:x-small">OLPRO</span> has far more capabilities, but these are not covered by <b><tt>molpro_input.py</tt></b>. However, <b><tt>molpro_input.py</tt></b> can also prepare template files which are compatible with the  S<span style="font-size:x-small">HARC</span>- M<span style="font-size:x-small">OLPRO</span> interface (<b><tt>MOLPRO.template</tt></b> file).
<div class="p"><!----></div>
The script interactively asks the user to specify the calculation and afterwards writes an input file and optionally a run script.
<div class="p"><!----></div>
<h4>Input</h4>
<div class="p"><!----></div>
<b>Type of calculation&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Choose to either perform a single-point calculation or a minimum optimization (including optionally frequency calculation), to generate a template file, or an optimization of a state crossing. For the template generation, no geometry file is needed, but the script looks for a <b><tt>MOLPRO.input</tt></b> in the same directory and allows to copy the settings. 
<div class="p"><!----></div>
For single-point calculations, optimizations and frequency calculations, files in  M<span style="font-size:x-small">OLDEN</span> format called <b><tt>geom.molden</tt></b>, <b><tt>opt.molden</tt></b> or <b><tt>freq.molden</tt></b>, respectively, are created (containing the orbitals, optimization steps and normal modes, respectively). The file <b><tt>freq.molden</tt></b> can be used to generate initial conditions with <b><tt>wigner.py</tt></b>.
<div class="p"><!----></div>
<b>Geometry&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Specify the geometry file in xyz format. Number of atoms and total nuclear charge is detected automatically. After the user inputs the total charge, the number of electrons is calculated automatically.
<div class="p"><!----></div>
In the case of the generation of a template file, instead only the number of electrons is required.
<div class="p"><!----></div>
<b>Non-default atomic masses&nbsp;&nbsp;</b>
<div class="p"><!----></div>
If a frequency calculation is requested, the user may modify the mass of specific atoms (e.g.&nbsp;to investigate isotopic effects). In the following menu, the user can add or remove atoms with their mass to a list containing all atoms with non-default masses. Each atom is referred to by its number as in the geometry file. Using the command <b><tt>show</tt></b> the user can display the list of atoms with non-default masses. Typing <b><tt>end</tt></b> confirms the list.
<div class="p"><!----></div>
Note that when using the produced  M<span style="font-size:x-small">OLDEN</span> file later with <b><tt>wigner.py</tt></b>, the user has to enter the same non-default masses again, since the  M<span style="font-size:x-small">OLDEN</span> file does not contain the masses and <b><tt>wigner.py</tt></b> has no way to retrieve these numbers.
<div class="p"><!----></div>
<b>Level of theory&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Supported are Hartree-Fock (HF), density functional theory (DFT), M&#248;ller-Plesset perturbation theory (MP2), equation-of-motion coupled-cluster with singles and doubles (EOM-CCSD) and CASSCF (either single-state or state-averaged). All methods (except EOM-CCSD) are compatible with odd-electron wave functions (<b><tt>molpro_input.py</tt></b> will use the corresponding UHF, UMP2 and UKS keywords in the input file, if necessary).
<div class="p"><!----></div>
For template generation, state-average CASSCF is automatically chosen. All methods (except EOM-CCSD) can be combined with optimizations and frequency calculations, however, the frequency calculation is much more efficient with HF or SS-CASSCF. 
<div class="p"><!----></div>
<b>DFT functional&nbsp;&nbsp;</b>
<div class="p"><!----></div>
For DFT calculations, enter a functional and choose whether dispersion correction should be applied. Note that the functional is just a string which is not checked by <b><tt>molpro_input.py</tt></b>. 
<div class="p"><!----></div>
<b>Basis set&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The basis set is just a string which is not checked by <b><tt>molpro_input.py</tt></b>. 
<div class="p"><!----></div>
<b>CASSCF settings&nbsp;&nbsp;</b>
<div class="p"><!----></div>
For CASSCF calculations, enter the number of active electrons and orbitals. 
<div class="p"><!----></div>
For SS-CASSCF, only the multiplicity needs to be specified. For SA-CASSCF, specify the number of states per multiplicity to be included. Note that  M<span style="font-size:x-small">OLPRO</span> allows to average over states with different numbers of electrons. This feature is not supported in <b><tt>molpro_input.py</tt></b>. However, the user can generate a closely-matching input and simply add the missing states to the CASSCF block manually. 
<div class="p"><!----></div>
For optimizations at SA-CASSCF level, the state to be optimized has to be given. For crossing point optimizations, two states need to be entered. The script automatically detects whether a conical intersection or a crossing between states of different multiplicity is requested and sets up the input accordingly.
<div class="p"><!----></div>
<b>EOM-CCSD settings&nbsp;&nbsp;</b>
<div class="p"><!----></div>
EOM-CCSD calculations allow to calculate relatively accurate excited-state energies and oscillator strengths from a Hartree-Fock reference, but only for singlet excited states.
<div class="p"><!----></div>
The user has to specify the number of states to be calculated. If only one state is requested, the script will setup a regular ground state CCSD calculation, while for more than one states, an EOM-CCSD calculation is setup.
Note that the calculation of transition properties takes twice as long as the energy calculation itself.
<div class="p"><!----></div>
<b>Memory&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Enter the amount of memory for  M<span style="font-size:x-small">OLPRO</span>. Note that values smaller than 50 MB are ignored, and 50 MB are used in this case.
<div class="p"><!----></div>
<b>Run script&nbsp;&nbsp;</b>
<div class="p"><!----></div>
If requested, the script also generates a simple Bash script (<b><tt>run_molpro.sh</tt></b>) to directly execute  M<span style="font-size:x-small">OLPRO</span>. The user has to enter the path to  M<span style="font-size:x-small">OLPRO</span> and the path to a suitable (fast) scratch directory. 
<div class="p"><!----></div>
Note that the scratch directory will be deleted after the calculation, only the wave function file <b><tt>wf</tt></b> will be copied back to the main directory.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc6.4"></a><h2>
6.4&nbsp;&nbsp;MOLCAS Interface</h2><a id="sec:int:molcas">
</a>
<div class="p"><!----></div>
The  S<span style="font-size:x-small">HARC</span>- M<span style="font-size:x-small">OLCAS</span> interface can be used to conduct excited-state dynamics based on  M<span style="font-size:x-small">OLCAS</span>' CASSCF wave functions, and with CASPT2 or MS-CASPT2 energies (and numerical gradients). 
RASSCF wave functions are not supported currently. 
It is important to note that currently,  S<span style="font-size:x-small">HARC</span>&nbsp;was only tested to work with  O<span style="font-size:x-small">PENMOLCAS</span> 18, which is freely available.
Some versions of  M<span style="font-size:x-small">OLCAS</span> 8 might also work, but no guarantee is given.
Note that within this Manual,  M<span style="font-size:x-small">OLCAS</span> and  O<span style="font-size:x-small">PENMOLCAS</span> are used synonymously.
<div class="p"><!----></div>
The interface uses the modules GATEWAY, SEWARD (integrals), RASSCF (wave function, energies), RASSI (transition dipole moments, spin-orbit couplings, overlaps), MCLR, and ALASKA (gradients). 
For CASPT2 and MS-CASPT2, numerical gradients can be calculated, where the interface itself controls the calculations at the displaced geometries. 
The interface can also numerically differentiate dipole moments and spin-orbit couplings.
Since  M<span style="font-size:x-small">OLCAS</span> is not able to calculate the full nonadiabatic coupling vectors, only wave function overlaps are currently implemented in the interface (overlaps are calculated via RASSI). 
Using the  WF<span style="font-size:x-small">OVERLAP</span> code, it is possible to calculate Dyson norms between neutral and ionic states.
Note that (unlike  M<span style="font-size:x-small">OLPRO</span>)  M<span style="font-size:x-small">OLCAS</span> cannot average over states of different multiplicities; hence, the multiplicities are always computed in separate jobs which all share the same CAS settings.
<div class="p"><!----></div>
The  S<span style="font-size:x-small">HARC</span>- M<span style="font-size:x-small">OLCAS</span> interface furthermore allows to perform QM/MM dynamics (CASSCF plus force fields), through the  M<span style="font-size:x-small">OLCAS</span>- T<span style="font-size:x-small">INKER</span> interface. 
<div class="p"><!----></div>
The interface needs two additional input files, a template file for the quantum chemistry (file name is <b><tt>MOLCAS.template</tt></b>) and a resource file (<b><tt>MOLCAS.resources</tt></b>). If the interface finds files with the name <b><tt>QM/MOLCAS.&lt;i&#62;.JobIph.init</tt></b> or <b><tt>QM/MOLCAS.&lt;i&#62;.RasOrb.init</tt></b>, they are used as initial wave function files, where <b><tt>&lt;i&#62;</tt></b> is the multiplicity. In the case of QM/MM calculations, two more input files are needed: <b><tt>MOLCAS.qmmm.key</tt></b>, which contains the path to the force field parameters and the partitioning into QM and MM regions, and <b><tt>MOLCAS.qmmm.table</tt></b>, which contains the connectivity and force field IDs per atom.
<div class="p"><!----></div>
     <a id="tth_sEc6.4.1"></a><h3>
6.4.1&nbsp;&nbsp;Template file: <b><tt>MOLCAS.template</tt></b></h3>
<div class="p"><!----></div>
This file contains the specifications for the wave function. Note that this is not a valid  M<span style="font-size:x-small">OLCAS</span> input file. No sections like <b><tt>$GATEWAY</tt></b>, etc., can be used. The file only contains a number of keywords, given in table&nbsp;<a href="#tab:molcas_temp"> 6.6</a>.
The actual input files are automatically generated.
<div class="p"><!----></div>
A fully commented template file with all possible options is located in <b><tt>$SHARC/../examples/SHARC_MOLCAS/</tt></b>.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb6.6">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 6.6: Keywords for the <b><tt>MOLACS.template</tt></b> file.</div>
  <a id="tab:molcas_temp">
</a>
<table>
<tr><td align="left">Keyword       </td><td align="left">Description</td></tr>
<tr><td align="left">basis           </td><td align="left">The basis set used. Note that some basis sets (e.g., Pople basis sets) do not work, since the spin-orbit integrals cannot be calculated.</td></tr>
<tr><td align="left">baslib          </td><td align="left">Can be used to provide the path to a custom basis set library (analogous to the baslib keyword in  M<span style="font-size:x-small">OLCAS</span>).</td></tr>
<tr><td align="left">nactel          </td><td align="left">Number of active electrons for CASSCF.</td></tr>
<tr><td align="left">ras2            </td><td align="left">Number of active orbitals for CASSCF.</td></tr>
<tr><td align="left">inactive        </td><td align="left">Number of inactive orbitals.</td></tr>
<tr><td align="left">roots           </td><td align="left">Followed by a list of integers, giving the number of states per multiplicity in the state-averaging procedure.</td></tr>
<tr><td align="left">rootpad         </td><td align="left">Followed by a list of integers, giving the number of extra, zero-weight states in the state-averaging.</td></tr>
<tr><td align="left">method          </td><td align="left">Followed by a string, which is either "CASSCF", "CASPT2" or "MS-CASPT2" (case insensitive), defining the level of theory. Default is "CASSCF".</td></tr>
<tr><td align="left">no-douglas-kroll</td><td align="left">Deactivates the use of the scalar-relativistic DK Hamiltonian and uses a non-relativistic Hamiltonian instead. Default is Douglas-Kroll-Hess 2nd order  (In  M<span style="font-size:x-small">OLCAS</span> standard parametrization).</td></tr>
<tr><td align="left">ipea            </td><td align="left">Followed by a float giving the IP-EA shift for CASPT2 (see  M<span style="font-size:x-small">OLCAS</span> manual for more information). The default is 0.25, as in  M<span style="font-size:x-small">OLCAS</span>.</td></tr>
<tr><td align="left">imaginary       </td><td align="left">Followed by a float giving the imaginary level shift for CASPT2 (see  M<span style="font-size:x-small">OLCAS</span> manual for more information). The default is 0.0, as in  M<span style="font-size:x-small">OLCAS</span>.</td></tr>
<tr><td align="left">frozen          </td><td align="left">Number of frozen orbitals for CASPT2. Default is -1, which lets  M<span style="font-size:x-small">OLCAS</span> choose the number of frozen orbitals.</td></tr>
<tr><td align="left">cholesky        </td><td align="left">Activates Cholesky decomposition in  M<span style="font-size:x-small">OLCAS</span>. Recommended for large basis sets. Will use numerical gradients even for CASSCF. Default is to use regular 4-electron integrals.</td></tr>
<tr><td align="left">cholesky_analytical    </td><td align="left">Activates analytical SA-CASSCF gradients with Cholesky decomposition. This is only possible with  M<span style="font-size:x-small">OLCAS</span> 8.</td></tr>
<tr><td align="left">gradaccudefault </td><td align="left">(float) Default accuracy for CP-MCSCF.</td></tr>
<tr><td align="left">gradaccumax     </td><td align="left">(float) Worst acceptable accuracy for CP-MCSCF.</td></tr>
<tr><td align="left">displ           </td><td align="left">Cartesian displacement (in &#197;) for numerical differentiation (default 0.005&nbsp;&#197;).</td></tr>
<tr><td align="left">qmmm            </td><td align="left">Activates the QM/MM mode. In this case, two more input files need to be present (see below).</td></tr></table>
</div>
<div class="p"><!----></div>
The template file can be setup with the tool <b><tt>molcas_input.py</tt></b>.
<div class="p"><!----></div>
     <a id="tth_sEc6.4.2"></a><h3>
6.4.2&nbsp;&nbsp;Resource file: <b><tt>MOLCAS.resources</tt></b></h3>
<div class="p"><!----></div>
The file <b><tt>MOLCAS.resources</tt></b> contains mainly paths (to the  M<span style="font-size:x-small">OLCAS</span> executables, to the scratch directory, etc.). This file must reside in the same directory where the interface is started. It uses a simple "<b><tt>keyword argument</tt></b>" syntax. Comments using # and blank lines are possible, the order of keywords is arbitrary. Lines with unknown keywords are ignored, since the interface just searches the file for certain keywords.
<div class="p"><!----></div>
Table&nbsp;<a href="#tab:molcas_sh2"> 6.7</a> lists the existing keywords.
A fully commented resource file for this interface with all possible options is located in <b><tt>$SHARC/../examples/SHARC_MOLCAS/</tt></b>.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb6.7">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 6.7: Keywords for the <b><tt>MOLCAS.resources</tt></b> file.</div>
  <a id="tab:molcas_sh2">
</a>
<table>
<tr><td align="left">Keyword       </td><td align="left">Description</td></tr>
<tr><td align="left">molcas          </td><td align="left">Is the path to the  O<span style="font-size:x-small">PENMOLCAS</span> installation. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. The interface will set <b><tt>$MOLCAS</tt></b> to this path. If this keyword is not present in <b><tt>MOLCAS.resources</tt></b>, the interface will use the environment variable <b><tt>$MOLCAS</tt></b>, if it is set.</td></tr>
<tr><td align="left">tinker          </td><td align="left">The path to the  T<span style="font-size:x-small">INKER</span> installation, usable with  M<span style="font-size:x-small">OLCAS</span>.</td></tr>
<tr><td align="left">wfoverlap       </td><td align="left">Is the path to the  WF<span style="font-size:x-small">OVERLAP</span> executable. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. Only needed for Dyson norm calculations.</td></tr>
<tr><td align="left">scratchdir      </td><td align="left">Is a path to the temporary directory. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. If it does not exist, the interface will create it. In any case, the interface will delete this directory after the calculation.</td></tr>
<tr><td align="left">savedir         </td><td align="left">Is a path to another temporary directory.  Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. The interface will store files needed for restart there.</td></tr>
<tr><td align="left">memory          </td><td align="left">The memory usable by  M<span style="font-size:x-small">OLCAS</span>. The interface will set <b><tt>$MOLCASMEM</tt></b> to this value. The default is 10&nbsp;MB.</td></tr>
<tr><td align="left">ncpu            </td><td align="left">The number of CPUs used by the interface. If zero or negative, one CPU will be used and all subtasks (Hamiltonian, dipole moments, analytical gradients, overlaps) will be done in one  M<span style="font-size:x-small">OLCAS</span> call. If positive, analytical gradients will be calculated by separate calls to  M<span style="font-size:x-small">OLCAS</span>, parallelized over the given number of CPUs. </td></tr>
<tr><td align="left">delay           </td><td align="left">Followed by a float giving the delay in seconds between starting parallel jobs to avoid excessive disk I/O.</td></tr>
<tr><td align="left">always_orb_init </td><td align="left">Do not use the orbital guesses from previous calculations/time steps, but always use the provided initial orbitals.</td></tr>
<tr><td align="left">always_guess   </td><td align="left">Always use the orbital guess from  M<span style="font-size:x-small">OLCAS</span>'s <b><tt>guessorb</tt></b> module.</td></tr>
<tr><td align="left">debug           </td><td align="left">Increases the verbosity of the interface.</td></tr>
<tr><td align="left">no_print       </td><td align="left">Reduces interface standard output.</td></tr></table>
</div>
<div class="p"><!----></div>
Note that the interface sets all environment variables necessary to run  M<span style="font-size:x-small">OLCAS</span> (e.g., <b><tt>$MOLCAS</tt></b>, <b><tt>$MOLCASMEM</tt></b>, <b><tt>$WorkDir</tt></b> ,<b><tt>$Project</tt></b>) automatically, based on the input from <b><tt>MOLCAS.resources</tt></b> and <b><tt>QM.in</tt></b>.
<div class="p"><!----></div>
Some explanations on parallelization: There are two parallel modes in which the interface can act. In the first mode, the wave function and expectation values are calculated serially first, and then all analytical gradients are computed in parallel, over the given number of CPUs. If the number of CPUs is one, then still the interface prepares independent computations for each gradient, and runs those sequentially on one CPU. If the given number of CPUs is negative or zero, then the gradients are not prepared as separate  M<span style="font-size:x-small">OLCAS</span> calculations, but together with the other quantities. The latter variant has less overhead, but is only recommended if the user is sure that the gradient calculations (MCLR) will converge in virtually all cases. If MCLR does not converge occasionally, it is advisable to use NCPU=1 instead of NCPU &#8804; 0.
<div class="p"><!----></div>
In the second parallelization mode, used for numerical gradients, the central point is calculated first and then all displacements are computed in parallel. This mode will be used for gradients on CASPT2, MS-CASPT2 and Cholesky-CASSCF level as well as for spin-orbit/dipole moment derivatives on all levels. In this mode there is no distinction between NCPU=1 and NCPU &#8804; 0. 
<div class="p"><!----></div>
     <a id="tth_sEc6.4.3"></a><h3>
6.4.3&nbsp;&nbsp;Template file generator: <b><tt>molcas_input.py</tt></b></h3><a id="sec:molcas_input.py">
</a>
<div class="p"><!----></div>
This is a small interactive script to generate template files for the  S<span style="font-size:x-small">HARC</span>- M<span style="font-size:x-small">OLCAS</span> interface. It simply queries the user for some input parameters and then writes the file <b><tt>MOLCAS.template</tt></b>, which can be used to run  S<span style="font-size:x-small">HARC</span>&nbsp;simulations with the  S<span style="font-size:x-small">HARC</span>- M<span style="font-size:x-small">OLCAS</span> interface.
The input generator can also be used to write proper  M<span style="font-size:x-small">OLCAS</span> input files for single-point calculations and optimizations/frequency calculations on CASSCF and (MS-)CASPT2 level of theory.
<div class="p"><!----></div>
<b>Type of calculation&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Choose to either perform a single-point calculation or a minimum optimization (including optionally frequency calculation), or to generate a template file. For the template generation, no geometry file is needed, but the script looks for a <b><tt>MOLCAS.input</tt></b> in the same directory and allows to copy the settings. 
<div class="p"><!----></div>
For single-point calculations, optimizations and frequency calculations, files in  M<span style="font-size:x-small">OLDEN</span> format are created (containing the orbitals, optimization steps and normal modes, respectively). The file <b><tt>MOLCAS.freq.molden</tt></b> can be used to generate initial conditions with <b><tt>wigner.py</tt></b>.
<div class="p"><!----></div>
<b>Geometry file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The geometry file is only used to calculate the nuclear charge.
<div class="p"><!----></div>
<b>Charge&nbsp;&nbsp;</b>
<div class="p"><!----></div>
This is the overall charge of the molecule. This number is used with the nuclear charge to calculate the number of electrons.
<div class="p"><!----></div>
<b>Method&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Choose either CASSCF or CASPT2. Multi-state CASPT2 can be requested later.
<div class="p"><!----></div>
<b>Basis set&nbsp;&nbsp;</b>
<div class="p"><!----></div>
This is simply a string, which is <i>not</i> checked by the script to be a valid basis set of the  M<span style="font-size:x-small">OLCAS</span> library.
<div class="p"><!----></div>
<b>Number of active electrons and orbitals&nbsp;&nbsp;</b>
<div class="p"><!----></div>
These settings are necessary for the definition of the CASSCF wave function. The number of inactive orbitals is automatically calculated from the total number of electrons and the number of active electrons.
<div class="p"><!----></div>
<b>States for state-averaging&nbsp;&nbsp;</b>
<div class="p"><!----></div>
For each multiplicity, the number of states for the state-averaging procedure must be equal or larger than the number of states used in the dynamics.
<div class="p"><!----></div>
<b>Further settings&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Depending on the run type and method, the script might ask further questions regarding the root to optimize, CASPT2 settings (whether to do multi-state CASPT2, IPEA shift, imaginary level shift), or whether a spin-orbit RASSI should be performed (for input file generation only).
<div class="p"><!----></div>
     <a id="tth_sEc6.4.4"></a><h3>
6.4.4&nbsp;&nbsp;QM/MM key file: <b><tt>MOLCAS.qmmm.key</tt></b></h3>
<div class="p"><!----></div>
This file defines some aspects of the QM/MM calculation. An example is given below:
<div class="p"><!----></div>
<pre>
parameters&nbsp;$MOLCAS/tinker/params/amber99sb.prm
QMMM&nbsp;18
QM&nbsp;&nbsp;&nbsp;&nbsp;-1&nbsp;15
MM&nbsp;&nbsp;&nbsp;-16&nbsp;18
QMMM-ELECTROSTATICS&nbsp;ESPF
</pre>
<div class="p"><!----></div>
The first line defines the force field parameters, which are read from  T<span style="font-size:x-small">INKER</span>'s library here. Note that in the file path, environment variables are expanded by the interface.
The next three lines define the QM and MM regions of the system, where in this case atoms 1-15 are in the QM region and atoms 16-18 are in the MM region (note the minus signs indicating the begin of an interval). The last line defines how to treat electrostatics in the calculation (currently, only ESPF is implemented for  M<span style="font-size:x-small">OLCAS</span>, so this line has to be present as shown, or omitted).
<div class="p"><!----></div>
     <a id="tth_sEc6.4.5"></a><h3>
6.4.5&nbsp;&nbsp;QM/MM connection table file: <b><tt>MOLCAS.qmmm.table</tt></b></h3>
<div class="p"><!----></div>
This is the template to generate the  T<span style="font-size:x-small">INKER</span> xyz file, which besides the geometry contains the force field atom type number and the connectivity information. A sample looks like:
<div class="p"><!----></div>
<pre>
8
1&nbsp;N*&nbsp;&nbsp;&nbsp;1.6&nbsp;&nbsp;3.3&nbsp;-2.0&nbsp;&nbsp;1132&nbsp;&nbsp;2
2&nbsp;CK&nbsp;&nbsp;&nbsp;0.3&nbsp;&nbsp;3.1&nbsp;-2.6&nbsp;&nbsp;1136&nbsp;&nbsp;1&nbsp;&nbsp;3&nbsp;&nbsp;4
3&nbsp;H5&nbsp;&nbsp;-0.4&nbsp;&nbsp;2.9&nbsp;-1.9&nbsp;&nbsp;1145&nbsp;&nbsp;2
4&nbsp;NB&nbsp;&nbsp;&nbsp;0.3&nbsp;&nbsp;3.2&nbsp;-3.9&nbsp;&nbsp;1135&nbsp;&nbsp;2&nbsp;&nbsp;5
5&nbsp;CB&nbsp;&nbsp;&nbsp;1.6&nbsp;&nbsp;3.5&nbsp;-4.2&nbsp;&nbsp;1134&nbsp;&nbsp;4&nbsp;&nbsp;6
6&nbsp;CA&nbsp;&nbsp;&nbsp;2.2&nbsp;&nbsp;3.8&nbsp;-5.4&nbsp;&nbsp;1140&nbsp;&nbsp;5&nbsp;&nbsp;7
7&nbsp;N2&nbsp;&nbsp;&nbsp;1.6&nbsp;&nbsp;3.8&nbsp;-6.6&nbsp;&nbsp;1142&nbsp;&nbsp;6&nbsp;&nbsp;8
8&nbsp;H&nbsp;&nbsp;&nbsp;&nbsp;2.1&nbsp;&nbsp;3.9&nbsp;-7.5&nbsp;&nbsp;1143&nbsp;&nbsp;7
</pre>
<div class="p"><!----></div>
The first line contains the number of atoms. In each following line, the atom index, the atomic symbol (or name), the coordinates of the atom, the force field atom type number and the index of atoms bonded to the current atom. The coordinates in this file are not used and are replaced by the  S<span style="font-size:x-small">HARC</span>- M<span style="font-size:x-small">OLCAS</span> interface by the actual coordinates of the atoms. The atom type number can be looked up in the <b><tt>.prm</tt></b> files of the  T<span style="font-size:x-small">INKER</span> parameter directory. 
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc6.5"></a><h2>
6.5&nbsp;&nbsp;COLUMBUS Interface</h2><a id="sec:int:columbus">
</a>
<div class="p"><!----></div>
The  S<span style="font-size:x-small">HARC</span>- C<span style="font-size:x-small">OLUMBUS</span> interface allows to run  S<span style="font-size:x-small">HARC</span>&nbsp;dynamics based on  C<span style="font-size:x-small">OLUMBUS</span>' CASSCF, RASSCF and MRCI wave functions. 
The interface is compatible to  C<span style="font-size:x-small">OLUMBUS</span> calculations utilizing the  C<span style="font-size:x-small">OLUMBUS</span>- M<span style="font-size:x-small">OLCAS</span> interface ( S<span style="font-size:x-small">EWARD</span> integrals and  A<span style="font-size:x-small">LASKA</span> gradients), or using the  D<span style="font-size:x-small">ALTON</span> integral code distributed with  C<span style="font-size:x-small">OLUMBUS</span>. 
Using  S<span style="font-size:x-small">EWARD</span> integrals, spin-orbit couplings can be calculated, but no nonadiabatic couplings (only overlaps can thus be used).
Using  D<span style="font-size:x-small">ALTON</span> integrals, spin-orbit couplings are not possible, but nonadiabatic couplings can be calculated.
The CASSCF step can be done with either  C<span style="font-size:x-small">OLUMBUS</span>' <b><tt>mcscf</tt></b> code (all features available) or with  M<span style="font-size:x-small">OLCAS</span>' <b><tt>rasscf</tt></b> code (faster, but no gradients possible).
The interface utilizes the  WF<span style="font-size:x-small">OVERLAP</span> program to calculate the overlap matrices.
The interface can also calculate Dyson norms between neutral and ionic wave functions using the  WF<span style="font-size:x-small">OVERLAP</span> code.
<div class="p"><!----></div>
The interface needs as additional input the file <b><tt>QM/COLUMBUS.resources</tt></b> and a template directory containing all input files needed for the  C<span style="font-size:x-small">OLUMBUS</span> calculations. Initial MOs can be given in the file <b><tt>QM/mocoef_mc.init</tt></b>.
For multiple jobs, initial MOs can be given as <b><tt>QM/mocoef_mc.init.&lt;job&#62;</tt></b>.
For runs with <b><tt>rasscf</tt></b>, initial MOs have to be given as <b><tt>molcas.RasOrb.init</tt></b> or <b><tt>molcas.RasOrb.init.&lt;job&#62;</tt></b>.
<div class="p"><!----></div>
     <a id="tth_sEc6.5.1"></a><h3>
6.5.1&nbsp;&nbsp;Template input</h3>
<div class="p"><!----></div>
The interface does not generate the full  C<span style="font-size:x-small">OLUMBUS</span> input on-the-fly. Instead, the interface uses an existing set of input files and performs only necessary modifications (e.g., the number of states). The set of input files must be provided by the user. Please see the <a href="http://www.univie.ac.at/columbus/docs_COL70/documentation_main.html"> C<span style="font-size:x-small">OLUMBUS</span> online documentation</a> and, most importantly, the 
<a href="http://www.univie.ac.at/columbus/docs_COL70/tutorial-SO.pdf"> C<span style="font-size:x-small">OLUMBUS</span> SOCI tutorial</a> for a documentation of the necessary input.
The  S<span style="font-size:x-small">HARC</span>&nbsp;tutorial also has a section about generating the required  C<span style="font-size:x-small">OLUMBUS</span> input file collection.
An example template directory is located in <b><tt>$SHARC/../examples/SHARC_COLUMBUS/</tt></b>.
<div class="p"><!----></div>
Generally, the input consists of a directory with one subdirectory with input for each multiplicity (singlets, doublets, triplets, ...). However, even-electron wave functions of different multiplicities can be computed together in the same job if spin-orbit couplings are desired. Independent multiple-DRT inputs (ISC keyword) are also acceptable. Note that symmetry is not allowed when using the interface.
<div class="p"><!----></div>
The path to the template directory must be given in <b><tt>COLUMBUS.resources</tt></b>, along with the other resources settings.
<div class="p"><!----></div>
<b>Integral input&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The interface is able to use input for calculations using  S<span style="font-size:x-small">EWARD</span> or  D<span style="font-size:x-small">ALTON</span> integrals. 
If you want to calculate SOCs, you have to use  S<span style="font-size:x-small">EWARD</span> and have to include the AMFI keyword in the integral input.
If you use  D<span style="font-size:x-small">ALTON</span>, SOCs are not available, but it is possible to compute nonadiabatic couplings.
<div class="p"><!----></div>
It is important to make sure that <b>the order of atoms</b> in the template input files and in the  S<span style="font-size:x-small">HARC</span>&nbsp;input <b>is consistent</b>.
<div class="p"><!----></div>
Furthermore, it is necessary to prepare all template subdirectories with the same integral code and the same AO basis set. 
<div class="p"><!----></div>
<b>MCSCF input&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The MCSCF section can use any desired state-averaging scheme, since the number of states in MCSCF is independent of the number of states in the MRCI module. However, frozen core orbitals in the MCSCF step are not possible (since otherwise gradients cannot be computed). Prepare the MCSCF input for CI gradients. It is advisable to use very tight MCSCF convergence criteria.
<div class="p"><!----></div>
If gradients are not needed, you can also manually prepare a  M<span style="font-size:x-small">OLCAS</span> RASSCF input in <b><tt>molcas.input</tt></b>, in order to use  M<span style="font-size:x-small">OLCAS</span> RASSCF instead of  C<span style="font-size:x-small">OLUMBUS</span> MCSCF (see <b><tt>molcas_rasscf</tt></b> keyword).
<div class="p"><!----></div>
<b>MRCI input&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Either prepare a single-DRT input without SOCI (to cover a single multiplicity), a single-DRT input with SOCI and a sufficient maximum multiplicity for spin-orbit couplings or an independent multiple-DRT input (as, e.g., for ISC optimizations). Make sure that all multiplicities are covered with all input directories.
<div class="p"><!----></div>
In the MRCI input, make sure to use sequential <b><tt>ciudg</tt></b>. Also take care to setup gradient input on MRCI level.
<div class="p"><!----></div>
<b>Job control&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Setup a single-point calculation with the following steps:
<ul>
<li> SCF
<div class="p"><!----></div>
</li>
<li> MCSCF
<div class="p"><!----></div>
</li>
<li> MR-CISD (serial operation) <b>or</b> SO-CI coupled to non-rel CI (for SOCI DRT inputs)
<div class="p"><!----></div>
</li>
<li> one-electron properties for all methods
<div class="p"><!----></div>
</li>
<li> transition moments for MR-CISD
<div class="p"><!----></div>
</li>
<li> nonadiabatic couplings (and/or gradients)
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
Request first transition moments and interstate couplings (or alternatively full nonadiabatic couplings if Dalton integrals are used) in the following dialogues. Analysis in internal coordinates and intersection slope analysis are not required.
<div class="p"><!----></div>
     <a id="tth_sEc6.5.2"></a><h3>
6.5.2&nbsp;&nbsp;Resource file: <b><tt>COLUMBUS.resources</tt></b></h3>
<div class="p"><!----></div>
Beyond the information from <b><tt>QM.in</tt></b> the interface needs additional input, which is read from the file <b><tt>COLUMBUS.resources</tt></b>. Table&nbsp;<a href="#tab:columbus_sh2"> 6.8</a> lists the keywords which can be given in the file.
A fully commented resource file with all possible options is located in <b><tt>$SHARC/../examples/SHARC_COLUMBUS/</tt></b>.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb6.8">
</a> 
<div style="text-align:center">      
<table>
<tr><td colspan="3" align="left"><div style="text-align:center">Table 6.8: Keywords for the <b><tt>COLUMBUS.resources</tt></b> file.</div></td></tr><a id="tab:columbus_sh2">
</a>
<tr><td align="left"></td></tr>
<tr><td align="left"><span class="roman">Keyword     </td><td align="left">Description</td></tr>
<tr><td align="left"></td></tr>
<tr><td align="left">
<div class="p"><!----></div>
<div class="p"><!----></div>
<div class="p"><!----></div>
<div class="p"><!----></div>
columbus        </td><td align="left">Path to the  C<span style="font-size:x-small">OLUMBUS</span> main directory. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used.</td></tr>
<tr><td align="left">molcas          </td><td align="left">Path to the  M<span style="font-size:x-small">OLCAS</span> main directory.  Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. This path is only used for overlap/Dyson calculations (since in this case the interface calls  M<span style="font-size:x-small">OLCAS</span> explicitly). Otherwise  C<span style="font-size:x-small">OLUMBUS</span> will use the path to  M<span style="font-size:x-small">OLCAS</span> specified during the installation of  C<span style="font-size:x-small">OLUMBUS</span>.</td></tr>
<tr><td align="left">wfoverlap       </td><td align="left">Path to the wave function overlap and Dyson norm code. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. Only necessary if overlaps or Dyson norms are calculated. Needs a suitable code that computes overlaps of CI wave functions.</td></tr>
<tr><td align="left">runc            </td><td align="left">Path to the <b><tt>runc</tt></b> script for  C<span style="font-size:x-small">OLUMBUS</span> execution. Default is <b><tt>$COLUMBUS/runc</tt></b>. This keyword is intended for users who like to modify <b><tt>runc</tt></b>.</td></tr>
<tr><td align="left">scratchdir      </td><td align="left">Path to the temporary directory, used to perform the  C<span style="font-size:x-small">OLUMBUS</span> calculations. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. If it does not exist, the interface will create it. The interface will delete this directory after the calculation.</td></tr>
<tr><td align="left">savedir         </td><td align="left">Path to another directory.  Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. The interface will store files needed for restart in this directory. Default is a subdirectory of the directory where the interface is executed.</td></tr>
<tr><td align="left">memory          </td><td align="left">(integer, MB) Memory for  C<span style="font-size:x-small">OLUMBUS</span>. The maximum amount of memory used by the wfoverlap code is also controlled with this keyword.</td></tr>
<tr><td align="left">ncpu            </td><td align="left">(integer) Number of CPU cores to use for SMP-parallel execution of the wfoverlap code. Parallel  C<span style="font-size:x-small">OLUMBUS</span> is currently not supported.</td></tr>
<tr><td align="left">wfthres         </td><td align="left">(float) Gives the amount of wave function norm which will be kept in the truncation of the determinant files for Dyson and overlap calculations. Default is 0.97 (i.e., the wave functions in the determinant files will have a norm of 0.97)</td></tr>
<tr><td align="left">nooverlap       </td><td align="left">(no argument) Do not keep the files necessary to calculate wave function overlaps in the next time step. If Dyson norms are requested, <b><tt>nooverlap</tt></b> is ignored.</td></tr>
<tr><td align="left">always_orb_init    </td><td align="left">Use the initial MO guess (<b><tt>mocoef_mc.init</tt></b>) for all time steps, not only for the first step.</td></tr>
<tr><td align="left">always_guess     </td><td align="left">In all time steps obtain the MO guess from an SCF calculation, instead of using the MOs from the previous step.</td></tr>
<tr><td align="left">integrals       </td><td align="left">Followed by a string which is either <b><tt>seward</tt></b> or <b><tt>dalton</tt></b>. Chooses the integral program for  C<span style="font-size:x-small">OLUMBUS</span>. Note that with  D<span style="font-size:x-small">ALTON</span> integrals SOC is not available. Default is <b><tt>seward</tt></b>.</td></tr>
<tr><td align="left">molcas_rasscf  </td><td align="left">Use  M<span style="font-size:x-small">OLCAS</span>' RASSCF program instead of  C<span style="font-size:x-small">OLUMBUS</span>' MCSCF program. Needs a properly prepared  C<span style="font-size:x-small">OLUMBUS</span> input (<b><tt>&amp;RASSCF</tt></b> section in <b><tt>molcas.input</tt></b>). Note that gradients are not available in this mode.</td></tr>
<tr><td align="left">template        </td><td align="left">Is followed by the path to the directory containing the template subdirectories. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. See also <a href="#int:col:template">6.5.3</a>.</td></tr>
<tr><td align="left">DIR             </td><td align="left">See <a href="#int:col:template">6.5.3</a>.</td></tr>
<tr><td align="left">MOCOEF          </td><td align="left">See <a href="#int:col:template">6.5.3</a>.</td></tr>
<tr><td align="left">numfrozcore           </td><td align="left">Can be used to override the number of frozen orbitals in Dyson calculations (Default is the value from the <b><tt>cidrt</tt></b> input).</td></tr>
<tr><td align="left">numocc           </td><td align="left">Can be used to declare orbitals above the frozen orbitals as doubly occupied in Dyson calculations. No ionization from these orbitals is calculated, but otherwise they are considered in the Dyson calculations. Default is zero.</td></tr>
<tr><td align="left">debug           </td><td align="left">Increases the verbosity of the interface.</td></tr>
<tr><td align="left">no_print       </td><td align="left">Reduces interface standard output.</td></tr>
<tr><td align="left"></td></tr></span></table>
</div>
<div class="p"><!----></div>
     <a id="tth_sEc6.5.3"></a><h3>
6.5.3&nbsp;&nbsp;Template setup</h3><a id="int:col:template">
</a>
<div class="p"><!----></div>
The template directory contains several subdirectories with input for different multiplicities. An example is given in figure&nbsp;<a href="#fig:dirs_COLtemp"> 6.2</a>. In <b><tt>COLUMBUS.resources</tt></b>, the user has to associate each multiplicity to a subdirectory. The line "<b><tt>DIR 1 Sing_Trip</tt></b>" would make the interface use the input files from the subdirectory <b><tt>Sing_Trip</tt></b> when calculating singlet states (the <b><tt>1</tt></b> refers to singlet calculations). All calculations using a particular input subdirectory are called a job.
<div class="p"><!----></div>
Additionally, the user must specify which job(s) provide the MO coefficients (e.g., the calculation for doublet states could be based on the same MOs as the singlet and triplet calculation). The line "<b><tt>MOCOEF Doub_Quar Sing_Trip</tt></b>" would tell the interface to do a MCSCF calculation in the <b><tt>Sing_Trip</tt></b> job, and reuse the MOs when doing the <b><tt>Doub_Quar</tt></b> job without reoptimizing the MOs.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_fIg6.2">
</a>   <div style="text-align:center">  <img src="http://sharc-md.org/wp-content/uploads/2018/02/dirs_COLtemp.png">  
<div style="text-align:center">Figure 6.2: Example directory structure of the  C<span style="font-size:x-small">OLUMBUS</span> template directory</div>
  <a id="fig:dirs_COLtemp">
</a>
</div>
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc6.6"></a><h2>
6.6&nbsp;&nbsp;Analytical PESs Interface</h2><a id="sec:int:analytical">
</a>
<div class="p"><!----></div>
The  S<span style="font-size:x-small">HARC</span>&nbsp;suite also contains an interface which allows to run dynamics simulations on PESs expressed with analytical functions.
In order to allow dynamics simulations in the same way as it is done on-the-fly, the interface uses two kinds of potential couplings:
<ul>
<li> couplings that are pre-diagonalized in the interface (yielding the equivalent of the MCH basis),
<div class="p"><!----></div>
</li>
<li> couplings given by the interface to  S<span style="font-size:x-small">HARC</span>&nbsp;as off-diagonal elements.
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
The interface needs one additional input file, called <b><tt>Analytical.template</tt></b>, which contains the definitions of all analytical expressions.
<div class="p"><!----></div>
     <a id="tth_sEc6.6.1"></a><h3>
6.6.1&nbsp;&nbsp;Parametrization</h3>
<div class="p"><!----></div>
The interface has to be provided with analytical expressions for all matrix elements of the following matrices in the diabatic basis:
<ul>
<li> Hamiltonian: <b>H</b>
<div class="p"><!----></div>
</li>
<li> Derivative of the Hamiltonian with respect to each atomic coordinate: <b>H</b><sub>x<sub>i</sub></sub>
<div class="p"><!----></div>
</li>
<li> (Transition) dipole matrices for each polarization direction: <b>M</b><sub>i</sub>
<div class="p"><!----></div>
</li>
<li> Real and imaginary part of the SOC matrix: &#931;
<div class="p"><!----></div>
</li>
<li> (Optionally) the derivatives of the transition dipole matrices: <b>D</b><sub>i,x<sub>j</sub></sub>
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
The diabatic Hamiltonian is diagonalized:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-4.png">
</td><td width="1%">(6.1)</td></tr></table>
<div class="p"><!----></div>
Then the following calculations lead to the MCH matrices which are passed to  S<span style="font-size:x-small">HARC</span>:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-5.png">
</td><td width="1%">(6.2)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-6.png">
</td><td width="1%">(6.3)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-7.png">
</td><td width="1%">(6.4)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-8.png">
</td><td width="1%">(6.5)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-9.png">
</td><td width="1%">(6.6)</td></tr></table>
The MCH Hamiltonian is the diagonalized diabatic Hamiltonian plus the SO matrix transformed into the MCH basis. The gradients in the MCH basis are obtained by transforming the derivative matrices into the MCH basis. The dipole matrices are also simply transformed into the MCH basis. The overlap matrix is the overlap of old and new transformation matrix.
<div class="p"><!----></div>
     <a id="tth_sEc6.6.2"></a><h3>
6.6.2&nbsp;&nbsp;Template file: <b><tt>Analytical.template</tt></b></h3>
<div class="p"><!----></div>
The interface-specific input file is called <b><tt>Analytical.template</tt></b>. It contains the analytical expressions for all matrix elements mentioned above. All analytical expressions in this file are evaluated considering the atomic coordinates read from <b><tt>QM.in</tt></b>.
<div class="p"><!----></div>
The file consists of a file header and the file body. The file body consists of variable definition blocks and matrix blocks.
A commented template file is located in <b><tt>$SHARC/../examples/SHARC_Analytical/</tt></b>.
<div class="p"><!----></div>
<b>Header&nbsp;&nbsp;</b> 
<div class="p"><!----></div>
The header looks similar to an xyz file:
<pre>
2
2
I&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0
Br&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xBr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0
</pre>
Here, the first line gives the number of atoms and the second line the number of states. 
<div class="p"><!----></div>
On the remaining lines, each Cartesian component of the atomic coordinates is associated to a variable name, which can be used in the analytical expressions. If a zero (<b><tt>0</tt></b>) is given instead of a variable name, then the corresponding Cartesian coordinate is neglected. In the above example, the variable name <b><tt>xI</tt></b> is associated with the x coordinate of the first atom given in <b><tt>QM.in</tt></b>. The y and z coordinates of the first atom are neglected.
<div class="p"><!----></div>
All variable names must be <a href="https://docs.python.org/2/reference/lexical_analysis.html#identifiers">valid Python identifiers</a> and must not start with an underscore. Hence, all strings starting with a letter, followed by an arbitrary number of letters, digits and underscores, are valid. It is not allowed to use a variable name twice.
<div class="p"><!----></div>
Note that the file header also contains the atom labels, which are just used for cross-checking against the atom labels in <b><tt>QM.in</tt></b>.
<div class="p"><!----></div>
The file header must not contain comments, neither at the end of a line nor separate lines. Also, blank lines are not allowed in the header. After the last line of the header (where the variables for the n<sub>atom</sub>-th atom are defined), blank lines and comments can be used freely (except in matrix blocks).
<div class="p"><!----></div>
<b>Variable definition blocks&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Variable definition blocks can be used to store additional numerical values (beyond the atomic coordinates) in variables, which can then be used in the equations in the matrix blocks. The most obvious use for this is of course to define values which will appear several times in the equations.
<div class="p"><!----></div>
A variable definition block looks like:
<pre>
Variables
A1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.067
g1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.996&nbsp;&nbsp;&nbsp;#&nbsp;Trailing&nbsp;comment
#&nbsp;Blank&nbsp;line&nbsp;with&nbsp;comment&nbsp;only
R1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4.666
End
</pre>
Each block starts with the keyword "Variables" and is terminated with "End". Inbetween, on each line a variable name and the corresponding numerical value (separated by blanks) can be given. Note that the naming conventions given above also apply to variables defined in these blocks. 
<div class="p"><!----></div>
There can be any number of complete variable definitions blocks in the input file. All blocks are read first, before any matrix expressions are evaluated. Hence, the relative order of the variable blocks and the matrix blocks does not matter. Also, note that variable names must not appear twice, so variables cannot be redefined halfway through the file.
<div class="p"><!----></div>
<b>Matrix blocks&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The most important information in the input file are of course contained in the expressions in the matrix blocks. In general, a matrix block has the following format:
<pre>
Matrix_Identifier
V11
V12,&nbsp;&nbsp;&nbsp;&nbsp;V22
V13,&nbsp;&nbsp;&nbsp;&nbsp;V23,&nbsp;&nbsp;&nbsp;&nbsp;V33
...
</pre>
The first line identifies the type of matrix. Those are valid identifiers:
<div class="p"><!----></div>
<table>
<tr><td width="197"><b><tt>Hamiltonian</tt></b>                               </td><td width="355">Defines the Hamiltonian including the diabatic potential couplings.</td></tr>
<tr><td width="197"><b><tt>Derivatives</tt></b> followed by a variable name   </td><td width="355">Derivative of the Hamiltonian with respect to the given variable.</td></tr>
<tr><td width="197"><b><tt>Dipole</tt></b> followed by 1, 2 or 3              </td><td width="355">(Transition) dipole moment matrix for Cartesian direction x, y or z, respectively.</td></tr>
<tr><td width="197"><b><tt>Dipolederivatives</tt></b> followed by 1, 2 or 3 followed by a variable name       </td><td width="355">Derivative of the respective dipole moment matrix.</td></tr>
<tr><td width="197"><b><tt>SpinOrbit</tt></b> followed by <b><tt>R</tt></b> or <b><tt>I</tt></b>  </td><td width="355">Real or Imaginary (respectively) part of the spin-orbit coupling matrix &#931;.</td></tr></table>
<div class="p"><!----></div>
Since the interface searches the file for these identifiers starting from the top until it is found, for each matrix only the first block takes effect. Note that the Hamiltonian and all relevant derivatives must be present. If dipole matrix, dipole derivative matrix or SO matrix definitions are missing, they will be assumed zero.
<div class="p"><!----></div>
In the lines after the identifier, the expressions for each matrix element are given. Note the lower triangular format (all matrices are assumed symmetric, except the imaginary part of the SO matrix, which is assumed antisymmetric). Matrix elements must be separated by commas (so that whitespace can be used inside the expressions). There must be at least as many lines as the number of states (additional lines are neglected). If any line or matrix element is missing, the interface will abort.
<div class="p"><!----></div>
An examplary block looks like:
<pre>
Hamiltonian
A1*(&nbsp;(1.-math.exp(g1*(R1-xI+xBr)))**2-1.),
0.0006,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3e-5*(xI-xBr)**2
</pre>
It is important to understand that the expressions are directly evaluated by the Python interpreter, hence all expressions must be valid Python expressions which evaluate to numeric (integer or float) values. Only the variables defined above can be used. 
<div class="p"><!----></div>
Note that exponentiation in Python is <b><tt>**</tt></b>. In order to provide most usual mathematical functions, the <a href="https://docs.python.org/2/library/math.html"><b><tt>math</tt></b> module</a> is available. Among others, the <b><tt>math</tt></b> module provides the following functions:
<ul>
<li> <b><tt>math.exp(x)</tt></b>: Exponential function
<div class="p"><!----></div>
</li>
<li> <b><tt>math.log(x)</tt></b>: Natural logarithm
<div class="p"><!----></div>
</li>
<li> <b><tt>math.pow(x,y)</tt></b>: x<sup>y</sup>
<div class="p"><!----></div>
</li>
<li> <b><tt>math.sqrt(x)</tt></b>: &#8730;x
<div class="p"><!----></div>
</li>
<li> <b><tt>math.cos(x)</tt></b>, <b><tt>math.sin(x)</tt></b>, <b><tt>math.tan(x)</tt></b>
<div class="p"><!----></div>
</li>
<li> <b><tt>math.acos(x)</tt></b>, <b><tt>math.asin(x)</tt></b>, <b><tt>math.atan(x)</tt></b>
<div class="p"><!----></div>
</li>
<li> <b><tt>math.atan2(y,x)</tt></b>: tan<sup>&#8722;1</sup>([y/x]), as in many programming languages (takes care of phases)
<div class="p"><!----></div>
</li>
<li> <b><tt>math.pi</tt></b>, <b><tt>math.e</tt></b>: &#960; and Euler's number
<div class="p"><!----></div>
</li>
<li> <b><tt>math.cosh(x)</tt></b>, <b><tt>math.sinh(x)</tt></b>: Hyperbolic functions (also tanh, acosh, asinh, atanh are available)
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc6.7"></a><h2>
6.7&nbsp;&nbsp;ADF Interface</h2><a id="sec:int:adf">
</a>
<div class="p"><!----></div>
The  S<span style="font-size:x-small">HARC</span>-ADF interface allows to run  S<span style="font-size:x-small">HARC</span>&nbsp;simulations with ADF's TD-DFT functionality.
The interface is compatible with restricted and unrestricted ground states, but not with symmetry.
Spin-orbit couplings are obtained with the perturbative ZORA formalism, and wave function overlaps from the  WF<span style="font-size:x-small">OVERLAP</span> code are available (but no nonadiabatic couplings).
Dyson norms can also be computed through the  WF<span style="font-size:x-small">OVERLAP</span> code.
 T<span style="font-size:x-small">HEO</span>DORE can be used to perform automatic wave function analysis.
QM/MM is possible through ADF's internal implementation, but only mechanical embedding is currently available in ADF.
<div class="p"><!----></div>
The interface needs two additional input files, a template file for the quantum chemistry (file name is <b><tt>ADF.template</tt></b>) and a resource file (<b><tt>ADF.resources</tt></b>). 
If files <b><tt>QM/ADF.t21.&lt;job&#62;.init</tt></b> are are present, they are used to provide an initial orbital guess for the SCF calculation of the respective job.
<div class="p"><!----></div>
Before running the ADF interface, it is necessary to source one of the <b><tt>adfrc</tt></b> files, so that Python can find the <b><tt>kf</tt></b> module of ADF.
<div class="p"><!----></div>
Note that for full functionality of the interface, a very new ADF version is necessary. The computation of wave function overlaps requires at least ADF2017 (Dyson norms work with older ADF). Using the <b><tt>dvd_residu</tt></b> or <b><tt>qmmm_coupling 2</tt></b> options (see below) requires at least ADF2017.207 or ADF2018. Using <b><tt>rihartreefock</tt></b> (see below) requires at least ADF2016. 
<div class="p"><!----></div>
     <a id="tth_sEc6.7.1"></a><h3>
6.7.1&nbsp;&nbsp;Template file: <b><tt>ADF.template</tt></b></h3>
<div class="p"><!----></div>
This file contains the specifications for the quantum chemistry calculation. Note that this is not a valid  ADF input file. The file only contains a number of keywords, given in table&nbsp;<a href="#tab:adf_temp"> 6.9</a>. The actual input for  ADF will be generated automatically through the interface.
In order to enable many functionalities of ADF and to allow fine-tuning of the performance for large calculations, the template has a relatively large number of keywords.
<div class="p"><!----></div>
A fully commented template file-with all possible options, a comprehensive descriptions, and some practical hints-is located in <b><tt>$SHARC/../examples/SHARC_ADF/ADF.template</tt></b>.
We recommend that users start from this template file and modify it appropriately for their calculations.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb6.9">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 6.9: Keywords for the <b><tt>ADF.template</tt></b> file.</div>
  <a id="tab:adf_temp">
</a>
  <span class="small">
<table>
<tr><td align="left">Keyword       </td><td align="left">Description</td></tr>
<tr><td align="left">relativistic            </td><td align="left">If not given, perform a nonrelativistic calculation. Otherwise, copy the line verbatim to the ADF input.
</td></tr>
<tr><td align="left">basis                   </td><td align="left">Gives the basis set for all atoms (default SZ).
</td></tr>
<tr><td align="left">basis_path             </td><td align="left">gives the path to the basis library of ADF (&nbsp;and $ can be used).
</td></tr>
<tr><td align="left">basis_per_element     </td><td align="left">Followed by an elemental symbol (e.g., "Fe", "H.1") and then by a path to the desired ADF basis set file. Files with frozen core should not be used.
</td></tr>
<tr><td align="left">define_fragment        </td><td align="left">Followed by an elemental symbol (e.g., "Fe", "H.1") and then by a list of atom numbers which should belong to this atom type.
</td></tr>
<tr><td align="left">functional              </td><td align="left">followed by two strings. First argument gives the type of functional (LDA, GGA, hybrid), second argument gives the functional (VWN, BP86, B3LYP, ...).
</td></tr>
<tr><td align="left">functional_xcfun       </td><td align="left">Enables functional evaluation with the XCFun library within ADF.
</td></tr>
<tr><td align="left">dispersion              </td><td align="left">If present, is written verbatim to ADF input with all arguments.
</td></tr>
<tr><td align="left">charge                  </td><td align="left">Sets the total charge of the (QM) system. Can be either followed by a single integer (then the interface will automatically assign the charges to the multiplicities) or by one charge per multiplicity. Automatic assignment might not work for QM/MM computations.
</td></tr>
<tr><td align="left">totalenergy             </td><td align="left">Activates the computation of total energies (by default, ADF computes binding energies). Does not work for relativistic or QM/MM calculations.
</td></tr>
<tr><td align="left">cosmo                   </td><td align="left">Followed by a string giving a solvent. Activates COSMO (no gradients possible).
</td></tr>
<tr><td align="left">cosmo_neql             </td><td align="left">Activates non-equilibrium solvation, which is needed for vertical excitation calculations. Is followed by a float giving the square of the refractive index of the solvent.
</td></tr>
<tr><td align="left">grid                    </td><td align="left">Followed by two strings (e.g., <b><tt>beckegrid normal</tt></b> or <b><tt>integration 4.0</tt></b>) defining which integration grid and accuracy to use. For details, see the example template file.
</td></tr>
<tr><td align="left">grid_qpnear            </td><td align="left">Followed by a float giving the maximum distance (in Bohr) an MM point charge can have from a QM atom, such that integration grid points are generated around the MM charge.
</td></tr>
<tr><td align="left">grid_per_atom         </td><td align="left">Followed by a string (e.g., <b><tt>basic</tt></b>, <b><tt>normal</tt></b>, <b><tt>good</tt></b>) and a list of the atoms which should have the given integration accuracy. Can be used multiple times with different qualities.
</td></tr>
<tr><td align="left">fit                     </td><td align="left">Followed by two strings (e.g., <b><tt>zlmfit normal</tt></b> or <b><tt>stofit</tt></b>) defining which Coulomb integration method and accuracy to use. For details, see the example template file.
</td></tr>
<tr><td align="left">fit_per_atom          </td><td align="left">Works like <b><tt>grid_per_atom</tt></b>, but for the Coulomb method accuracy.
</td></tr>
<tr><td align="left">exactdensity            </td><td align="left">Enables the <b><tt>exactdensity</tt></b> keyword in the ADF input.
</td></tr>
<tr><td align="left">rihartreefock           </td><td align="left">Followed by a quality keyword (e.g., <b><tt>basic</tt></b>, <b><tt>normal</tt></b>, <b><tt>good</tt></b>). If not present, the old HF exchange routines in ADF are used.
</td></tr>
<tr><td align="left">rihf_per_atom         </td><td align="left">Works like <b><tt>grid_per_atom</tt></b>, but for the RI Hartree Fock method.
</td></tr>
<tr><td align="left">occupations             </td><td align="left">If present, the foll line is copied verbatim to the ADF input.
</td></tr>
<tr><td align="left">scf_iterations         </td><td align="left">Followed by the maximum number of SCF iterations (default: 100)
</td></tr>
<tr><td align="left">linearscaling           </td><td align="left">Followed by an integer (between 0 and 99), which controls whether certain terms are neglected in ADF.
</td></tr>
<tr><td align="left">cpks_eps               </td><td align="left">Followed by a float (default 0.0001) giving the convergence threshold in the CPKS equations for excited-state gradients.
</td></tr>
<tr><td align="left">no_tda                 </td><td align="left">This keyword deactivates TDA, which the interface requests by default.
</td></tr>
<tr><td align="left">paddingstates           </td><td align="left">Followed by a list of integers, which give the number of extra states to compute by ADF, but which are neglected in the output. Should not be changed between time steps, as this will break ADF's restart routines.
</td></tr>
<tr><td align="left">dvd_vectors            </td><td align="left">Number of Davidson vectors. Default: min(40,nstates+40).
</td></tr>
<tr><td align="left">dvd_tolerance          </td><td align="left">Energy convergence criterion for the excited states (in Hartree).
</td></tr>
<tr><td align="left">dvd_residu             </td><td align="left">Residual norm convergence criterion for the excited states. Only works for ADF version  &#8805; 2017.207 or ADF2018.
</td></tr>
<tr><td align="left">dvd_mblocksmall        </td><td align="left">Activates the <b><tt>mblocksmall</tt></b> keyword in the ADF input. This undocumented keyword changes how the Davidson algorithm works. In reduces computation time, but might lead to incomplete convergence in certain cases.
</td></tr>
<tr><td align="left">unrestricted_triplets  </td><td align="left">Requests that the triplets are calculated in a separate job from an unrestricted ground state. Default is to compute triplets as linear response of the restricted singlet ground state.
</td></tr>
<tr><td align="left">modifyexcitations       </td><td align="left">Followed by an integer, indicating that excitation should only be possible from the first n MOs. Can be used to compute core-excitation states (for X-Ray spectra).
</td></tr>
<tr><td align="left">qmmm                    </td><td align="left">Activates QM/MM. In this case, the interface will look for two additional input files (see below).
</td></tr>
<tr><td align="left">qmmm_coupling          </td><td align="left">Followed by an integer (1=mechanical embedding, 2=electrostatic embedding). Default is 1, option 2 only works for ADF version  &#8805; 2017.207 or ADF2018.</td></tr></table>
</span></div>
<div class="p"><!----></div>
     <a id="tth_sEc6.7.2"></a><h3>
6.7.2&nbsp;&nbsp;Resource file: <b><tt>ADF.resources</tt></b></h3>
<div class="p"><!----></div>
The file <b><tt>ADF.resources</tt></b> contains mainly paths (to the  ADF executables, to the scratch directory, etc.) and other resources, plus settings for <b><tt>wfoverlap.x</tt></b> and  T<span style="font-size:x-small">HEO</span>DORE. This file must reside in the same directory where the interface is started. It uses a simple "<b><tt>keyword argument</tt></b>" syntax. Comments using # and blank lines are possible, the order of keywords is arbitrary. Lines with unknown keywords are ignored, since the interface just searches the file for certain keywords.
<div class="p"><!----></div>
Table&nbsp;<a href="#tab:adf_sh2"> 6.10</a> lists the existing keywords.
A fully commented resource file with all possible options and comprehensive descriptions is located in <b><tt>$SHARC/../examples/SHARC_ADF/</tt></b>.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb6.10">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 6.10: Keywords for the <b><tt>ADF.resources</tt></b> file.</div>
  <a id="tab:adf_sh2">
</a>
<table>
<tr><td align="left">Keyword       </td><td align="left">Description</td></tr>
<tr><td align="left">adfhome                 </td><td align="left">Is the path to the  ADF installation. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. The interface will set <b><tt>$ADFHOME</tt></b> to this path, and will set the <b><tt>$ADFBIN</tt></b>.
</td></tr>
<tr><td align="left">scmlicense              </td><td align="left">Is the path to the  ADF license file. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. 
</td></tr>
<tr><td align="left">scm_tmpdir             </td><td align="left">Path to the ADF-internal scratch directory. Usually, this is set at installation, but can be overridden here. Should not exist and must not be identical to scratchdir.
</td></tr>
<tr><td align="left">scratchdir              </td><td align="left">Is a path to the temporary directory. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. If it does not exist, the interface will create it. In any case, the interface will delete this directory after the calculation.
</td></tr>
<tr><td align="left">savedir                 </td><td align="left">Is a path to another temporary directory.  Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. The interface will store files needed for restart there.
</td></tr>
<tr><td align="left">memory                  </td><td align="left">The memory usable by  WF<span style="font-size:x-small">OVERLAP</span>. The default is 100&nbsp;MB. The ADF memory usage cannot be controlled.
</td></tr>
<tr><td align="left">ncpu                    </td><td align="left">The number of CPUs used by the interface. Is overridden by environment variables from queuing engines (e.g., <b><tt>$NSLOTS</tt></b> or <b><tt>$SLURM_NTASKS_PER_NODE</tt></b>). Will either be used to run ADF in parallel or to run several independent ADF runs at the same time.
</td></tr>
<tr><td align="left">schedule_scaling       </td><td align="left">Gives the expected parallelizable fraction of the ADF run time (Amdahl's law). With a value close to zero, the interface will try to run all jobs at the same time. With values close to one, jobs will be run sequentially with the maximum number of cores.
</td></tr>
<tr><td align="left">delay                   </td><td align="left">Followed by a float giving the delay in seconds between starting parallel jobs to avoid excessive disk I/O (usually not necessary).
</td></tr>
<tr><td align="left">qmmm_table             </td><td align="left">Followed by the path to the connection table file, in ADF format.
</td></tr>
<tr><td align="left">qmmm_ff_file          </td><td align="left">Followed by the path to the force field file, in Amber95-like format for ADF.
</td></tr>
<tr><td align="left">wfoverlap               </td><td align="left">Path to the  WF<span style="font-size:x-small">OVERLAP</span> code. Needed for overlap and Dyson norm calculations.
</td></tr>
<tr><td align="left">wfthres                 </td><td align="left">(float) Gives the amount of wave function norm which will be kept in the truncation of the determinant files. Default is 0.99 (i.e., the wave functions in the determinant files will have a norm of 0.99). Note that if hybrid functionals and no TDA are used, the response vector can have a norm larger than one, and wfthres should be increased.
</td></tr>
<tr><td align="left">numfrozcore             </td><td align="left">Number of frozen core orbitals for overlap and Dyson norm calculations. A value of -1 enables automatic frozen core.
</td></tr>
<tr><td align="left">numocc                  </td><td align="left">Number of ignored occupied orbitals in Dyson calculations.
</td></tr>
<tr><td align="left">nooverlap               </td><td align="left">Do not save determinant files for overlap computations.
</td></tr>
<tr><td align="left">theodir                 </td><td align="left">Path to the  T<span style="font-size:x-small">HEO</span>DORE installation. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. The interface will set <b><tt>$PYTHONPATH</tt></b> automatically.
</td></tr>
<tr><td align="left">theodore_prop          </td><td align="left">Followed by a list with the descriptors which  T<span style="font-size:x-small">HEO</span>DORE should compute. Note that descriptors will only be computed for restricted singlets (and triplets). Instead of a simple list, a Python literal can also be used, as in the  T<span style="font-size:x-small">HEO</span>DORE input files.
</td></tr>
<tr><td align="left">theodore_fragment      </td><td align="left">Followed by a list of atom numbers which should constitute a fragment in  T<span style="font-size:x-small">HEO</span>DORE. For multiple fragments, the keyword can be used multiple times. Instead, the keyword can be followed by a Python literal, as in the  T<span style="font-size:x-small">HEO</span>DORE input files.
</td></tr>
<tr><td align="left">always_orb_init       </td><td align="left">Do not use the orbital guesses from previous calculations/time steps, but always use the provided initial orbitals.
</td></tr>
<tr><td align="left">always_guess           </td><td align="left">Always use the orbital guess from ADF.
</td></tr>
<tr><td align="left">debug                 </td><td align="left">Increases the verbosity of the interface (standard out). Does not clean up the scratch directory. Copies all ADF outputs to the save directory.
</td></tr>
<tr><td align="left">no_print             </td><td align="left">Reduces interface standard output.
</td></tr></table>
</div>
<div class="p"><!----></div>
<b>Parallelization&nbsp;&nbsp;</b>
<div class="p"><!----></div>
ADF usually shows very good parallel scaling for most calculations.
However, it is more efficient to carry out multiple ADF calculations (different multiplicities, multiple gradients) in parallel, each one using a smaller number of CPUs.
<div class="p"><!----></div>
In the  S<span style="font-size:x-small">HARC</span>-ADF interface, parallelization is controlled by the keywords <b><tt>ncpu</tt></b> and <b><tt>schedule_scaling</tt></b>.
The first keyword controls the maximum number of CPUs which the interface is allowed to use for all ADF runs simultaneously.
The second keyword is the parallel fraction from Amdahl's Law, see Section&nbsp;<a href="#met:amdahl">8.3</a>.
With a value close to zero, the interface will try to run all jobs at the same time. With values close to one, jobs will be run sequentially with the maximum number of cores.
Typical values for <b><tt>schedule_scaling</tt></b> are 0.95 for GGA functionals, 0.75 for hybrid functionals, and 0.90 for hybrid functions in combination with the <b><tt>rihartreefock</tt></b> option.
<div class="p"><!----></div>
Note that it is very advantageous to set <b><tt>schedule_scaling</tt></b> appropriately if the ADF installation is older than version 2017.207, because in this case all gradients need to be done in separate ADF runs, leading to a relatively large number of ADF runs.
If one uses ADF2018 (or ADF &#8805; 2017.207), then multiple gradients can be computed in one ADF run, so that in many cases only one ADF run is carried out and <b><tt>schedule_scaling</tt></b> becomes irrelevant.
<div class="p"><!----></div>
     <a id="tth_sEc6.7.3"></a><h3>
6.7.3&nbsp;&nbsp;QM/MM force field file: <b><tt>ADF.qmmm.ff</tt></b></h3>
<div class="p"><!----></div>
The force field file for ADF contains all force field parameters for the MM part of the QM/MM calculation.
The interface uses this file without any modification, except that it will copy the file into the relevant scratch directory.
<div class="p"><!----></div>
The force field file needs to be in the format specified in the <a href="https://www.scm.com/doc/QMMM/ADF_QMMM/The_Force_Field_File.html">ADF manual</a>, which is similar in format to an  A<span style="font-size:x-small">MBER</span> parameter file.
<b><tt>$SHARC/../examples/SHARC_ADF/ADF.qmmm.ff</tt></b> contains a functioning example of the file format.
Here, we only show briefly the general format:
<pre>
FORCE_FIELD_SETTINGS
=================================
&nbsp;ELSTAT_1-4_SCALE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.8333
&nbsp;ELSTAT_NB_CUTOFF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;none
&nbsp;VDW_1-4_SCALE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.5
&nbsp;VDW_DEFAULT_POTENTIAL&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(1:6-12&nbsp;&nbsp;&nbsp;2:exp-6&nbsp;&nbsp;3:exp&nbsp;purely&nbsp;repulsive)
&nbsp;VDW_NB_CUTOFF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;none
&nbsp;DIELECTRIC_CONSTANT&nbsp;&nbsp;&nbsp;&nbsp;1.000&nbsp;
=================================
MASSES&nbsp;&amp;&nbsp;ATOM&nbsp;LABELS
--------------------------------
force_field&nbsp;&nbsp;atomic
&nbsp;atom_type&nbsp;&nbsp;&nbsp;symbol&nbsp;&nbsp;&nbsp;&nbsp;mass&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOTES
================================
&nbsp;&nbsp;&nbsp;&nbsp;BR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Br&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;79.9000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bromine
================================
BONDS&nbsp;&nbsp;&nbsp;Ebond&nbsp;=&nbsp;0.5*K(r-ro)**2&nbsp;&nbsp;&nbsp;&nbsp;
--------------------------------
&nbsp;Atoms&nbsp;&nbsp;&nbsp;&nbsp;pot&nbsp;&nbsp;&nbsp;
i&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;j&nbsp;&nbsp;type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;K&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOTES
==============================
C&nbsp;&nbsp;&nbsp;&nbsp;CT&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;634.00&nbsp;&nbsp;1.522&nbsp;&nbsp;&nbsp;&nbsp;JCC,7,(1986),230;&nbsp;AA
==============================
BENDS&nbsp;&nbsp;&nbsp;&nbsp;Ebend&nbsp;=&nbsp;0.5*k(a-ao)^2&nbsp;&nbsp;&nbsp;(K&nbsp;in&nbsp;kcal/mol*rad^2)
--------------------------------
&nbsp;&nbsp;&nbsp;&nbsp;Atoms&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pot&nbsp;
i&nbsp;&nbsp;-&nbsp;&nbsp;j&nbsp;-&nbsp;k&nbsp;&nbsp;type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;K&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;theta&nbsp;&nbsp;&nbsp;NOTES
===================================
H1&nbsp;&nbsp;&nbsp;CT&nbsp;&nbsp;&nbsp;HC&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;70.00&nbsp;&nbsp;&nbsp;109.50&nbsp;&nbsp;M.&nbsp;Swart&nbsp;added
===================================
TORSIONS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Etors=K(1+cos(nt-to))
--------------------------------
&nbsp;&nbsp;&nbsp;&nbsp;Atoms&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pot&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;per.&nbsp;&nbsp;&nbsp;shift&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
i&nbsp;&nbsp;&nbsp;-&nbsp;j&nbsp;&nbsp;-&nbsp;k&nbsp;-&nbsp;&nbsp;l&nbsp;&nbsp;type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOTES
=================================================
*&nbsp;&nbsp;&nbsp;&nbsp;C&nbsp;&nbsp;&nbsp;&nbsp;CT&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0000&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;JCC,7,(1986),230&nbsp;&nbsp;
=================================================
OUT-OF-PLANE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Etors=K(1-cos(2t-to))
--------------------------------
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Atoms&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pot&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;i&nbsp;-&nbsp;j&nbsp;&nbsp;-&nbsp;k&nbsp;&nbsp;-&nbsp;l&nbsp;&nbsp;&nbsp;type&nbsp;&nbsp;&nbsp;K&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOTES
=====================================
*&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;CC&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;1.00&nbsp;&nbsp;180.0&nbsp;&nbsp;&nbsp;HEME&nbsp;improper
=====================================
VAN&nbsp;DER&nbsp;WAALS
--------------------------------
&nbsp;&nbsp;atom(s)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Emin&nbsp;&nbsp;&nbsp;&nbsp;Rmin&nbsp;&nbsp;&nbsp;gamma&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOTES
====================================
&nbsp;&nbsp;&nbsp;&nbsp;H&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0157&nbsp;&nbsp;&nbsp;1.2000&nbsp;&nbsp;12.00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ferguson&nbsp;base&nbsp;pair&nbsp;geom.
====================================
CHARGES
--------------------------------
&nbsp;type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;charge(e)&nbsp;&nbsp;&nbsp;&nbsp;NOTES
=====================
&nbsp;&nbsp;OW&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-0.8340&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Amber95&nbsp;water&nbsp;charges&nbsp;(TIP3P&nbsp;had&nbsp;-0.82)
=====================
</pre>
<div class="p"><!----></div>
     <a id="tth_sEc6.7.4"></a><h3>
6.7.4&nbsp;&nbsp;QM/MM connection table file: <b><tt>ADF.qmmm.table</tt></b></h3>
<div class="p"><!----></div>
The connection table file defines the topology of the QM/MM system, by defining which atoms belong to QM or MM, and which atoms have MM bonds between them.
The file can also be used to define link atoms or to override the MM charges of specific atoms.
<div class="p"><!----></div>
One should keep in mind that the content of the file is copied verbatim to the ADF input, inside the <b><tt>MM_CONNECTION_TABLE</tt></b> subblock of the QM/MM input section.
See the <a href="https://www.scm.com/doc/QMMM/ADF_QMMM/QMMM_keyblock_options.html">ADF manual</a> for details on this input section.
<div class="p"><!----></div>
An example of the file is given in <b><tt>$SHARC/../examples/SHARC_ADF/ADF.qmmm.table</tt></b>.
In the simplest form, the content of the file could look like:
<pre>
1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2
2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4
3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;H1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2
4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;H1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2
5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OW&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7
6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HW&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5
7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HW&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5
</pre>
Here, the first column is the atom index, the second is the MM atom type (as defined in the force field file), the third column is the atom designation (either <b><tt>QM</tt></b>, <b><tt>MM</tt></b>, or <b><tt>LI</tt></b> for a link atom), and the remaining entries are the atom indices to which the current atom is bonded in MM.
Note that in the connection table, all <b><tt>MM</tt></b> atoms must come at the very end.
<div class="p"><!----></div>
As the file content is copied verbatim, it is possible to add further sublocks to the QM/MM input section.
This is necessary if any of the atoms is designated as link atom (label <b><tt>LI</tt></b>).
In this case, the <b><tt>LINK_BONDS</tt></b> section needs to be added:
<pre>
1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2
2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4
3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2
4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7
5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;H1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4
6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;H1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4
7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10
8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7
9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7
10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7
&nbsp;&nbsp;subend
&nbsp;&nbsp;link_bonds
7&nbsp;-&nbsp;4&nbsp;&nbsp;1.4&nbsp;&nbsp;H.1&nbsp;&nbsp;HC
</pre>
Note how the <b><tt>MM_CONNECTION_TABLE</tt></b> block is terminated by <b><tt>subend</tt></b> and then the <b><tt>LINK_BONDS</tt></b> section starts; the <b><tt>LINK_BONDS</tt></b> section is not terminated by <b><tt>subend</tt></b> because the interface adds a <b><tt>subend</tt></b> after the file content.
Within the <b><tt>LINK_BONDS</tt></b> section, each line has the following structure: (i) atom index of the <b><tt>LI</tt></b> atom; (ii) a <b><tt>-</tt></b> separated by spaces; (iii) atom index of a <b><tt>QM</tt></b> atom bonded to the link atom; (iv) a floating point number giving the parameter f; (v) the atomic fragment type of the atom which replaces the <b><tt>LI</tt></b> atom in the QM calculation; (vi) the MM atom type of the replacing atom.
Given these parameters, internally ADF will replace the <b><tt>LI</tt></b> atom by an atom of the specified atomic fragment type, which will be placed on the <b><tt>QM</tt></b>-<b><tt>LI</tt></b> bond where the new bond length is the old bond length divided by f.
<div class="p"><!----></div>
The file can also be used to override the MM charges for specific atoms:
<pre>
1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2
2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4
3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;H1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2
4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;H1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2
5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OW&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7
6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HW&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5
7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HW&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5
&nbsp;subend
&nbsp;charges
5&nbsp;&nbsp;-0.96
6&nbsp;&nbsp;+0.48
7&nbsp;&nbsp;+0.48
</pre>
The same rules regarding the <b><tt>subend</tt></b> as above apply.
<div class="p"><!----></div>
     <a id="tth_sEc6.7.5"></a><h3>
6.7.5&nbsp;&nbsp;Input file generator: <b><tt>ADF_input.py</tt></b></h3><a id="sec:ADF_input.py">
</a>
<div class="p"><!----></div>
In order to quickly setup simple calculations using ADF, the  S<span style="font-size:x-small">HARC</span>&nbsp;suite contains a small script called <b><tt>ADF_input.py</tt></b>. It can be used to setup single point calculations, optimizations, and frequency calculations on the DFT and TD-DFT level of theory. Of course, ADF has far more capabilities, but these are not covered by <b><tt>ADF_input.py</tt></b>. For more complicated inputs, users should manually adjust the generated input or employ <b><tt>adfinput</tt></b>.
<div class="p"><!----></div>
The script interactively asks the user to specify the calculation and writes an input file and optionally a run script.
<div class="p"><!----></div>
<h4>Input</h4>
<div class="p"><!----></div>
<b>Type of calculation&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Choose to either perform a single-point calculation or a minimum optimization (including optionally frequency calculation).
<div class="p"><!----></div>
The standard output or <b><tt>TAPE21</tt></b> files from a frequency calculation can be converted (see section&nbsp;<a href="#sec:ADF_freq.py">6.7.6</a>) to a file in  M<span style="font-size:x-small">OLDEN</span> format, which can then be used to generate initial conditions with <b><tt>wigner.py</tt></b>.
<div class="p"><!----></div>
<b>Geometry, Charge, Multiplicity&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Specify the geometry file in xyz format. Number of atoms and total nuclear charge is detected automatically. After the user inputs the total charge, the number of electrons is calculated automatically. The number of unpaired electrons can be specified to define the multiplicity.
<div class="p"><!----></div>
<b>Basis set&nbsp;&nbsp;</b>
<div class="p"><!----></div>
With <b><tt>ADF_input.py</tt></b> it is only possible to enter a single basis set for all atoms. More complicated basis setups can be achieved by manually adjusting the generated input file.
<div class="p"><!----></div>
<b>Level of theory&nbsp;&nbsp;</b>
<div class="p"><!----></div>
One can setup calculations with any ADF-supported functional, and for ground state or excited state. The user is also queried whether relativistic effects need to be included, and for the most important accuracy settings.
<div class="p"><!----></div>
<b>Run script&nbsp;&nbsp;</b>
<div class="p"><!----></div>
If requested, the script also generates a simple Bash script (<b><tt>run_molpro.sh</tt></b>) to directly execute ADF. The user has to enter the path to ADF and the path to a suitable (fast) scratch directory. 
<div class="p"><!----></div>
Note that the scratch directory will be deleted after the calculation, only the wave function file <b><tt>wf</tt></b> will be copied back to the main directory.
<div class="p"><!----></div>
     <a id="tth_sEc6.7.6"></a><h3>
6.7.6&nbsp;&nbsp;Frequencies converter: <b><tt>ADF_freq.py</tt></b></h3><a id="sec:ADF_freq.py">
</a>
<div class="p"><!----></div>
The small script <b><tt>ADF_freq.py</tt></b> can be used to convert the standard output or the <b><tt>TAPE21</tt></b> file created by an ADF frequency calculation.
The usage is very simple:
<pre>
python&nbsp;$SHARC/ADF_freq.py&nbsp;ADF.out
</pre>
or:
<pre>
python&nbsp;$SHARC/ADF_freq.py&nbsp;TAPE21
</pre>
The script detects automatically the file format.
Note that in ADF, the infrared intensities are only accessible from the standard output, so use this for IR spectrum generation.
However, the data in <b><tt>TAPE21</tt></b> has a higher numeric precision, so it is recommended to convert the <b><tt>TAPE21</tt></b> file if no intensities are needed.
In any case, a file called <b><tt>&lt;filename&#62;.molden</tt></b> is written, containing the frequencies and normal modes.
This file can then be used with <b><tt>wigner.py</tt></b>.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc6.8"></a><h2>
6.8&nbsp;&nbsp;RICC2 Interface</h2><a id="sec:int:ricc2">
</a>
<div class="p"><!----></div>
The  S<span style="font-size:x-small">HARC</span>- R<span style="font-size:x-small">ICC</span>2 interface can be used to conduct excited-state dynamics based on  T<span style="font-size:x-small">URBOMOLE</span>'s CC2 and ADC(2) methods, for singlet and triplet states.
The interface uses the programs <b><tt>define</tt></b>, <b><tt>dscf</tt></b> and <b><tt>ricc2</tt></b>.
For spin-orbit couplings,  O<span style="font-size:x-small">RCA</span> needs to be installed in addition to  T<span style="font-size:x-small">URBOMOLE</span>.
Only ADC(2) can be used to calculate spin-orbit couplings, but not CC2 (hence, it is not recommended to perform CC2 calculations with both singlet and triplet states).
Even with ADC(2), only singlet-triplet SOCs are obtained, but no triplet-triplet SOCs; S<sub>0</sub>-triplet SOCs are also missing currently.
Wavefunction overlaps are calculated using the  WF<span style="font-size:x-small">OVERLAP</span> code of the Gonz&#225;lez group.<a href="#Plasser2016JCTC" class="tth_citeref">[73</a>]
<div class="p"><!----></div>
The interface needs two additional input files, a template file for the quantum chemistry (file name is <b><tt>RICC2.template</tt></b>) and a general input file (<b><tt>RICC2.resources</tt></b>). 
If a file <b><tt>QM/mos.init</tt></b> is are present, it is used to provide an initial orbital guess for the SCF calculation.
<div class="p"><!----></div>
     <a id="tth_sEc6.8.1"></a><h3>
6.8.1&nbsp;&nbsp;Template file: <b><tt>RICC2.template</tt></b></h3>
<div class="p"><!----></div>
This file contains the specifications for the quantum chemistry calculation. Note that this is not a valid  T<span style="font-size:x-small">URBOMOLE</span> input file. The file only contains a number of keywords, given in table&nbsp;<a href="#tab:ricc2_temp"> 6.11</a>. The actual input for  T<span style="font-size:x-small">URBOMOLE</span> will be generated automatically through <b><tt>define</tt></b>.
A fully commented template file with all possible options is located in <b><tt>$SHARC/../examples/SHARC_RICC2/</tt></b>.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb6.11">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 6.11: Keywords for the <b><tt>RICC2.template</tt></b> file.</div>
  <a id="tab:ricc2_temp">
</a>
<table>
<tr><td align="left">Keyword       </td><td align="left">Description</td></tr>
<tr><td align="left">basis           </td><td align="left">The basis set used. The interface will convert this string to the correct case for  T<span style="font-size:x-small">URBOMOLE</span>.</td></tr>
<tr><td align="left">auxbasis        </td><td align="left">The auxiliary basis set used in <b><tt>ricc2</tt></b>. If no auxbasis is given, the interface will let <b><tt>define</tt></b> decide on a suitable auxbasis.</td></tr>
<tr><td align="left">basislib        </td><td align="left">Path to external basis set library. Can be used to employ custom basis sets.</td></tr>
<tr><td align="left">charge          </td><td align="left">The total molecular charge. The interface will calculate the number of electrons automatically during setup.</td></tr>
<tr><td align="left">method          </td><td align="left">Followed by a string, which is either "CC2" or "ADC(2)" (case insensitive), defining the level of theory. Default is "ADC(2)".</td></tr>
<tr><td align="left">douglas-kroll   </td><td align="left">Activates the use of the scalar-relativistic DK Hamiltonian of 2nd order. Default (if no keyword is given) is to use the non-relativistic Hamiltonian.</td></tr>
<tr><td align="left">spin-scaling    </td><td align="left">Followed by a string, which is either "none", "scs" or "sos". Using these options, spin-component scaling can be activated. Under certain restrictions (no SOC, no transition dipole moments, no SMP), "lt-sos" can be used to perform cheaper "sos" calculations.</td></tr>
<tr><td align="left">scf             </td><td align="left">Followed by a string which is either "dscf" or "ridft". Using this option, the SCF program can be chosen. Note that currently, there is no advantage of using "ridft".</td></tr>
<tr><td align="left">frozen          </td><td align="left">Followed by an integer giving the number of frozen core orbitals in the <b><tt>ricc2</tt></b> calculations. Default is to use frozen core orbitals and let <b><tt>define</tt></b> decide on the number. If frozen core is not wanted, use <b><tt>frozen 0</tt></b> in the template.</td></tr></table>
</div>
<div class="p"><!----></div>
<h4>External basis set libary</h4>
<div class="p"><!----></div>
If users want to employ their own basis sets, they can create a basis set library directory with the required files, and use the <b><tt>basislib</tt></b> keyword to tell the interface to use this directory.
The <b><tt>basislib</tt></b> keyword cannot be used together with the <b><tt>auxbasis</tt></b> keyword.
<div class="p"><!----></div>
The specified directory must contain <b><tt>basen/</tt></b> and <b><tt>cbasen/</tt></b> subdirectories. These must contain one file per element, containing the desired basis set parameters.
The files in <b><tt>cbasen/</tt></b> must auxiliary basis sets of the same name as the basis sets in <b><tt>basen/</tt></b>.
See the  T<span style="font-size:x-small">URBOMOLE</span> directory structure to see how the directories and files need to be prepared.
<div class="p"><!----></div>
<div class="p"><!----></div>
     <a id="tth_sEc6.8.2"></a><h3>
6.8.2&nbsp;&nbsp;Resource file: <b><tt>RICC2.resources</tt></b></h3>
<div class="p"><!----></div>
The file <b><tt>RICC2.resources</tt></b> contains mainly paths (to the  T<span style="font-size:x-small">URBOMOLE</span> and  O<span style="font-size:x-small">RCA</span> executables, to the scratch directory, etc.). This file must reside in the same directory where the interface is started. It uses a simple "<b><tt>keyword argument</tt></b>" syntax. Comments using # and blank lines are possible, the order of keywords is arbitrary. Lines with unknown keywords are ignored, since the interface just searches the file for certain keywords.
<div class="p"><!----></div>
Table&nbsp;<a href="#tab:ricc2_sh2"> 6.12</a> lists the existing keywords.
A fully commented resource file with all possible options is located in <b><tt>$SHARC/../examples/SHARC_RICC2/</tt></b>.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb6.12">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 6.12: Keywords for the <b><tt>RICC2.resources</tt></b> file.</div>
  <a id="tab:ricc2_sh2">
</a>
<table>
<tr><td align="left">Keyword       </td><td align="left">Description</td></tr>
<tr><td align="left">turbodir        </td><td align="left">Is the path to the  T<span style="font-size:x-small">URBOMOLE</span> installation. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. The interface will set <b><tt>$TURBODIR</tt></b> to this path, and will set the <b><tt>$PATH</tt></b> correctly (using  T<span style="font-size:x-small">URBOMOLE</span>'s <b><tt>sysname</tt></b> tool. If this keyword is not present in <b><tt>RICC2.resources</tt></b>, the interface will use the environment variable <b><tt>$TURBODIR</tt></b>, if it is set.</td></tr>
<tr><td align="left">orcadir         </td><td align="left">Is the path to the  O<span style="font-size:x-small">RCA</span> installation, which is necessary when spin-orbit couplings are calculated. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. If this keyword is not present in <b><tt>RICC2.resources</tt></b>, the interface will use the environment variable <b><tt>$ORCADIR</tt></b>, if it is set.</td></tr>
<tr><td align="left">scratchdir      </td><td align="left">Is a path to the temporary directory. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. If it does not exist, the interface will create it. In any case, the interface will delete this directory after the calculation.</td></tr>
<tr><td align="left">savedir         </td><td align="left">Is a path to another temporary directory.  Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. The interface will store files needed for restart there.</td></tr>
<tr><td align="left">memory          </td><td align="left">The memory usable by  T<span style="font-size:x-small">URBOMOLE</span> and  WF<span style="font-size:x-small">OVERLAP</span>. The default is 100&nbsp;MB.</td></tr>
<tr><td align="left">ncpu            </td><td align="left">The number of CPUs used by the interface. If larger than one, the interface will use the SMP executables of  T<span style="font-size:x-small">URBOMOLE</span> with the given number of CPUs.</td></tr>
<tr><td align="left">always_orb_init </td><td align="left">Do not use the orbital guesses from previous calculations/time steps, but always use the provided initial orbitals.</td></tr>
<tr><td align="left">always_guess   </td><td align="left">Always use the orbital guess from the EHT calculation of <b><tt>define</tt></b>.</td></tr>
<tr><td align="left">dipolelevel     </td><td align="left">Followed by an integer which is either 0, 1, or 2. Controls which dipole moment calculations are skipped by the interface.</td></tr>
<tr><td align="left">wfoverlap       </td><td align="left">Is the path to the  WF<span style="font-size:x-small">OVERLAP</span> executable. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. This keyword is only necessary if overlaps need to be calculated.</td></tr>
<tr><td align="left">wfthres         </td><td align="left">Threshold for the truncation of the response vectors which are used in the overlap calculations. A threshold of x implies that only the minimal number of determinants needed to give a norm of 1&#8722;x are included.</td></tr>
<tr><td align="left">numfrozcore     </td><td align="left">Overrides the number of frozen core orbitals for the overlap calculation. Default is to use the frozen orbitals from the RICC2 steps.</td></tr>
<tr><td align="left">nooverlap       </td><td align="left">Do not save files necessary to do overlaps.</td></tr>
<tr><td align="left">debug           </td><td align="left">Increases the verbosity of the interface.</td></tr>
<tr><td align="left">no_print       </td><td align="left">Reduces interface standard output.</td></tr></table>
</div>
<div class="p"><!----></div>
Note that the interface sets all environment variables necessary to run  T<span style="font-size:x-small">URBOMOLE</span> (e.g., <b><tt>$PATH</tt></b>) automatically, based on the input from <b><tt>RICC2.resources</tt></b> and <b><tt>QM.in</tt></b>.
<div class="p"><!----></div>
For parallel calculations, the interface will call the SMP executables of  T<span style="font-size:x-small">URBOMOLE</span> and  WF<span style="font-size:x-small">OVERLAP</span>.
<div class="p"><!----></div>
Note that the <b><tt>dipolelevel</tt></b> keyword can have significant impact on the calculation time.
Generally, in response methods like CC2 and ADC(2), extra computational effort is required for the calculation of state and transition dipole moments .
However, dipole moments have only influence in the dynamics simulations if a laser field is present.
Using the <b><tt>dipolelevel</tt></b> keyword, it is possible to deactivate dipole moment calculations if they are not required.
There are three different settings for <b><tt>dipolelevel</tt></b>: 
<ul>
<li> <b><tt>dipolelevel</tt></b>=0: The interface will return only dipole moments which can be calculated at no cost (state dipole moments of states where a gradient is calculated; excited-excited transition dipole moments if SOCs are calculated)
<div class="p"><!----></div>
</li>
<li> <b><tt>dipolelevel</tt></b>=1: In addition, the interface will calculate transition dipole moments between S<sub>0</sub> and excited singlet states. Use at least this level for the initial condition setup (<b><tt>setup_init.py</tt></b> takes care of this).
<div class="p"><!----></div>
</li>
<li> <b><tt>dipolelevel</tt></b>=2: The interface will calculate all state and transition dipole moments
<div class="p"><!----></div>
</li>
</ul>
If only energies and dipole moments are calculated, <b><tt>dipolelevel</tt></b>=1 is only slightly more expensive than <b><tt>dipolelevel</tt></b>=0, while <b><tt>dipolelevel</tt></b>=2 increases computation time more strongly.
However, the computation time also depends on whether or not spin-orbit couplings and gradients are calculated. 
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc6.9"></a><h2>
6.9&nbsp;&nbsp;LVC Interface</h2><a id="sec:int:lvc">
</a>
<div class="p"><!----></div>
The purpose of the LVC interface is to allow performing computationally efficient dynamics using a linear vibronic coupling (LVC) model <a href="#Koeppel84ACP" id="CITEKoeppel84ACP" class="tth_citation">[102</a>].
In the vibronic coupling model the diabatic energy and coupling matrix <b>V</b> is constructed as
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-10.png"><a id="eq:V">
</a>
</td><td width="1%">(6.7)</td></tr></table>
<div class="p"><!----></div>
To construct these matrices, the Cartesian coordinate displacements r<sub>&#945;</sub> are first converted to dimensionless mass-frequency scaled normal coordinates, which are given as
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-11.png"><a id="eq:Qi">
</a>
</td><td width="1%">(6.8)</td></tr></table>
where &#969;<sub>i</sub> is the frequency of normal mode i, M<sub>&#945;</sub> is an atomic mass, and K<sub>&#945;i</sub> denotes the conversion matrix between mass-weighted Cartesian and normal coordinates.
Using these coordinates, the harmonic ground state potential is given as
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-12.png"><a id="eq:V0Qi">
</a>
</td><td width="1%">(6.9)</td></tr></table>
In the case of the linear vibronic coupling model, one additionally considers the following state-specific terms that constitute the <b>W</b> matrix.
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-13.png"><a id="eq:Wnn">
</a>
</td><td width="1%">(6.10)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-14.png"><a id="eq:Wmn">
</a>
</td><td width="1%">(6.11)</td></tr></table>
Here the &#1013;<sub>n</sub> are the vertical excitation energies, the &#951;<sub>mn</sub> are the SOC constants, and the &#954;<sub>i</sub><sup>(n)</sup> and &#955;<sub>j</sub><sup>(m,n)</sup> are termed intrastate and interstate vibronic coupling constant <a href="#Koeppel84ACP" class="tth_citeref">[102</a>].
<div class="p"><!----></div>
     <a id="tth_sEc6.9.1"></a><h3>
6.9.1&nbsp;&nbsp;Input files</h3>
<div class="p"><!----></div>
Two input files are needed:
<div class="p"><!----></div>
<b><b><tt>V0.txt</tt></b>&nbsp;&nbsp;</b> Contains all information to describe V<sub>0</sub>: the equilibrium geometry, the frequencies &#969;<sub>i</sub>, and an orthogonal matrix containing the normal coordinates K<sub>&#945;i</sub>.
<pre>
Geometry
&nbsp;S&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;16.&nbsp;&nbsp;&nbsp;&nbsp;0.00000000&nbsp;&nbsp;&nbsp;&nbsp;0.00000000&nbsp;&nbsp;&nbsp;-0.00039079&nbsp;&nbsp;&nbsp;31.97207180
&nbsp;O&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8.&nbsp;&nbsp;&nbsp;&nbsp;0.00000000&nbsp;&nbsp;&nbsp;-2.38362453&nbsp;&nbsp;&nbsp;&nbsp;1.36159121&nbsp;&nbsp;&nbsp;15.99491464
&nbsp;O&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8.&nbsp;&nbsp;&nbsp;&nbsp;0.00000000&nbsp;&nbsp;&nbsp;&nbsp;2.38362453&nbsp;&nbsp;&nbsp;&nbsp;1.36159120&nbsp;&nbsp;&nbsp;15.99491464
Frequencies
&nbsp;0.0000&nbsp;&nbsp;0.0000&nbsp;&nbsp;0.0000&nbsp;&nbsp;0.0000&nbsp;&nbsp;0.0000&nbsp;&nbsp;0.0000&nbsp;&nbsp;0.00234&nbsp;&nbsp;0.0053&nbsp;&nbsp;0.0064
Mass-weighted&nbsp;normal&nbsp;modes
&nbsp;&nbsp;0.0000&nbsp;&nbsp;1.0000&nbsp;&nbsp;0.0000&nbsp;&nbsp;0.0000&nbsp;&nbsp;0.0000&nbsp;&nbsp;0.0000&nbsp;&nbsp;0.0000&nbsp;&nbsp;0.0000&nbsp;&nbsp;0.0000
&nbsp;&nbsp;0.6564&nbsp;&nbsp;0.0000&nbsp;&nbsp;0.0000&nbsp;&nbsp;0.3108&nbsp;&nbsp;0.0494&nbsp;&nbsp;0.2004&nbsp;&nbsp;0.0000&nbsp;&nbsp;0.0000&nbsp;-0.6557
...
</pre>
<b><tt>V0.txt</tt></b> can be created from a  M<span style="font-size:x-small">OLDEN</span> file using <b><tt>wigner.py</tt></b>.
<div class="p"><!----></div>
<b><b><tt>LVC.template</tt></b>&nbsp;&nbsp;</b> Contains the state-specific information: &#1013;<sub>i</sub>, &#954;<sub>i</sub><sup>(n)</sup>, &#955;<sub>j</sub><sup>(m,n)</sup>, &#951;<sub>mn</sub>, as well as (transition) dipole moments.
Here, for multiplets &#1013;<sub>i</sub>, &#954;<sub>i</sub><sup>(n)</sup>, and &#955;<sub>j</sub><sup>(m,n)</sup> are shared between the multiplet components, whereas in the SOC and dipole moment matrices the multiplet components need to be considered explicitly.
<pre>
V0.txt
4&nbsp;0&nbsp;3&nbsp;
epsilon
7
&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;0.0000000000
&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;0.1640045037
&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;0.1781507393
&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;0.2500917150
&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;0.1341247878
&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;0.1645714941
&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;0.1700512159
kappa
12
&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7&nbsp;&nbsp;1.19647e-03
&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8&nbsp;&nbsp;1.21848e-02
...
lambda
3
&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;9&nbsp;-1.83185e-02
&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;9&nbsp;&nbsp;7.32022e-03
&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;9&nbsp;&nbsp;5.71746e-03
SOC&nbsp;R
&nbsp;&nbsp;0.000e+00&nbsp;&nbsp;0.000e+00&nbsp;&nbsp;0.000e+00&nbsp;&nbsp;0.000e+00&nbsp;&nbsp;0.000e+00&nbsp;&nbsp;0.000e+00&nbsp;...
&nbsp;&nbsp;0.000e+00&nbsp;&nbsp;0.000e+00&nbsp;&nbsp;0.000e+00&nbsp;&nbsp;0.000e+00&nbsp;&nbsp;0.000e+00&nbsp;-1.086e-04&nbsp;...
...
SOC&nbsp;I
&nbsp;&nbsp;0.000e+00&nbsp;&nbsp;0.000e+00&nbsp;&nbsp;0.000e+00&nbsp;&nbsp;0.000e+00&nbsp;&nbsp;0.000e+00&nbsp;&nbsp;0.000e+00&nbsp;...
&nbsp;&nbsp;0.000e+00&nbsp;&nbsp;0.000e+00&nbsp;&nbsp;0.000e+00&nbsp;&nbsp;1.000e+00&nbsp;&nbsp;0.000e+00&nbsp;&nbsp;1.000e-04&nbsp;...
...
DMX&nbsp;R
&nbsp;-7.400e-07&nbsp;-1.639e-01&nbsp;&nbsp;0.000e+00&nbsp;&nbsp;3.000e-06&nbsp;&nbsp;0.000e+00&nbsp;&nbsp;0.000e+00&nbsp;&nbsp;...
&nbsp;-1.639e-01&nbsp;&nbsp;3.930e-06&nbsp;&nbsp;0.000e+00&nbsp;&nbsp;2.400e-05&nbsp;&nbsp;0.000e+00&nbsp;&nbsp;0.000e+00&nbsp;&nbsp;...
...
DMX&nbsp;I
...
DMY&nbsp;R
...
DMY&nbsp;I
...
DMZ&nbsp;R
...
DMZ&nbsp;I
...
</pre>
Only the two first lines are mandatory, but then all states will have the same potentials (the ground state potential).
This file can be prepared with <b><tt>QMout2LVC.py</tt></b>.
<div class="p"><!----></div>
     <a id="tth_sEc6.9.2"></a><h3>
6.9.2&nbsp;&nbsp;Preparing Template Files: <b><tt>wigner.py</tt></b> and <b><tt>QMout2LVC.py</tt></b></h3><a id="sec:QMout2LVC.py">
</a>
<div class="p"><!----></div>
Both input files can be conveniently created using the  S<span style="font-size:x-small">HARC</span>&nbsp;tools. <b><tt>V0.txt</tt></b> is created using the <b><tt>wigner.py</tt></b> script, which is also used for initial condition generation. Simply call, e.g.
<b><tt>$SHARC/wigner.py -l &lt;filename.molden&#62;</tt></b>
Note that this only works if all 3N normal modes are present in the file (unfortunately, some programs omit translations and rotations in the output).
<div class="p"><!----></div>
To obtain the LVC parameters, it is first necessary to perform a single-point computation at the ground state equilibrium geometry.
Using the <b><tt>QM.in</tt></b> file, you can specify, which types of properties to compute. For the full LVC model, <b><tt>SOC</tt></b>, <b><tt>DM</tt></b>, <b><tt>Grad</tt></b>, and <b><tt>NACDR</tt></b> are needed, so use
<pre>
3
&nbsp;S&nbsp;&nbsp;&nbsp;&nbsp;0.00000000&nbsp;&nbsp;&nbsp;&nbsp;0.00000000&nbsp;&nbsp;&nbsp;-0.00039079&nbsp;
&nbsp;O&nbsp;&nbsp;&nbsp;&nbsp;0.00000000&nbsp;&nbsp;&nbsp;-2.38362453&nbsp;&nbsp;&nbsp;&nbsp;1.36159121&nbsp;
&nbsp;O&nbsp;&nbsp;&nbsp;&nbsp;0.00000000&nbsp;&nbsp;&nbsp;&nbsp;2.38362453&nbsp;&nbsp;&nbsp;&nbsp;1.36159120&nbsp;
Unit&nbsp;Bohr
States&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3
&nbsp;INIT
&nbsp;SOC
&nbsp;DM
&nbsp;Grad
&nbsp;NACDR
</pre>
<div class="p"><!----></div>
Copy the <b><tt>V0.txt</tt></b> to the same directory containing the <b><tt>QM.out</tt></b> file of this computation and run
<b><tt>$SHARC/QMout2LVC.py</tt></b>
to create the file <b><tt>LVC.template</tt></b>.
Note that currently, the script only works for singlets and triplets.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc6.10"></a><h2>
6.10&nbsp;&nbsp; G<span style="font-size:x-small">AUSSIAN</span> Interface</h2><a id="sec:int:gaussian">
</a>
<div class="p"><!----></div>
The  S<span style="font-size:x-small">HARC</span>- G<span style="font-size:x-small">AUSSIAN</span> interface allows to run  S<span style="font-size:x-small">HARC</span>&nbsp;simulations with  G<span style="font-size:x-small">AUSSIAN</span>'s TD-DFT functionality.
The interface is compatible with restricted and unrestricted ground states, but not with symmetry.
Spin-orbit couplings cannot be computed, but wave function overlaps from the  WF<span style="font-size:x-small">OVERLAP</span> code are available (no nonadiabatic couplings).
Dyson norms can also be computed through the  WF<span style="font-size:x-small">OVERLAP</span> code.
 T<span style="font-size:x-small">HEO</span>DORE can be used to perform automatic wave function analysis.
<div class="p"><!----></div>
The interface needs two additional input files, a template file for the quantum chemistry (file name is <b><tt>GAUSSIAN.template</tt></b>) and a resource file (<b><tt>GAUSSIAN.resources</tt></b>). 
If files <b><tt>QM/GAUSSIAN.chk.init</tt></b> or <b><tt>QM/GAUSSIAN.chk.&lt;job&#62;.init</tt></b> are are present, they are used to provide an initial orbital guess for the SCF calculation of the respective job.
<div class="p"><!----></div>
     <a id="tth_sEc6.10.1"></a><h3>
6.10.1&nbsp;&nbsp;Template file: <b><tt>GAUSSIAN.template</tt></b></h3>
<div class="p"><!----></div>
This file contains the specifications for the quantum chemistry calculation. Note that this is not a valid  G<span style="font-size:x-small">AUSSIAN</span> input file. The file only contains a number of keywords, given in table&nbsp;<a href="#tab:gauss_temp"> 6.13</a>. The actual input for  G<span style="font-size:x-small">AUSSIAN</span> will be generated automatically through the interface.
<div class="p"><!----></div>
A fully commented template file-with all possible options, a comprehensive descriptions, and some practical hints-is located in <b><tt>$SHARC/../examples/SHARC_GAUSSIAN/GAUSSIAN.template</tt></b>.
We recommend that users start from this template file and modify it appropriately for their calculations.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb6.13">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 6.13: Keywords for the <b><tt>GAUSSIAN.template</tt></b> file.</div>
  <a id="tab:gauss_temp">
</a>
  <span class="small">
<table>
<tr><td align="left">Keyword       </td><td align="left">Description</td></tr>
<tr><td align="left">basis                   </td><td align="left">Gives the basis set for all atoms (default 6-31G).
</td></tr>
<tr><td align="left">functional              </td><td align="left">followed by one string giving the exchange-correlation functional. Default is <b><tt>PBEPBE</tt></b>.
</td></tr>
<tr><td align="left">dispersion              </td><td align="left">Activates dispersion correction. Arguments are written verbatim to  G<span style="font-size:x-small">AUSSIAN</span> input (in <b><tt>EmpiricalDispersion=()</tt></b>). Default is no dispersion. An example argument would be <b><tt>GD3</tt></b>.
</td></tr>
<tr><td align="left">charge                  </td><td align="left">Sets the total charge of the system. Can be either followed by a single integer (then the interface will automatically assign the charges to the multiplicities) or by one charge per multiplicity. 
</td></tr>
<tr><td align="left">scrf                    </td><td align="left">Activates solvation. All arguments (e.g., <b><tt>iefpcm solvent=water</tt></b>) are copied to  G<span style="font-size:x-small">AUSSIAN</span> input (in <b><tt>scrf=()</tt></b>).
</td></tr>
<tr><td align="left">grid                    </td><td align="left">Followed by a string (e.g., <b><tt>grid finegrid</tt></b>) defining which integration grid and accuracy to use. For details, see the example template file.
</td></tr>
<tr><td align="left">denfit                  </td><td align="left">Activates density fitting, which might speed up the computation.
</td></tr>
<tr><td align="left">scf                     </td><td align="left">Arguments are written verbatim to  G<span style="font-size:x-small">AUSSIAN</span> input (in <b><tt>scf=()</tt></b>).
</td></tr>
<tr><td align="left">no_tda                 </td><td align="left">This keyword deactivates TDA, which the interface requests by default.
</td></tr>
<tr><td align="left">paddingstates           </td><td align="left">Followed by a list of integers, which give the number of extra states to compute by  G<span style="font-size:x-small">AUSSIAN</span>, but which are neglected in the output. Should not be changed between time steps, as this will break  G<span style="font-size:x-small">AUSSIAN</span>'s restart routines.
</td></tr>
<tr><td align="left">unrestricted_triplets  </td><td align="left">Requests that the triplets are calculated in a separate job from an unrestricted ground state. Default is to compute triplets as linear response of the restricted singlet ground state.
</td></tr>
<tr><td align="left">iop                     </td><td align="left">Arguments are written verbatim to  G<span style="font-size:x-small">AUSSIAN</span> input (in <b><tt>iop=()</tt></b>). Expert option.
</td></tr>
<tr><td align="left">keys                    </td><td align="left">Arguments are written verbatim to  G<span style="font-size:x-small">AUSSIAN</span> input as separate keywords. Expert option.
</td></tr></table>
</span></div>
<div class="p"><!----></div>
     <a id="tth_sEc6.10.2"></a><h3>
6.10.2&nbsp;&nbsp;Resource file: <b><tt>GAUSSIAN.resources</tt></b></h3>
<div class="p"><!----></div>
The file <b><tt>GAUSSIAN.resources</tt></b> contains mainly paths (to the  G<span style="font-size:x-small">AUSSIAN</span> executables, to the scratch directory, etc.) and other resources, plus settings for <b><tt>wfoverlap.x</tt></b> and  T<span style="font-size:x-small">HEO</span>DORE. This file must reside in the same directory where the interface is started. It uses a simple "<b><tt>keyword argument</tt></b>" syntax. Comments using # and blank lines are possible, the order of keywords is arbitrary. Lines with unknown keywords are ignored, since the interface just searches the file for certain keywords.
<div class="p"><!----></div>
Table&nbsp;<a href="#tab:gauss_sh2"> 6.14</a> lists the existing keywords.
A fully commented resource file with all possible options and comprehensive descriptions is located in <b><tt>$SHARC/../examples/SHARC_GAUSSIAN/</tt></b>.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb6.14">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 6.14: Keywords for the <b><tt>GAUSSIAN.resources</tt></b> file.</div>
  <a id="tab:gauss_sh2">
</a>
<table>
<tr><td align="left">Keyword       </td><td align="left">Description</td></tr>
<tr><td align="left">groot                   </td><td align="left">Is the path to the  G<span style="font-size:x-small">AUSSIAN</span> installation. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. The interface will set <b><tt>$GAUSS_EXEDIR</tt></b> to this path.
</td></tr>
<tr><td align="left">scratchdir              </td><td align="left">Is a path to the temporary directory. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. If it does not exist, the interface will create it. In any case, the interface will delete this directory after the calculation. The interface will set <b><tt>$GAUSS_SCRDIR</tt></b> to this path.
</td></tr>
<tr><td align="left">savedir                 </td><td align="left">Is a path to another temporary directory.  Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. The interface will store files needed for restart there.
</td></tr>
<tr><td align="left">memory                  </td><td align="left">The memory usable by  G<span style="font-size:x-small">AUSSIAN</span> and  WF<span style="font-size:x-small">OVERLAP</span>. The default is 100&nbsp;MB. 
</td></tr>
<tr><td align="left">ncpu                    </td><td align="left">The number of CPUs used by the interface. Is overridden by environment variables from queuing engines (e.g., <b><tt>$NSLOTS</tt></b> or <b><tt>$SLURM_NTASKS_PER_NODE</tt></b>). Will either be used to run  G<span style="font-size:x-small">AUSSIAN</span> in parallel or to run several independent  G<span style="font-size:x-small">AUSSIAN</span> runs at the same time.
</td></tr>
<tr><td align="left">schedule_scaling       </td><td align="left">Gives the expected parallelizable fraction of the  G<span style="font-size:x-small">AUSSIAN</span> run time (Amdahl's law). With a value close to zero, the interface will try to run all jobs at the same time. With values close to one, jobs will be run sequentially with the maximum number of cores.
</td></tr>
<tr><td align="left">delay                   </td><td align="left">Followed by a float giving the delay in seconds between starting parallel jobs to avoid excessive disk I/O (usually not necessary).
</td></tr>
<tr><td align="left">wfoverlap               </td><td align="left">Path to the  WF<span style="font-size:x-small">OVERLAP</span> code. Needed for overlap and Dyson norm calculations.
</td></tr>
<tr><td align="left">wfthres                 </td><td align="left">(float) Gives the amount of wave function norm which will be kept in the truncation of the determinant files. Default is 0.99 (i.e., the wave functions in the determinant files will have a norm of 0.99). Note that if hybrid functionals and no TDA are used, the response vector can have a norm larger than one, and wfthres should be increased.
</td></tr>
<tr><td align="left">numfrozcore             </td><td align="left">Number of frozen core orbitals for overlap and Dyson norm calculations. A value of -1 enables automatic frozen core.
</td></tr>
<tr><td align="left">numocc                  </td><td align="left">Number of ignored occupied orbitals in Dyson calculations.
</td></tr>
<tr><td align="left">nooverlap               </td><td align="left">Do not save determinant files for overlap computations.
</td></tr>
<tr><td align="left">theodir                 </td><td align="left">Path to the  T<span style="font-size:x-small">HEO</span>DORE installation. Relative and absolute paths, environment variables and <b><tt> </tt></b> can be used. The interface will set <b><tt>$PYTHONPATH</tt></b> automatically.
</td></tr>
<tr><td align="left">theodore_prop          </td><td align="left">Followed by a list with the descriptors which  T<span style="font-size:x-small">HEO</span>DORE should compute. Note that descriptors will only be computed for restricted singlets (and triplets). Instead of a simple list, a Python literal can also be used, as in the  T<span style="font-size:x-small">HEO</span>DORE input files.
</td></tr>
<tr><td align="left">theodore_fragment      </td><td align="left">Followed by a list of atom numbers which should constitute a fragment in  T<span style="font-size:x-small">HEO</span>DORE. For multiple fragments, the keyword can be used multiple times. Instead, the keyword can be followed by a Python literal, as in the  T<span style="font-size:x-small">HEO</span>DORE input files.
</td></tr>
<tr><td align="left">always_orb_init       </td><td align="left">Do not use the orbital guesses from previous calculations/time steps, but always use the provided initial orbitals.
</td></tr>
<tr><td align="left">always_guess           </td><td align="left">Always use the orbital guess from  G<span style="font-size:x-small">AUSSIAN</span>.
</td></tr>
<tr><td align="left">debug                 </td><td align="left">Increases the verbosity of the interface (standard out). Does not clean up the scratch directory. Copies all  G<span style="font-size:x-small">AUSSIAN</span> outputs to the save directory.
</td></tr>
<tr><td align="left">no_print             </td><td align="left">Reduces interface standard output.
</td></tr></table>
</div>
<div class="p"><!----></div>
<b>Parallelization&nbsp;&nbsp;</b>
<div class="p"><!----></div>
 G<span style="font-size:x-small">AUSSIAN</span> usually shows very good parallel scaling for most TD-DFT calculations.
However, it is more efficient to carry out multiple  G<span style="font-size:x-small">AUSSIAN</span> calculations (different multiplicities, multiple gradients) in parallel, each one using a smaller number of CPUs.
<div class="p"><!----></div>
In the  S<span style="font-size:x-small">HARC</span>- G<span style="font-size:x-small">AUSSIAN</span> interface, parallelization is controlled by the keywords <b><tt>ncpu</tt></b> and <b><tt>schedule_scaling</tt></b>.
The first keyword controls the maximum number of CPUs which the interface is allowed to use for all  G<span style="font-size:x-small">AUSSIAN</span> runs simultaneously.
The second keyword is the parallel fraction from Amdahl's Law, see Section&nbsp;<a href="#met:amdahl">8.3</a>.
With a value close to zero, the interface will try to run all jobs at the same time. With values close to one, jobs will be run sequentially with the maximum number of cores.
Typical values for <b><tt>schedule_scaling</tt></b> are around 0.90 for both GGA functionals and hybrid functionals,  possibly less for very small computations.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc6.11"></a><h2>
6.11&nbsp;&nbsp;The  WF<span style="font-size:x-small">OVERLAP</span> Program</h2><a id="sec:int:wfoverlap">
</a>
<div class="p"><!----></div>
This section does not describe an interface to  S<span style="font-size:x-small">HARC</span>, but rather the  WF<span style="font-size:x-small">OVERLAP</span> program.
This program is part of the  S<span style="font-size:x-small">HARC</span>&nbsp;distribution, but can also be obtained as a <a href="https://sharc-md.org/?page_id=309">stand-alone package</a> (including a more detailed manual and a set of auxiliary scripts).
It computes overlaps between many-electron wave functions expressed in terms of linear combinations of Slater determinant, which are based on molecular orbitals (from an LCAO ansatz).
It can also compute Dyson orbitals and Dyson norms between wave functions differing by one &#945; or one &#946; electron.
The program is based on the efficient and general algorithm published in Ref.&nbsp;<a href="#Plasser2016JCTC" class="tth_citeref">[73</a>].
It is possible to vary the geometry, the basis set, the molecular orbitals, and the wavefunction expansion between the calculations.
<div class="p"><!----></div>
The resulting wave function overlaps or Dyson norms can be used for example for:
<ul>
<li> Propagation in local diabatization, the main application inside  S<span style="font-size:x-small">HARC</span>,
<div class="p"><!----></div>
</li>
<li> Computation of photoionization spectra&nbsp;<a href="#Ruckenbauer2016SR" class="tth_citeref">[31</a>,<a href="#Ruckenbauer2016JCP" class="tth_citeref">[86</a>],
<div class="p"><!----></div>
</li>
<li> Comparison of wave functions at different levels of theory&nbsp;<a href="#Plasser2016JCP" class="tth_citeref">[87</a>].
<div class="p"><!----></div>
</li>
</ul>
If you employ the <b><tt>wfoverlap.x</tt></b> code inside the  S<span style="font-size:x-small">HARC</span>&nbsp;suite for these purposes, please cite these references!
<div class="p"><!----></div>
The documentation here only gives a brief overview over the input options of  <span style="font-size:x-small">WFOVERLAP</span>.<span style="font-size:x-small">X</span>, because within the  S<span style="font-size:x-small">HARC</span>&nbsp;suite the <b><tt>wfoverlap.x</tt></b> program is always called automatically by the interfaces. For the full manual (and for access to the auxiliary scripts of  <span style="font-size:x-small">WFOVERLAP</span>.<span style="font-size:x-small">X</span>), please download the separate <a href="https://sharc-md.org/?page_id=309"> WF<span style="font-size:x-small">OVERLAP</span> package</a>.
<div class="p"><!----></div>
     <a id="tth_sEc6.11.1"></a><h3>
6.11.1&nbsp;&nbsp;Installation</h3>
<div class="p"><!----></div>
 <a id="tth_sEc6.12"></a><h2>
6.12&nbsp;&nbsp;Getting started</h2>
Start by moving into the corresponding subdirectory of  S<span style="font-size:x-small">HARC</span>:
<div class="p"><!----></div>
        <tt>cd&nbsp;$SHARC/../wfoverlap/</tt>
<div class="p"><!----></div>
 <a id="tth_sEc6.13"></a><h2>
6.13&nbsp;&nbsp;Manual installation</h2>
<div class="p"><!----></div>
For the manual installation you need a working Fortran90 compatible compiler (Intel's ifort is recommended),
some reasonably fast BLAS/LAPACK libraries (Intel's MKL is recommended, although atlas is also fine).
<div class="p"><!----></div>
Optionally, with a working  C<span style="font-size:x-small">OLUMBUS</span> Installation you can install the  C<span style="font-size:x-small">OLUMBUS</span> bindings, which will
allow direct reading of SIFS integral files generated by  D<span style="font-size:x-small">ALTON</span>. To use this option, it is
necessary to use the <tt>read_dalton.o</tt> object file.
 M<span style="font-size:x-small">OLCAS</span>/S<span style="font-size:x-small">EWARD</span> integral files can be read by linking with the  C<span style="font-size:x-small">OLUMBUS</span>/M<span style="font-size:x-small">OLCAS</span> interface. Link against
<tt>read_molcas.o</tt> for this purpose.
<div class="p"><!----></div>
To compile the source code, switch to the <tt>source</tt> directory and edit the Makefile to adjust it to your Fortran compiler and BLAS/LAPACK
installation. The location of your  C<span style="font-size:x-small">OLUMBUS</span> installation has to be set via the enviroment variable
<tt>$COLUMBUS</tt>.
<div class="p"><!----></div>
Issuing the command:
<div class="p"><!----></div>
        <tt>make</tt>
<div class="p"><!----></div>
will compile the source and create the binaries.
<div class="p"><!----></div>
        <tt>make&nbsp;test</tt>
<div class="p"><!----></div>
will run a couple of tests to check if the program is working correctly (alternatively you can call <tt>ovl_test.bash&nbsp;$OVDIR</tt> directly, as explained above).
<div class="p"><!----></div>
If you are unable to link against  C<span style="font-size:x-small">OLUMBUS</span> and/or  M<span style="font-size:x-small">OLCAS</span>, simply call
<div class="p"><!----></div>
        <tt>make&nbsp;&nbsp;wfoverlap_ascii.x</tt>
<div class="p"><!----></div>
to compile a minimal version of the CI Overlap program that only reads ASCII files.
In this case, overlap and Dyson calculations with <b><tt>SHARC_COLUMBUS.py</tt></b> and Dyson calculations with <b><tt>SHARC_MOLCAS.py</tt></b> will not be possible.
<div class="p"><!----></div>
     <a id="tth_sEc6.13.1"></a><h3>
6.13.1&nbsp;&nbsp;Workflow</h3>
<div class="p"><!----></div>
The workflow of the overlap program is shown in Figure&nbsp;<a href="#fig:work"> 6.3</a>.
Four pieces of input, as shown on top, have to be given:
<ul>
<li> Overlaps between the two sets of AOs used to construct the bra and ket wavefunctions,
<div class="p"><!----></div>
</li>
<li> MO coefficients of the bra and ket wavefunctions,
<div class="p"><!----></div>
</li>
<li> information about the Slater determinants,
<div class="p"><!----></div>
</li>
<li> the corresponding CI coefficients.
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
Two main intermediates are computed, the MO overlaps and the unique factors <i>S</i><sub>kl</sub>, <span class="overacc2">&#x2015;</span><i>S</i><sub>kl</sub> where the latter may require significant amounts of memory to be stored.
The reuse of these intermediates is one of the main reasons for the decent performance of the <b><tt>wfoverlap.</tt></b> program.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_fIg6.3">
</a>   <div style="text-align:center">  <img src="http://sharc-md.org/wp-content/uploads/2018/02/wfoverlap.png">  
<div style="text-align:center">Figure 6.3: Workflow of the wavefunction overlap program.</div>
  <a id="fig:work">
</a>
</div>
<div class="p"><!----></div>
     <a id="tth_sEc6.13.2"></a><h3>
6.13.2&nbsp;&nbsp;Calling the program</h3>
The main program is called in the following form
<b><tt>wfoverlap.x [-m &lt;mem=1000&#62;] [-f &lt;input_file=cioverlap.input&#62;]</tt></b>
with the command line options
<ul>
<li> <b><tt>-m</tt></b> : amount of memory in MB
<div class="p"><!----></div>
</li>
<li> <b><tt>-f</tt></b> : input file
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
Example:
<b><tt>wfoverlap.x -m 2000 -f wfov.in</tt></b>
<div class="p"><!----></div>
<b>Mode&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The program automatically detects whether overlaps or Dyson orbitals should be calculated.
If the number of electrons in the bra and ket wavefunctions is the same, wavefunction overlaps are computed.
If the number of &#945; electrons or the number of &#946; electrons differ by exactly 1, Dyson orbitals are computed.
If the wave functions differ by more than one electron, the program will stop with an error message.
<div class="p"><!----></div>
<b>Memory&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The amount of <b>memory</b> given is a decisive factor for the performance of the code.
Depending on the amount of memory, one of three different modes is chosen:
<div class="p"><!----></div>
(i) All <i>S</i><sub>kl</sub> and <span class="overacc2">&#x2015;</span><i>S</i><sub>kl</sub> terms are kept in core (using arrays called <b><tt>P_ovl</tt></b>and <b><tt>Q_ovl</tt></b>).
<div class="p"><!----></div>
(ii) Only the <i>S</i><sub>kl</sub> factors (<b><tt>P_ovl</tt></b>) are kept in core. This is indicated by
<b><tt>Allocation of Q block overlap matrix failed.
  - Using on-the-fly algorithm for Q determinants.</tt></b>
This mode is generally as efficient as 1. but shows somewhat worse parallel scaling.
<div class="p"><!----></div>
(iii) Not even all <i>S</i><sub>kl</sub> factors can be stored
<b><tt>Only 437 out of 886 columns of the P_ovl matrix are stored in memory (3 MB)!
 Increase the amount of memory to improve the efficiency.</tt></b>
This mode is significantly slower than (i) and (ii) and should be avoided by increasing the amount of memory.
<div class="p"><!----></div>
<b>Input file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb6.15">
</a>   <div style="text-align:center">Table 6.15: List of keywords given in the input file. The <b><tt>a_mo, b_mo, a_det, b_det</tt></b> keywords are mandatory, all others are optional.</div>
  <a id="tab:key_wfo">
</a>
<table>
<tr><td align="left">Keyword </td><td align="left">Default </td><td width="355">Description </td></tr>
<tr><td align="left"><b><tt>a_mo</tt></b>                 </td><td align="left">-                           </td><td width="355">MO coefficient file (bra)</td></tr>
<tr><td align="left"><b><tt>b_mo</tt></b>                 </td><td align="left">-                           </td><td width="355">MO coefficient file (ket)</td></tr>
<tr><td align="left"><b><tt>a_mo_read</tt></b>           </td><td align="left">0                             </td><td width="355">Format for the MO coefficients (bra):</td></tr>
<tr><td align="left"></td><td align="left"></td><td width="355">0:  C<span style="font-size:x-small">OLUMBUS</span>, 1:  M<span style="font-size:x-small">OLCAS</span>, 2:  T<span style="font-size:x-small">URBOMOLE</span></td></tr>
<tr><td align="left"><b><tt>b_mo_read</tt></b>           </td><td align="left">0                             </td><td width="355">Format for the MO coefficients (ket)</td></tr>
<tr><td align="left"><b><tt>a_det</tt></b>                </td><td align="left">-                           </td><td width="355">Determinant file (bra)</td></tr>
<tr><td align="left"><b><tt>b_det</tt></b>                </td><td align="left">-                           </td><td width="355">Determinant file (ket)</td></tr>
<tr><td align="left"><b><tt>ncore</tt></b>                 </td><td align="left">0                             </td><td width="355">Number of discarded core orbitals</td></tr>
<tr><td align="left"><b><tt>ndocc</tt></b>                 </td><td align="left">0                             </td><td width="355">Number of doubly occupied orbitals that are not used for 
                                                                annihilation in Dyson orbital calculations (only has effect if larger than <b><tt>ncore</tt></b>)</td></tr>
<tr><td align="left"><b><tt>ao_read</tt></b>              </td><td align="left">0                             </td><td width="355">Format for overlap integrals:</td></tr>
<tr><td align="left"></td><td align="left"></td><td width="355">0: ASCII, 1:  M<span style="font-size:x-small">OLCAS</span>, 2:  C<span style="font-size:x-small">OLUMBUS</span>/SIFS,</td></tr>
<tr><td align="left"></td><td align="left"></td><td width="355">-1: Compute by inversion of MO coefficient matrx</td></tr>
<tr><td align="left"><b><tt>mix_aoovl</tt></b>            </td><td align="left"><b><tt>S_mix/ONEINT/aoints</tt></b>    </td><td width="355">AO overlap file</td></tr>
<tr><td align="left"></td><td align="left">for <b><tt>ao_read=0/1/2</tt></b>      </td><td width="355"></td></tr>
<tr><td align="left"><b><tt>same_aos</tt></b>             </td><td align="left">.false.                       </td><td width="355">If both calculations were performed with the same set of AOs (specify only for <b><tt>ao_read=1/2</tt></b>)</td></tr>
<tr><td align="left"><b><tt>nao_a</tt></b>                </td><td align="left"><i>automatic</i>            </td><td width="355">Number of bra AOs for <b><tt>ao_read=1/2</tt></b> (specify only if different from ket AOs) </td></tr>
<tr><td align="left"><b><tt>nao_b</tt></b>                </td><td align="left"><i>automatic</i>            </td><td width="355">Number of ket AOs (see above)  </td></tr>
<tr><td align="left"><b><tt>moprint</tt></b>               </td><td align="left">0                             </td><td width="355">Print Dyson orbitals: 1: coefficients to std. out,</td></tr>
<tr><td align="left"></td><td align="left">2: as Jmol script</td></tr>
<tr><td align="left"><b><tt>force_direct_dets</tt></b>   </td><td align="left">.false.                       </td><td width="355">Compute <i>S</i><sub>kl</sub> terms directly (turn off &#223;uperblocks").
                                                                Recommended if the number of CPU-cores is large (on the same order as the number of &#223;uperblocks").</td></tr>
<tr><td align="left"><b><tt>force_noprecalc</tt></b>      </td><td align="left">.false.                       </td><td width="355">Do not precalculate the <span class="overacc2">&#x2015;</span><i>S</i><sub>kl</sub> factors.</td></tr>
<tr><td align="left"><b><tt>mixing_angles</tt></b>        </td><td align="left">.false.                       </td><td width="355">Compute mixing angles as a matrix logarithm.</td></tr></table>
<div class="p"><!----></div>
An example input file is shown below:
<pre>
a_mo=mocoef_a
b_mo=mocoef_b
a_det=dets_a
b_det=dets_b
ao_read=2
same_aos
</pre>
The full list of keywords is given in Table&nbsp;<a href="#tab:key_wfo"> 6.15</a>.
<div class="p"><!----></div>
     <a id="tth_sEc6.13.3"></a><h3>
6.13.3&nbsp;&nbsp;Input data</h3>
Typically, three types of input need to be provided: AO overlaps, MO coefficients, and a combined file with determinant information and CI coefficients (cf.&nbsp;Figure&nbsp;<a href="#fig:work"> 6.3</a>).
The file formats are explained here.
Within  S<span style="font-size:x-small">HARC</span>, these files are automatically extracted or converted by the interfaces, so the user does not need to create them.
<div class="p"><!----></div>
<b>AO overlaps&nbsp;&nbsp;</b>
The mixed AO overlaps  &lt; &#967;<sub>&#956;</sub>&#124;&#967;<sub>&#957;</sub>&#8242; &gt;  between the AOs used to expand the bra and ket wavefunctions are required.
They are in general created by a "double molecule" calculation, i.e. an AO integral calculation where every atom is found twice in the input file.
<div class="p"><!----></div>
The native format (<b><tt>ao_read=0</tt></b>) is a simple ASCII file containing the relevant off-diagonal block of the mixed AO overlap matrix, e.g.
<div class="p"><!----></div>
<pre>
&nbsp;&nbsp;&nbsp;7&nbsp;7
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;9.97108464676133E-001&nbsp;&nbsp;&nbsp;&nbsp;2.36720699813181E-001&nbsp;&nbsp;&nbsp;...
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.36720699813181E-001&nbsp;&nbsp;&nbsp;&nbsp;9.99919192433940E-001&nbsp;&nbsp;&nbsp;...
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.00147985713321E-002&nbsp;&nbsp;&nbsp;&nbsp;6.52340422397770E-003&nbsp;&nbsp;&nbsp;...
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...
</pre>
<div class="p"><!----></div>
In addition,  M<span style="font-size:x-small">OLCAS</span> (<b><tt>ao_read=1</tt></b>) and  C<span style="font-size:x-small">OLUMBUS</span>/SIFS (<b><tt>ao_read=2</tt></b>) files can be read in binary form.
<div class="p"><!----></div>
If the same AOs are used for the bra and ket wavefunctions and the MO coefficient matrix is square, it is possible to reconstruct the overlaps by inversion of the MO coefficient matrix (<b><tt>ao_read=-1</tt></b>).
In this case it is not necessary to supply a <b><tt>mix_aoovl</tt></b> file.
<div class="p"><!----></div>
<b>MO coefficients&nbsp;&nbsp;</b>
<div class="p"><!----></div>
MO coefficients of the bra and ket wavefunctions can usually be read in directly in the form written by the quantum chemistry program.
The supported options for <b><tt>a_mo_read</tt></b> and <b><tt>b_mo_read</tt></b> are <b><tt>0</tt></b> for  C<span style="font-size:x-small">OLUMBUS</span> format, <b><tt>1</tt></b> for  M<span style="font-size:x-small">OLCAS</span> lumorb format, and <b><tt>2</tt></b> for  T<span style="font-size:x-small">URBOMOLE</span> format.
<div class="p"><!----></div>
Because the number of electrons strongly affects the run time of <b><tt>wfoverlap.x</tt></b>, it is generally beneficial to apply a frozen core approximation, even if the actual wave function calculation did not do so.
Most interfaces which use <b><tt>wfoverlap.x</tt></b> have a keyword <b><tt>numfrozcore</tt></b> in the resource file, which only affects the number of frozen core orbitals for the overlap calculation (If the interface support frozen core for the quantum chemistry itself, there will be a keyword in the template file).
<div class="p"><!----></div>
<b>Slater determinants and CI coefficients&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Slater determinants and CI coefficients are currently supplied by an ASCII file of the form
<pre>
3&nbsp;7&nbsp;168
dddddee&nbsp;&nbsp;&nbsp;0.979083342437&nbsp;&nbsp;&nbsp;&nbsp;0.979083342437&nbsp;&nbsp;&nbsp;-0.122637656388
ddddabe&nbsp;&nbsp;-0.094807515471&nbsp;&nbsp;&nbsp;-0.094807515471&nbsp;&nbsp;&nbsp;-0.663224542162
ddddbae&nbsp;&nbsp;&nbsp;0.094807515471&nbsp;&nbsp;&nbsp;&nbsp;0.094807515471&nbsp;&nbsp;&nbsp;&nbsp;0.663224542162
...
</pre>
<div class="p"><!----></div>
The first line specifies
<ul>
<li> the number of states (columns in the file),
<div class="p"><!----></div>
</li>
<li> the number of MOs (length of the determinant strings), and
<div class="p"><!----></div>
</li>
<li> the number of determinants in the file (length of the file).
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
Every subsequent line gives the determinant string and the corresponding CI coefficients for the different states.
The following symbols are used in the determinant string:
<div class="p"><!----></div>
<ul>
d - doubly occupied
a - singly occupied (&#945;)
b - singly occupied (&#946;)
e - empty</ul>
<div class="p"><!----></div>
Most relevant for  S<span style="font-size:x-small">HARC</span>&nbsp;users, the <b><tt>wfoverlap.x</tt></b> program <em>fully considers all determinants inside these files</em>, without applying any form of truncation. Hence, truncation of long wave functions is done during the creation of the determinant files.
Most interfaces which write these files have a keyword <b><tt>wfthres</tt></b> in their resource file. This threshold is a number between 0.0 and 1.0, and is the minimum wave function norm to which the wave functions should be truncated. During truncation, the interfaces generally retain the largest-amplitude CI coefficients, and remove determinants with small coefficients, i.e., they find the truncated expansion with the fewest determinants which has a norm above the <b><tt>wfthres</tt></b>.
Choosing this threshold properly can very strongly affect the computational time spent in the overlap calculation. Generally, for CASSCF wave functions the threshold can be set to 1 (<b><tt>SHARC_MOLPRO.py</tt></b> and <b><tt>SHARC_MOLCAS.py</tt></b> always use all determinants and do not have the <b><tt>wfthres</tt></b> option), for TDA-DFT/ADC(2) it should usually be above 0.99, for and for MRCI wave functions it might be necessary to go as low as 0.95, depending on the accuracy and performance needed.
For TD-DFT calculations without the Tamm-Damcoff approximation, the response vectors are usually normalized to &#124;<b>X</b>&#124;<sup>2</sup>&#8722;&#124;<b>Y</b>&#124;=1, but only <b>X</b> is used in the overlap calculation; since the norm of <b>X</b> can thus exceed 1, the <b><tt>wfthres</tt></b> should be increased above 1, too.
As a rule of thumb, the threshold should always be chosen such that each state is represented by at least a few 100 determinants in the file, in order to obtain smoothly varying overlaps.
If unsure, the user should perform a test calculation, varying the <b><tt>wfthres</tt></b> until a suitable one is found.
<div class="p"><!----></div>
     <a id="tth_sEc6.13.4"></a><h3>
6.13.4&nbsp;&nbsp;Output</h3>
<div class="p"><!----></div>
Usually, the output of <b><tt>wfoverlap.x</tt></b> is automatically extracted by the interfaces, and reported in <b><tt>QM.out</tt></b> in the overlap or 2D-property sections.
<div class="p"><!----></div>
<b>Wavefunction overlaps&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The output first lists some information about the wavefunction structure and about the computational time taken for the individual steps (cf. Figure&nbsp;<a href="#fig:work"> 6.3</a>).
<div class="p"><!----></div>
A typical result of a wavefunction overlap computation is shown here:
<pre>
&nbsp;Overlap&nbsp;matrix&nbsp;&lt;PsiA_i|PsiB_j&#62;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|PsiB&nbsp;&nbsp;1&#62;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|PsiB&nbsp;&nbsp;2&#62;
&lt;PsiA&nbsp;&nbsp;1|&nbsp;&nbsp;&nbsp;&nbsp;0.5162656622&nbsp;-0.2040109070
&lt;PsiA&nbsp;&nbsp;2|&nbsp;&nbsp;&nbsp;-0.2167057391&nbsp;-0.5266552021
&nbsp;Renormalized&nbsp;overlap&nbsp;matrix&nbsp;&lt;PsiA_i|PsiB_j&#62;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|PsiB&nbsp;&nbsp;1&#62;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|PsiB&nbsp;&nbsp;2&#62;
&lt;PsiA&nbsp;&nbsp;1|&nbsp;&nbsp;&nbsp;&nbsp;0.5162656622&nbsp;-0.2040109070
&lt;PsiA&nbsp;&nbsp;2|&nbsp;&nbsp;&nbsp;-0.2167057391&nbsp;-0.5266552021
&nbsp;Performing&nbsp;Lowdin&nbsp;orthonormalization&nbsp;by&nbsp;SVD...
&nbsp;Orthonormalized&nbsp;overlap&nbsp;matrix&nbsp;&lt;PsiA_i|PsiB_j&#62;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|PsiB&nbsp;&nbsp;1&#62;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|PsiB&nbsp;&nbsp;2&#62;
&lt;PsiA&nbsp;&nbsp;1|&nbsp;&nbsp;&nbsp;&nbsp;0.9273847015&nbsp;-0.3741090956
&lt;PsiA&nbsp;&nbsp;2|&nbsp;&nbsp;&nbsp;-0.3741090956&nbsp;-0.9273847015
</pre>
<div class="p"><!----></div>
<b><tt>Overlap matrix</tt></b> gives the raw overlap values
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-15.png">
</td><td width="1%">(6.12)</td></tr></table>
of the wavefunctions supplied.
<div class="p"><!----></div>
<b><tt>Renormalized overlap matrix</tt></b> gives the renormalized overlap values
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-16.png">
</td><td width="1%">(6.13)</td></tr></table>
relevant in the case of wavefunction truncation.
<div class="p"><!----></div>
The <b><tt>Orthonormalized overlap matrix</tt></b> is constructed according to a procedure described in more detail in Ref.&nbsp;<a href="#Plasser2016JCTC" class="tth_citeref">[73</a>].
<div class="p"><!----></div>
<b>Dyson orbitals&nbsp;&nbsp;</b>
The matrix of Dyson norms is printed at the end of the file
<div class="p"><!----></div>
<pre>
&nbsp;ALPHA&nbsp;ionization
&nbsp;Dyson&nbsp;norm&nbsp;matrix&nbsp;|&lt;PsiA_i|PsiB_j&#62;|^2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|PsiB&nbsp;&nbsp;1&#62;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|PsiB&nbsp;&nbsp;2&#62;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|PsiB&nbsp;&nbsp;3&#62;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;PsiA&nbsp;&nbsp;1|&nbsp;&nbsp;&nbsp;&nbsp;0.8817323437&nbsp;&nbsp;0.4716319904&nbsp;&nbsp;0.0680618001&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;PsiA&nbsp;&nbsp;2|&nbsp;&nbsp;&nbsp;&nbsp;0.0615587916&nbsp;&nbsp;0.4657174978&nbsp;&nbsp;0.8772909828&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;PsiA&nbsp;&nbsp;3|&nbsp;&nbsp;&nbsp;&nbsp;0.0000000000&nbsp;&nbsp;0.0363130811&nbsp;&nbsp;0.0000000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;PsiA&nbsp;&nbsp;4|&nbsp;&nbsp;&nbsp;&nbsp;0.9634885049&nbsp;&nbsp;0.0000000000&nbsp;&nbsp;0.0017379586&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;PsiA&nbsp;&nbsp;5|&nbsp;&nbsp;&nbsp;&nbsp;0.0000000000&nbsp;&nbsp;0.9261839484&nbsp;&nbsp;0.0000000000&nbsp;
</pre>
<div class="p"><!----></div>
In the case of <b><tt>moprint=1</tt></b> the orbitals are printed, as well.
The expansion is given with respect to the MOs of the neutral system.
<pre>
&nbsp;&nbsp;Dyson&nbsp;orbitals&nbsp;in&nbsp;reference&nbsp;|ket&#62;&nbsp;MO&nbsp;basis:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;PsiA&nbsp;&nbsp;1|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|PsiB&nbsp;&nbsp;&nbsp;1&#62;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|PsiB&nbsp;&nbsp;&nbsp;2&#62;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|PsiB&nbsp;&nbsp;&nbsp;3&#62;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
MO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;-1.24032037E-03&nbsp;&nbsp;0.00000000E+00&nbsp;&nbsp;9.98160731E-04&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
MO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;-5.90277699E-02&nbsp;&nbsp;0.00000000E+00&nbsp;&nbsp;6.14517859E-02&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
MO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;-1.23295110E-09&nbsp;&nbsp;0.00000000E+00&nbsp;&nbsp;3.08416849E-10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
MO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;0.00000000E+00&nbsp;-6.86713110E-01&nbsp;&nbsp;0.00000000E+00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
MO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;9.31351013E-01&nbsp;&nbsp;0.00000000E+00&nbsp;-2.49427166E-01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
MO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6&nbsp;-3.50106110E-02&nbsp;&nbsp;0.00000000E+00&nbsp;&nbsp;4.19935829E-02
MO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7&nbsp;-1.83303166E-10&nbsp;&nbsp;0.00000000E+00&nbsp;-3.67409953E-12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
MO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8&nbsp;-1.91183349E-10&nbsp;&nbsp;0.00000000E+00&nbsp;&nbsp;9.40768334E-11&nbsp;
...
</pre>
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_chAp7"></a><h1>
Chapter 7 Auxilliary Scripts</h1><a id="chap:aux">
</a>
<div class="p"><!----></div>
In this chapter, all auxiliary scripts and programs are documented. Input generators (like <b><tt>molpro_input.py</tt></b> and <b><tt>molcas_input.py</tt></b>) are documented in the relevant interface sections.
<div class="p"><!----></div>
All auxiliary scripts are either interactive-prompting user input from stdin in order to setup a certain task-or non-interactive, meaning they are controlled by command-line arguments and options, in the same way as many standard command-line tools work.
<div class="p"><!----></div>
All interactive scripts sequentially ask a number of questions to the user. In many cases, a default value is presented, which is either preset or detected by the scripts based on the availability of certain files. Furthermore, the scripts feature auto-completion of paths and filenames (use TAB), which is active only in questions where auto-completion is relevant. For certain questions where lists of integers needs to be entered, ranges can be indicated with the tilde symbol (), e.g., <b><tt>-8-2</tt></b> (note that no spaces are allowed between the tilde and the two numbers) to indicate the list <b><tt>-8 -7 -6 -5 -4 -3 -2</tt></b>. 
<div class="p"><!----></div>
All interactive scripts write a file called <b><tt>KEYSTROKES.&lt;script_name&#62;</tt></b> which contains the user input from the last completed session. These files can be piped to the interactive scripts to perform the same task again, for example:
<pre>
user@host&#62;&nbsp;cat&nbsp;KEYSTROKES.excite&nbsp;-&nbsp;|&nbsp;$SHARC/excite.py
</pre>
Note the <b><tt>-</tt></b>, which tells <b><tt>cat</tt></b> to switch to stdin after the file ends, so that the user can proceed if the script asks for more input than contained in the <b><tt>KEYSTROKES</tt></b> file.
<div class="p"><!----></div>
All non-interactive scripts can be called with the <b><tt>-h</tt></b> option to obtain a short description, usage information and a list of the command line options.
Non-interactive scripts also write a <b><tt>KEYSTROKES.&lt;script_name&#62;</tt></b> file, which will contain the last command entered to execute the script (including all options and arguments).
<div class="p"><!----></div>
All scripts can be safely killed during a run by using <b><tt>Ctrl-C</tt></b>. In the case of interactive scripts, a <b><tt>KEYSTROKES.tmp</tt></b> file remains, containing the user input made so far. Note that the <b><tt>KEYSTROKES.tmp</tt></b> file cannot be directly piped to the scripts, because <b><tt>KEYSTROKES.tmp</tt></b> will be overwritten when the script starts.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc7.1"></a><h2>
7.1&nbsp;&nbsp;Wigner Distribution Sampling: <b><tt>wigner.py</tt></b></h2><a id="sec:wigner.py">
</a>
<div class="p"><!----></div>
The first step in preparing the dynamics calculation is to obtain a set of physically reasonable initial conditions. Each initial condition is a set of initial atomic coordinates, initial atomic velocities and initial electronic state. The initial geometry and velocities can be obtained in different ways. With  S<span style="font-size:x-small">HARC</span>, often sampling of a quantum-harmonic Wigner distribution is performed. 
<div class="p"><!----></div>
The sampling is carried out with the non-interactive Python script <b><tt>wigner.py</tt></b>. The theoretical background is summarized in section&nbsp;<a href="#met:wigner">8.20</a>.
<div class="p"><!----></div>
     <a id="tth_sEc7.1.1"></a><h3>
7.1.1&nbsp;&nbsp;Usage</h3>
<div class="p"><!----></div>
The general usage is 
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/wigner.py&nbsp;[options]&nbsp;filename.molden
</pre>
<b><tt>wigner.py</tt></b> takes exactly one command-line argument (the input file with the frequencies and normal modes), plus some options. Usually, the <b><tt>-n</tt></b> option is necessary, since the default is to only create 3 initial conditions.
<div class="p"><!----></div>
The argument is the filename of the file containing the information about the vibrational frequencies and normal modes. The file is by default assumed to be in the <a href="http://www.cmbi.ru.nl/molden/molden_format.html"> M<span style="font-size:x-small">OLDEN</span> format</a>. For usage with <b><tt>wigner.py</tt></b>, only the following blocks have to be present:
<div class="p"><!----></div>
<table border="0"><tr><td></td><td><table border="0"><tr><td>
<ul>
<li> [FREQ]
<div class="p"><!----></div>
</li>
<li> [FR-COORD]
<div class="p"><!----></div>
</li>
<li> [FR-NORM-COORD]
<div class="p"><!----></div>
</li>
</ul>
</td></tr></table><!--vbox-->
</td><td></td></tr></table><!--hboxt-->The script accepts a number of command-line options, specified in table&nbsp;<a href="#tab:wigner_opts"> 7.1</a>.
<div class="p"><!----></div>
<a id="tth_tAb7.1">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 7.1: Command-line options for script <b><tt>wigner.py</tt></b>.</div>
  <a id="tab:wigner_opts">
</a>
<table>
<tr><td align="left"><span class="roman">Option        </td><td align="left">Description      </td><td width="355">Default</td></tr>
<tr><td align="left">-h                  </td><td align="left">Display help message and quit              </td><td width="355">-                            </td></tr>
<tr><td align="left">-n  INTEGER         </td><td align="left">Number of initial conditions to generate   </td><td width="355">3                              </td></tr>
<tr><td align="left">-m                  </td><td align="left">Modify atom masses (starts interactive dialog)  </td><td width="355">Most common isotopes      </td></tr>
<tr><td align="left">-s  FLOAT           </td><td align="left">Scaling factor for the frequencies         </td><td width="355">1.0                            </td></tr>
<tr><td align="left">-t  FLOAT           </td><td align="left">Use Boltzmann-weighted distribution at the given temperature   </td><td width="355">0.0 K</td></tr>
<tr><td align="left">-T                  </td><td align="left">Discard very high vibrational states at high temperatures      </td><td width="355">Don't discard, but warn</td></tr>
<tr><td align="left">-L  FLOAT           </td><td align="left">Discard frequencies below the given one (in cm<sup>&#8722;1</sup>)         </td><td width="355">10.0</td></tr>
<tr><td align="left">-o  FILENAME        </td><td align="left">Output filename                            </td><td width="355"><b><tt>initconds</tt></b>                </td></tr>
<tr><td align="left">-x                  </td><td align="left">Creates an xyz file with the sampled geometries </td><td width="355"><b><tt>initconds.xyz</tt></b>       </td></tr>
<tr><td align="left">-l                  </td><td align="left">Instead of generating <b><tt>initconds</tt></b>, create input for <b><tt>SHARC_LVC.py</tt></b>    </td><td width="355">Create <b><tt>initconds</tt></b></td></tr>
<tr><td align="left">-r  INTEGER         </td><td align="left">Seed for random number generator           </td><td width="355">16661                          </td></tr>
<tr><td align="left">-f F                </td><td align="left">Type of normal modes read (0=detect automatically, 1-4=see below)     </td><td width="355">0</td></tr>
<tr><td align="left">-keep_trans_rot  </td><td align="left">Do not remove translations and rotations from velocity vector </td><td width="355"></td></tr>
<tr><td align="left">-use_eq_geom     </td><td align="left">Sample only velocities, but keep equilibrium geometry  </td><td width="355">Sample normally</td></tr>
<tr><td align="left">-use_zero_veloc  </td><td align="left">Sample only geometries, but set velocities to zero     </td><td width="355">Sample normally</td></tr></span></table>
</div>
<div class="p"><!----></div>
     <a id="tth_sEc7.1.2"></a><h3>
7.1.2&nbsp;&nbsp;Normal mode types</h3>
<div class="p"><!----></div>
The normal mode vectors contained in a  M<span style="font-size:x-small">OLDEN</span> file can follow different conventions, e.g., unscaled Cartesian displacements or different kinds of mass-weighted displacements.
By default, <b><tt>wigner.py</tt></b> attempts to identify which convention is followed by the file (by performing different renormalizations and checking if the so-obtained matrix is orthogonal).
In order to use this automatic detection, use <b><tt>-f 0</tt></b>, which is the default.
Otherwise, there are four possible options: <b><tt>-f 1</tt></b> to assume normal modes in the  G<span style="font-size:x-small">AUSSIAN</span> convention (used by  G<span style="font-size:x-small">AUSSIAN</span>,  T<span style="font-size:x-small">URBOMOLE</span>,  Q-C<span style="font-size:x-small">HEM</span>, ADF, and  O<span style="font-size:x-small">RCA</span>); <b><tt>-f 2</tt></b> to assume Cartesian normal modes (used by  M<span style="font-size:x-small">OLCAS</span> and  M<span style="font-size:x-small">OLPRO</span>); <b><tt>-f 3</tt></b> to assume the  C<span style="font-size:x-small">OLUMBUS</span> convention; or <b><tt>-f 4</tt></b> for mass-weighted, orthogonal normal modes.
<div class="p"><!----></div>
     <a id="tth_sEc7.1.3"></a><h3>
7.1.3&nbsp;&nbsp;Non-default masses</h3>
<div class="p"><!----></div>
When the <b><tt>-m</tt></b> option is used, the script will ask the user to interactively modify the atom masses. For each atom (referred to by the atom index as in the  M<span style="font-size:x-small">OLDEN</span> file), a mass can be given (relative atomic weights). Note that the frequency calculation which produces the  M<span style="font-size:x-small">OLDEN</span> should be done with the same atomic masses.
<div class="p"><!----></div>
     <a id="tth_sEc7.1.4"></a><h3>
7.1.4&nbsp;&nbsp;Sampling at finite temperatures</h3>
<div class="p"><!----></div>
When the <b><tt>-t</tt></b> option is used, the script assumes a finite, non-zero temperature.
The sampling will then consist of two steps, where first randomly a vibrational state is picked from the Boltzmann distribution, and then the Wigner distribution of that state is employed.
For more details, see Section&nbsp;<a href="#met:wigner">8.20</a>.
<div class="p"><!----></div>
At high temperatures and for low-frequency modes it is possible that very large vibrational quantum numbers will be selected.
Because of the occurrence of factorials in the Laguerre polynomials in the excited Wigner distributions, this leads to variable overflow for &#957;<sub>vib</sub> &gt; 150. Hence, the highest vibrational quantum number considered is 150, and higher ones are set to 150.
Since this can lead to an overrepresentation of &#957;<sub>vib</sub>=150, with the <b><tt>-T</tt></b> option one can instead discard all samplings where &#957;<sub>vib</sub> &gt; 150.
No matter whether <b><tt>-T</tt></b> is used or not, keep in mind that usually such high vibrational states might invalidate the assumption of an harmonic oscillator, and other sampling methods (e.g., molecular dynamics) should be considered.
<div class="p"><!----></div>
     <a id="tth_sEc7.1.5"></a><h3>
7.1.5&nbsp;&nbsp;Output</h3>
<div class="p"><!----></div>
The script <b><tt>wigner.py</tt></b> generates a single output file, by default called <b><tt>initconds</tt></b>. All information about the initial conditions is stored in this file. Later steps in the preparation of the initial conditions add information about the excited states to this file. The file is formatted in a human-readable form.
<div class="p"><!----></div>
The <b><tt>initconds</tt></b> file format is specified in section&nbsp;<a href="#sec:initcondsfile">7.5.5</a>.
<div class="p"><!----></div>
When the <b><tt>-x</tt></b> option is given, additionally the script produces a file called <b><tt>initconds.xyz</tt></b>, which contains the sampled geometries in standard xyz format. This can be useful to inspect the distribution of geometry parameters (e.g., bond lengths) or to perform single point calculations at the sampled geometries.
<div class="p"><!----></div>
When the <b><tt>-l</tt></b> option is given, the script only produces a file called <b><tt>V0.txt</tt></b>, which is a necessary input file for the LVC interface (see section&nbsp;<a href="#sec:int:lvc">6.9</a>). If this option is activated, no <b><tt>initconds</tt></b> or <b><tt>initconds.xyz</tt></b> files are produced.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc7.2"></a><h2>
7.2&nbsp;&nbsp; A<span style="font-size:x-small">MBER</span> Trajectory Sampling: <b><tt>amber_to_initconds.py</tt></b></h2><a id="sec:amber_to_initconds.py">
</a>
<div class="p"><!----></div>
The first step in preparing the dynamics calculation is to obtain a set of physically reasonable initial conditions. Each initial condition is a set of initial atomic coordinates, initial atomic velocities and initial electronic state. The initial geometry and velocities can be obtained in different ways. 
Besides sampling from a quantum mechanical Wigner distribution, it is often appropriate to sample geometries and velocities from a ground state molecular dynamics simulation.
<div class="p"><!----></div>
Using <b><tt>amber_to_initconds.py</tt></b>, one can convert the results of an  A<span style="font-size:x-small">MBER</span> simulation to a  S<span style="font-size:x-small">HARC</span>&nbsp;<b><tt>initconds</tt></b> file.
<div class="p"><!----></div>
     <a id="tth_sEc7.2.1"></a><h3>
7.2.1&nbsp;&nbsp;Usage</h3>
<div class="p"><!----></div>
In order to use <b><tt>amber_to_initconds.py</tt></b>, it is necessary to first carry out an  A<span style="font-size:x-small">MBER</span> simulation.
You need to add the following options to the  A<span style="font-size:x-small">MBER</span> MD input file: (i) <b><tt>ntxo=1</tt></b> to tell  A<span style="font-size:x-small">MBER</span> to write ASCII restart files, (ii) <b><tt>ntwr=-5000</tt></b> to create a restart file every 5000 steps (other values are possible, but use the minus to not overwrite the restart files).
This will create a set of  A<span style="font-size:x-small">MBER</span> restart files called, e.g., <b><tt>md.rst_5000</tt></b>, <b><tt>md.rst_10000</tt></b>, ...
<div class="p"><!----></div>
Note that it is also necessary to reimage the  A<span style="font-size:x-small">MBER</span> restart files, because  S<span style="font-size:x-small">HARC</span>&nbsp;does not work with periodic boundary conditions, but the  A<span style="font-size:x-small">MBER</span> trajectories might use them.
The reimaging can be performed with  A<span style="font-size:x-small">MBER</span>'s tool <b><tt>cpptraj</tt></b>, using the following input:
<pre>
parm&nbsp;&lt;filename&#62;.prmtop
trajin&nbsp;&lt;filename&#62;.rst7
autoimage
trajout&nbsp;&lt;filename2&#62;.rst7
run
</pre>
This command has to be repeated for each restart file which needs to be reimaged.
If you saved the restart files in  A<span style="font-size:x-small">MBER</span>'s newer NetCDF format, <b><tt>cpptraj</tt></b> can also be used to convert them to ASCII restart files.
If you did not save restart files, <b><tt>cpptraj</tt></b> can even be used to generate restart files from the trajectory file (<b><tt>.mdcrd</tt></b>).
<div class="p"><!----></div>
With the restart files prepared, call <b><tt>amber_to_initconds.py</tt></b> like this:
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/amber_to_initconds.py&nbsp;[options]&nbsp;md.prmtop&nbsp;md.rst_0&nbsp;md.rst_5000&nbsp;md.rst_10000&nbsp;...
</pre>
The possible options are shown in Table&nbsp;<a href="#tab:amber_opts"> 7.2</a>.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb7.2">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 7.2: Command-line options for script <b><tt>amber_to_initconds.py</tt></b>.</div>
  <a id="tab:amber_opts">
</a>
<table>
<tr><td align="left"><span class="roman">Option        </td><td align="left">Description      </td><td width="355">Default</td></tr>
<tr><td align="left">-h                  </td><td align="left">Display help message and quit              </td><td width="355">-                            </td></tr>
<tr><td align="left">-t  FLOAT           </td><td align="left">Time step (in femtoseconds) used in the  A<span style="font-size:x-small">MBER</span> simulation      </td><td width="355">-</td></tr>
<tr><td align="left">-o  FILENAME        </td><td align="left">Output filename                            </td><td width="355"><b><tt>initconds</tt></b>                </td></tr>
<tr><td align="left">-x                  </td><td align="left">Creates an xyz file with the sampled geometries </td><td width="355"><b><tt>initconds.xyz</tt></b>       </td></tr>
<tr><td align="left">-m                  </td><td align="left">Modify atom masses (starts interactive dialog)  </td><td width="355">As in <b><tt>prmtop</tt></b> file   </td></tr>
<tr><td align="left">-keep_trans_rot  </td><td align="left">Do not remove translations and rotations from velocity vector </td><td width="355"></td></tr>
<tr><td align="left">-use_zero_veloc  </td><td align="left">Sample only geometries, but set velocities to zero     </td><td width="355">Sample normally</td></tr></span></table>
</div>
<div class="p"><!----></div>
     <a id="tth_sEc7.2.2"></a><h3>
7.2.2&nbsp;&nbsp;Time Step</h3>
<div class="p"><!----></div>
Note that the option <b><tt>-t</tt></b> (giving the time step used in  A<span style="font-size:x-small">MBER</span> in femtoseconds) is mandatory; if not given, an error message is produced.
This is because  A<span style="font-size:x-small">MBER</span> uses a Leapfrog algorithm and thus stores in the restart file R(t) and v(t+&#8710;t/2), whereas  S<span style="font-size:x-small">HARC</span>&nbsp;uses the velocity-Verlet algorithm and requires R(t+&#8710;t/2) and v(t+&#8710;t/2), i.e., geometry and velocity at the same time.
To compensate this, <b><tt>amber_to_initconds.py</tt></b> computes R(t+&#8710;t/2) from R(t)&#8722;v(t+&#8710;t/2)&#8710;t/2.
<div class="p"><!----></div>
     <a id="tth_sEc7.2.3"></a><h3>
7.2.3&nbsp;&nbsp;Atom Types and Masses</h3>
<div class="p"><!----></div>
By default, atom types and masses are read from the <b><tt>prmtop</tt></b> file (from flags <b><tt>ATOMIC_NUMBER</tt></b> and <b><tt>MASS</tt></b>). 
If the atomic number is not sensible (e.g., -1 for a transition metal) then <b><tt>amber_to_initconds.py</tt></b> prompts the user to define the element.
The masses in the <b><tt>prmtop</tt></b> file can be overridden if the <b><tt>-m</tt></b> option is given; then the user can adjust the mass of each atom individually.
<div class="p"><!----></div>
     <a id="tth_sEc7.2.4"></a><h3>
7.2.4&nbsp;&nbsp;Output</h3>
<div class="p"><!----></div>
<b><tt>amber_to_initconds.py</tt></b> produces the same output as <b><tt>wigner.py</tt></b> (section &nbsp;<a href="#sec:wigner.py">7.1</a>).
By default, a file called <b><tt>initconds</tt></b> is generated for the converted initial conditions. 
It is important to note that the first restart file given (the second command line argument) is treated as the "equilibrium" geometry for the purpose of generating the <b><tt>initconds</tt></b> file.
The second given restart file is then converted to the initial condition with index 1, and so on.
Note that it is possible to give the same restart file multiple times as an argument (so that the same geometry can be used as "equilibrium" geometry and as proper initial condition.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc7.3"></a><h2>
7.3&nbsp;&nbsp; S<span style="font-size:x-small">HARC</span>&nbsp;Trajectory Sampling: <b><tt>sharctraj_to_initconds.py</tt></b></h2><a id="sec:sharctraj_to_initconds.py">
</a>
<div class="p"><!----></div>
The first step in preparing the dynamics calculation is to obtain a set of physically reasonable initial conditions. Each initial condition is a set of initial atomic coordinates, initial atomic velocities and initial electronic state. The initial geometry and velocities can be obtained in different ways. 
Besides sampling from a quantum mechanical Wigner distribution, it is often appropriate to sample geometries and velocities from a ground state molecular dynamics simulation.
<div class="p"><!----></div>
Using <b><tt>sharctraj_to_initconds.py</tt></b>, one can convert the results of a  S<span style="font-size:x-small">HARC</span>&nbsp;simulation to a new  S<span style="font-size:x-small">HARC</span>&nbsp;<b><tt>initconds</tt></b> file.
<div class="p"><!----></div>
     <a id="tth_sEc7.3.1"></a><h3>
7.3.1&nbsp;&nbsp;Usage</h3>
<div class="p"><!----></div>
In order to use <b><tt>sharctraj_to_initconds.py</tt></b>, it is necessary to first run a number of  S<span style="font-size:x-small">HARC</span>&nbsp;trajectories (the initial conditions for those need to be obtained with <b><tt>wigner.py</tt></b> or <b><tt>amber_to_initconds.py</tt></b>).
The trajectories can be run with any number of states and in any state, and with any desirable options; only geometries and velocities are converted to the new <b><tt>initconds</tt></b> file.
<div class="p"><!----></div>
With the trajectories prepared, call <b><tt>sharctraj_to_initconds.py</tt></b> like this:
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/sharctraj_to_initconds.py&nbsp;[options]&nbsp;TRAJ_00001&nbsp;TRAJ_00002&nbsp;...
</pre>
The possible options are shown in Table&nbsp;<a href="#tab:sharctraj_opts"> 7.3</a>.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb7.3">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 7.3: Command-line options for script <b><tt>sharctraj_to_initconds.py</tt></b>.</div>
  <a id="tab:sharctraj_opts">
</a>
<table>
<tr><td align="left"><span class="roman">Option        </td><td align="left">Description      </td><td width="355">Default</td></tr>
<tr><td align="left">-h                  </td><td align="left">Display help message and quit              </td><td width="355">-                            </td></tr>
<tr><td align="left">-r  INTEGER         </td><td align="left">Seed for the random number generator       </td><td width="355">16661                          </td></tr>
<tr><td align="left">-S INTEGER INTEGER  </td><td align="left">Range of time steps from which a step is randomly chosen       </td><td width="355">last step  </td></tr>
<tr><td align="left">-o  FILENAME        </td><td align="left">Output filename                            </td><td width="355"><b><tt>initconds</tt></b>                </td></tr>
<tr><td align="left">-x                  </td><td align="left">Creates an xyz file with the sampled geometries </td><td width="355"><b><tt>initconds.xyz</tt></b>       </td></tr>
<tr><td align="left">-keep_trans_rot  </td><td align="left">Do not remove translations and rotations from velocity vector </td><td width="355"></td></tr>
<tr><td align="left">-use_zero_veloc  </td><td align="left">Sample only geometries, but set velocities to zero     </td><td width="355">Sample normally</td></tr>
<tr><td align="left">-debug             </td><td align="left">Show timings                                           </td><td width="355"></td></tr></span></table>
</div>
<div class="p"><!----></div>
     <a id="tth_sEc7.3.2"></a><h3>
7.3.2&nbsp;&nbsp;Random Picking of Time Step</h3>
<div class="p"><!----></div>
For each directory specified as command line argument, <b><tt>sharctraj_to_initconds.py</tt></b> picks exactly one time step and extracts geometries and velocities of that time step.
Note that a directory can be given several times as argument, so that multiple time steps can be selected.
<div class="p"><!----></div>
The time steps are generally picked randomly (uniform probabilities) from an interval specified with the <b><tt>-S</tt></b> option.
This option takes two integers, e.g., <b><tt>-S 50 -50</tt></b>, which can be positive or negative.
The meaning of positive/negative/zero is the same as in  P<span style="font-size:x-small">YTHON</span>: positive numbers simply denote a time step (start counting with zero for the step zero of the trajectory); for negative numbers, start counting at the end, i.e., -1 is the last time step of the trajectory.
In this way, it is possible to select the snapshot from the last n steps of all trajectories, even if they have different length.
The example above, <b><tt>-S 50 -50</tt></b>, means picking a time step between the 50th and the 50th-last step. Note that if a trajectory is shorter than 100 steps, in this example it is skipped because there are no steps between the 50th and the 50th-last step.
<div class="p"><!----></div>
     <a id="tth_sEc7.3.3"></a><h3>
7.3.3&nbsp;&nbsp;Output</h3>
<div class="p"><!----></div>
<b><tt>sharctraj_to_initconds.py</tt></b> produces the same output as <b><tt>wigner.py</tt></b> (section &nbsp;<a href="#sec:wigner.py">7.1</a>).
By default, a file called <b><tt>initconds</tt></b> is generated for the converted initial conditions. 
It is important to note that the first directory given (the first command line argument) is treated as the "equilibrium" geometry for the purpose of generating the <b><tt>initconds</tt></b> file.
The second given directory is then converted to the initial condition with index 1, and so on.
Note that it is possible to give the same directory multiple times as an argument (so that the same geometry can be used as "equilibrium" geometry and as proper initial condition.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc7.4"></a><h2>
7.4&nbsp;&nbsp;Setup of Initial Calculations: <b><tt>setup_init.py</tt></b></h2><a id="sec:setup_init.py">
</a>
<div class="p"><!----></div>
The interactive script <b><tt>setup_init.py</tt></b> creates input for single point calculations at the initial geometries given in an <b><tt>initconds</tt></b> file. These calculations might be necessary for some schemes to select the initial electronic state of the trajectory, e.g., based on the excitation energies and oscillator strength of the transitions from ground state to the excited state, or based on overlaps with a reference wave function. 
<div class="p"><!----></div>
There are other choices of the initial state possible, which do not require single point calculations at all initial geometries. See the description of <b><tt>excite.py</tt></b> (section&nbsp;<a href="#sec:excite.py">7.5</a>). In this case, <b><tt>setup_init.py</tt></b> can be used to set up only the calculation at the equilibrium geometry (see below at "Range of Initial Conditions").
<div class="p"><!----></div>
     <a id="tth_sEc7.4.1"></a><h3>
7.4.1&nbsp;&nbsp;Usage</h3>
<div class="p"><!----></div>
The script is interactive, and can be started by simply typing 
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/setup_init.py
</pre>
Please be aware that the script will setup the calculations in the directory where it was started, so the user should <b><tt>cd</tt></b> to the desired directory before executing the script.
<div class="p"><!----></div>
Please note that the script does not expand <b><tt> </tt></b> or shell variables, except where noted otherwise.
<div class="p"><!----></div>
     <a id="tth_sEc7.4.2"></a><h3>
7.4.2&nbsp;&nbsp;Input</h3>
<div class="p"><!----></div>
The script will prompt the user for the input. In the following, all input parameters are documented:
<div class="p"><!----></div>
<b>Initial Conditions File&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Enter the filename of the initial conditions file, which was generated beforehand with <b><tt>wigner.py</tt></b>. If the script finds a file called <b><tt>initconds</tt></b>, the user is asked whether to use this file, otherwise the user has to enter an appropriate filename. The script detects the number of initial conditions and number of atoms automatically from the initial conditions file.
<div class="p"><!----></div>
<b>Range of Initial Conditions&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The initial conditions in <b><tt>initconds</tt></b> are indexed, starting with the index 1. In order to prepare ab initio calculations for a subset of all initial conditions, enter a range of indices, e.g.&nbsp;a and b. This will prepare all initial conditions with indices in the interval [a,b]. In any case, the script will additionally prepare a calculation for the equilibrium geometry (except if a finished calculation for the equilibrium geometry was found).
<div class="p"><!----></div>
If the interval [0,0] is given, the script will only setup the calculation at the equilibrium geometry.
<div class="p"><!----></div>
<b>Number of states&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Here the user can specify the number of excited states to be calculated. Note that the ground state has to be counted as well, e.g., if 4 singlet states are specified, the calculation will involve the S<sub>0</sub>, S<sub>1</sub>, S<sub>2</sub> and S<sub>3</sub>. Also states of higher multiplicity can be given, e.g.&nbsp;triplet or quintet states. 
For even-electron molecules, including odd-electron states (e.g.&nbsp;doublets) is only useful if transition properties for ionization can be computed (e.g.&nbsp;Dyson norms with some of the interfaces). These transition properties can be used to calculate ionization spectra or to obtain initial conditions for dynamics after ionization.
<div class="p"><!----></div>
<b>Interface&nbsp;&nbsp;</b>
<div class="p"><!----></div>
In this point, choose any of the displayed interfaces to carry out the ab initio calculations. Enter the corresponding number. 
<div class="p"><!----></div>
<b>Spin-orbit calculation&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Usually, it is sufficient to calculate the spin-free excitation energies and oscillator strengths in order to decide for the initial state. However, using this option, the effects of spin-orbit coupling on the excitation energies and oscillator strengths can be included. Note that the script will never calculate spin-orbit couplings if only singlet states are included in the calculation, or if the chosen interface does not support calculation of spin-orbit couplings.
<div class="p"><!----></div>
<b>Reference overlaps&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The calculations can be setup in such a way that the wave function overlaps between states at the equilibrium geometry and the displaced geometries is computed.
This allows correlating the states at the displaced geometries with the reference states, such that one can know the state characters of all states without inspection.
This is useful for a crude "diabatization" of the states, e.g., if one wants to start all trajectories in the n&#960;<sup>*</sup> state of the molecule although this state can be S<sub>1</sub>, S<sub>2</sub>, or S<sub>3</sub> (use <b><tt>excite.py</tt></b> to setup initial conditions in such a way, see section&nbsp;<a href="#sec:excite.py">7.5</a>).
<div class="p"><!----></div>
When activating this option, keep in mind that the calculation in <b><tt>ICOND_00000</tt></b> must be successfully finished before any of the other <b><tt>ICOND_XXXXX</tt></b> calculations can be started.
<div class="p"><!----></div>
<b>TheoDORE analysis&nbsp;&nbsp;</b>
<div class="p"><!----></div>
If the chosen interface supports wave function analysis with TheoDORE, then this option can be activated here.
<b><tt>setup_init.py</tt></b> will then include the relevant keywords in the computations, and the results of the TheoDORE analysis will be written to the <b><tt>QM.out</tt></b> files.
<div class="p"><!----></div>
The remaining settings for TheoDORE (fragment and descriptor input) will be asked later in <b><tt>setup_init.py</tt></b>.
<div class="p"><!----></div>
     <a id="tth_sEc7.4.3"></a><h3>
7.4.3&nbsp;&nbsp;Interface-specific input</h3>
<div class="p"><!----></div>
The following input in <b><tt>setup_init.py</tt></b> depends on the chosen interface.
However, some input is similar between several interfaces and is discussed (out of input order) in section&nbsp;<a href="#sec:setup_init.py:several">7.4.3</a>.
Note that most of the questions asked in the input dialogue have some counterpart in the resource file of the chosen interface, so you might find additional information in chapter&nbsp;<a href="#chap:interfaces">6</a>.
<div class="p"><!----></div>
<div class="p"><!----></div>
<h4>Input which is similar between interfaces</h4><a id="sec:setup_init.py:several">
</a>
<div class="p"><!----></div>
<b>Path to quantum chemistry programs and licenses&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Here the user is prompted to provide the path to the relevant executables or installation directories. 
<div class="p"><!----></div>
Note that the setup script will not expand the user (<b><tt> </tt></b>) and shell variables (since the calculations might be running on a different machine than the one used for setup, so the meaning of shell variables could be different). <b><tt> </tt></b> and shell variables will only be expanded by the interfaces during the actual calculation.
<div class="p"><!----></div>
For some interfaces, also the path to a license file might need to be specified.
<div class="p"><!----></div>
<b>Scratch directory&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The script takes the string without any checking. Each individual initial condition uses a subdirectory of the given path, so that there are no clashes between the initial conditions. <b><tt> </tt></b> and shell variables will only be expanded by the interface during the actual calculation.
<div class="p"><!----></div>
Note that you can use, e.g., <b><tt>./temp/</tt></b> as scratch directory, which is a subdirectory of the working directory of the interface. Using <b><tt>./</tt></b> as scratch directory is not recommended, since the interface will delete the scratch directory.
<div class="p"><!----></div>
<b>Template file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
For almost all interfaces, <b><tt>setup_init.py</tt></b> will ask for a template file containing the quantum chemistry specifics of the calculations. The format of the template file depends on the interface; formats are described in the interface chapter&nbsp;<a href="#chap:interfaces">6</a>.
<div class="p"><!----></div>
For most interfaces, <b><tt>setup_init.py</tt></b> will perform some basic checks, but ultimately the template file will be checked by the interface once the calculation is submitted.
<div class="p"><!----></div>
<b>Initial orbital guess&nbsp;&nbsp;</b>
<div class="p"><!----></div>
For some interfaces, <b><tt>setup_init.py</tt></b> will ask for files containing initial orbital guesses. providing initial is especially important for multi-reference calculations, because otherwise it is very likely that the calculations converge to an undesirable active space.
<div class="p"><!----></div>
<b>Resource usage&nbsp;&nbsp;</b>
<div class="p"><!----></div>
For most interfaces, <b><tt>setup_init.py</tt></b> will ask for the amount of memory and the number of CPU cores to use. For some interfaces, additionally a delay between the start of parallel calculation can be provided (this might be helpful if many calculations starting at the same time is problematic for I/O).
For the ADF and <b><tt>Gaussian</tt></b> interfaces, furthermore the <b><tt>schedule_scaling</tt></b> is queried for (see section&nbsp;<a href="#met:amdahl">8.3</a> for details).
<div class="p"><!----></div>
<b>Wavefunction overlap program&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The scripts asks for the path to the wavefunction overlap program. In a complete  S<span style="font-size:x-small">HARC</span>&nbsp;installation, the overlap program should be located at <b><tt>$/SHARC/wfoverlap.x</tt></b>.
Depending on the interface, the script might also ask for the threshold to truncate the wave function files, or for the memory for <b><tt>wfoverlap.x</tt></b> (if the memory of the quantum chemistry program cannot be set).
For some interfaces, it is also possible to control the number of frozen core orbitals for the overlap calculation (and the number of inactive orbitals for Dyson orbital calculations).
<div class="p"><!----></div>
<b> T<span style="font-size:x-small">HEO</span>DORE setup&nbsp;&nbsp;</b>
<div class="p"><!----></div>
If  T<span style="font-size:x-small">HEO</span>DORE is enabled, <b><tt>setup_init.py</tt></b> will query for the path to the  T<span style="font-size:x-small">HEO</span>DORE installation directory. Furthermore, the user needs to enter a list of the descriptors to be calculated by  T<span style="font-size:x-small">HEO</span>DORE, as well as the atom indices for each fragment for the charge transfer number computation.
<div class="p"><!----></div>
<b>QM/MM setup&nbsp;&nbsp;</b>
<div class="p"><!----></div>
For some interfaces, <b><tt>setup_init.py</tt></b> will ask for QM/MM-related files if the template file specifies a QM/MM calculation.
Currently, the QM/MM setup consists simply of providing the relevant interface-specific files to <b><tt>setup_init.py</tt></b>, which it simply copies accordingly.
<div class="p"><!----></div>
<div class="p"><!----></div>
<h4>Input for  M<span style="font-size:x-small">OLPRO</span></h4><a id="sec:setup_init.py:molpro">
</a>
<div class="p"><!----></div>
<b>Path to  M<span style="font-size:x-small">OLPRO</span>&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Here the user is prompted to provide the path to the  M<span style="font-size:x-small">OLPRO</span> executable. 
For more details, see section&nbsp;<a href="#sec:setup_init.py:several">7.4.3</a>.
<div class="p"><!----></div>
<b>Scratch directory&nbsp;&nbsp;</b>
<div class="p"><!----></div>
See section&nbsp;<a href="#sec:setup_init.py:several">7.4.3</a>.
<div class="p"><!----></div>
<b>Template file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Enter the filename for the  M<span style="font-size:x-small">OLPRO</span> template input. This file should contain at least the basis set, active orbitals and electrons, number of electrons and number of states for state-averaging. For details, see the section about the  S<span style="font-size:x-small">HARC</span>- M<span style="font-size:x-small">OLPRO</span> interface (<a href="#sec:int:molpro">6.3</a>). The setup script will check whether the template file contains the necessary entries. 
<div class="p"><!----></div>
<b>Initial wave function file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
You can provide an initial wave function (with an appropriate MO guess) to  M<span style="font-size:x-small">OLPRO</span>. This usually provides a drastic speedup for the CASSCF calculations and helps in ensuring that all calculations are based on the same active space. In simple cases it might be acceptable to not provide an initial wave function.
<div class="p"><!----></div>
<b>Resource usage&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The script asks for the memory and number of CPU cores to be used. Note that both settings apply to  M<span style="font-size:x-small">OLPRO</span> and to <b><tt>wfoverlap.x</tt></b>, if the latter is required (but note that the two programs are never run simultaneously).
If more than one CPU core is used, the interface will parallelize different  M<span style="font-size:x-small">OLPRO</span> runs (but will not run  M<span style="font-size:x-small">OLPRO</span> in parallel mode); <b><tt>wfoverlap.x</tt></b> will be run in SMP-parallel mode.
<div class="p"><!----></div>
<b>Wavefunction overlap program&nbsp;&nbsp;</b>
<div class="p"><!----></div>
See section&nbsp;<a href="#sec:setup_init.py:several">7.4.3</a>. Note that for the  M<span style="font-size:x-small">OLPRO</span> interface, no truncation threshold can be given, since <b><tt>wfoverlap.x</tt></b> is very efficient for CASSCF wavefunctions.
<div class="p"><!----></div>
<h4>Input for  M<span style="font-size:x-small">OLCAS</span></h4><a id="sec:setup_init.py:molcas">
</a>
<div class="p"><!----></div>
<b>Path to  M<span style="font-size:x-small">OLCAS</span>&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Here the user is prompted to provide the path to the  M<span style="font-size:x-small">OLCAS</span> directory. 
For more details, see section&nbsp;<a href="#sec:setup_init.py:several">7.4.3</a>.
<div class="p"><!----></div>
<b>Scratch directory&nbsp;&nbsp;</b>
<div class="p"><!----></div>
See section&nbsp;<a href="#sec:setup_init.py:several">7.4.3</a>.
<div class="p"><!----></div>
<b>Template file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Enter the filename for the  M<span style="font-size:x-small">OLCAS</span> template input. This file should contain at least the basis set, active orbitals and electrons, number of inactive orbitals, and number of states for state-averaging. For details, see the section about the  S<span style="font-size:x-small">HARC</span>- M<span style="font-size:x-small">OLCAS</span> interface (<a href="#sec:int:molcas">6.4</a>). The setup script will check whether the template file contains the necessary entries. 
<div class="p"><!----></div>
<b>QM/MM&nbsp;&nbsp;</b>
<div class="p"><!----></div>
If the keyword <b><tt>qmmm</tt></b> is contained in the template file, the user will be queried for the path to  T<span style="font-size:x-small">INKER</span>'s <b><tt>bin/</tt></b> directory. Note that only  T<span style="font-size:x-small">INKER</span> installations with the necessary modifications for  M<span style="font-size:x-small">OLCAS</span> can be used.
<div class="p"><!----></div>
The script will also ask for the key file (containing the path to the force field file and the QM/MM partition) and the connection table file. See section&nbsp;<a href="#sec:int:molcas">6.4</a> for details.
<div class="p"><!----></div>
<b>Initial wave function file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
You can provide initial MO coefficients to  M<span style="font-size:x-small">OLCAS</span>. This usually provides a drastic speedup for the CASSCF calculations and helps in ensuring that all calculations are based on the same active space. In simple cases it might be acceptable to not provide an initial wave function. For  M<span style="font-size:x-small">OLCAS</span>, you have to specify one file for each multiplicity (but you can use the same file as guess for several multiplicities).
Initial orbital files can either be in <b><tt>JobIph</tt></b> or <b><tt>RasOrb</tt></b> format.
<div class="p"><!----></div>
<b>Resource usage&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The script asks for the memory and number of CPU cores to be used. Note that both settings apply to  M<span style="font-size:x-small">OLCAS</span> and to <b><tt>wfoverlap.x</tt></b>, if the latter is required (but note that the two programs are never run simultaneously).
If more than one CPU core is used, the interface will parallelize different  M<span style="font-size:x-small">OLCAS</span> runs (but will not run  M<span style="font-size:x-small">OLCAS</span> in parallel mode); <b><tt>wfoverlap.x</tt></b> will be run in SMP-parallel mode.
<div class="p"><!----></div>
<b>Wavefunction overlap program&nbsp;&nbsp;</b>
<div class="p"><!----></div>
See section&nbsp;<a href="#sec:setup_init.py:several">7.4.3</a>. The <b><tt>wfoverlap.x</tt></b> program is only required if Dyson norms need to be calculated. Note that for the  M<span style="font-size:x-small">OLCAS</span> interface, no truncation threshold can be given, since <b><tt>wfoverlap.x</tt></b> is very efficient for CASSCF wavefunctions.
<div class="p"><!----></div>
<div class="p"><!----></div>
<h4>Input for  C<span style="font-size:x-small">OLUMBUS</span></h4><a id="sec:setup_init.py:columbus">
</a>
<div class="p"><!----></div>
<b>Path to  C<span style="font-size:x-small">OLUMBUS</span>&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Here the user is prompted to provide the path to the  C<span style="font-size:x-small">OLUMBUS</span> directory. 
For more details, see section&nbsp;<a href="#sec:setup_init.py:several">7.4.3</a>.
<div class="p"><!----></div>
<b>Scratch directory&nbsp;&nbsp;</b>
<div class="p"><!----></div>
See section&nbsp;<a href="#sec:setup_init.py:several">7.4.3</a>.
<div class="p"><!----></div>
<b>Template directory&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Enter the path to a directory containing subdirectories with  C<span style="font-size:x-small">OLUMBUS</span> input files necessary for the calculations. The setup script will expand <b><tt> </tt></b> and shell variables and will pass the absolute path to the calculations.
<div class="p"><!----></div>
The script will auto-detect (based on the <b><tt>cidrtin</tt></b> files) which subdirectory contains the input for each multiplicity. The user has to check in the following dialog whether the association of multiplicities with job directories is correct. Additionally, the association of MO coefficient files to the jobs has to be checked. See the section on the  S<span style="font-size:x-small">HARC</span>- C<span style="font-size:x-small">OLUMBUS</span> interface (<a href="#sec:int:columbus">6.5</a>) for further details. 
<div class="p"><!----></div>
Note that the setup script does not check any content of the input files beyond the multiplicity. Note that <b><tt>transmomin</tt></b> and <b><tt>control.run</tt></b> do not need to be present (and that their content has no effect on the calculation), since these files are written on-the-fly by the interface. 
<div class="p"><!----></div>
The template directory can either be linked or copied to the initial condition calculations.
<div class="p"><!----></div>
<b>Initial orbital coefficient file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
You can provide initial MO coefficients for the  C<span style="font-size:x-small">OLUMBUS</span> calculation. This usually provides a drastic speedup for the CASSCF calculations and helps to ensure that all calculations are based on the same active space. In simple cases it might be acceptable to not provide an initial wave function.
<div class="p"><!----></div>
<b>Memory&nbsp;&nbsp;</b>
<div class="p"><!----></div>
For  C<span style="font-size:x-small">OLUMBUS</span>, the available memory must be given here. The  C<span style="font-size:x-small">OLUMBUS</span> interface does not allow for parallelization currently.
<div class="p"><!----></div>
<b>Wavefunction overlap program&nbsp;&nbsp;</b>
<div class="p"><!----></div>
See section&nbsp;<a href="#sec:setup_init.py:several">7.4.3</a>. For CASSCF calculations with  C<span style="font-size:x-small">OLUMBUS</span>, use a truncation threshold of 1.0, for MRCIS/MRCISD calculations, 0.97-0.99 should provide sufficient performance and accuracy.
<div class="p"><!----></div>
<div class="p"><!----></div>
<h4>Input for analytical potentials</h4><a id="sec:setup_init.py:analytical">
</a>
<div class="p"><!----></div>
<b>Template file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Enter the filename for the template input specifying the analytical potentials. For details, see the section about the  S<span style="font-size:x-small">HARC</span>-Analytical interface (<a href="#sec:int:analytical">6.6</a>). The setup script will check whether the template file is valid. 
<div class="p"><!----></div>
<div class="p"><!----></div>
<h4>Input for  ADF</h4><a id="sec:setup_init.py:adf">
</a>
<div class="p"><!----></div>
<b>Path to  ADF&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Here the user is first asked if setup should be made from an <b><tt>adfrc.sh</tt></b> file. If yes, only the path to this file is needed.
<div class="p"><!----></div>
Otherwise, the path to the ADF installation directory and the path to the license file need to be provided.
For more details, see section&nbsp;<a href="#sec:setup_init.py:several">7.4.3</a>.
<div class="p"><!----></div>
<b>Scratch directory&nbsp;&nbsp;</b>
<div class="p"><!----></div>
See section&nbsp;<a href="#sec:setup_init.py:several">7.4.3</a>.
<div class="p"><!----></div>
<b>Template file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Enter the filename for the  ADF template input. This file should contain at least the basis set, functional, and charge keywords. For details, see the section about the  S<span style="font-size:x-small">HARC</span>- ADF interface (<a href="#sec:int:adf">6.7</a>). The setup script will check whether the template file contains the necessary entries. 
<div class="p"><!----></div>
<b>QM/MM&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The script will ask for the two QM/MM-specific input files for the interface, which are called <b><tt>ADF.qmmm.ff</tt></b> and <b><tt>ADF.qmmm.table</tt></b>.
See section&nbsp;<a href="#sec:int:adf">6.7</a> for details on these files.
<div class="p"><!----></div>
<b>Initial orbital coefficient file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
You can provide initial MO coefficients for the  ADF calculation. This can provide a small speedup for the calculations and helps to ensure that all calculations are based on the same orbitals.
In many cases, no initial orbitals are required.
<div class="p"><!----></div>
<b>Resource usage&nbsp;&nbsp;</b>
<div class="p"><!----></div>
For  ADF, the amount of memory to be used cannot be controlled. However, the number of CPU cores needs to be given. If more than one core is used, also the parallel scaling needs to be specified (see section&nbsp;<a href="#met:amdahl">8.3</a>).
<div class="p"><!----></div>
<b>Wavefunction overlap program&nbsp;&nbsp;</b>
<div class="p"><!----></div>
See section&nbsp;<a href="#sec:setup_init.py:several">7.4.3</a>. <b><tt>setup_init.py</tt></b> will ask for the memory usage of <b><tt>wfoverlap.x</tt></b>. The truncation threshold for TD-DFT can usually be chosen as 0.99-1.00 (depending on the system and functional, but it is recommended that it is high enough that each state is described by around 100 determinants in the generated files). See section&nbsp;<a href="#sec:int:adf">6.7</a> for details.
<div class="p"><!----></div>
<b> T<span style="font-size:x-small">HEO</span>DORE setup&nbsp;&nbsp;</b>
<div class="p"><!----></div>
See section&nbsp;<a href="#sec:setup_init.py:several">7.4.3</a>. 
<div class="p"><!----></div>
<div class="p"><!----></div>
<h4>Input for  R<span style="font-size:x-small">ICC</span>2</h4><a id="sec:setup_init.py:ricc2">
</a>
<div class="p"><!----></div>
<b>Path to  T<span style="font-size:x-small">URBOMOLE</span>&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The path to the  T<span style="font-size:x-small">URBOMOLE</span> installation directory needs to be provided.
If spin-orbit couplings are requested, also the path to the  O<span style="font-size:x-small">RCA</span> installation directory is needed.
For more details, see section&nbsp;<a href="#sec:setup_init.py:several">7.4.3</a>.
<div class="p"><!----></div>
<b>Scratch directory&nbsp;&nbsp;</b>
<div class="p"><!----></div>
See section&nbsp;<a href="#sec:setup_init.py:several">7.4.3</a>.
<div class="p"><!----></div>
<b>Template file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Enter the filename for the  R<span style="font-size:x-small">ICC</span>2 template input. This file should contain at least the basis set and charge keywords. For details, see the section about the  S<span style="font-size:x-small">HARC</span>- R<span style="font-size:x-small">ICC</span>2 interface (<a href="#sec:int:ricc2">6.8</a>). The setup script will check whether the template file contains the necessary entries. 
<div class="p"><!----></div>
<b>Initial orbital coefficient file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
You can provide initial MO coefficients for the  ADF calculation. This can provide a small speedup for the calculations and helps to ensure that all calculations are based on the same orbitals.
In many cases, no initial orbitals are required.
<div class="p"><!----></div>
<b>Resource usage&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The amount of memory and the number of CPU cores are required in this section.
Note that the  S<span style="font-size:x-small">HARC</span>- R<span style="font-size:x-small">ICC</span>2 interface always runs only one  T<span style="font-size:x-small">URBOMOLE</span> instance at the same time (if the number of CPU cores is larger than one, it will use the SMP/OMP binaries of  T<span style="font-size:x-small">URBOMOLE</span>).
<div class="p"><!----></div>
<b>Wavefunction overlap program&nbsp;&nbsp;</b>
<div class="p"><!----></div>
See section&nbsp;<a href="#sec:setup_init.py:several">7.4.3</a>. <b><tt>setup_init.py</tt></b> will ask for the memory usage of <b><tt>wfoverlap.x</tt></b>. The truncation threshold can usually be chosen as 0.99-1.00 (depending on the system, but it is recommended that it is high enough that each state is described by around 100 determinants in the generated files). See section&nbsp;<a href="#sec:int:ricc2">6.8</a> for details.
<div class="p"><!----></div>
<b> T<span style="font-size:x-small">HEO</span>DORE setup&nbsp;&nbsp;</b>
<div class="p"><!----></div>
See section&nbsp;<a href="#sec:setup_init.py:several">7.4.3</a>.
<div class="p"><!----></div>
<div class="p"><!----></div>
<h4>Input for LVC interface</h4><a id="sec:setup_init.py:lvc">
</a>
<div class="p"><!----></div>
<b>Template file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Enter the filename for the template input specifying the LVC parameters. For details, see the section about the  S<span style="font-size:x-small">HARC</span>-LVC interface (<a href="#sec:int:lvc">6.9</a>). The setup script will not check whether the template file is valid. 
<div class="p"><!----></div>
<div class="p"><!----></div>
<h4>Input for  G<span style="font-size:x-small">AUSSIAN</span> interface</h4><a id="sec:setup_init.py:gaussian">
</a>
<div class="p"><!----></div>
<b>Path to  G<span style="font-size:x-small">AUSSIAN</span>&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The path to the  G<span style="font-size:x-small">AUSSIAN</span> installation directory needs to be provided.
The interface will automatically detect which  G<span style="font-size:x-small">AUSSIAN</span> version is used.
For more details, see section&nbsp;<a href="#sec:setup_init.py:several">7.4.3</a>.
<div class="p"><!----></div>
<b>Scratch directory&nbsp;&nbsp;</b>
<div class="p"><!----></div>
See section&nbsp;<a href="#sec:setup_init.py:several">7.4.3</a>.
<div class="p"><!----></div>
<b>Template file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Enter the filename for the  G<span style="font-size:x-small">AUSSIAN</span> template input. This file should contain at least the basis set, functional, and charge keywords. For details, see the section about the  S<span style="font-size:x-small">HARC</span>- G<span style="font-size:x-small">AUSSIAN</span> interface (<a href="#sec:int:gaussian">6.10</a>). The setup script will check whether the template file contains the necessary entries. 
<div class="p"><!----></div>
<b>Initial orbital coefficient file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
You can provide initial MO coefficients for the  G<span style="font-size:x-small">AUSSIAN</span> calculation. This can provide a small speedup for the calculations and helps to ensure that all calculations are based on the same orbitals.
In many cases, no initial orbitals are required.
<div class="p"><!----></div>
<b>Resource usage&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The amount of memory and the number of CPU cores are required in this section. If more than one core is used, also the parallel scaling needs to be specified (see section&nbsp;<a href="#met:amdahl">8.3</a>).
<div class="p"><!----></div>
<b>Wavefunction overlap program&nbsp;&nbsp;</b>
<div class="p"><!----></div>
See section&nbsp;<a href="#sec:setup_init.py:several">7.4.3</a>. <b><tt>setup_init.py</tt></b> will ask for the memory usage of <b><tt>wfoverlap.x</tt></b>. The truncation threshold for TD-DFT can usually be chosen as 0.99-1.00 (depending on the system and functional, but it is recommended that it is high enough that each state is described by around 100 determinants in the generated files). See section&nbsp;<a href="#sec:int:gaussian">6.10</a> for details.
<div class="p"><!----></div>
<b> T<span style="font-size:x-small">HEO</span>DORE setup&nbsp;&nbsp;</b>
<div class="p"><!----></div>
See section&nbsp;<a href="#sec:setup_init.py:several">7.4.3</a>. 
<div class="p"><!----></div>
<div class="p"><!----></div>
     <a id="tth_sEc7.4.4"></a><h3>
7.4.4&nbsp;&nbsp;Input for Run Scripts</h3><a id="sec:setup_init.py:run">
</a>
<div class="p"><!----></div>
<b>Run script mode&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The script <b><tt>setup_init.py</tt></b> generates a run script (Bash) for each initial condition calculation. Due to the large variety of cluster architectures, these run scripts might not work in every case. It is the user's responsibility to adapt the generated run scripts to his needs.
<div class="p"><!----></div>
<b><tt>setup_init.py</tt></b> can generate run scripts for two different schemes how to execute the calculations. With the first scheme, the ab initio calculations are performed in the directory where they were setup (subdirectories of the directory where <b><tt>setup_init.py</tt></b> was started). Note that the interfaces will still use their scratch directories to perform the actual quantum chemistry calculations. Currently, this is the default option.
<div class="p"><!----></div>
With the second option, the run scripts will transfer the input files for each ab initio calculation to a temporary directory, where the interface is started. After the interface finishes all calculations, the results files are transferred back to the primary directory and the temporary directory is deleted. Note that <b><tt>setup_init.py</tt></b> in any case creates the directory structure in the directory where it was started. The name of the temporary directory can contain shell variables, which will be expanded when the script is running (on the compute host).
<div class="p"><!----></div>
<b>Submission script&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The setup script can also create a Bash script for the submission of all ab initio calculations to a queueing system. The user has to provide a submission command for that, including any options which might be necessary. This submission script might not work with all queueing systems.
<div class="p"><!----></div>
<b>Project name&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The user can enter a project name. This is used currently only for the job names of submitted jobs (<b><tt>-N</tt></b> option for queueing system).
<div class="p"><!----></div>
     <a id="tth_sEc7.4.5"></a><h3>
7.4.5&nbsp;&nbsp;Output</h3>
<div class="p"><!----></div>
<b><tt>setup_init.py</tt></b> will create for each initial condition in the given range a directory whose names follow the format <b><tt>ICOND_%05i/</tt></b>, where <b><tt>%05i</tt></b> is the index of the initial condition padded with zeroes to 5 digits. Additionally, the directory <b><tt>ICOND_00000/</tt></b> is created for the calculation of the excitation energies at the equilibrium geometry.
<div class="p"><!----></div>
To each directory, the following files will be added:
<ul>
<li> <b><tt>QM.in</tt></b>: Main input file for the interface, contains the geometry and the control keywords (to specify which quantities need to be calculated).
<div class="p"><!----></div>
</li>
<li> <b><tt>run.sh</tt></b>: Run script, which can be started interactively in order to perform the ab initio calculation in this directory. Can also be adapted to a batch script for submission to a queue
<div class="p"><!----></div>
</li>
<li> Interface-specific files: Usually a template file, a resource file, and an initial wave function.
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
The calculations in each directory can be simply executed by starting <b><tt>run.sh</tt></b> in each directory. In order to perform this task consecutively on a single machine, the script <b><tt>all_run.sh</tt></b> can be executed. The file <b><tt>DONE</tt></b> contains the progress of this calculation.
Alternatively, each run script can be sent to a queueing system (you might need to adapt this script to you cluster system).
Note that if reference overlaps were requested, the calculation in <b><tt>ICOND_00000/</tt></b> must be finished before starting any of the other calculations.
<div class="p"><!----></div>
In figure&nbsp;<a href="#fig:dirs_init"> 7.1</a>, the directory tree structure setup by <b><tt>setup_init.py</tt></b> is given.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_fIg7.1">
</a>   <div style="text-align:center">  <img src="http://sharc-md.org/wp-content/uploads/2018/02/dirs_init.png">  
<div style="text-align:center">Figure 7.1: Directory structure created by <b><tt>setup_init.py</tt></b>. Directories are in blue, executable scripts in green and regular files in black and white. Interface files usually include initial MO coefficients, template files and interface input files.</div>
  <a id="fig:dirs_init">
</a>
</div>
<div class="p"><!----></div>
After all calculations are finished, <b><tt>excite.py</tt></b> can be used to collect the results.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc7.5"></a><h2>
7.5&nbsp;&nbsp;Excitation Selection: <b><tt>excite.py</tt></b></h2><a id="sec:excite.py">
</a>
<div class="p"><!----></div>
<b><tt>excite.py</tt></b> has two tasks: adding excited-state information to the <b><tt>initconds</tt></b> file, and deciding which excited state for which initial condition is a valid initial state for the dynamics.
<div class="p"><!----></div>
     <a id="tth_sEc7.5.1"></a><h3>
7.5.1&nbsp;&nbsp;Usage</h3>
<div class="p"><!----></div>
The script is interactive, and can be started by simply typing 
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/excite.py
</pre>
<div class="p"><!----></div>
     <a id="tth_sEc7.5.2"></a><h3>
7.5.2&nbsp;&nbsp;Input</h3>
<div class="p"><!----></div>
<b>Initial condition file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Enter the path to the initial conditions file, to which <b><tt>excite.py</tt></b> will add excited-state information. This file can already contain excited-state information (in this case this information can be reused).
<div class="p"><!----></div>
<b>Generate excited state list&nbsp;&nbsp;</b>
<div class="p"><!----></div>
There are three possibilities to add excited-state information to the <b><tt>initconds</tt></b> file:
<ol type="1">
<li> generate a list of dummy excited states,
<div class="p"><!----></div>
</li>
<li> read excited-state information from the output of the initial ab initio calculations (prepare the calculations with <b><tt>setup_init.py</tt></b>),
<div class="p"><!----></div>
</li>
<li> keep the existing excited-state information in the <b><tt>initconds</tt></b> file.
<div class="p"><!----></div>
</li>
</ol>
The first option is mainly used if no initial ab initio calculations need to be performed (e.g., the initial state is known). 
<div class="p"><!----></div>
In order to use the second option, one should first setup initial excited-state calculations using <b><tt>setup_init.py</tt></b> (see&nbsp;<a href="#sec:setup_init.py">7.4</a>) and run the calculations. <b><tt>excite.py</tt></b> can then read the output of the initial calculations and calculate excitation energies and oscillator strengths.
<div class="p"><!----></div>
The third option can be used to reuse the information in the <b><tt>initconds</tt></b> file, e.g., to apply a different selection scheme to the states or to just read the number of states.
<div class="p"><!----></div>
<b>Path to ab initio results&nbsp;&nbsp;</b>
<div class="p"><!----></div>
If <b><tt>excite.py</tt></b> will read the excited-state information from the ab initio calculation results, here the user has to provide the path to the directory containing the <b><tt>ICOND_%05i</tt></b> subdirectories.
<div class="p"><!----></div>
<b>Number of states&nbsp;&nbsp;</b>
<div class="p"><!----></div>
If a dummy list of states will be generated, the user has to provide the number of states per multiplicity. Note that a singlet ground state has to be counted as well, e.g.&nbsp;if 4 singlet states are specified, the calculation will involve the S<sub>0</sub>, S<sub>1</sub>, S<sub>2</sub> and S<sub>3</sub>. Also states of higher multiplicity can be given, e.g.&nbsp;doublet or triplet states (e.g., <b><tt>2 2 1</tt></b> for two singlets, two doublets and one triplet).
<div class="p"><!----></div>
If the ab initio results are read the number of states will be automatically determined from the results.
<div class="p"><!----></div>
<b>Excited-state representation&nbsp;&nbsp;</b>
<div class="p"><!----></div>
When generating new lists of excited states (either dummy states or from ab initio results), the user has to specify the representation of the excited states (either MCH or diagonal representation). The MCH representation is spin-free, meaning that transition dipole moments are only allowed between states of the same multiplicity. For molecules without heavy atoms, this option is sufficient. For heavier atoms, the diagonal representation can be used, which includes the effects of spin-orbit coupling on the excitation energies and oscillator strengths. 
Note, however, that excited-state selection with delta pulse excitation (option 3 under "Initial state selection") should be carried out in the MCH representation if the ground state is not significantly spin-orbit-mixed.
<div class="p"><!----></div>
When reading ab initio results, <b><tt>excite.py</tt></b> will diagonalize the Hamiltonian and transform the transition dipole matrices for each initial condition to obtain the diagonal representation. 
<div class="p"><!----></div>
When a dummy state list is generated, the representation will only be written to <b><tt>initconds.excited</tt></b> (but has no actual numeric effect for <b><tt>excite.py</tt></b>). Note that the representation which is declared in the <b><tt>initconds.excited</tt></b> file influences how  S<span style="font-size:x-small">HARC</span>&nbsp;determines the initial coefficients (see the paragraph on initial coefficients in&nbsp;&nbsp;<a href="#ssec:input:keywords">4.1.3</a>).
<div class="p"><!----></div>
Note that the representation cannot be changed if existing excited-state information is kept. 
<div class="p"><!----></div>
Hint: If the <b><tt>ICOND_%05i</tt></b> directories need to be deleted (e.g., due to disk space restrictions), making one read-out with <b><tt>excite.py</tt></b> for each representation and saving the results to two different files will preserve most necessary information.
<div class="p"><!----></div>
<b>Ionization probabilities&nbsp;&nbsp;</b>
<div class="p"><!----></div>
If <b><tt>excite.py</tt></b> detects that the ab initio results contain ionization probabilities, then those can be used instead of the transition dipole moments. Note that in this case the transition dipole moments are not written to the <b><tt>initconds.excited</tt></b> file. 
<div class="p"><!----></div>
<b>Reference energy&nbsp;&nbsp;</b>
<div class="p"><!----></div>
<b><tt>excite.py</tt></b> can read the reference energy (ground state equilibrium energy) directly from the ab initio results. If the ab initio data is read anyways, <b><tt>excite.py</tt></b> already knows the relevant path. If a dummy list of states is generated, the user can provide just the path to the <b><tt>QM.out</tt></b> file of the ab initio calculation for the equilibrium geometry. Otherwise, <b><tt>excite.py</tt></b> will prompt the user to enter a reference energy manually (in hartree).
<div class="p"><!----></div>
<b>Initial state selection&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Every excited state of each initial condition has a flag specifying it either as a valid initial state or not. <b><tt>excite.py</tt></b> has four modes how to flag the excited states:
<ol type="1">
<li> Unselect all excited states,
<div class="p"><!----></div>
</li>
<li> User provides a list of initial states,
<div class="p"><!----></div>
</li>
<li> States are selected stochastically based on excitation energies and oscillator strengths,
<div class="p"><!----></div>
</li>
<li> Keep all existing flags.
<div class="p"><!----></div>
</li>
</ol>
The first option can be used if <b><tt>excite.py</tt></b> is only used to read the ab initio results for the generation of an absorption spectrum (using <b><tt>spectrum.py</tt></b>). 
<div class="p"><!----></div>
The second option can be used to directly specify a list of initial states, if the initial state is known (e.g., starting in the ground state and exciting with an explicit laser field). In this case, the given states of <i>all</i> initial conditions are flagged as initial states. This option is also useful if reference overlaps were computed (see&nbsp;<a href="#sec:setup_init.py">7.4</a>.
<div class="p"><!----></div>
The third option is only available if excited-state information exists (i.e., if no dummy list is generated). For details on the stochastic selection procedure, see section&nbsp;<a href="#met:exc_selection">8.8</a>. 
<div class="p"><!----></div>
The fourth option can only be used if the existing state information is kept. In this case <b><tt>excite.py</tt></b> does nothing except counting the number of flagged initial states.
<div class="p"><!----></div>
<b>Excitation window&nbsp;&nbsp;</b>
<div class="p"><!----></div>
This option allows to exclude excited states from the selection procedure if they are outside a given energy window. This option is only available if excited state information exists, but not if a dummy list of states is generated (because the dummy states have no defined excitation energy).
<div class="p"><!----></div>
For the stochastic selection procedure, states outside the excitation window do not count for the determination of p<sub>max</sub> (see equation&nbsp;(<a href="#eq:exc_prob"> 8.37</a>)). This allows to excite, e.g., to a dark n&#960;<sup>*</sup> state despite the presence of a much brighter &#960;&#960;<sup>*</sup> state.
<div class="p"><!----></div>
For the keep-flags option, this option can be used to count the number of excited states in the energy window.
<div class="p"><!----></div>
<b>Considered states&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Here the user can specify the list of desired initial states. 
If reference overlaps are present in the excitation calculations, then the user can choose to specify the initial state in terms of diabatized states (as defined by the overlap with the reference, where the diabatized states are identical to the computed states).
See section&nbsp;<a href="#met:exc_diabatic">8.8.1</a> for how the diabatization is carried out.
<div class="p"><!----></div>
For the stochastic selection procedure, the user can instead exclude certain states from the procedure. Excluded states do not count for the determination of p<sub>max</sub> (see equation&nbsp;(<a href="#eq:exc_prob"> 8.37</a>)).
<div class="p"><!----></div>
If the number of states per multiplicity is known, <b><tt>excite.py</tt></b> will print a table giving for each state index the multiplicity, quantum number and M<sub>s</sub> value.
<div class="p"><!----></div>
<b>Random number generator seed&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The random number generator in <b><tt>excite.py</tt></b> is used in the stochastic selection procedure. Instead of typing an integer, typing "<b><tt>!</tt></b>" will initialize the RNG from the system time. Note that this will not be reproducible, i.e.&nbsp;repeating the <b><tt>excite.py</tt></b> run with "<b><tt>!</tt></b>" as random seed will give a different selection in each run.
<div class="p"><!----></div>
     <a id="tth_sEc7.5.3"></a><h3>
7.5.3&nbsp;&nbsp;Matrix diagonalization</h3>
<div class="p"><!----></div>
When using the diagonal representation, <b><tt>excite.py</tt></b> needs to diagonalize and multiply matrices. By default, the Python package  N<span style="font-size:x-small">UM</span>P<span style="font-size:x-small">Y</span> is used, if available. If the script does not find a  N<span style="font-size:x-small">UM</span>P<span style="font-size:x-small">Y</span> installation, it will use a small Fortran code which comes with the  S<span style="font-size:x-small">HARC</span>&nbsp;suite. In order for this to work, you need to set the environment variable <b><tt>$SHARC</tt></b> to the <b><tt>bin/</tt></b> directory within your  S<span style="font-size:x-small">HARC</span>&nbsp;installation. See section&nbsp;<a href="#sec:diagonalizer.x">7.25</a> for more details.
<div class="p"><!----></div>
     <a id="tth_sEc7.5.4"></a><h3>
7.5.4&nbsp;&nbsp;Output</h3>
<div class="p"><!----></div>
<b><tt>excite.py</tt></b> writes all output to a file <b><tt>&lt;BASE&#62;.excited</tt></b>, where <b><tt>&lt;BASE&#62;</tt></b> is the name of the initial conditions file used as input. The output file is also an initial conditions file, but contains additional information regarding the excited states, the reference energy and the representation of the excited states. An initial conditions file with excited-state information is needed for the final preparatory step: setting up the dynamics with <b><tt>setup_traj.py</tt></b>.
Additionally, <b><tt>spectrum.py</tt></b> can calculate absorption spectra from excited-state initial condition files.
<div class="p"><!----></div>
     <a id="tth_sEc7.5.5"></a><h3>
7.5.5&nbsp;&nbsp;Specification of the <b><tt>initconds.excited</tt></b> file format</h3><a id="sec:initcondsfile">
</a>
<div class="p"><!----></div>
The initial conditions files <b><tt>initconds</tt></b> and <b><tt>initconds.excited</tt></b> contain lists of initial conditions, which are needed for the setup of trajectories. An initial condition is a set of initial coordinates of all atoms and corresponding initial velocities of each atom, and optionally a list of excited state informations. In the following, the format of this file is specified.
<div class="p"><!----></div>
The file contains of a header, followed by the body of the file containing a list of the initial conditions. 
<div class="p"><!----></div>
<b>File header&nbsp;&nbsp;</b>
<div class="p"><!----></div>
An examplary header looks like:
<span class="footnotesize">
<pre>
SHARC&nbsp;Initial&nbsp;conditions&nbsp;file,&nbsp;version&nbsp;0.2&nbsp;&nbsp;&nbsp;&lt;Excited&#62;
Ninit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;100
Natom&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2
Repr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MCH
Eref&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-0.50
Eharm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.04
States&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;0&nbsp;1&nbsp;
Equilibrium
&nbsp;H&nbsp;&nbsp;&nbsp;1.0&nbsp;&nbsp;0.0&nbsp;&nbsp;0.0&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;1.00782503&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;0.0&nbsp;&nbsp;0.0
&nbsp;H&nbsp;&nbsp;&nbsp;1.0&nbsp;&nbsp;1.5&nbsp;&nbsp;0.0&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;1.00782503&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;0.0&nbsp;&nbsp;0.0
</pre>
  </span>
The first line must read <b><tt>SHARC Initial conditions file, version &lt;VERSION&#62;</tt></b>, with the correct version string followed. The string <b><tt>Excited</tt></b> is optional, and marks an initial conditions file as being an output file of <b><tt>excite.py</tt></b> (<b><tt>setup_traj.py</tt></b> will only accept files marked like this). The following lines contain:
<ol type="1">
<li> the number of initial conditions,
<div class="p"><!----></div>
</li>
<li> the number of atoms,
<div class="p"><!----></div>
</li>
<li> the electronic state representation (a string which is <b><tt>None</tt></b>, <b><tt>MCH</tt></b> or <b><tt>diag</tt></b>),
<div class="p"><!----></div>
</li>
<li> the reference energy (hartree),
<div class="p"><!----></div>
</li>
<li> the harmonic energy (zero point energy in the harmonic approximation, hartree),
<div class="p"><!----></div>
</li>
<li> optionally the number of states per multiplicity.
<div class="p"><!----></div>
</li>
</ol>
<div class="p"><!----></div>
After the header, first the equilibrium geometry is expected. It is demarked with the keyword <b><tt>Equilibrium</tt></b>, followed by n<sub>atom</sub> lines, each specifying one atom. Unlike the actual initial conditions, the equilibrium geometry does not have a list of excited states or defined energies.
<div class="p"><!----></div>
<b>File body&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The file body contains a list of initial conditions. Each initial condition is specified by a block starting with a line containing the string <b><tt>Index</tt></b> and the number of the initial condition. In the file, the initial conditions are expected to appear in order.
<div class="p"><!----></div>
A block specifying an initial condition looks like:
<span class="footnotesize">
<pre>
Index&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1
Atoms
&nbsp;H&nbsp;&nbsp;&nbsp;1.0&nbsp;&nbsp;-0.02&nbsp;&nbsp;0.0&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;1.00782503&nbsp;&nbsp;-0.001&nbsp;&nbsp;0.0&nbsp;&nbsp;0.0
&nbsp;H&nbsp;&nbsp;&nbsp;1.0&nbsp;&nbsp;&nbsp;1.52&nbsp;&nbsp;0.0&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;1.00782503&nbsp;&nbsp;&nbsp;0.001&nbsp;&nbsp;0.0&nbsp;&nbsp;0.0
States
001&nbsp;&nbsp;&nbsp;&nbsp;-0.49&nbsp;&nbsp;&nbsp;&nbsp;-0.49&nbsp;&nbsp;-0.16&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;-0.03&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;0.05&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;0.00&nbsp;False
002&nbsp;&nbsp;&nbsp;&nbsp;-0.25&nbsp;&nbsp;&nbsp;&nbsp;-0.49&nbsp;&nbsp;&nbsp;0.02&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;0.43&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;-1.77&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;6.5&nbsp;&nbsp;&nbsp;0.53&nbsp;True
003&nbsp;&nbsp;&nbsp;&nbsp;-0.40&nbsp;&nbsp;&nbsp;&nbsp;-0.49&nbsp;&nbsp;&nbsp;0.00&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;0.00&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;0.00&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;2.5&nbsp;&nbsp;&nbsp;0.00&nbsp;False
004&nbsp;&nbsp;&nbsp;&nbsp;-0.40&nbsp;&nbsp;&nbsp;&nbsp;-0.49&nbsp;&nbsp;&nbsp;0.00&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;0.00&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;0.00&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;2.5&nbsp;&nbsp;&nbsp;0.00&nbsp;False
005&nbsp;&nbsp;&nbsp;&nbsp;-0.40&nbsp;&nbsp;&nbsp;&nbsp;-0.49&nbsp;&nbsp;&nbsp;0.00&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;0.00&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;0.00&nbsp;&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;2.5&nbsp;&nbsp;&nbsp;0.00&nbsp;False
Ekin&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.004&nbsp;a.u.
Epot_harm&nbsp;&nbsp;&nbsp;0.026&nbsp;a.u.
Epot&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.013&nbsp;a.u.
Etot_harm&nbsp;&nbsp;&nbsp;0.030&nbsp;a.u.
Etot&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.018&nbsp;a.u.
</pre>
  </span>
The formal structure of such a block is as follows. After the line containing the keyword <b><tt>Index</tt></b> and the index number, the keyword <b><tt>Atoms</tt></b> indicates the start of the list of atoms. Each atom is specified on one line:
<ol type="1">
<li> symbol,
<div class="p"><!----></div>
</li>
<li> nuclear charge,
<div class="p"><!----></div>
</li>
<li> x, y, z coordinate in Bohrs,
<div class="p"><!----></div>
</li>
<li> atomic mass,
<div class="p"><!----></div>
</li>
<li> x, y and z component of nuclear velocity in atomic units.
<div class="p"><!----></div>
</li>
</ol>
<div class="p"><!----></div>
After the atom list, the keyword <b><tt>States</tt></b> indicates the list of electronic states. This list consists of one line per electronic state, but can be empty, if no information of the electronic states is available. Each line consists of: 
<ol type="1">
<li> state number (starting with 1),
<div class="p"><!----></div>
</li>
<li> state energy in Hartree,
<div class="p"><!----></div>
</li>
<li> reference energy in Hartree (usually the energy of the lowest state),
<div class="p"><!----></div>
</li>
<li> six numbers defining the transition dipole moment to the reference state (usually the lowest state),
<div class="p"><!----></div>
</li>
<li> the excitation energy in eV,
<div class="p"><!----></div>
</li>
<li> the oscillator strength,
<div class="p"><!----></div>
</li>
<li> a string which is either <b><tt>True</tt></b> or <b><tt>False</tt></b>, specifying whether the electronic state was selected by <b><tt>excite.py</tt></b> as initial electronic state.
<div class="p"><!----></div>
</li>
</ol>
The transition dipole moments are specified by six floating point numbers, which are real part of the x component, imaginary part of the x component, then the real and imaginary parts for the y and finally the z component (the transition dipole moments can be complex in the diagonal representation). 
<div class="p"><!----></div>
The electronic state list is terminated with the keyword <b><tt>Ekin</tt></b>, which at the same time gives the kinetic energy of all atoms. The remaining entries give the potential energy in the harmonic approximation and the actual potential energy, as well as the total energy.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc7.6"></a><h2>
7.6&nbsp;&nbsp;Setup of Trajectories: <b><tt>setup_traj.py</tt></b></h2><a id="sec:setup_traj.py">
</a>
<div class="p"><!----></div>
This interactive script prepares the input for the excited-state dynamics simulations with  S<span style="font-size:x-small">HARC</span>. It works similarly to <b><tt>setup_init.py</tt></b>, reading an initial conditions file, prompting the user for a number of input parameters, and finally prepares one directory per trajectory. However, the <b><tt>setup_traj.py</tt></b> input section is noticeably longer, because most options for the  S<span style="font-size:x-small">HARC</span>&nbsp;dynamics are covered.
<div class="p"><!----></div>
     <a id="tth_sEc7.6.1"></a><h3>
7.6.1&nbsp;&nbsp;Input</h3>
<div class="p"><!----></div>
<b>Initial conditions file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Please be aware that <b><tt>setup_traj.py</tt></b> needs an initial conditions file generated by <b><tt>excite.py</tt></b> (files generated by <b><tt>wigner.py</tt></b>, <b><tt>amber_to_initconds.py</tt></b>, or <b><tt>sharctraj_to_initconds.py</tt></b> are not allowed). The script reads the number of initial states, the representation, and the reference energy automatically from the file.
<div class="p"><!----></div>
<b>Number of states&nbsp;&nbsp;</b>
<div class="p"><!----></div>
This is the total number of states per multiplicity included in the dynamics calculation. Affects the keyword <b><tt>nstates</tt></b> in the  S<span style="font-size:x-small">HARC</span>&nbsp;input file.
<div class="p"><!----></div>
Only advanced users should use here a different number of states than given to <b><tt>setup_init.py</tt></b>. In this case, the excited-state information in the initial conditions file might be inconsistent. For example, if 10 singlets and 10 triplets were included in the initial calculations, but only 5 singlets and 5 triplets in the dynamics, then the sixth entry in the initial conditions file corresponds to S<sub>5</sub>, while <b><tt>setup_traj.py</tt></b> assumes the sixth entry to correspond to T<sub>1</sub>.
<div class="p"><!----></div>
<b>Active states&nbsp;&nbsp;</b>
<div class="p"><!----></div>
States can be frozen for the dynamics calculation here. See section&nbsp;<a href="#met:activestates">8.2</a> for a general description of state freezing in  S<span style="font-size:x-small">HARC</span>. Only the highest states in each multiplicity can be frozen, it is not possible to, e.g., freeze the ground state in simulations where ground state relaxation is negligible. Affects the keyword <b><tt>actstates</tt></b>.
<div class="p"><!----></div>
<b>Contents of the initial conditions file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Optionally, a map of the contents of the initial conditions file can be displayed during the execution of <b><tt>setup_traj.py</tt></b>, showing for each state which initial conditions were selected (and which initial conditions do not have the necessary excited-state information). For each state, a table is given, where each symbol represents one initial condition. A dot "<b><tt>.</tt></b>" represents an initial condition where information about the current excited state is available, but which is not selected for dynamics. A hash mark "<b><tt>#</tt></b>" represents an initial condition which is selected for dynamics. A question mark "<b><tt>?</tt></b>" represents initial conditions for which no information about the excited state is available (e.g.&nbsp;if the initial excited-state calculation failed). The tutorial shows an example of this output.
<div class="p"><!----></div>
The content of the initial conditions file is also summarized in a table giving the number of initial conditions selected per state. 
<div class="p"><!----></div>
<b>Initial states for dynamics setup&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The user has to input all states from which trajectories should be launched. The numbers must be entered according to the above table giving the number of selected initial conditions per state. It is not allowed to specify inactive states as initial states. The script will give the number of trajectories which can be setup with the specified set of states. If no trajectories can be setup, the user has to specify another set of initial states. The initial state will be written to the  S<span style="font-size:x-small">HARC</span>&nbsp;input, specified in the same representation as given in the initial conditions file. The initial coefficients will be determined automatically by  S<span style="font-size:x-small">HARC</span>, according to the description in section&nbsp;<a href="#ssec:input:keywords">4.1.3</a>.
<div class="p"><!----></div>
<b>Starting index for dynamics setup&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Specifies the first initial condition within the initial condition file to be included in the setup. This is useful, for example, if the user might setup 50 trajectories starting with index 1. <b><tt>setup_traj.py</tt></b> reports afterwards the last initial condition to be used for setup, e.g.&nbsp;index 90. Later, the user can setup additional trajectories, starting with index 91.
<div class="p"><!----></div>
<b>Random number generator seed&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The random number generator in <b><tt>setup_traj.py</tt></b> is used to randomly generate RNG seeds for the  S<span style="font-size:x-small">HARC</span>&nbsp;input. Instead of typing an integer, typing "<b><tt>!</tt></b>" will initialize the RNG from the system time. Note that this will not be reproducible, i.e.&nbsp;repeating the <b><tt>setup_traj.py</tt></b> run (with the same input) with "<b><tt>!</tt></b>" as random seed will give for the same trajectories different RNG seeds. Affects the keyword <b><tt>RNGseed</tt></b>.
<div class="p"><!----></div>
<b>Interface&nbsp;&nbsp;</b>
<div class="p"><!----></div>
In this point, choose any of the displayed interfaces to carry out the ab initio calculations. Enter the corresponding number. The choice of the interface influences some dynamics options which can be set in the next section of the <b><tt>setup_traj.py</tt></b> input.
<div class="p"><!----></div>
<b>Simulation Time&nbsp;&nbsp;</b>
<div class="p"><!----></div>
This is the maximum time that  S<span style="font-size:x-small">HARC</span>&nbsp;will run the dynamics simulation. If trajectories need to be run for longer time, it is recommended to first let the simulation finish. Afterwards, increase the simulation time in the corresponding  S<span style="font-size:x-small">HARC</span>&nbsp;input file (keyword <b><tt>tmax</tt></b>) and add the restart keyword (also make sure that the <b><tt>norestart</tt></b> keyword is not present). Then the simulation can be restarted by running again the <b><tt>run.sh</tt></b> script. Sets the keyword <b><tt>tmax</tt></b> in the  S<span style="font-size:x-small">HARC</span>&nbsp;input files.
<div class="p"><!----></div>
<b>Simulation Timestep&nbsp;&nbsp;</b>
<div class="p"><!----></div>
This gives the time step for the dynamics. The on-the-fly ab initio calculations are performed with this time step, as is the propagation of the nuclear coordinates. A shorter time step gives more accurate results, especially if light atoms (hydrogen) are subjected to high kinetic energies or steep gradients. Of course a shorter time step is computationally more expensive. A good compromise in many situations is 0.5&nbsp;fs. Sets the keyword <b><tt>stepsize</tt></b> in the  S<span style="font-size:x-small">HARC</span>&nbsp;input files.
<div class="p"><!----></div>
<b>Number of substeps&nbsp;&nbsp;</b>
<div class="p"><!----></div>
This gives the number of substeps for the interpolation of the Hamiltonian for the propagation of the electronic wave function. Usually, 25 substeps are sufficient. In cases where the diagonal elements of the Hamiltonian are very large (very large excitation energies or a badly chosen reference energy) more substeps are necessary. Sets the keyword <b><tt>nsubsteps</tt></b> in the  S<span style="font-size:x-small">HARC</span>&nbsp;input files.
<div class="p"><!----></div>
<b>Prematurely terminate trajectories&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Usually, trajectories which relaxed to the ground state do not recross to an excited state, but vibrate indefinitely in the ground state. If the user is not interested in these vibrations, such trajectories can be terminated prematurely in order to save computational resources. A threshold of 10-20&nbsp;fs is usually a good choice to safely detect ground state relaxation. Sets the keyword <b><tt>killafter</tt></b> in the  S<span style="font-size:x-small">HARC</span>&nbsp;input files.
<div class="p"><!----></div>
<b>Representation for the dynamics&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Either the diagonal representation can be chosen (by typing "<b><tt>yes</tt></b>") to perform dynamics with the  S<span style="font-size:x-small">HARC</span>&nbsp;methodology, or the dynamics can be performed on the MCH states (spin-diabatic dynamics <a href="#Granucci2012JCP" class="tth_citeref">[26</a>], FISH <a href="#Mitric2009PRA" class="tth_citeref">[25</a>]). Sets the keyword <b><tt>surf</tt></b> in the  S<span style="font-size:x-small">HARC</span>&nbsp;input files.
<div class="p"><!----></div>
<b>Spin-orbit couplings&nbsp;&nbsp;</b>
<div class="p"><!----></div>
If more than just singlet states are requested, the script asks whether spin-orbit couplings should be computed. If the chosen interface cannot provide spin-orbit couplings, this question is automatically answered.
<div class="p"><!----></div>
<b>Non-adiabatic couplings&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Electronic propagation can be performed with temporal derivatives, nonadiabatic coupling vectors or overlap matrices (Local diabatization). Enter the corresponding number. Note that depending on the chosen interface, some options might not be available, as displayed by <b><tt>setup_traj.py</tt></b>. Also note that currently, no interface can provide temporal derivatives (because their computation involves calculating the overlap matrix and then local diabatization can be done instead). Sets the keyword <b><tt>coupling</tt></b> in the  S<span style="font-size:x-small">HARC</span>&nbsp;input files.
<div class="p"><!----></div>
If nonadiabatic coupling vectors are chosen, the user is asked whether overlap matrices should be computed anyways to provide wave function phase information. As the overlap calculations are usually fast compared to other steps, this is recommended.
<div class="p"><!----></div>
<b>Gradient transformation&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The nonadiabatic coupling vectors can be used to correctly transform the gradients to the diagonal representation. If nonadiabatic coupling vectors are used anyways, this option is strongly recommended, since it gives more accurate gradients for no additional cost. Sets the keyword <b><tt>gradcorrect</tt></b> in the  S<span style="font-size:x-small">HARC</span>&nbsp;input files. If the dynamics uses the MCH representation, this question is not asked. 
<div class="p"><!----></div>
<b>Surface hop treatment&nbsp;&nbsp;</b>
<div class="p"><!----></div>
This option determines how the total energy is conserved after a surface hop and whether frustrated hops lead to reflection. Sets the keywords <b><tt>ekincorrect</tt></b> and <b><tt>reflect_frustrated</tt></b> in the  S<span style="font-size:x-small">HARC</span>&nbsp;input files.
<div class="p"><!----></div>
<b>Decoherence correction&nbsp;&nbsp;</b>
<div class="p"><!----></div>
For most applications, a decoherence correction should be enabled. This controls the <b><tt>decoherence_scheme</tt></b> (and <b><tt>decoherence_param</tt></b> keywords in the  S<span style="font-size:x-small">HARC</span>&nbsp;input files. 
<div class="p"><!----></div>
Note that <b><tt>setup_traj.py</tt></b> does not allow to modify the &#945; parameter for the energy-based decoherence (keyword <b><tt>decoherence_param</tt></b>). In order to change <b><tt>decoherence_param</tt></b>, the user has to manually edit the  S<span style="font-size:x-small">HARC</span>&nbsp;input files.
<div class="p"><!----></div>
<b>Surface hopping scheme&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Choose one of the available schemes to compute the hopping probabilities or turn off hopping.
<div class="p"><!----></div>
<b>Scaling and Damping&nbsp;&nbsp;</b>
<div class="p"><!----></div>
These two prompts set the keywords <b><tt>scaling</tt></b> and <b><tt>damping</tt></b> in the  S<span style="font-size:x-small">HARC</span>&nbsp;input files. The scaling parameter has to be positive, and the damping parameter has to be in the interval [0,1].
<div class="p"><!----></div>
<b>Atom masking&nbsp;&nbsp;</b>
<div class="p"><!----></div>
In some cases, the script will ask to specify the atoms to which decoherence/rescaling/reflection should be applied.
See section&nbsp;<a href="#chap:input">4</a> for explanations (keyword <b><tt>atommask</tt></b>).
<div class="p"><!----></div>
<b>Gradient and nonadiabatic coupling selection&nbsp;&nbsp;</b>
<div class="p"><!----></div>
For dynamics in the MCH representation, selection of gradients is used by default, and only one gradient (of the current state) is calculated. Selection of nonadiabatic couplings is only relevant if they are used (for propagation, gradient correction or rescaling of the velocities after a surface hop). For the selection threshold, usually 0.5&nbsp;eV is sufficient, except if spin-orbit coupling is very strong and hence the gradients mix strongly.
Sets the keywords <b><tt>grad_select</tt></b> and <b><tt>nac_select</tt></b> in the  S<span style="font-size:x-small">HARC</span>&nbsp;input files.
<div class="p"><!----></div>
<b>Laser file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The user can specify to use an external laser field during the dynamics, and has to provide the path to the laser file (see section&nbsp;<a href="#sec:laser.x">7.7</a> and&nbsp;<a href="#sec:laserfile">4.5</a>). <b><tt>setup_traj.py</tt></b> will check whether the number of steps and the time steps are compatible to the dynamics. If the interface can provide dipole moment gradients, <b><tt>setup_traj.py</tt></b> will also ask whether dipole moment gradients should be included in the simulations.
<div class="p"><!----></div>
<b>Dyson norm calculation&nbsp;&nbsp;</b>
<div class="p"><!----></div>
If the interface is compatible, the user can request that Dyson norms are calculated on-the-fly. This option is only asked if Dyson norms can be computed (i.e., if states are present which differ by one electron, e.g., singlets and doublets).
<div class="p"><!----></div>
<b> T<span style="font-size:x-small">HEO</span>DORE calculations&nbsp;&nbsp;</b>
<div class="p"><!----></div>
If the interface is compatible, the user can request that  T<span style="font-size:x-small">HEO</span>DORE is run on-the-fly. 
<div class="p"><!----></div>
     <a id="tth_sEc7.6.2"></a><h3>
7.6.2&nbsp;&nbsp;Interface-specific input</h3>
<div class="p"><!----></div>
This input section is basically the same as for <b><tt>setup_init.py</tt></b> (section&nbsp;<a href="#sec:setup_init.py:several">7.4.3</a> and following sections). Note that for the dynamics simulations an initial wave function file is even more strongly recommended than for the initial excited-state calculations.
<div class="p"><!----></div>
     <a id="tth_sEc7.6.3"></a><h3>
7.6.3&nbsp;&nbsp;Output control</h3>
<div class="p"><!----></div>
<b><tt>setup_traj.py</tt></b> will ask a number of questions regarding the content of the <b><tt>output.dat</tt></b> file, specifically about writing gradients, nonadiabatic coupling vectors, properties (1D and 2D), and overlap matrices to this file.
Note that this is only possible if these quantities are actually calculated; otherwise, <b><tt>sharc.x</tt></b> will ignore these requestes.
<div class="p"><!----></div>
     <a id="tth_sEc7.6.4"></a><h3>
7.6.4&nbsp;&nbsp;Run script setup</h3>
<div class="p"><!----></div>
Also this input section is very similar to the one in <b><tt>setup_init.py</tt></b> (see section&nbsp;<a href="#sec:setup_init.py">7.4</a>).
<div class="p"><!----></div>
     <a id="tth_sEc7.6.5"></a><h3>
7.6.5&nbsp;&nbsp;Output</h3>
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_fIg7.2">
</a>   <div style="text-align:center">  <img src="http://sharc-md.org/wp-content/uploads/2018/02/dirs_traj.png">  
<div style="text-align:center">Figure 7.2: Directory structure created by <b><tt>setup_traj.py</tt></b>. Directories are in blue, executable scripts in green and regular files in black and white. Interface files usually include initial MO coefficients, template files and interface input files.</div>
  <a id="fig:dirs_traj">
</a>
</div>
<div class="p"><!----></div>
<b><tt>setup_traj.py</tt></b> will create for each initial state a directory where all trajectories starting in this state will be put. If the initial conditions file specified that the initial conditions are in the MCH representation, then the initial states will be assumed to be in the MCH representation as well. In this case, the directories will be named <b><tt>Singlet_0</tt></b>, <b><tt>Singlet_1</tt></b>, ..., <b><tt>Doublet_0</tt></b>, <b><tt>Triplet_1</tt></b>, ... If the initial states are in the diagonal representation, then the directories are simply called <b><tt>X_1</tt></b>, ... since they do not have a definite spin.
<div class="p"><!----></div>
In each directory, subdirectories called <b><tt>TRAJ_%05i</tt></b> are created, where <b><tt>%05i</tt></b> is the initial condition index, padded to 5 digits with zeroes. In each trajectory's directory, an  S<span style="font-size:x-small">HARC</span>&nbsp;input file called <b><tt>input</tt></b> will be created, which contains all the dynamics options chosen during the <b><tt>setup_traj.py</tt></b> run. Also, files <b><tt>geom</tt></b> and <b><tt>veloc</tt></b> will be created. For trajectories setup with <b><tt>setup_traj.py</tt></b>, the determination of the initial wave function coefficients is done by  S<span style="font-size:x-small">HARC</span>.
Furthermore, in each trajectory directory a subdirectory <b><tt>QM</tt></b> is created, where the <b><tt>runQM.sh</tt></b> script containing the call to the interface is put. In the directory <b><tt>QM</tt></b> also all interface-specific input files will be copied.
<div class="p"><!----></div>
For each trajectory, a <b><tt>run.sh</tt></b> script will be created, which can be executed to run the dynamics simulation. You might need to adapt the run script to your cluster setup.
<div class="p"><!----></div>
Optionally, <b><tt>setup_traj.py</tt></b> also creates a script <b><tt>all_qsub.sh</tt></b>, which can be executed to submit all trajectories to a queueing system. You might need to adapt also this script to your cluster setup.
<div class="p"><!----></div>
The full directory structure created by <b><tt>setup_traj.py</tt></b> is given in figure&nbsp;<a href="#fig:dirs_traj"> 7.2</a>.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc7.7"></a><h2>
7.7&nbsp;&nbsp;Laser field generation: <b><tt>laser.x</tt></b></h2><a id="sec:laser.x">
</a>
<div class="p"><!----></div>
The Fortran code <b><tt>laser.x</tt></b> can generate files containing laser fields which can be used with  S<span style="font-size:x-small">HARC</span>. It is possible to superimpose several lasers, use different polarizations and apply a number of chirp parameters.
<div class="p"><!----></div>
     <a id="tth_sEc7.7.1"></a><h3>
7.7.1&nbsp;&nbsp;Usage</h3>
<div class="p"><!----></div>
The program is simply called by 
<pre>
user@host&#62;&nbsp;$SHARC/laser.x
</pre>
It will interactively ask for the laser parameters. After input is complete, it writes the laser field to the file <b><tt>laser</tt></b> in the format which  S<span style="font-size:x-small">HARC</span>&nbsp;expects (see&nbsp;<a href="#sec:laserfile">4.5</a>).
<div class="p"><!----></div>
Similar to the interactive Python scripts, <b><tt>laser.x</tt></b> will also write the user input to <b><tt>KEYSTROKES.laser</tt></b>. After modifying this file, it can be used to directly execute <b><tt>laser.x</tt></b> without doing the interactive input again:
<pre>
user@host&#62;&nbsp;$SHARC/laser.x&nbsp;&lt;&nbsp;KEYSTROKES.laser
</pre>
<div class="p"><!----></div>
     <a id="tth_sEc7.7.2"></a><h3>
7.7.2&nbsp;&nbsp;Input</h3>
<div class="p"><!----></div>
The first four options are global and need to be entered only once, all remaining input options need to be given for every laser pulse. For the definition of laser fields see section&nbsp;<a href="#met:laser_field">8.13</a>.
<div class="p"><!----></div>
<b>Number of lasers&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Any number of lasers can be used. The output file will contain the sum of all laser pulses defined.
<div class="p"><!----></div>
<b>Real-valued field&nbsp;&nbsp;</b>
<div class="p"><!----></div>
If this is true, the output file will only contain the real parts of the laser field, while the columns defining the imaginary part of the field will be zero. Note, however, that  S<span style="font-size:x-small">HARC</span>&nbsp;will anyways only use the real part of the field in the simulations.
<div class="p"><!----></div>
<b>Time interval and steps&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The definitions of the starting time, end time and time step of the laser field must exactly match the simulation time and time substeps of the  S<span style="font-size:x-small">HARC</span>&nbsp;simulation. Note, that the laser field must always start at t=0 fs to be used with  S<span style="font-size:x-small">HARC</span>. The end time for the laser field must therefore coincide with the total simulation time given in the  S<span style="font-size:x-small">HARC</span>&nbsp;input. The number of time steps for the laser field is t<sub>total</sub>/&#8710;t<sub>sub</sub> +1.
<div class="p"><!----></div>
<b>Files for debugging&nbsp;&nbsp;</b>
<div class="p"><!----></div>
This option is normally not needed, and can be set to False. If set to True, the chirped and unchirped laser fields in both time and frequency domain will be written to files called <b><tt>DEBUG_... </tt></b>.
<div class="p"><!----></div>
<b>Polarization vector&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The polarization vector <b>p</b> (will be normalized).
<div class="p"><!----></div>
<b>Type of envelope&nbsp;&nbsp;</b>
<div class="p"><!----></div>
There are two options possible for the envelope function <i>E</i>(t), either a Gaussian envelope or a sinusoidal one (see&nbsp;<a href="#met:laser_field">8.13</a>).
<div class="p"><!----></div>
<b>Field strength&nbsp;&nbsp;</b>
<div class="p"><!----></div>
There are two input lines for the field strength <i>E</i><sub>0</sub>, the first defining the unit in which the field strength is defined, the second gives the corresponding number. Field strength can be read in in GV/m, TW/cm<sup>&#8722;2</sup> or atomic units.
<div class="p"><!----></div>
<b>FWHM and time intervals&nbsp;&nbsp;</b>
<div class="p"><!----></div>
This option depends on the type of envelope chosen. While in both cases all 5 numbers need to be entered, for a Gaussian pulse only the first and third number have an effect. For a sinusoidal pulse all but the first number has an effect.
<div class="p"><!----></div>
For a Gaussian pulse, the first argument corresponds to FWHM in equation&nbsp;(<a href="#eq:laser_gauss_2"> 8.63</a> and the third argument to t<sub>c</sub> in &nbsp;).
<div class="p"><!----></div>
For a sinusoidal pulse, the second, third, fourth and fifth argument correspond to t<sub>0</sub>, t<sub>c</sub>, t<sub>c2</sub> and t<sub>e</sub>, respectively, in equation&nbsp;(<a href="#eq:laser_sinus"> 8.64</a>).
<div class="p"><!----></div>
<b>Central frequency&nbsp;&nbsp;</b>
<div class="p"><!----></div>
There are two input lines for the central frequency &#969;<sub>0</sub>. The first defines the unit (wavelength in nm, energy in eV, or atomic units). The second line gives the value.
<div class="p"><!----></div>
<b>Phase&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The total phase &#981; is given in multiples of &#960;. For example, the input "<b><tt>1.5</tt></b>" gives a phase of [(3&#960;)/2].
<div class="p"><!----></div>
<b>Chirp parameters&nbsp;&nbsp;</b>
<div class="p"><!----></div>
There are four lines giving the chirp parameters b<sub>1</sub>, b<sub>2</sub>, b<sub>3</sub> and b<sub>4</sub>. See equation&nbsp;(<a href="#eq:laser_chirp"> 8.66</a>) for the meaning of these parameters.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc7.8"></a><h2>
7.8&nbsp;&nbsp;Calculation of Absorption Spectra: <b><tt>spectrum.py</tt></b></h2><a id="sec:spectrum.py">
</a>
<div class="p"><!----></div>
Aside from setting up trajectories, the <b><tt>initconds.excited</tt></b> files can also be used to generate absorption spectra based on the excitation energies and oscillator strengths in the file. The script <b><tt>spectrum.py</tt></b> calculates Gaussian, Lorentzian, or Log-normal convolutions of these data in order to obtain spectra. See section&nbsp;<a href="#met:spectrum">8.1</a> for further details.
<div class="p"><!----></div>
<b><tt>spectrum.py</tt></b> evaluates the absorption spectrum on a grid for all states it finds in an initial conditions file. Using command-line options, some initial conditions can be omitted in the convolution, see table&nbsp;<a href="#tab:spectrum_opts"> 7.4</a>.
<div class="p"><!----></div>
     <a id="tth_sEc7.8.1"></a><h3>
7.8.1&nbsp;&nbsp;Input</h3>
<div class="p"><!----></div>
The script is executed with the initial conditions file as argument:
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/spectrum.py&nbsp;[OPTIONS]&nbsp;initconds.excited
</pre>
<div class="p"><!----></div>
The script accepts a number of command-line options, which are given in table&nbsp;<a href="#tab:spectrum_opts"> 7.4</a>.
<div class="p"><!----></div>
<a id="tth_tAb7.4">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 7.4: Command-line options for script <b><tt>spectrum.py</tt></b>.</div>
  <a id="tab:spectrum_opts">
</a>
<table>
<tr><td align="left"><span class="roman">Option        </td><td align="left">Description      </td><td align="left">Default</td></tr>
<tr><td align="left">-h                  </td><td align="left">Display help message and quit.         </td><td align="left">-       </td></tr>
<tr><td align="left">-o FILENAME         </td><td align="left">Output filename (for the spectrum)     </td><td align="left"><b><tt>spectrum.out</tt></b></td></tr>
<tr><td align="left">-n INTEGER          </td><td align="left">Number of grid points                  </td><td align="left">500       </td></tr>
<tr><td align="left">-e FLOAT FLOAT      </td><td align="left">Energy range (eV) for the spectrum     </td><td align="left">1 to 10 eV</td></tr>
<tr><td align="left">-i INTEGER INTEGER  </td><td align="left">Index range for the initial conditions </td><td align="left">1 to 1000</td></tr>
<tr><td align="left">-f FLOAT            </td><td align="left">FWHM (eV) for the spectrum             </td><td align="left">0.1 eV</td></tr>
<tr><td align="left">-G                  </td><td align="left">Gaussian convolution                   </td><td align="left">Gaussian</td></tr>
<tr><td align="left">-L                  </td><td align="left">Lorentzian convolution                 </td><td align="left">Gaussian</td></tr>
<tr><td align="left">-N                  </td><td align="left">Log-normal convolution                 </td><td align="left">Gaussian</td></tr>
<tr><td align="left">-s                  </td><td align="left">Use only selected initial conditions   </td><td align="left">Use all</td></tr>
<tr><td align="left">-l                  </td><td align="left">Make a line spectrum                   </td><td align="left">Convolution</td></tr>
<tr><td align="left">-D                  </td><td align="left">Compute density of states (ignore f<sub>osc</sub>)      </td><td align="left">Compute absorption</td></tr>
<tr><td align="left">--gnuplot FILENAME  </td><td align="left">Write a  G<span style="font-size:x-small">NUPLOT</span> script        </td><td align="left">No  G<span style="font-size:x-small">NUPLOT</span> script</td></tr></span></table>
</div>
<div class="p"><!----></div>
     <a id="tth_sEc7.8.2"></a><h3>
7.8.2&nbsp;&nbsp;Output</h3>
<div class="p"><!----></div>
The script writes the absorption spectrum to a file (by default <b><tt>spectrum.out</tt></b>). Using the <b><tt>-o</tt></b> option, the user can redirect the output to a suitable file. The output is a table containing n+2 columns, where n is the number of states found in the initial conditions file. The first column gives the energy in eV, within the given energy interval. In columns 2 to n+1 the state-wise absorption spectra are given. The last column contains the total absorption spectrum, i.e., the sum over all states. The table has n<sub>grid</sub>+1 rows. For line spectra the output format is exactly the same, however, the file will contain one row for each excited state of each initial condition in the initial conditions file. If density of states is computed, the script replaces the oscillator strength by a factor of 1 for all states.
<div class="p"><!----></div>
Additionally, the script writes some information about the calculation to standard output, among these the maximum of the spectrum, which can be used in order to normalize the spectrum. The reported maximum is simply the largest value in the last column of the spectrum. 
<div class="p"><!----></div>
If requested, the script generates a  G<span style="font-size:x-small">NUPLOT</span> script, which can be used to directly plot the spectrum. 
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc7.9"></a><h2>
7.9&nbsp;&nbsp;File transfer: <b><tt>retrieve.sh</tt></b></h2><a id="sec:retrieve">
</a>
<div class="p"><!----></div>
Usually,  S<span style="font-size:x-small">HARC</span>&nbsp;will run on some temporary directory, and not in the directory where the trajectories have been submitted from. The shell script <b><tt>retrieve.sh</tt></b> is a simple <b><tt>scp</tt></b> wrapper, which can be executed (in a directory where a trajectory has been sent from) in order to retrieve the output files of this trajectory. This might not work for every cluster setup.
<div class="p"><!----></div>
It relies on the presence of the file <b><tt>host_infos</tt></b>. All trajectories set up with <b><tt>setup_traj.py</tt></b> create this file after the trajectory has been started with <b><tt>run.sh</tt></b>. <b><tt>retrieve.sh</tt></b> reads <b><tt>host_infos</tt></b> to determine the hostname and working directory of the trajectory and then uses <b><tt>scp</tt></b> to retrieve the output and restart files.
<div class="p"><!----></div>
The script can be called with the option "<b><tt>-lis</tt></b>" in order to only retrieve the <b><tt>output.lis</tt></b> file, but not the other output files.
<div class="p"><!----></div>
If the script is called with the option "<b><tt>-res</tt></b>" then also the restart files and the content of the <b><tt>restart/</tt></b> directory are copied.
<div class="p"><!----></div>
It is advisable to configure public-key authentification for the hosts running the trajectories, so that not for every execution of <b><tt>retrieve.sh</tt></b> a password has to be entered.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc7.10"></a><h2>
7.10&nbsp;&nbsp;Data Extractor: <b><tt>data_extractor.x</tt></b></h2><a id="sec:data_extractor.x">
</a>
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb7.5">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 7.5: Command-line options for <b><tt>data_extractor.x</tt></b>.</div>
  <a id="tab:dataextractor_options">
</a>
<table>
<tr><td align="left"><span class="roman">Option        </td><td align="left">Description      </td><td align="left">Default</td></tr>
<tr><td align="left">-h          </td><td align="left">Display help message and quit.                         </td><td align="left">-                      </td></tr>
<tr><td align="left">-e          </td><td align="left">Write <b><tt>energy.out</tt></b>                                 </td><td align="left">True                     </td></tr>
<tr><td align="left">-d          </td><td align="left">Write <b><tt>fosc.out</tt></b>                                   </td><td align="left">True                     </td></tr>
<tr><td align="left">-da         </td><td align="left">Write <b><tt>fosc_act.out</tt></b>                              </td><td align="left">True                     </td></tr>
<tr><td align="left">-sp         </td><td align="left">Write <b><tt>spin.out</tt></b>                                   </td><td align="left">True                     </td></tr>
<tr><td align="left">-cd         </td><td align="left">Write <b><tt>coeff_diag.out</tt></b>                            </td><td align="left">True                     </td></tr>
<tr><td align="left">-cm         </td><td align="left">Write <b><tt>coeff_MCH.out</tt></b>                             </td><td align="left">True                     </td></tr>
<tr><td align="left">-cb         </td><td align="left">Write <b><tt>coeff_diab.out</tt></b>                            </td><td align="left">True (if overlaps present) </td></tr>
<tr><td align="left">-p          </td><td align="left">Write <b><tt>prob.out</tt></b>                                   </td><td align="left">True                     </td></tr>
<tr><td align="left">-x          </td><td align="left">Write <b><tt>expec.out</tt></b>                                  </td><td align="left">True                     </td></tr>
<tr><td align="left">-xm         </td><td align="left">Write <b><tt>expec_MCH.out</tt></b>                             </td><td align="left">True                     </td></tr>
<tr><td align="left">-id         </td><td align="left">Write <b><tt>ion_diag.out</tt></b>                              </td><td align="left">False                    </td></tr>
<tr><td align="left">-im         </td><td align="left">Write <b><tt>ion_MCH.out</tt></b>                               </td><td align="left">False                    </td></tr>
<tr><td align="left">-z          </td><td align="left"><b><tt>-e</tt></b>, <b><tt>-cd</tt></b>, <b><tt>-cm</tt></b>, <b><tt>-p</tt></b>, <b><tt>-x</tt></b>     </td><td align="left">-                      </td></tr>
<tr><td align="left">-s          </td><td align="left">All options except <b><tt>-id</tt></b> and <b><tt>-im</tt></b>             </td><td align="left">-                      </td></tr>
<tr><td align="left">-a          </td><td align="left">All options                                            </td><td align="left">-                      </td></tr></span></table>
</div>
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb7.6">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 7.6: Content of the files written by <b><tt>data_extractor.x</tt></b>. n is the total number of states, j is a state index (j &#8712; {1..n}).</div>
  <a id="tab:outputdata">
</a>
<table>
<tr><td align="left">File  </td><td align="left"># Columns     </td><td colspan="2" align="left">Columns</td></tr>
<tr><td align="left">energy.out       </td><td align="left">4+n
      </td><td align="center">1 </td><td align="left">Time t (fs)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">2 </td><td align="left">Kinetic energy (eV)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">3 </td><td align="left">Potential energy (eV) of active state (diagonal)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">4 </td><td align="left">Total energy (eV)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">4+j </td><td align="left">Potential energy (eV) of state j (diagonal)</td></tr>
<tr><td align="left">fosc.out       </td><td align="left">2+n
      </td><td align="center">1 </td><td align="left">Time t (fs)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">2 </td><td align="left">Oscillator strength from lowest to active state (diagonal)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">2+j </td><td align="left">Oscillator strength from lowest state to state j (diagonal)</td></tr>
<tr><td align="left">fosc_act.out       </td><td align="left">1+2n
      </td><td align="center">1 </td><td align="left">Time t (fs)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">1+j </td><td align="left">E<sub>j</sub>&#8722;E<sub>active</sub> (in eV, diagonal)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">1+n+j </td><td align="left">Oscillator strength from active state to state j (diagonal)</td></tr>
<tr><td align="left">spin.out       </td><td align="left">2+n
      </td><td align="center">1 </td><td align="left">Time t (fs)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">2 </td><td align="left">Total spin expectation value of active state</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">2+j </td><td align="left">Total spin expectation value of state j</td></tr>
<tr><td align="left">coeff_diag.out       </td><td align="left">2+2n
      </td><td align="center">1 </td><td align="left">Time t (fs)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">2 </td><td align="left">Norm of wave function &#8721;<sub>j</sub> &#124;c<sub>j</sub><sup>diag</sup>&#124;<sup>2</sup></td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">1+2j </td><td align="left">&#8476;(c<sub>j</sub><sup>diag</sup>)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">2+2j </td><td align="left">&#8465;(c<sub>j</sub><sup>diag</sup>)</td></tr>
<tr><td align="left">coeff_MCH.out       </td><td align="left">2+2n
      </td><td align="center">1 </td><td align="left">Time t (fs)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">2 </td><td align="left">Norm of wave function &#8721;<sub>j</sub> &#124;c<sub>j</sub><sup>MCH</sup>&#124;<sup>2</sup></td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">1+2j </td><td align="left">&#8476;(c<sub>j</sub><sup>MCH</sup>)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">2+2j </td><td align="left">&#8465;(c<sub>j</sub><sup>MCH</sup>)</td></tr>
<tr><td align="left">coeff_diab.out       </td><td align="left">2+2n
      </td><td align="center">1 </td><td align="left">Time t (fs)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">2 </td><td align="left">Norm of wave function &#8721;<sub>j</sub> &#124;c<sub>j</sub><sup>diab</sup>&#124;<sup>2</sup></td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">1+2j </td><td align="left">&#8476;(c<sub>j</sub><sup>diab</sup>)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">2+2j </td><td align="left">&#8465;(c<sub>j</sub><sup>diab</sup>)</td></tr>
<tr><td align="left">prob.out       </td><td align="left">2+n
      </td><td align="center">1 </td><td align="left">Time t (fs)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">2 </td><td align="left">Random number from surface hopping</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">2+j </td><td align="left">Cumulated hopping probability &#8721;<sub>k=1</sub><sup>j</sup> P<sub>k</sub></td></tr>
<tr><td align="left">expec.out      </td><td align="left">4+3n
      </td><td align="center">1 </td><td align="left">Time t (fs)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">2 </td><td align="left">Kinetic energy (eV)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">3 </td><td align="left">Potential energy (eV) of active state (diagonal)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">4 </td><td align="left">Total energy (eV)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">4+j </td><td align="left">Potential energy (eV) of state j (diagonal)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">4+n+j </td><td align="left">Total spin expectation value of state j (diagonal)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">4+2n+j </td><td align="left">Oscillator strength of state j (diagonal)</td></tr>
<tr><td align="left">expec_MCH.out      </td><td align="left">4+3n
      </td><td align="center">1 </td><td align="left">Time t (fs)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">2 </td><td align="left">Kinetic energy (eV)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">3 </td><td align="left">Potential energy (eV) of approximate active state (MCH)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">4 </td><td align="left">Total energy (eV)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">4+j </td><td align="left">Potential energy (eV) of state j (MCH)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">4+n+j </td><td align="left">Total spin expectation value of state j (MCH)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">4+2n+j </td><td align="left">Oscillator strength of state j (MCH)</td></tr>
<tr><td align="left">ion_diag.out      </td><td align="left">4+3n
      </td><td align="center">1 </td><td align="left">Time t (fs)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">1+j </td><td align="left">E<sub>j</sub>&#8722;E<sub>active</sub> (in eV, diagonal)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">1+n+j </td><td align="left">Dyson norm from active state to state j (diagonal)</td></tr>
<tr><td align="left">ion_MCH.out      </td><td align="left">4+3n
      </td><td align="center">1 </td><td align="left">Time t (fs)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">1+j </td><td align="left">E<sub>j</sub>&#8722;E<sub>approximate active</sub> (in eV, mCH)</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center">1+n+j </td><td align="left">Dyson norm from approximate active state to state j (MCH)</td></tr></table>
</div>
<div class="p"><!----></div>
The output of  S<span style="font-size:x-small">HARC</span>&nbsp;is mainly written to <b><tt>output.dat</tt></b>. In order to obtain plottable files in tabular format, the Fortran program <b><tt>data_extractor.x</tt></b> is used.
<div class="p"><!----></div>
     <a id="tth_sEc7.10.1"></a><h3>
7.10.1&nbsp;&nbsp;Usage</h3>
<div class="p"><!----></div>
The <b><tt>data_extractor.x</tt></b> is a command line tool, and is called with the <b><tt>output.dat</tt></b> file as an argument, and possibly with some options.
<pre>
user@host&#62;&nbsp;$SHARC/data_extractor.x&nbsp;[options]&nbsp;output.dat
</pre>
The program will create a directory <b><tt>output_data/</tt></b> in the current working directory (not necessarily in the directory where <b><tt>output.dat</tt></b> resides). In this directory, several files are written, containing, e.g., the potential energies depending on time, populations depending on time, etc.
Which files are created can be controlled with the command line options, which are summarized in Table&nbsp;<a href="#tab:dataextractor_options"> 7.5</a>. For most applications, using the <b><tt>-z</tt></b> or <b><tt>-s</tt></b> flags should be sufficient. The default is equivalent to <b><tt>-s</tt></b>.
<div class="p"><!----></div>
The program will extract the complete <b><tt>output.dat</tt></b> file until it reaches the EOF. 
<div class="p"><!----></div>
The <b><tt>data_extractor.x</tt></b> program will automatically detect the format of the <b><tt>output.dat</tt></b> file (the first  S<span style="font-size:x-small">HARC</span>&nbsp;release had a different file format than the current  S<span style="font-size:x-small">HARC</span>&nbsp;release).
<div class="p"><!----></div>
     <a id="tth_sEc7.10.2"></a><h3>
7.10.2&nbsp;&nbsp;Output</h3>
<div class="p"><!----></div>
After the program finishes, the directory <b><tt>output_data/</tt></b> contains a number of files. In each file, the number of columns is dependent in the total number n of states i &#8712; {1...n}. The content of the files is listed in Table&nbsp;<a href="#tab:outputdata"> 7.6</a>.
<div class="p"><!----></div>
The file <b><tt>expec.out</tt></b> contains the information of <b><tt>energy.out</tt></b>, <b><tt>spin.out</tt></b> and <b><tt>fosc.out</tt></b> in one file. The content of <b><tt>expec.out</tt></b> can be conveniently plotted by using <b><tt>make_gnuscript.py</tt></b> to generate a  G<span style="font-size:x-small">NUPLOT</span> script.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc7.11"></a><h2>
7.11&nbsp;&nbsp;Plotting the Extracted Data: <b><tt>make_gnuscript.py</tt></b></h2><a id="sec:make_gnuscript.py">
</a>
<div class="p"><!----></div>
The contents of the output files of <b><tt>data_extractor.x</tt></b> can be plotted with  G<span style="font-size:x-small">NUPLOT</span>. In order to quickly generate an appropriate  G<span style="font-size:x-small">NUPLOT</span> script, <b><tt>make_gnuscript.py</tt></b> can be used. The usage is:
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/make_gnuscript.py&nbsp;&lt;S&#62;&nbsp;[&lt;D&#62;&nbsp;[&lt;T&#62;&nbsp;[&lt;Q&#62;&nbsp;...&nbsp;]&nbsp;]&nbsp;]
</pre>
<b><tt>make_gnuscript.py</tt></b> takes between 1 and 8 integers as command-line arguments, specifying the number of singlet, doublet, triplet, etc.&nbsp;states. It writes an appropriate  G<span style="font-size:x-small">NUPLOT</span> script to standard out, hence redirect the output to a file, e.g.:
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/make_gnuscript.py&nbsp;3&nbsp;0&nbsp;2&nbsp;&#62;&nbsp;gnuscript.gp
</pre>
<div class="p"><!----></div>
Then,  G<span style="font-size:x-small">NUPLOT</span> can be run in the <b><tt>output_data</tt></b> directory of a trajectory:
<pre>
user@host&#62;&nbsp;gnuplot&nbsp;gnuscript.gp
</pre>
This can also be accomplished in one step using a pipe, e.g.:
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/make_gnuscript.py&nbsp;3&nbsp;0&nbsp;2&nbsp;|&nbsp;gnuplot
</pre>
<div class="p"><!----></div>
The created plot script generates four different plots (press ENTER in the command-line where you started  G<span style="font-size:x-small">NUPLOT</span> to go to the next plot). The first plot shows the potential energy of all states in the dynamics over time in the diagonal representation. The currently occupied state is marked with black circles. A thin black line gives the total energy (sum of the kinetic energy and the potential energy of the currently occupied state). Each state is colored, with one color as contour and one color at the core of the line. The contour color represents the total spin expectation value of the state. The core color represents the oscillator strength of the state with the lowest state. See figure&nbsp;<a href="#fig:colors"> 7.3</a> for the relevant color code.
<div class="p"><!----></div>
<a id="tth_fIg7.3">
</a>   <div style="text-align:center">  <img src="http://sharc-md.org/wp-content/uploads/2018/02/colors.png">  
<div style="text-align:center">Figure 7.3: Color code for plots generated with the use of <b><tt>make_gnuscript.py</tt></b>.</div>
  <a id="fig:colors">
</a>
</div>
<div class="p"><!----></div>
Note that by definition the "oscillator strength" of the lowest state with itself is exactly zero, hence the lowest state is also light grey. This dual coloring allows for a quick recognition of different types of states in the dynamics, e.g.&nbsp;singlets vs.&nbsp;triplets or n&#960;<sup>*</sup> vs.&nbsp;&#960;&#960;<sup>*</sup> states.
<div class="p"><!----></div>
The second plot shows the population &#124;c<sub>i</sub><sup>MCH</sup>&#124;<sup>2</sup> of the MCH electronic states over time. The line colors are auto-generated in order to give a large spread of all colors over the excited states, but the colors might be sub-optimal, e.g.&nbsp;for printing. In this cases, the user should manually adjust the colors in the generated script.
<div class="p"><!----></div>
The third plot shows the population &#124;c<sub>i</sub><sup>diag</sup>&#124;<sup>2</sup> of the diagonal electronic states over time. These are the populations which are actually used for surface hopping. However, since these states are spin-mixed, it is usually difficult to interpret these populations.
<div class="p"><!----></div>
The fourth plot shows the surface hopping probabilities over time. The plot is setup in such a way that the visible area corresponding to a certain state is proportional to the probability to hop into the state. Hence, if for a given time step the random number (black circles) lies within a colored area, a surface hop to the corresponding state is performed.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc7.12"></a><h2>
7.12&nbsp;&nbsp;Ensemble Diagnostics Tool: <b><tt>diagnostics.py</tt></b></h2><a id="sec:diagnostics.py">
</a>
<div class="p"><!----></div>
The purpose of this script is to automatize the critical step of checking the trajectories in an ensemble for sanity before beginning the ensemble analysis.
<div class="p"><!----></div>
The tool can check several different aspects of the trajectories.
First, it checks whether all relevant output files of the trajectories are present, and if they are complete and consistent (e.g., no missing lines due to network/file system problems).
Second, it checks simulation progress and status (e.g., whether the trajectory is running, crashed, finished, or stopped).
Third, it can check several energy-related requirements: total energy conservation, smoothness of kinetic and potential energy, and hopping energy differences.
It also checks for conservation of total population, and for trajectories using local diabatization also intruder states are checked.
<div class="p"><!----></div>
Note that the diagnostics script can also be used to automatically run the <b><tt>data_extractor.x</tt></b> for all trajectories.
<div class="p"><!----></div>
Also note that <b><tt>diagnostics.py</tt></b> will not work if the <b><tt>printlevel</tt></b> in the  S<span style="font-size:x-small">HARC</span>&nbsp;trajectories was lower than 2.
<div class="p"><!----></div>
     <a id="tth_sEc7.12.1"></a><h3>
7.12.1&nbsp;&nbsp;Usage</h3>
<div class="p"><!----></div>
The script is interactive, simply start it with no command-line arguments or options:
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/diagnostics.py
</pre>
<div class="p"><!----></div>
     <a id="tth_sEc7.12.2"></a><h3>
7.12.2&nbsp;&nbsp;Input</h3>
<div class="p"><!----></div>
<b>Paths to trajectories&nbsp;&nbsp;</b>
<div class="p"><!----></div>
First the script asks the user to specify all directories for whose content the analysis should be performed. Enter one directory path at a time, and finish the directory input section by typing "<b><tt>end</tt></b>". Please do not specify each trajectory directory separately, but specify their parent directories, e.g.&nbsp;the directories <b><tt>Singlet_1</tt></b> and <b><tt>Singlet_2</tt></b>. <b><tt>diagnostics.py</tt></b> will automatically include all trajectories contained in these directories.
<div class="p"><!----></div>
Unlike the ensemble analysis scripts (these are <b><tt>populations.py</tt></b>, <b><tt>transition.py</tt></b>, <b><tt>crossing.py</tt></b>, <b><tt>trajana_essdyn.py</tt></b>, <b><tt>trajana_nma.py</tt></b>, and <b><tt>data_collector.py</tt></b>, see below), <b><tt>diagnostics.py</tt></b> ignores files which indicate the status of a trajectory (<b><tt>CRASHED</tt></b>, <b><tt>RUNNING</tt></b>, <b><tt>DONT_ANALYZE</tt></b>) and carries out the diagnostics routines as long as it identifies a directory as a  S<span style="font-size:x-small">HARC</span>&nbsp;trajectory.
<div class="p"><!----></div>
<b>Settings&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The settings for the diagnostics run can be modified with a simple menu, which can be navigated with the commands <b><tt>show</tt></b>, <b><tt>help</tt></b>, <b><tt>end</tt></b>, and where the settings can be modified with <b><tt>&lt;key&#62; &lt;value&#62;</tt></b> (e.g., <b><tt>hop_energy 0.2</tt></b> sets the corresponding option to 0.2&nbsp;eV).
A list of the settings is given in Table&nbsp;<a href="#tab:diagnostics"> 7.7</a>.
<div class="p"><!----></div>
Generally, the keywords <b><tt>missing_output</tt></b>, <b><tt>missing_restart</tt></b>, and <b><tt>normal_termination</tt></b> should always be left at <b><tt>True</tt></b>, since checking them is cheap and the obtained information is important.
Note that <b><tt>data_extractor.x</tt></b> is always run for all trajectories, except if <b><tt>output.dat</tt></b> is older than the files in <b><tt>output_data/</tt></b>.
During the check of each trajectory, <b><tt>output.lis</tt></b>, <b><tt>output_data/energies.out</tt></b>, and <b><tt>output_data/coeff_diag.out</tt></b> are furthermore checked for missing time steps.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb7.7">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 7.7: List of the settings for <b><tt>diagnostics.py</tt></b>.</div>
  <a id="tab:diagnostics">
</a>
<table>
<tr><td align="left">Key  </td><td align="left">Value     </td><td align="center">Explanation</td></tr>
<tr><td align="left">missing_output     </td><td align="left">Boolean        </td><td align="center">Checks if &#246;utput.lis", &#246;utput.log", &#246;utput.xyz", &#246;utput.dat" are existing. Setting to <b><tt>False</tt></b> only suppresses output, but files are always checked.</td></tr>
<tr><td align="left">missing_restart    </td><td align="left">Boolean        </td><td align="center">Checks if "restart.ctrl", "restart.traj", "restart/" are existing. Files are not checked if set to <b><tt>False</tt></b>.</td></tr>
<tr><td align="left">normal_termination </td><td align="left">Boolean        </td><td align="center">Checks for status of trajectory:</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center"><b><tt>RUNNING</tt></b>: no finish message in <b><tt>output.log</tt></b>, last step started recently.</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center"><b><tt>STUCK</tt></b>: no finish message in <b><tt>output.log</tt></b>, last step started long ago.</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center"><b><tt>CRASHED</tt></b>: error message in <b><tt>output.log</tt></b>.</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center"><b><tt>FINISHED</tt></b>: finish message in <b><tt>output.log</tt></b>.</td></tr>
<tr><td align="left"></td><td align="left"></td><td align="center"><b><tt>FINISHED (stopped by user)</tt></b>: finished due to <b><tt>STOP</tt></b> file.</td></tr>
<tr><td align="left">etot_window        </td><td align="left">Float          </td><td align="center">Maximum permissible drift (along full trajectory) in the total energy (in eV).</td></tr>
<tr><td align="left">etot_step          </td><td align="left">Float          </td><td align="center">Maximum permissible total energy difference between two successive time steps (in eV).</td></tr>
<tr><td align="left">epot_step          </td><td align="left">Float          </td><td align="center">Maximum permissible active state potential energy difference between two successive time steps (in eV). Not checked for time steps where a hop occurred.</td></tr>
<tr><td align="left">ekin_step          </td><td align="left">Float          </td><td align="center">Maximum permissible kinetic energy difference between two successive time steps (in eV).</td></tr>
<tr><td align="left">pop_window         </td><td align="left">Float          </td><td align="center">Maximum permissible drift in total population.</td></tr>
<tr><td align="left">hop_energy         </td><td align="left">Float          </td><td align="center">Maximum permissible change in active state energy during a surface hop (in eV).</td></tr>
<tr><td align="left">intruders           </td><td align="left">Boolean        </td><td align="center">Checks if intruder state messages in &#246;utput.log" refer to active state.</td></tr></table>
</div>
<div class="p"><!----></div>
<b>Trajectory Flagging&nbsp;&nbsp;</b>
<div class="p"><!----></div>
<b><tt>diagnostics.py</tt></b> determines for each trajectory a "maximum usable time" value (T<sub>mu</sub>).
This value is either the total simulation time or the time when the first violation (problems with time step consistency, total energy conservation, potential/kinetic energy smoothness, hopping energy restriction, or intruder states) in the trajectory appeared.
The script prints the T<sub>mu</sub> values for all trajectories at the end.
<div class="p"><!----></div>
The user can then give a threshold for T<sub>mu</sub>, so that <b><tt>diagnostics.py</tt></b> excludes all trajectories with values smaller than the threshold from analysis (the script will create a file <b><tt>DONT_ANALYZE</tt></b> in the directory of each affected trajectory).
In this way it is possible to perform ensemble analysis for a given simulation length while ignoring problematic trajectories.
<div class="p"><!----></div>
When choosing the threshold for T<sub>mu</sub>, keep in mind that a compromise usually has to be made.
A small value of the threshold will mean that many trajectories are admitted for analysis (because problems occurring late do not matter), giving good statistics, but that the analysis can only be carried out for the first part of the simulation time.
On the other hand, choosing a large threshold allows analysis of a satisfactory simulation time, but only few trajectories will be included in the analysis (only the ones where no problems occurred for many time steps).
<div class="p"><!----></div>
It is advisable that the chosen threshold value is used as input for the ensemble analysis scripts which ask for a maximum analysis time (<b><tt>populations.py</tt></b>, <b><tt>transition.py</tt></b>, <b><tt>crossing.py</tt></b>, <b><tt>trajana_essdyn.py</tt></b>, <b><tt>trajana_nma.py</tt></b>).
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc7.13"></a><h2>
7.13&nbsp;&nbsp;Calculation of Ensemble Populations: <b><tt>populations.py</tt></b></h2><a id="sec:populations.py">
</a>
<div class="p"><!----></div>
For an ensemble of trajectories, usually one of the most relevant results are ensemble-averaged populations. The interactive script <b><tt>populations.py</tt></b> collects these populations from a set of trajectories. 
<div class="p"><!----></div>
Different methods to obtain populations or quantities approximating populations can be collected, as described below.
<div class="p"><!----></div>
     <a id="tth_sEc7.13.1"></a><h3>
7.13.1&nbsp;&nbsp;Usage</h3>
<div class="p"><!----></div>
The script is interactive, simply start it with no command-line arguments or options:
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/populations.py
</pre>
<div class="p"><!----></div>
Depending on the analysis mode (see below) it might be necessary to run <b><tt>data_extractor.x</tt></b> for each trajectory prior to running <b><tt>populations.py</tt></b> (but <b><tt>populations.py</tt></b> can also call <b><tt>data_extractor.x</tt></b> for each subdirectory, if desired). 
<div class="p"><!----></div>
<b>Paths to trajectories&nbsp;&nbsp;</b>
<div class="p"><!----></div>
First, the script asks the user to specify all directories for whose content the analysis should be performed. Enter one directory path at a time, and finish the directory input section by typing "<b><tt>end</tt></b>". Please do not specify each trajectory directory separately, but specify their parent directories, e.g.&nbsp;the directories <b><tt>Singlet_1</tt></b> and <b><tt>Singlet_2</tt></b>. <b><tt>populations.py</tt></b> will automatically include all trajectories contained in these directories.
<div class="p"><!----></div>
If you want to exclude certain trajectories from the analysis, it is sufficient to create an empty file called <b><tt>CRASHED</tt></b> or <b><tt>RUNNING</tt></b> in the corresponding trajectory directory. <b><tt>populations.py</tt></b> will ignore all directories containing one of these files. The file name is case insensitive, i.e., also files like <b><tt>crashed</tt></b> or even <b><tt>cRasHED</tt></b> will lead to the trajectory being ignored.
Additionally, <b><tt>populations.py</tt></b> will ignore trajectories with a <b><tt>DONT_ANALYZE</tt></b> file from <b><tt>diagnostics.py</tt></b>.
<div class="p"><!----></div>
<b>Analysis mode&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Using <b><tt>populations.py</tt></b>, there are two basic ways in obtaining the excited-state populations. The first way is to count the number of trajectories for which a certain condition holds. For example, the number of trajectories in each classical state can be obtained in this way. However, it is also possible to count the number of trajectories for which the total spin expectation value is within a certain interval. 
The second way to obtain populations is to obtain the sum of the absolute squares of the quantum amplitudes over all trajectories. Table&nbsp;<a href="#tab:Populations_modes"> 7.8</a> contains a list of all possible analysis modes.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb7.8">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 7.8: Analysis modes for <b><tt>populations.py</tt></b>. The last column indicates whether <b><tt>data_extractor.x</tt></b> has to be run prior to the ensemble analysis.</div>
  <a id="tab:Populations_modes">
</a>
<table>
<tr><td align="left">Mode        </td><td width="335">Description    </td><td align="left"><span class="roman">From which file?     </td><td align="left">Extract?</td></tr>
<tr><td align="left">1   </td><td width="335">For each diagonal state count how many trajectories have this state as active state. </td><td align="left">output.lis  </td><td align="left">No</td></tr>
<tr><td align="left">2   </td><td width="335">For each MCH state count how many trajectories have this state as approximate active state (see section&nbsp;<a href="#ssec:state_transform">8.19.1</a>). </td><td align="left">output.lis  </td><td align="left">No</td></tr>
<tr><td align="left">3   </td><td width="335">For each MCH state count how many trajectories have this state as approximate active state (see section&nbsp;<a href="#ssec:state_transform">8.19.1</a>). Multiplet components are summed up. </td><td align="left">output.lis  </td><td align="left">No</td></tr>
<tr><td align="left">4   </td><td width="335">Generate a histogram with definable bins (variable width). Bin the trajectories according to their total spin expectation value (of the currently active diagonal state).   </td><td align="left">output.lis </td><td align="left">No</td></tr>
<tr><td align="left">5   </td><td width="335">Generate a histogram with definable bins (variable width). Bin the trajectories according to their state dipole moment expectation value (of the currently active diagonal state).   </td><td align="left">output.lis </td><td align="left">No</td></tr>
<tr><td align="left">6   </td><td width="335">Generate a histogram with definable bins (variable width). Bin the trajectories according to the oscillator strength between lowest and currently active diagonal states.        </td><td align="left">output_data/fosc.out  </td><td align="left">Yes</td></tr>
<tr><td align="left">7   </td><td width="335">Calculate the sum of the absolute squares of the diagonal coefficients for each state.       </td><td align="left">output_data/coeff_diag.out</td><td align="left">Yes</td></tr>
<tr><td align="left">8   </td><td width="335">Calculate the sum of the absolute squares of the MCH coefficients for each state.       </td><td align="left">output_data/coeff_MCH.out</td><td align="left">Yes</td></tr>
<tr><td align="left">9   </td><td width="335">Calculate the sum of the absolute squares of the MCH coefficients for each state. Multiplet components are summed up.       </td><td align="left">output_data/coeff_MCH.out</td><td align="left">Yes</td></tr>
<tr><td align="left">10   </td><td width="335">Transform option 1 to MCH basis (trajectory-wise transformation with <b>U</b> matrix).   </td><td align="left">output.dat</td><td align="left">No</td></tr>
<tr><td align="left">11   </td><td width="335">Transform option 1 to MCH basis (trajectory-wise transformation with <b>U</b> matrix). Multiplet components are summed up.   </td><td align="left">output.dat</td><td align="left">No</td></tr>
<tr><td align="left">20   </td><td width="335">Calculate the sum of the absolute squares of the diabatic coefficients for each state (Only for trajectories with local diabatization).      </td><td align="left">output_data/coeff_diab.out</td><td align="left">Yes</td></tr></span></table>
</div>
<div class="p"><!----></div>
<b>Run data extractor&nbsp;&nbsp;</b>
<div class="p"><!----></div>
For analysis modes 6, 7, 8, 9 and 20 it is necessary to first run the data extractor (see section&nbsp;<a href="#sec:data_extractor.x">7.10</a>). This task can be accomplished by <b><tt>populations.py</tt></b>. However, for a large ensemble or for long trajectories this may take some time. Hence, it is not necessary to perform this step each time <b><tt>populations.py</tt></b> is run. 
<div class="p"><!----></div>
<b><tt>populations.py</tt></b> will detect whether the file <b><tt>output.dat</tt></b> or the content of <b><tt>output_data/</tt></b> is more recent. Only if <b><tt>output.dat</tt></b> is newer the <b><tt>data_extractor.x</tt></b> will be run for this trajectory.
<div class="p"><!----></div>
Note that mode 20 can only be used for trajectories using local diabatization propagation (keyword <b><tt>coupling overlap</tt></b> in  S<span style="font-size:x-small">HARC</span>&nbsp;input file) or .
<div class="p"><!----></div>
<b>Number of states&nbsp;&nbsp;</b>
<div class="p"><!----></div>
For analysis modes 1, 2, 3, 7, 8 and 9 it is necessary to specify the number of states in each multiplicity. The number is auto-detected from the input file of one of the trajectories.
<div class="p"><!----></div>
<b>Intervals&nbsp;&nbsp;</b>
<div class="p"><!----></div>
For analysis modes 4, 5 and 6 the user must specify the intervals (i.e., the histogram bins) for the classification of the trajectories. The user has to input a list of interval borders, e.g.:
<pre>
Please&nbsp;enter&nbsp;the&nbsp;interval&nbsp;limits,&nbsp;all&nbsp;on&nbsp;one&nbsp;line.
Interval&nbsp;limits:&nbsp;1e-3&nbsp;0.01&nbsp;0.1&nbsp;1
</pre>
<div class="p"><!----></div>
Note that scientific notation can be used. Based on this input, for each time step a histogram is created with the number of trajectories in each interval. The histogram bins are:
<ol type="1">
<li> x &#8804; 10<sup>&#8722;3</sup>
<div class="p"><!----></div>
</li>
<li> 10<sup>&#8722;3</sup> &lt; x &#8804; 0.01
<div class="p"><!----></div>
</li>
<li> 0.01 &lt; x &#8804; 0.1
<div class="p"><!----></div>
</li>
<li> 0.1 &lt; x &#8804; 1
<div class="p"><!----></div>
</li>
<li> 1 &lt; x
<div class="p"><!----></div>
</li>
</ol>
Note that there is always one more bin that interval borders entered.
<div class="p"><!----></div>
<b>Normalization&nbsp;&nbsp;</b>
<div class="p"><!----></div>
If desired, <b><tt>populations.py</tt></b> can normalize the populations by dividing the populations by the number of trajectories. 
<div class="p"><!----></div>
<b>Maximum simulation time&nbsp;&nbsp;</b>
<div class="p"><!----></div>
This gives the maximum simulation time until which the populations are analyzed. For trajectories which are shorter than this value, the last population information is used to make the trajectory long enough. Trajectories which are longer are not analyzed to the end. <b><tt>populations.py</tt></b> prints the length of the shortest and longest trajectories after the analysis.
<div class="p"><!----></div>
If <b><tt>diagnostics.py</tt></b> was executed previously, the user can enter here the threshold for the maximum usable time (see section&nbsp;<a href="#sec:diagnostics.py">7.12</a>).
<div class="p"><!----></div>
<b>Setup for bootstrapping&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The output file of <b><tt>populations.py</tt></b> is sufficient to perform kinetic model fits with the script <b><tt>make_fitscript.py</tt></b>.
However, if error estimates for the kinetic model are desired (using <b><tt>bootstrap.py</tt></b>), the output file of <b><tt>populations.py</tt></b> is not enough.
The user can tell <b><tt>populations.py</tt></b> to save additional data which is required by <b><tt>bootstrap.py</tt></b>.
<div class="p"><!----></div>
<b>Gnuplot script&nbsp;&nbsp;</b>
<div class="p"><!----></div>
<b><tt>populations.py</tt></b> can generate an appropriate  G<span style="font-size:x-small">NUPLOT</span> script for the performed population analysis. 
<div class="p"><!----></div>
     <a id="tth_sEc7.13.2"></a><h3>
7.13.2&nbsp;&nbsp;Output</h3>
<div class="p"><!----></div>
By default, <b><tt>populations.py</tt></b> writes the resulting populations to <b><tt>pop.out</tt></b>. If the file already exists, the user is ask whether it shall be overwritten, or to provide an alternative filename. Note that the output file is checked only after the analysis is completed, so the program might run for a considerable amount of time before asking for the output file.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc7.14"></a><h2>
7.14&nbsp;&nbsp;Calculation of Numbers of Hops: <b><tt>transition.py</tt></b></h2><a id="sec:transition.py">
</a>
<div class="p"><!----></div>
Another important information from the trajectory ensemble is the number of hopping events and the involved states, for example to judge the relative importance of competing reaction pathways.
<div class="p"><!----></div>
The interactive script <b><tt>transition.py</tt></b> calculates from an ensemble the number of hops between each pair of states and presents the results as "transition matrices".
Currently, the script employs the MCH active state information from <b><tt>output.lis</tt></b> for this computations. 
Note that since the MCH active state is only an approximate quantity (since hops are actually performed in the diagonal basis in  S<span style="font-size:x-small">HARC</span>), the results should be checked carefully.
The script <b><tt>transition.py</tt></b> is still partly work-in-progress.
<div class="p"><!----></div>
     <a id="tth_sEc7.14.1"></a><h3>
7.14.1&nbsp;&nbsp;Usage</h3>
<div class="p"><!----></div>
The script is interactive, simply start it with no command-line arguments or options:
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/transition.py
</pre>
<div class="p"><!----></div>
<b>Paths to trajectories&nbsp;&nbsp;</b>
<div class="p"><!----></div>
First the script asks the user to specify all directories for whose content the analysis should be performed. Enter one directory path at a time, and finish the directory input section by typing "<b><tt>end</tt></b>". Please do not specify each trajectory directory separately, but specify their parent directories, e.g.&nbsp;the directories <b><tt>Singlet_1</tt></b> and <b><tt>Singlet_2</tt></b>. <b><tt>populations.py</tt></b> will automatically include all trajectories contained in these directories.
<div class="p"><!----></div>
If you want to exclude certain trajectories from the analysis, it is sufficient to create an empty file called <b><tt>CRASHED</tt></b> or <b><tt>RUNNING</tt></b> in the corresponding trajectory directory. <b><tt>populations.py</tt></b> will ignore all directories containing one of these files. The file name is case insensitive, i.e., also files like <b><tt>crashed</tt></b> or even <b><tt>cRasHED</tt></b> will lead to the trajectory being ignored.
Additionally, <b><tt>transition.py</tt></b> will ignore trajectories with a <b><tt>DONT_ANALYZE</tt></b> file from <b><tt>diagnostics.py</tt></b>.
<div class="p"><!----></div>
<b>Analysis mode&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The different analysis modes for <b><tt>transition.py</tt></b> are given in Table&nbsp;<a href="#tab:Transition_modes"> 7.9</a>.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb7.9">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 7.9: Analysis modes for <b><tt>transition.py</tt></b>. The last column indicates whether <b><tt>data_extractor.x</tt></b> has to be run prior to the ensemble analysis.</div>
  <a id="tab:Transition_modes">
</a>
<table>
<tr><td align="left">Mode        </td><td width="316">Description    </td><td align="left"><span class="roman">From which     </td><td align="left">Extract?</td></tr>
<tr><td align="left"></td><td width="316"></td><td align="left"><span class="roman">file?          </td><td align="left"></td></tr>
<tr><td align="left">1   </td><td width="316">Get transition matrix in MCH basis. </td><td align="left">output.lis  </td><td align="left">No</td></tr>
<tr><td align="left">2   </td><td width="316">Get transition matrix in MCH basis, ignoring hops within multiplets. </td><td align="left">output.lis  </td><td align="left">No</td></tr>
<tr><td align="left">3   </td><td width="316">Write a tabular file with the transition matrix in the MCH basis for each time step. </td><td align="left">output.lis  </td><td align="left">No</td></tr>
<tr><td align="left">4   </td><td width="316">Write a tabular file with the transition matrix in the MCH basis for each time step, ignoring hops within multiplets.   </td><td align="left">output.lis </td><td align="left">No</td></tr></span></span></table>
</div>
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc7.15"></a><h2>
7.15&nbsp;&nbsp;Fitting population data to kinetic models: <b><tt>make_fitscript.py</tt></b></h2><a id="sec:make_fitscript.py">
</a>
<div class="p"><!----></div>
Often it is interesting to fit some functions to the population data from a trajectory ensemble, in order to provide a way to abstract the data and to obtain some kind of rate constants for population transfer, which allows to compare to experimental works.
In simple cases, it might be sufficient to fit basic mono- and biexponential functions to the data, which provides the sought-after time constants.
However, often a more meaningful approach is based on a chemical kinetics model.
Such a model is specified by a set of chemical species (e.g., electronic states, reactants, products, etc) connected by elementary reactions with associated rate constants, which together form a reaction network graph.
For an explanation of those graphs, see section&nbsp;<a href="#met:globalfit">8.9</a>.
<div class="p"><!----></div>
The script <b><tt>make_fitscript.py</tt></b> helps the user in implementing and executing such global fits to a kinetics model.
<div class="p"><!----></div>
The script employs the open-source computer algebra system  M<span style="font-size:x-small">AXIMA</span> as back-end to solve the differential equation systems which describe the model kinetics.
The script writes a  G<span style="font-size:x-small">NUPLOT</span> script containing all commands necessary for the global fit. 
The fitting itself is performed with  G<span style="font-size:x-small">NUPLOT</span>.
<div class="p"><!----></div>
     <a id="tth_sEc7.15.1"></a><h3>
7.15.1&nbsp;&nbsp;Usage</h3>
<div class="p"><!----></div>
The script is interactive, simply start it with no command-line arguments or options:
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/make_fitscript.py
</pre>
<div class="p"><!----></div>
Before you start the script, you need to prepare a file with the relevant populations data (usually, the output file of <b><tt>populations.py</tt></b> will suffice).
You also might want to run <b><tt>transition.py</tt></b> first, which can help in developing a suitable kinetic model.
<div class="p"><!----></div>
     <a id="tth_sEc7.15.2"></a><h3>
7.15.2&nbsp;&nbsp;Input</h3>
<div class="p"><!----></div>
The interactive input for this script consists of specifying the reaction network graph, the initial conditions and the data file.
Additionally, the user has to specify which species should be fitted to which data columns in the file.
<div class="p"><!----></div>
<b>Kinetic model species&nbsp;&nbsp;</b>
<div class="p"><!----></div>
As a first step, the user has to specify the set of species in the model.
Each species is fully described by its label.
A label must start with a letter and can be followed by letters, numbers and underscores (although an underscore must not be directly followed by another underscore).
<div class="p"><!----></div>
During input, the user can add one or several labels to the set of species, remove labels and display the current set of defined labels.
It is not possible to add a label twice.
Once all labels are defined, the keyword <b><tt>end</tt></b> brings the user to the next input section (hence, <b><tt>end</tt></b> is not a valid label).
<div class="p"><!----></div>
<b>Kinetic model elementary reactions&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Next, the reactions have to be defined.
A reaction is specified by its initial species, final species, and reaction rate label.
Reaction rate labels are under the same restrictions as species labels and must not be already used as a species label.
Furthermore, initial and final species must be both defined previously and they must be different.
There can only be one reaction from any species to another species (If a second reaction is defined, the first reaction label is simply overwritten).
<div class="p"><!----></div>
During input, the user can add and remove reactions and display the currently defined reactions (displayed as a matrix).
Unlike species labels, only one reaction can be added per line.
Once all reactions are defined, the keyword <b><tt>end</tt></b> brings the user to the next input section.
<div class="p"><!----></div>
<b>Kinetic model initial values&nbsp;&nbsp;</b>
<div class="p"><!----></div>
In order to specify the initial values for each species, the user simply has to define which species have non-zero initial population.
These species will then be assigned an initial population constant (e.g., for species <b><tt>A</tt></b> the initial population constant would be <b><tt>A__0</tt></b>).
These constants will show up in the  G<span style="font-size:x-small">NUPLOT</span> script and their value can edited there.
It is also possible to fit the initial populations to the data.
<div class="p"><!----></div>
During input, the user can add and remove species from the set of species with non-zero initial population.
Once all reactions are defined, the keyword <b><tt>end</tt></b> brings the user to the next input section.
<div class="p"><!----></div>
<b>Populations data file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The user has to specify a path (autocomplete is enabled) to the file containing the population data to which the model functions should be fitted.
The script reads the file and automatically detects the maximum time and the number of data columns.
<div class="p"><!----></div>
The file should be formatted as a table, with one time step per line (e.g., an output file of <b><tt>populations.py</tt></b>). 
On each line, the first number is interpreted as the time in femtoseconds and all consecutive numbers (separated by spaces) as the populations at this time.
Note that the first entry must be at t=0 and all subsequent lines must be in strictly increasing order.
Time steps can be unevenly spaced if necessary.
<div class="p"><!----></div>
<b>Species-Data mapping&nbsp;&nbsp;</b>
<div class="p"><!----></div>
In the final setup section, the user has to specify which functions should be fitted to which data column from the data file.
In the simplest case, one species is fitted to a single data column (e.g., the species <b><tt>S0</tt></b> is fitted to data column 2).
However, it is also possible to fit the sum of two species to a column (this can be useful, e.g., to describe biexponential processes) and to fit a species to the sum of several columns (e.g., one can fit to the total triplet population to obtain a total ISC rate constant).
In general, it is also possible to fit sums of species to sums of columns.
<div class="p"><!----></div>
It is not allowed to use one species or one column in more than one mapping.
However, it is possible to leave species or data columns unused in the global fit. 
While unused species still affect the outcome (through the reaction network definitions), unused data columns are simply ignored in the fit.
<div class="p"><!----></div>
During input, the user can add one mapping per line as well as display the current mappings.
If a typo is made, the user can reset the mappings and repeat only the mapping input without the need to repeat the previous input.
Once all mappings are defined, the keyword <b><tt>end</tt></b> finishes the input section.
<div class="p"><!----></div>
<b>Running  M<span style="font-size:x-small">AXIMA</span>&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Before the script attempts to call  M<span style="font-size:x-small">AXIMA</span>, it prints the command to be executed and asks the user for permission to execute.
If permission is denied, the user may enter another command to call maxima.
After permission is granted, the script calls  M<span style="font-size:x-small">AXIMA</span> and waits for up to 30&nbsp;seconds before killing it (this is an error and the script cannot proceed to generate the output files).
If  M<span style="font-size:x-small">AXIMA</span> runs for long durations, often this is due to complicated reaction networks which need additional assumptions (e.g., whether certain linear combinations of rate constants are positive, negative or, zero).
In this cases the script cannot automatically continue, but the user can use the <b><tt>MAXIMA.input</tt></b> and <b><tt>MAXIMA.output</tt></b> files to identify the problem.
<div class="p"><!----></div>
     <a id="tth_sEc7.15.3"></a><h3>
7.15.3&nbsp;&nbsp;Output</h3>
<div class="p"><!----></div>
After successful execution of the script, two files are created, <b><tt>model_fit.dat</tt></b> and <b><tt>model_fit.gp</tt></b>.
The former file contains the populations data formatted appropriately for the global fit.
The latter file contains the  G<span style="font-size:x-small">NUPLOT</span> script which can be executed by
<pre>
user@host&#62;&nbsp;gnuplot&nbsp;model_fit.gp
</pre>
to perform the global fit.
Please follow the instructions printed by <b><tt>make_fitscript.py</tt></b> at the end of the execution, in particular by adjusting the starting guesses for the fitting parameters (you have to open and edit <b><tt>model_fit.gp</tt></b> for this).
Please do not change the structure of <b><tt>model_fit.gp</tt></b> if you intend to use this file with <b><tt>bootstrap.py</tt></b>.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc7.16"></a><h2>
7.16&nbsp;&nbsp;Estimating Errors of Fits: <b><tt>bootstrap.py</tt></b></h2><a id="sec:bootstrap.py">
</a>
<div class="p"><!----></div>
As was described in section&nbsp;<a href="#sec:make_fitscript.py">7.15</a>, the population data from <b><tt>populations.py</tt></b> can be fitted to a kinetic model to obtain interpretable rate constants.
Often, one is also interested in obtaining an estimate of the error associated to these rate constants, e.g., in order to decide whether enough trajectories were computed.
A possible way to obtain such error estimates is the statistical bootstrapping procedure.
The idea of bootstrapping is to generate <em>resamples</em> of the original ensemble; for an ensemble of n trajectories, one draws n random trajectories with replacement to obtain one resample.
The resample can then be fitted like the original ensemble to obtain a second estimate of the rate constants. 
By generating many resamples, one can thus obtain a "probability" distribution of the rate constants, from which a statistical error measure can be calculated.
For details on these statistical measures, see section&nbsp;<a href="#met:bootstrapping">8.4</a>.
<div class="p"><!----></div>
The script <b><tt>bootstrap.py</tt></b> implements this resampling-fitting-statistics procedure.
It is dependent on the output of <b><tt>populations.py</tt></b> and <b><tt>make_fitscript.py</tt></b>, and employs  G<span style="font-size:x-small">NUPLOT</span> to perform the actual fits.
<div class="p"><!----></div>
     <a id="tth_sEc7.16.1"></a><h3>
7.16.1&nbsp;&nbsp;Usage</h3>
<div class="p"><!----></div>
The script is interactive, simply start it with no command-line arguments or options:
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/bootstrap.py
</pre>
<div class="p"><!----></div>
Before you start the script, you need to run <b><tt>populations.py</tt></b> to generate the bootstrapping data (<b><tt>populations.py</tt></b> asks the related question near the end of the input query).
<div class="p"><!----></div>
Additionally, you need to use <b><tt>make_fitscript.py</tt></b> to generate a  G<span style="font-size:x-small">NUPLOT</span> fitting script. Please, do not modify the script (beyond initial values for the fitting constants), as <b><tt>bootstrap.py</tt></b> relies on the proper format of this file.
It is advisable to create the  G<span style="font-size:x-small">NUPLOT</span> fitting script from one of the files contained in the bootstrap data directory (because then the simulation time is consistent between the fitting script and the bootstrapping data).
<div class="p"><!----></div>
     <a id="tth_sEc7.16.2"></a><h3>
7.16.2&nbsp;&nbsp;Input</h3>
<div class="p"><!----></div>
The interactive input consists in specifying the paths to the bootstrapping data directory (from <b><tt>populations.py</tt></b>), the path to the fitting script, the number of resamples, and some other minor options.
<div class="p"><!----></div>
<b>Path to the bootstrapping data directory&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The user should enter here the path to the directory which was created by <b><tt>populations.py</tt></b> and which contains the bootstrapping raw data (i.e., the populations for each individual trajectory before summing up over the ensemble).
<b><tt>bootstrap.py</tt></b> automatically detects the number of trajectories, time step, number of steps, and number of data columns.
<div class="p"><!----></div>
Note that <b><tt>bootstrap.py</tt></b> only considers files in this directory if their filename starts with <b><tt>pop_</tt></b>.
Also note that <b><tt>bootstrap.py</tt></b> creates a temporary subdirectory inside the bootstrapping data directory as scratch area.
<div class="p"><!----></div>
<b>Number of bootstrapping cycles&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Here, the number of resamples to generate and fit needs to be entered.
The default, 10 resamples, is very small and not sufficient to achieve convergence in the errors for most applications.
It is advisable to employ several hundred or thousand resamples to achieve good statistical convergence.
<div class="p"><!----></div>
Note that the script can be interrupted during the iterations (using <b><tt>Ctrl-C</tt></b>) and then skips to the final analysis, so it is no problem to enter a too large number of cycles.
<div class="p"><!----></div>
<b>Random number generator seed&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The script employs random numbers to generate the random resamples.
For reproducible results, do not use the default option (<b><tt>!</tt></b>), but enter an integer.
<div class="p"><!----></div>
<b>Path to the fitting script&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The user should enter the path to the appropriate  G<span style="font-size:x-small">NUPLOT</span> fitting script, generated with <b><tt>make_fitscript.py</tt></b>.
It is strongly advisable to adjust the initial guesses for the fitting parameters in the script in order to ensure quick and stable convergence of the fits.
Please, do not modify the generated  G<span style="font-size:x-small">NUPLOT</span> script in any other way, as this might break <b><tt>bootstrap.py</tt></b>.
<div class="p"><!----></div>
<b>Command to execute&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Here, the user should enter the command to be used to call  G<span style="font-size:x-small">NUPLOT</span>. In most cases, this will simply be <b><tt>gnuplot</tt></b>, but the user might want to use another installation of  G<span style="font-size:x-small">NUPLOT</span> for the fitting.
<div class="p"><!----></div>
<b>Number of CPUs&nbsp;&nbsp;</b>
<div class="p"><!----></div>
<b><tt>bootstrap.py</tt></b> can be run in parallel mode, where multiple  G<span style="font-size:x-small">NUPLOT</span> processes are employed at the same time.
Currently, this parallelization is not very efficient due to process creation overheads, but for complicated fitting scripts (where each fit takes relatively long), large data sets, or many resamples it can be useful.
<div class="p"><!----></div>
Note that if more than one CPU is used, users should not prematurely terminate <b><tt>bootstrap.py</tt></b> with <b><tt>Ctrl-C</tt></b>, as some of the subprocesses might get stuck and the script will not properly go to the final analysis.
<div class="p"><!----></div>
     <a id="tth_sEc7.16.3"></a><h3>
7.16.3&nbsp;&nbsp;Output</h3>
<div class="p"><!----></div>
During the resample iterations, <b><tt>bootstrap.py</tt></b> prints the current values and errors (geometric mean and geometric standard deviation) of the fitting parameters every few iterations.
In this way, the user can monitor the convergence of these values, to decide whether more iterations are required.
Typically, the values and errors will vary strongly during the first iterations and stabilize later.
The convergence rate is strongly dependent on the fitting model and the data.
<div class="p"><!----></div>
After all iterations are done (or the script is interrupted with <b><tt>Ctrl-C</tt></b>), the script will print a summary of the statistical analysis.
For each fitting parameter (all time constants and all initial populations), the script will list the arithmetic mean and standard deviation (absolute and relative), the geometric mean and standard deviation (separately for + and &#8722;, absolute and relative), and the minimum and maximum values.
The script will also print a histogram with the obtained distribution for each parameter.
For details on these statistical measures, see section&nbsp;<a href="#met:bootstrapping">8.4</a>.
<div class="p"><!----></div>
<b><tt>bootstrap.py</tt></b> also creates two output files.
The first file, <b><tt>bootstrap_cycles.out</tt></b>, is written on-the-fly while the resample iterations are running.
It contains the same tabular output as is shown in standard output, and can be used to visualize the convergence behavior of the parameters. For example, the first parameter can be monitored using  G<span style="font-size:x-small">NUPLOT</span> with this command: <b><tt>plot "bootstrap_cycles.out" using 1:6:8 w yerrorbars</tt></b>.
The scond file, <b><tt>bootstrap.out</tt></b>, is written once the final analysis is complete. It contains the summary of the statistical analysis with the computed statistical measures and the histograms.
Additionally, at the end this file contains a table with all obtained fitting parameters for resamples (e.g., for further statistical or correlation analysis).
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc7.17"></a><h2>
7.17&nbsp;&nbsp;Obtaining Special Geometries: <b><tt>crossing.py</tt></b></h2><a id="sec:crossing.py">
</a>
<div class="p"><!----></div>
In many cases, it is also important to obtain certain special geometries from the trajectories. The script <b><tt>crossing.py</tt></b> extracts geometries fulfilling special conditions from an ensemble of trajectories. 
<div class="p"><!----></div>
Currently, <b><tt>crossing.py</tt></b> finds geometries where the approximate MCH state (see section&nbsp;<a href="#ssec:state_transform">8.19.1</a>) of the last time step is different from the MCH state of the current time step (i.e.&nbsp;<b><tt>crossing.py</tt></b> finds geometries where surface hops occured). 
<div class="p"><!----></div>
     <a id="tth_sEc7.17.1"></a><h3>
7.17.1&nbsp;&nbsp;Usage</h3>
<div class="p"><!----></div>
The script is interactive, simply start it with no command-line arguments or options:
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/crossing.py
</pre>
<div class="p"><!----></div>
The input to the script is very similar to the one of <b><tt>populations.py</tt></b>. 
<div class="p"><!----></div>
<b>Paths to trajectories&nbsp;&nbsp;</b>
<div class="p"><!----></div>
First the script asks the user to specify all directories for whose content the analysis should be performed. Enter one directory path at a time, and finish the directory input section by typing "<b><tt>end</tt></b>". Please do not specify each trajectory directory separately, but specify their parent directories, e.g.&nbsp;the directories <b><tt>Singlet_1</tt></b> and <b><tt>Singlet_2</tt></b>. <b><tt>crossing.py</tt></b> will automatically include all trajectories contained in these directories.
<div class="p"><!----></div>
If you want to exclude certain trajectories from the analysis, it is sufficient to create an empty file called <b><tt>CRASHED</tt></b> or <b><tt>RUNNING</tt></b> in the corresponding trajectory directory. <b><tt>crossing.py</tt></b> will ignore all directories containing one of these files.
Additionally, <b><tt>crossing.py</tt></b> will ignore trajectories with a <b><tt>DONT_ANALYZE</tt></b> file from <b><tt>diagnostics.py</tt></b>.
<div class="p"><!----></div>
<b>Analysis mode&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Currently, <b><tt>crossing.py</tt></b> only supports one analysis mode, where <b><tt>crossing.py</tt></b> is scanning for each trajectory the file <b><tt>output.lis</tt></b>. If the occupied MCH state (column 4 in output file <b><tt>output.lis</tt></b>) changes from one time step to the next, it is checked whether the old and new MCH states are the ones specified by the user. If this is the case, the geometry corresponding to the new time step (t) is retrieved from <b><tt>output.xyz</tt></b> (lines t(n<sub>atom</sub>+2)+1 to t(n<sub>atom</sub>+2)+n<sub>atom</sub>). 
<div class="p"><!----></div>
<b>States involved in surface hop&nbsp;&nbsp;</b>
<div class="p"><!----></div>
First, the user has to specify the permissible old MCH state. The state has to be specified with two integers, the first giving the multiplicity (<b><tt>1</tt></b>=singlet, ...), the second the state within the multiplicity (<b><tt>1 1</tt></b>=S<sub>0</sub>, <b><tt>1 2</tt></b>=S<sub>1</sub>, etc.). If a state of higher multiplicity is given, <b><tt>crossing.py</tt></b> will report all geometries where the old MCH state is any of the multiplet components. 
<div class="p"><!----></div>
For the new MCH state, the same is valid.
<div class="p"><!----></div>
Third, the direction of the surface hop has to be specified. Choosing "Backwards" has the same effect as exchanging the old and new MCH states. 
<div class="p"><!----></div>
     <a id="tth_sEc7.17.2"></a><h3>
7.17.2&nbsp;&nbsp;Output</h3>
<div class="p"><!----></div>
All geometries are in the end written to an output file, by default <b><tt>crossing.xyz</tt></b>. The file is in standard xyz format. The comment of each geometry gives the path to the trajectory where this geometry was extracted, the simulation time and the diagonal and MCH states at this simulation time. 
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc7.18"></a><h2>
7.18&nbsp;&nbsp;Internal Coordinates Analysis: <b><tt>geo.py</tt></b></h2><a id="sec:geo.py">
</a>
<div class="p"><!----></div>
 S<span style="font-size:x-small">HARC</span>&nbsp;writes at every time step the molecular geometry to the file <b><tt>output.xyz</tt></b>. The non-interactive script <b><tt>geo.py</tt></b> can be used in order to extract internal coordinates from xyz files. The usage is:
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/geo.py&nbsp;[options]&nbsp;&lt;&nbsp;Geo.inp&nbsp;&#62;&nbsp;Geo.out
</pre>
By default, the coordinates are read from <b><tt>output.xyz</tt></b>, but this can be changed with the <b><tt>-g</tt></b> option (see table&nbsp;<a href="#tab:Geo_options"> 7.11</a>). Note that the internal coordinate specifications are read from standard input and the result table is written to standard out. 
<div class="p"><!----></div>
     <a id="tth_sEc7.18.1"></a><h3>
7.18.1&nbsp;&nbsp;Input</h3>
<div class="p"><!----></div>
The specifications for the desired internal coordinates are read from standard input. It follows a simple syntax, where each internal coordinate is specified by a single line of input. Each line starts with a one-letter key which specifies the type of internal coordinate (e.g.&nbsp;bond length, angle, dihedral, ...). The key is followed by a list of integers, specifying which atoms should be measured. As a simple example, <b><tt>r 1 2</tt></b> specifies the bond length (<b><tt>r</tt></b> is the key for bond lengths) between atoms 1 and 2. Note that the numbering of the atoms starts with 1. Each line of input is checked for consistency (whether any atom index is larger than the number of atoms, repeated atom indices, misspelled keys, wrong number of atom indices, ...), and erroneous lines are ignored (this is indicate by an error message).
<div class="p"><!----></div>
Table&nbsp;<a href="#tab:Geo_input"> 7.10</a> lists the available types of internal coordinates. The output is a table, where the first column is the time (Actually, the geometries are just enumerated starting with zero, and the number multiplied by the time step from the <b><tt>-t</tt></b> option). The successive columns in the output table list the results of the internal coordinates calculations. Each request generates at least one column, see table&nbsp;<a href="#tab:Geo_input"> 7.10</a>. 
<div class="p"><!----></div>
Note that for most internal coordinates, the order of the atoms is crucial, since e.g.&nbsp;a<sub>123</sub> &#8800; a<sub>213</sub>. This also holds for the Cremer-Pople parameter requests. For these input lines, the atoms should be listed in the order they appear in the ring (clockwise or counter-clockwise).
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb7.10">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 7.10: Possible types of internal coordinates in <b><tt>geo.py</tt></b>. </div>
  <a id="tab:Geo_input">
</a>
<table>
<tr><td align="left"><span class="roman">Key         </td><td align="center"><span class="roman"><span class="roman">Atom      </td><td align="right">Description    </td><td align="left">Output columns</td></tr>
<tr><td align="left"></td><td align="center"><span class="roman"><span class="roman">Indices   </td><td align="right"></td><td align="left"></td></tr>
<tr><td align="left">x   </td><td align="center">a              </td><td align="right">x coordinate of atom <b><tt>a</tt></b>                                         </td><td align="left">x</td></tr>
<tr><td align="left">y   </td><td align="center">a              </td><td align="right">y coordinate of atom <b><tt>a</tt></b>                                         </td><td align="left">y</td></tr>
<tr><td align="left">z   </td><td align="center">a              </td><td align="right">z coordinate of atom <b><tt>a</tt></b>                                         </td><td align="left">z</td></tr>
<tr><td align="left">r   </td><td align="center">a b            </td><td align="right">Bond length between <b><tt>a</tt></b> and <b><tt>b</tt></b>                                </td><td align="left">r</td></tr>
<tr><td align="left">a   </td><td align="center">a b c          </td><td align="right">Angle between <b><tt>a</tt></b>-<b><tt>b</tt></b> and <b><tt>b</tt></b>-<b><tt>c</tt></b>                    </td><td align="left">a</td></tr>
<tr><td align="left">d   </td><td align="center">a b c d        </td><td align="right">Dihedral, i.e., angle between normal vectors of (<b><tt>a,b,c</tt></b>) and (<b><tt>b,c,d</tt></b>)   </td><td align="left">d</td></tr>
<tr><td align="left"></td><td align="center"></td><td align="right">(between -180<sup>&#176;</sup> and 180<sup>&#176;</sup>, same sign conventions as  M<span style="font-size:x-small">OLDEN</span>)</td></tr>
<tr><td align="left">p   </td><td align="center">a b c d        </td><td align="right">Pyramidalization angle: 90<sup>&#176;</sup> minus angle between bond <b><tt>a</tt></b>-<b><tt>b</tt></b>   </td><td align="left">p</td></tr>
<tr><td align="left"></td><td align="center"></td><td align="right">and normal vector of (<b><tt>b,c,d</tt></b>)</td><td align="left"></td></tr>
<tr><td align="left">q   </td><td align="center">a b c d        </td><td align="right">Pyramidalization angle (alternative definition; angle between  </td><td align="left">q</td></tr>
<tr><td align="left"></td><td align="center"></td><td align="right">bond <b><tt>a</tt></b>-<b><tt>b</tt></b> and average of bonds <b><tt>b</tt></b>-<b><tt>c</tt></b> and <b><tt>b</tt></b>-<b><tt>d</tt></b></td><td align="left"></td></tr>
<tr><td align="left">5   </td><td align="center">a b c d e      </td><td align="right">Cremer-Pople parameters for 5-membered rings <a href="#Cremer1975JACS" class="tth_citeref">[78</a>] and</td><td align="left">q<sub>2</sub>, &#981;<sub>2</sub>, Boeyens</td></tr>
<tr><td align="left"></td><td align="center"></td><td align="right">comformation classification.</td><td align="left"></td></tr>
<tr><td align="left">6   </td><td align="center">a b c d e f    </td><td align="right">Cremer-Pople parameters for 6-membered rings <a href="#Cremer1975JACS" class="tth_citeref">[78</a>] and</td><td align="left">Q, &#981;, &#952;, Boeyens</td></tr>
<tr><td align="left"></td><td align="center"></td><td align="right">Boeyens classification <a href="#Boeyens1976JCMS" class="tth_citeref">[79</a>].</td><td align="left"></td></tr>
<tr><td align="left">i   </td><td align="center">a - f          </td><td align="right">Angle between average plane through 3-rings (<b><tt>a - c</tt></b>) and (<b><tt>d - f</tt></b>)      </td><td align="left">i</td></tr>
<tr><td align="left">j   </td><td align="center">a - h          </td><td align="right">Angle between average plane through 4-rings (<b><tt>a - d</tt></b>) and (<b><tt>e - f</tt></b>)      </td><td align="left">j</td></tr>
<tr><td align="left">k   </td><td align="center">a - j          </td><td align="right">Angle between average plane through 5-rings (<b><tt>a - e</tt></b>) and (<b><tt>f - j</tt></b>)      </td><td align="left">k</td></tr>
<tr><td align="left">l   </td><td align="center">a - l          </td><td align="right">Angle between average plane through 6-rings (<b><tt>a - f</tt></b>) and (<b><tt>g - l</tt></b>)      </td><td align="left">l</td></tr>
<tr><td align="left">c   </td><td align="center"></td><td align="right">Writes the comment (second line of the </td><td align="left">Comment</td></tr>
<tr><td align="left"></td><td align="center"></td><td align="right">xyz format) to the table.</td><td align="left"></td></tr></span></span></span></span></span></table>
</div>
<div class="p"><!----></div>
As an advice, it is always a good idea to put the comment as the <i>last</i> request, if needed. Since the comment may contain blanks, having the comment not as the very last column might make it impossible to plot the resulting table.
<div class="p"><!----></div>
The Boeyens classification symbols which are output for 6-membered rings are reported in <span class="roman">L</span><sup><span class="roman">A</span></sup><span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span>&nbsp;math code. Note that in the Boeyens classification scheme by definition a number of symbols are equivalent, and only one symbol is reported. 
These are the equivalent symbols: <sup>1</sup>C<sub>4</sub>=<sup>3</sup>C<sub>6</sub>=<sup>5</sup>C<sub>2</sub>, <sup>4</sup>C<sub>1</sub>=<sup>6</sup>C<sub>3</sub>=<sup>2</sup>C<sub>5</sub>, <sup>1</sup>T<sub>3</sub>=<sup>4</sup>T<sub>6</sub>, <sup>2</sup>T<sub>6</sub>=<sup>5</sup>T<sub>3</sub>, <sup>2</sup>T<sub>4</sub>=<sup>5</sup>T<sub>1</sub>, <sup>3</sup>T<sub>1</sub>=<sup>6</sup>T<sub>4</sub>, <sup>6</sup>T<sub>2</sub>=<sup>3</sup>T<sub>5</sub> and <sup>4</sup>T<sub>2</sub>=<sup>1</sup>T<sub>5</sub>.
<div class="p"><!----></div>
For 5-membered rings, the classification symbols are chosen similar to the Boeyens symbols. For the <sup>a</sup>E and E<sub>a</sub> symbols, atom a is puckered out of the plane and the four other atoms are coplanar, while for the <sup>a</sup>H<sub>b</sub> symbols the neighboring atoms a and b are puckered out of the plane in opposite directions and only the three remaining atoms are coplanar.
<div class="p"><!----></div>
It is also possible to measure angles between the average planes through two n-membered rings.
Currently, this is only possible if both rings have the same number of atoms (3, 4, 5, or 6).
<div class="p"><!----></div>
     <a id="tth_sEc7.18.2"></a><h3>
7.18.2&nbsp;&nbsp;Options</h3>
<div class="p"><!----></div>
<b><tt>geo.py</tt></b> accepts a number of command-line options, see table&nbsp;<a href="#tab:Geo_options"> 7.11</a>. All options have sensible defaults. However, especially if long comments should be written to the output file, it might be necessary to increase the field width. Note that the minimum column width is 20 so that the table header can be printed correctly.
Also note that the column for the comment is enlarged by 50 characters.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb7.11">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 7.11: Command-line options for <b><tt>geo.py</tt></b>. </div>
  <a id="tab:Geo_options">
</a>
<table>
<tr><td align="left"><span class="roman">Option         </td><td align="left">Description    </td><td align="left">Default</td></tr>
<tr><td align="left">-h          </td><td align="left">Display help message and quit.         </td><td align="left">-       </td></tr>
<tr><td align="left">-b          </td><td align="left">Report x, y, z, r, q<sub>2</sub> and Q in Bohrs       </td><td align="left">Angstrom</td></tr>
<tr><td align="left">-r          </td><td align="left">Report a, d, p, q, &#981;<sub>2</sub>, &#981;, &#952;, i, j, k, and l in Radians         </td><td align="left">Degrees</td></tr>
<tr><td align="left">-g FILENAME </td><td align="left">Read coordinates from the specified file       </td><td align="left"><b><tt>output.xyz</tt></b></td></tr>
<tr><td align="left">-t FLOAT    </td><td align="left">Assumed time step between successive geometries (fs)    </td><td align="left">1.0 fs</td></tr>
<tr><td align="left">-w INTEGER  </td><td align="left">Width of each column (min=20)                   </td><td align="left">20</td></tr>
<tr><td align="left">-p INTEGER  </td><td align="left">Precision (Number of decimals, min=width-3)         </td><td align="left">4</td></tr></span></table>
</div>
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc7.19"></a><h2>
7.19&nbsp;&nbsp;Essential Dynamics Analysis: <b><tt>trajana_essdyn.py</tt></b></h2><a id="sec:trajana_essdyn.py">
</a>
<div class="p"><!----></div>
An essential dynamics analysis&nbsp;<a href="#Amadei1993PSFB" class="tth_citeref">[82</a>] is a procedure to find the most active vibrational modes in an ensemble of trajectories.
It is based on the computation of the covariance matrix between all Cartesian (or mass-weighted Cartesian) coordinates of all steps of all trajectories and a singular value decomposition of this covariance matrix.
For details on the computation, see section&nbsp;<a href="#met:essdyn">8.7</a>.
<div class="p"><!----></div>
The interactive script <b><tt>trajana_essdyn.py</tt></b> can be used to perform such an analysis.
<div class="p"><!----></div>
     <a id="tth_sEc7.19.1"></a><h3>
7.19.1&nbsp;&nbsp;Usage</h3>
<div class="p"><!----></div>
<b><tt>trajana_essdyn.py</tt></b> is an interactive script, which is started with:
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/trajana_essdyn.py
</pre>
Note that before executing the script you should prepare an XYZ geometry file with the reference geometry (e.g., the ground state minimum or the average geometry from the trajectories).
<div class="p"><!----></div>
     <a id="tth_sEc7.19.2"></a><h3>
7.19.2&nbsp;&nbsp;Input</h3>
<div class="p"><!----></div>
During interactive input, the script queries for the paths to the trajectories, the path to the reference structure, and a few other settings.
<div class="p"><!----></div>
<b>Path to the trajectories&nbsp;&nbsp;</b>
<div class="p"><!----></div>
First the script asks the user to specify all directories for whose content the analysis should be performed. Enter one directory path at a time, and finish the directory input section by typing "<b><tt>end</tt></b>". Please do not specify each trajectory directory separately, but specify their parent directories, e.g.&nbsp;the directories <b><tt>Singlet_1</tt></b> and <b><tt>Singlet_2</tt></b>. <b><tt>trajana_essdyn.py</tt></b> will automatically include all trajectories contained in these directories.
<div class="p"><!----></div>
If you want to exclude certain trajectories from the analysis, it is sufficient to create an empty file called <b><tt>CRASHED</tt></b> or <b><tt>RUNNING</tt></b> in the corresponding trajectory directory. <b><tt>trajana_essdyn.py</tt></b> will ignore all directories containing one of these files.
Additionally, <b><tt>trajana_essdyn.py</tt></b> will ignore trajectories with a <b><tt>DONT_ANALYZE</tt></b> file from <b><tt>diagnostics.py</tt></b>.
<div class="p"><!----></div>
<b>Path to reference structure&nbsp;&nbsp;</b>
<div class="p"><!----></div>
For the essential dynamics analysis, a reference structure is required. This structure is substracted from all geometries for the correlation analysis.
The structure can be in any format understandable by  O<span style="font-size:x-small">PEN</span>B<span style="font-size:x-small">ABEL</span>, but the type of format needs to be specified.
In most cases, the reference structure will be either in XYZ or  M<span style="font-size:x-small">OLDEN</span> format.
<div class="p"><!----></div>
<b>Mass-weighted coordinates&nbsp;&nbsp;</b>
<div class="p"><!----></div>
If enabled, the correlation analysis will be carried out in mass-weighted Cartesian coordinates.
In the output file, the mass-weighting will be removed properly.
<div class="p"><!----></div>
<b>Number of steps and time step&nbsp;&nbsp;</b>
<div class="p"><!----></div>
These parameters are automatically detected and suggested as defaults.
It is not necessary to change them.
<div class="p"><!----></div>
<b>Time step intervals&nbsp;&nbsp;</b>
<div class="p"><!----></div>
By default, <b><tt>trajana_essdyn.py</tt></b> will analyze the full length of the simulations together. 
However, it is also possible to compute the essential dynamics for different time intervals (e.g., if the molecular motion is different in the beginning of the dynamics).
Multiple, possibly overlapping, intervals can be entered; for each of the intervals, one set of output files is produced.
<div class="p"><!----></div>
<b>Results directory&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The path to the directory where the output files are stored.
The path has to be entered as a relative or absolute path.
If it does not exist, <b><tt>trajana_essdyn.py</tt></b> will create it.
<div class="p"><!----></div>
     <a id="tth_sEc7.19.3"></a><h3>
7.19.3&nbsp;&nbsp;Output</h3>
<div class="p"><!----></div>
Inside the results directory, <b><tt>trajana_essdyn.py</tt></b> will create two subdirectories, <b><tt>total_cov/</tt></b> and <b><tt>cross_av/</tt></b>.
In the directory <b><tt>total_cov/</tt></b> the results of the full covariance analysis are stored (i.e., essential modes found here have large total activity, but the trajectories could behave very differently).
On the contrary, <b><tt>cross_av/</tt></b> will contain the results of the analysis of the average trajectory (i.e., essential modes found here have strongly coherent activity, where all trajectories behave similarly).
<div class="p"><!----></div>
For each time step interval entered, one output file (e.g., <b><tt>0-1000.molden</tt></b>) is created in each of the two subdirectories.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc7.20"></a><h2>
7.20&nbsp;&nbsp;Normal Mode Analysis: <b><tt>trajana_nma.py</tt></b></h2><a id="sec:trajana_nma.py">
</a>
<div class="p"><!----></div>
A normal mode analysis&nbsp;<a href="#Kurtz2001JCP" class="tth_citeref">[80</a>] is a procedure to find the activity of given normal modes in an ensemble of trajectories
For details on the computation, see section&nbsp;<a href="#met:nma">8.15</a>.
<div class="p"><!----></div>
The interactive script <b><tt>trajana_nma.py</tt></b> can be used to perform such an analysis.
<div class="p"><!----></div>
     <a id="tth_sEc7.20.1"></a><h3>
7.20.1&nbsp;&nbsp;Usage</h3>
<div class="p"><!----></div>
<b><tt>trajana_nma.py</tt></b> is an interactive script, which is started with:
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/trajana_nma.py
</pre>
Note that before executing the script you should prepare a  M<span style="font-size:x-small">OLDEN</span> file with the relevant normal modes.
<div class="p"><!----></div>
     <a id="tth_sEc7.20.2"></a><h3>
7.20.2&nbsp;&nbsp;Input</h3>
<div class="p"><!----></div>
During interactive input, the script queries for the paths to the trajectories, the path to the normal mode file, and a few other settings.
<div class="p"><!----></div>
<b>Path to the trajectories&nbsp;&nbsp;</b>
<div class="p"><!----></div>
First the script asks the user to specify all directories for whose content the analysis should be performed. Enter one directory path at a time, and finish the directory input section by typing "<b><tt>end</tt></b>". Please do not specify each trajectory directory separately, but specify their parent directories, e.g.&nbsp;the directories <b><tt>Singlet_1</tt></b> and <b><tt>Singlet_2</tt></b>. <b><tt>trajana_nma.py</tt></b> will automatically include all trajectories contained in these directories.
<div class="p"><!----></div>
If you want to exclude certain trajectories from the analysis, it is sufficient to create an empty file called <b><tt>CRASHED</tt></b> or <b><tt>RUNNING</tt></b> in the corresponding trajectory directory. <b><tt>trajana_nma.py</tt></b> will ignore all directories containing one of these files.
Additionally, <b><tt>trajana_nma.py</tt></b> will ignore trajectories with a <b><tt>DONT_ANALYZE</tt></b> file from <b><tt>diagnostics.py</tt></b>.
<div class="p"><!----></div>
<b>Path to normal mode file&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The normal mode file (in  M<span style="font-size:x-small">OLDEN</span> format) needs to contain the normal modes for which the analysis should be carried out.
The file needs to have the same atom ordering as the trajectories.
<div class="p"><!----></div>
<b>Mass-weighted coordinates&nbsp;&nbsp;</b>
<div class="p"><!----></div>
If enabled, the correlation analysis will be carried out in mass-weighted Cartesian coordinates.
In the output file, the mass-weighting will be removed properly.
<div class="p"><!----></div>
<b>Number of steps and time step&nbsp;&nbsp;</b>
<div class="p"><!----></div>
These parameters are automatically detected and suggested as defaults.
It is not necessary to change them.
<div class="p"><!----></div>
<b>Automatic plot creation&nbsp;&nbsp;</b>
<div class="p"><!----></div>
If available, the user can choose to automatically create total activity and temporal plots of the normal mode analysis.
<div class="p"><!----></div>
<b>Non-totally symmetric modes&nbsp;&nbsp;</b>
<div class="p"><!----></div>
For symmetry reasons, the average value of a non-totally symmetric normal mode will always be close to zero for a sufficiently large ensemble.
In order to still obtain useful information for such modes, the user can specify modes whose absolute value should be considered.
Note that in the input it is possible to specify ranges, e.g., <b><tt>28</tt></b> for all modes from 2 to 8.
<div class="p"><!----></div>
<b>Multiplication by -1&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The user can choose to multiply certain normal modes by -1.
This is only for convenience when viewing the results.
Note that in the input it is possible to specify ranges, e.g., <b><tt>28</tt></b> for all modes from 2 to 8.
<div class="p"><!----></div>
<b>Time step intervals&nbsp;&nbsp;</b>
<div class="p"><!----></div>
By default, <b><tt>trajana_nma.py</tt></b> will analyze the full length of the simulations together. 
However, it is also possible to compute the essential dynamics for different time intervals (e.g., if the molecular motion is different in the beginning of the dynamics).
Multiple, possibly overlapping, intervals can be entered; for each of the intervals, one set of output files is produced.
<div class="p"><!----></div>
<b>Results directory&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The path to the directory where the output files are stored.
The path has to be entered as a relative or absolute path.
If it does not exist, <b><tt>trajana_nma.py</tt></b> will create it.
<div class="p"><!----></div>
     <a id="tth_sEc7.20.3"></a><h3>
7.20.3&nbsp;&nbsp;Output</h3>
<div class="p"><!----></div>
Inside the results directory, <b><tt>trajana_nma.py</tt></b> will create one subdirectory, <b><tt>nma/</tt></b>.
By default, four output files are written into this subdirectory.
The file <b><tt>total_std.txt</tt></b> will contain the mode activity for each normal mode and for each time interval; a large value indicates that across all time steps and trajectories there is a large variance in that normal mode.
Similarly, the file <b><tt>cross_av_std.txt</tt></b> will contain the mode activity for each normal mode and for each time interval; this is computed from the average trajectory, therefore only showing coherent mode activity.
The files <b><tt>mean_against_time.txt</tt></b> and <b><tt>std_against_time.txt</tt></b> contain for all normal modes and for all time steps the mean and standard deviation, respectively.
<div class="p"><!----></div>
Also by default, additionally, inside each of the trajectory directories, <b><tt>trajana_nma.py</tt></b> generates three output files.
The file <b><tt>nma_nma.txt</tt></b> is a table containing the normal mode coordinates of the trajectory for each time step; functionally, it is very similar to the output of <b><tt>geo.py</tt></b>.
The files <b><tt>nma_nma_av.txt</tt></b> and <b><tt>nma_nma_std.txt</tt></b> contain for each time interval and each normal mode the mean and average for that trajectory.
<div class="p"><!----></div>
Finally, if automatic plots were requested, the results subdirectory will contain two directories, <b><tt>bar_graphs/</tt></b> and <b><tt>time_plots/</tt></b>.
The former contains plots of the data in <b><tt>total_std.txt</tt></b> and <b><tt>cross_av_std.txt</tt></b>, whereas the latter will contain plots of <b><tt>mean_against_time.txt</tt></b> and <b><tt>std_against_time.txt</tt></b>.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc7.21"></a><h2>
7.21&nbsp;&nbsp;General Data Analysis: <b><tt>data_collector.py</tt></b></h2><a id="sec:data_collector.py">
</a>
<div class="p"><!----></div>
Whereas most of the other analysis scripts in the  S<span style="font-size:x-small">HARC</span>&nbsp;suite are intended for rather specific tasks, <b><tt>data_collector.py</tt></b> is aimed at providing a general analysis tool to carry out a large variety of tasks.
The primary task of <b><tt>data_collector.py</tt></b> is to collect tabular data from files which are present in all trajectories, possibly perform some analysis procedures (smoothing, averaging, convoluting, integrating, summing), and output the combined data as a single file.
Possible applications of this functionality are statistical analysis of internal coordinates (e.g., mean and variation in a bond length), the creation of hair figures (e.g., a specific bond length plotted for all trajectories), data convolutions (e.g., distribution of bond length over time, simulation of time- and energy-resolved spectra), or data integration (e.g., computation of time-resolved intensities).
<div class="p"><!----></div>
     <a id="tth_sEc7.21.1"></a><h3>
7.21.1&nbsp;&nbsp;Usage</h3>
<div class="p"><!----></div>
<b><tt>data_collector.py</tt></b> is an interactive script, which is started with:
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/data_collector.py
</pre>
<div class="p"><!----></div>
     <a id="tth_sEc7.21.2"></a><h3>
7.21.2&nbsp;&nbsp;Input</h3>
<div class="p"><!----></div>
In general, the first step in <b><tt>data_collector.py</tt></b> is to collect tabular data files which exist in the directories of multiple trajectories.
For each trajectory, this file needs to have the same file name and the same tabular format; for example, one could read for all trajectories the <b><tt>output.lis</tt></b> files.
<div class="p"><!----></div>
<b>Collecting&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Hence, in the first input section, the script asks the user to specify all directories for whose content the analysis should be performed. Enter one directory path at a time, and finish the directory input section by typing "<b><tt>end</tt></b>". Please do not specify each trajectory directory separately, but specify their parent directories, e.g.&nbsp;the directories <b><tt>Singlet_1</tt></b> and <b><tt>Singlet_2</tt></b>. <b><tt>data_collector.py</tt></b> will automatically include all trajectories contained in these directories.
If you want to exclude certain trajectories from the analysis, it is sufficient to create an empty file called <b><tt>CRASHED</tt></b> or <b><tt>RUNNING</tt></b> in the corresponding trajectory directory. <b><tt>data_collector.py</tt></b> will ignore all directories containing one of these files.
Additionally, <b><tt>data_collector.py</tt></b> will ignore trajectories with a <b><tt>DONT_ANALYZE</tt></b> file from <b><tt>diagnostics.py</tt></b>.
<div class="p"><!----></div>
In the second step, <b><tt>data_collector.py</tt></b> displays all files which appear in multiple trajectories and which might be suitable for analysis (the script ignores files which it knows to be not suitable, e.g., <b><tt>output.dat</tt></b>, <b><tt>output.xyz</tt></b>, most files in the <b><tt>QM/</tt></b> or <b><tt>restart/</tt></b> subdirectories, ...). 
All other files (e.g., <b><tt>output.lis</tt></b>, files in <b><tt>output_data/</tt></b>, ...) will be displayed, together with the number of appearances.
<div class="p"><!----></div>
Once one of the files has been selected, one needs to assign the different data columns.
(i) One column is designated the time column T, which defines the sequentiality of the data:
(ii) Multiple columns can then be designated as data columns, called X columns in the following.
(iii) The same number of columns is designated as weight columns, called Y columns here (weights can be set equal to 1 by selecting column "0" in the relevant menu).
For example, for a time-resolved spectrum, the transition energies would be the X data, whereas the oscillator strengths would be the Y data (weights).
With these assignments, the full data set is defined:
<ul>
<li> For each trajectory a
<ul>
<li> For each time step t
<ul>
<li> For each X column i there will be a value pair (x<sup>a</sup><sub>i</sub>(t),y<sup>a</sup><sub>i</sub>(t)) or (x<sup>a</sup><sub>i</sub>(t),1).
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
</li>
</ul>
In the simplest case, there will be exactly one (x<sup>a</sup>(t),1) pair for each trajectory and time, which is a two-dimensional data set.
Keep in mind that in general, each trajectory could have different time steps at this point.
We refer to this kind of data set (independent trajectories with possibly different time axes) as <b><tt>Type1</tt></b> data set.
As will be described below, in <b><tt>data_collector.py</tt></b>, during certain processing steps the format of the data set is changed, which will create <b><tt>Type2</tt></b> or <b><tt>Type3</tt></b> data sets.
<div class="p"><!----></div>
Once this data set is collected from the files (where too short or commented lines are ignored), <b><tt>data_collector.py</tt></b> allows for a number of subsequent processing steps, which are summarized in Figure&nbsp;<a href="#fig:data_collector"> 7.4</a>.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_fIg7.4">
</a>   <div style="text-align:center">  <img src="http://sharc-md.org/wp-content/uploads/2018/02/data_collector.png">  
<div style="text-align:center">Figure 7.4: 
  Possible workflows in <b><tt>data_collector.py</tt></b>. 
  Grey boxes denote the different computational actions, yellow diamonds denote the different decisions which are queried in the input dialog, and the boxes at the denote the three different data set types (dark blue=<b><tt>Type1</tt></b>, light blue=<b><tt>Type2</tt></b>, green=<b><tt>Type3</tt></b>).
  The different actions and data set types are explained in the text.
  </div>
  <a id="fig:data_collector">
</a>
</div>
<div class="p"><!----></div>
<b>Smoothing&nbsp;&nbsp;</b>
<div class="p"><!----></div>
In this step, each trajectory is individually smoothed, using one of several smoothing kernels (Gaussian, Lorentzian, Log-normal, rectangular). 
Smoothing does not change the size or format of the data set, each value is simply replaced by the corresponding smoothed value; hence, a new <b><tt>Type1</tt></b> data set is obtained.
Smoothing is applied to each X and each Y column independently, but always with the same kernel.
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-17.png">
</td><td width="1%">(7.1)</td></tr></table>
Here, f(t,t&#8242;) is the smoothing kernel.
<div class="p"><!----></div>
<b>Synchronizing&nbsp;&nbsp;</b>
<div class="p"><!----></div>
In this step, the <b><tt>Type1</tt></b> data set is reformatted, by merging all trajectories together.
This step creates a <b><tt>Type2</tt></b> data set, which has a common T axis for all trajectories (simply the union of the T columns from all trajectories).
For each time step, all X and Y values of all trajectories are collected.
If a trajectories does not have data at a particular time step, NaNs will be inserted.
In this way, a rectangular, two-dimensional data set is obtained, with as many rows as time steps, and 2n<sub>traj</sub>n<sub>X</sub> data columns.
<div class="p"><!----></div>
A simple application of Collecting+Synchronizing could be to generate a table with the bond length for all time steps for all trajectories, in order to generate a "hair figure".
This task could in principle also be accomplished with Bash tools like <b><tt>awk</tt></b> and <b><tt>paste</tt></b>, but this is troublesome if the trajectories are of different length, with different time steps, or if the table files contain comments.
<div class="p"><!----></div>
<b>Averaging&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The <b><tt>Type2</tt></b> data set from the Synchronizing step can contain a large number of data columns (2n<sub>traj</sub>n<sub>X</sub>).
In order to reduce this amount of information, the Averaging step can be used to compute the mean and standard deviation across all trajectories, separately for each time step.
This will create a new <b><tt>Type2</tt></b> data set, which still has a common time axis, but will only contain 4n<sub>X</sub>+1 data columns; these are the mean and standard deviation of all X and Y columns, plus one column giving the number of trajectories for each time step.
<div class="p"><!----></div>
Currently, this step can be performed with either arithmetic mean/standard deviation or geometric mean/standard deviation.
<div class="p"><!----></div>
<b>Statistics&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Similar to the Averaging step, the Statistics step computes mean and standard deviations from a <b><tt>Type2</tt></b> data set.
The difference is that during Statistics, these values are computed for all values from the first to the current time step.
The data in the last time step thus gives the total statistics over all time steps and trajectories.
The <b><tt>Type2</tt></b> data set from the Statistics step  contains the same number of data columns as the one from the Averaging step.
<div class="p"><!----></div>
Currently, this step can be performed with either arithmetic mean/standard deviation or geometric mean/standard deviation.
<div class="p"><!----></div>
With the Averaging and Statistics steps, it is possible to compute the same data as with <b><tt>trajana_nma.py</tt></b> (if the appropriate files are read), namely the total (Statistics) and coherent (Averaging+Statistics) activity of the normal modes.
Using <b><tt>data_collector.py</tt></b>, the same analysis can also be applied to internal coordinates computed with <b><tt>geo.py</tt></b>.
<div class="p"><!----></div>
<b>Convoluting(X)&nbsp;&nbsp;</b>
<div class="p"><!----></div>
In order to create a data set which has common T <em>and</em> X axes (a <b><tt>Type3</tt></b> data set), it is in general necessary to perform some kind of data convolution involving the X column data.
In order to do this, <b><tt>data_collector.py</tt></b> creates a grid along the X axis (n<sub>grid</sub> points from the minimum value to the maximum value of all X data in the data set, plus some padding).
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-18.png">
</td><td width="1%">(7.2)</td></tr></table>
The created <b><tt>Type3</tt></b> data set has n<sub>X</sub> data points for each time step and each X grid point.
<div class="p"><!----></div>
Using energies as X columns and oscillator strengths/intensities as Y columns, in this way it is possible to compute time-dependent spectra.
<div class="p"><!----></div>
<b>Summing(Y)&nbsp;&nbsp;</b>
<div class="p"><!----></div>
When n<sub>X</sub> is larger than one, the Summing step can be used to compute the sum over all data points for each time step and each X grid point.
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-19.png">
</td><td width="1%">(7.3)</td></tr></table>
This creates a new <b><tt>Type3</tt></b> data set, which will only contain one data point for each time step and each X grid point.
<div class="p"><!----></div>
For example, for a transient spectrum involving multiple final states (n<sub>X</sub> &gt; 1), after the Convoluting(X) step one obtains one transient spectrum for each final state. With the Summing(Y) step, one can then compute the total transient absorption spectrum.
<div class="p"><!----></div>
<b>Integrating(X)&nbsp;&nbsp;</b>
<div class="p"><!----></div>
When computing transient spectra, one is often interested in integrating the spectrum within a certain energy window.
This can be done with the Integrating(X) step.
After entering a lower and upper X limit, a new <b><tt>Type3</tt></b> data set is created, with only three data points per time step.
The first data point contains the integral from minus infinity to the lower limit, the second data point the integral between lower and upper limit, and the third data point the integral from the upper limit to infinity.
If Summing(Y) was not carried out, this integration is carried out independently for each of the n<sub>X</sub> data columns.
<div class="p"><!----></div>
<b>Convoluting(T)&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The <b><tt>Type3</tt></b> data set can also be convoluted along the time axis (e.g., in order to apply an instrument response function to a time-resolved spectrum).
In order to do this, a uniform grid along the T axis is generated (with n<sub>Tgrid</sub> points from the minimum value to the maximum value of the previous T axis, plus some padding).
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-20.png">
</td><td width="1%">(7.4)</td></tr></table>
The created <b><tt>Type3</tt></b> data set has as many data points for each X grid point as before, but the number of time steps is now n<sub>Tgrid</sub>.
Convoluting(T) can be applied also if Summing(Y) and/or Integrating(X) were used (in this case, the kernel is applied to the summed up or integrated data).
<div class="p"><!----></div>
<b>Integrating(T)&nbsp;&nbsp;</b>
<div class="p"><!----></div>
This step carries out a cumulative summation along the T axis.
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-21.png">
</td><td width="1%">(7.5)</td></tr></table>
In this way, the data in the last time step constitute the integral over all time steps.
Since all the partial cumulative sums are also computed, integrals within some bounds can simply be computed as differences between partial cumulative sums.
<div class="p"><!----></div>
<b>Converting&nbsp;&nbsp;</b>
<div class="p"><!----></div>
At the end of the workflow, a <b><tt>Type3</tt></b> data set can be converted back into a <b><tt>Type2</tt></b> data set, which affects how the output file is formatted.
This is usually a good idea if the Integrating(X) step was performed, but might not be a good idea otherwise.
See below for how the different data set types are formatted on output.
<div class="p"><!----></div>
     <a id="tth_sEc7.21.3"></a><h3>
7.21.3&nbsp;&nbsp;Output</h3>
<div class="p"><!----></div>
After the input dialog is finished, <b><tt>data_collector.py</tt></b> will start carrying out the requested analyses.
For each of the workflow steps, one output file is written, so that all intermediate results can be used as well.
Output files have automatically generated filenames, which describe how the data was obtained.
Filenames are always in the form <b><tt>collected_data_&lt;T&#62;_&lt;X&#62;_&lt;Y&#62;_&lt;steps&#62;.&lt;type&#62;.txt</tt></b>, where <b><tt>&lt;T&#62;</tt></b> is an integer giving the T column index, <b><tt>&lt;X&#62;</tt></b> and <b><tt>&lt;y&#62;</tt></b> are lists of integers of the X and Y column indices, <b><tt>&lt;steps&#62;</tt></b> is a string denoting which workflow steps were carried out, and <b><tt>&lt;type&#62;</tt></b> denotes the data set type.
For example, an output file could be named <b><tt>collected_data_1_2_0_sy_cX.type3.txt</tt></b>, where column 1 was the T column, column 2 the X column, no Y column was used, Synchronizing and Convoluting(X) were performed, resulting in a <b><tt>Type3</tt></b> data set.
<div class="p"><!----></div>
<b>Format of <b><tt>Type1</tt></b> data set output&nbsp;&nbsp;</b>
<div class="p"><!----></div>
<b><tt>Type1</tt></b> data sets are formatted such that each trajectory is given as a continuous block, separated by an empty line.
Within each block, each line contains the data of one time step, order increasingly.
Each line contains a trajectory index, the relative file path, the time, all X column data, and then all Y column data.
<span class="footnotesize">
<pre>
#&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7
#Index&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Filename&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time&nbsp;&nbsp;&nbsp;&nbsp;X&nbsp;Column&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;X&nbsp;Column&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;Y&nbsp;Column&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;Y&nbsp;Column&nbsp;&nbsp;&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;Singlet_1//TRAJ_00001/./Geo.out&nbsp;&nbsp;0.00000000E+00&nbsp;&nbsp;1.13340000E-01&nbsp;&nbsp;7.99096900E+00&nbsp;&nbsp;1.00000000E+00&nbsp;&nbsp;1.00000000E+00
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;Singlet_1//TRAJ_00001/./Geo.out&nbsp;&nbsp;5.00000000E-01&nbsp;&nbsp;1.59173000E-01&nbsp;&nbsp;7.94395200E+00&nbsp;&nbsp;1.00000000E+00&nbsp;&nbsp;1.00000000E+00
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;Singlet_1//TRAJ_00001/./Geo.out&nbsp;&nbsp;1.00000000E+00&nbsp;&nbsp;2.10868000E-01&nbsp;&nbsp;7.89084000E+00&nbsp;&nbsp;1.00000000E+00&nbsp;&nbsp;1.00000000E+00
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;Singlet_1//TRAJ_00002/./Geo.out&nbsp;&nbsp;0.00000000E+00&nbsp;&nbsp;5.03990000E-02&nbsp;&nbsp;7.99078100E+00&nbsp;&nbsp;1.00000000E+00&nbsp;&nbsp;1.00000000E+00
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;Singlet_1//TRAJ_00002/./Geo.out&nbsp;&nbsp;1.00000000E+00&nbsp;&nbsp;3.80370000E-02&nbsp;&nbsp;8.00349700E+00&nbsp;&nbsp;1.00000000E+00&nbsp;&nbsp;1.00000000E+00&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;Singlet_1//TRAJ_00002/./Geo.out&nbsp;&nbsp;2.00000000E+00&nbsp;&nbsp;1.09515000E-01&nbsp;&nbsp;7.93073500E+00&nbsp;&nbsp;1.00000000E+00&nbsp;&nbsp;1.00000000E+00&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;Singlet_1//TRAJ_00004/./Geo.out&nbsp;&nbsp;0.00000000E+00&nbsp;&nbsp;2.10908000E-01&nbsp;&nbsp;8.29417600E+00&nbsp;&nbsp;1.00000000E+00&nbsp;&nbsp;1.00000000E+00
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;Singlet_1//TRAJ_00004/./Geo.out&nbsp;&nbsp;5.00000000E-01&nbsp;&nbsp;1.49506000E-01&nbsp;&nbsp;8.35651800E+00&nbsp;&nbsp;1.00000000E+00&nbsp;&nbsp;1.00000000E+00
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;Singlet_1//TRAJ_00004/./Geo.out&nbsp;&nbsp;1.00000000E+00&nbsp;&nbsp;1.05887000E-01&nbsp;&nbsp;8.40056700E+00&nbsp;&nbsp;1.00000000E+00&nbsp;&nbsp;1.00000000E+00
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...
</pre>
  </span>
Note here in the example that the second trajectory has a time step of 1.0&nbsp;fs and thus no data at 0.5&nbsp;fs.
<div class="p"><!----></div>
<b>Format of <b><tt>Type2</tt></b> data set output&nbsp;&nbsp;</b>
<div class="p"><!----></div>
<b><tt>Type2</tt></b> data sets are formatted such that all trajectories share a common time axis, hence for each time step there will be one line of data.
Each line starts with the time, followed columns with the data for the first trajectory, followed by the data for the second trajectory, etc.
Within each trajectory, first all X columns, then all Y columns are given. If a Y column contains only unit weights (using special file column "0"), then this Y column is omitted from the <b><tt>Type2</tt></b> formatted output.
<span class="footnotesize">
<pre>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7&nbsp;&nbsp;...
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time&nbsp;&nbsp;&nbsp;&nbsp;X&nbsp;Column&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;X&nbsp;Column&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;X&nbsp;Column&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;X&nbsp;Column&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;X&nbsp;Column&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;X&nbsp;Column&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;...
&nbsp;0.00000000E+00&nbsp;&nbsp;1.13340000E-01&nbsp;&nbsp;7.99096900E+00&nbsp;&nbsp;5.03990000E-02&nbsp;&nbsp;7.99078100E+00&nbsp;&nbsp;2.10908000E-01&nbsp;&nbsp;8.29417600E+00&nbsp;&nbsp;...
&nbsp;5.00000000E-01&nbsp;&nbsp;1.59173000E-01&nbsp;&nbsp;7.94395200E+00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NaN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NaN&nbsp;&nbsp;1.49506000E-01&nbsp;&nbsp;8.35651800E+00&nbsp;&nbsp;...
&nbsp;1.00000000E+00&nbsp;&nbsp;2.10868000E-01&nbsp;&nbsp;7.89084000E+00&nbsp;&nbsp;3.80370000E-02&nbsp;&nbsp;8.00349700E+00&nbsp;&nbsp;1.05887000E-01&nbsp;&nbsp;8.40056700E+00&nbsp;&nbsp;...
&nbsp;...
</pre>
  </span>
Note here in the example that the second trajectory does not have data at 0.5&nbsp;fs.
<div class="p"><!----></div>
<b>Format of <b><tt>Typ3</tt></b> data set output&nbsp;&nbsp;</b>
<div class="p"><!----></div>
<b><tt>Type3</tt></b> data sets are formatted such that all trajectories share common time and X axes.
The data is formatted block-wise, with the first block corresponding to the first time step and containing all points on the X grid, followed by an empty line, followed by the second block, etc.
Each block consists of n<sub>grid</sub> lines, each starting with the time and X value in the first two columns and followed by n<sub>X</sub> columns with the convoluted data.
<span class="footnotesize">
<pre>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X_axis&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Conv(5,0)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Conv(6,0)&nbsp;
&nbsp;0.00000000E+00&nbsp;-1.45534000E-01&nbsp;&nbsp;2.38544715E-05&nbsp;&nbsp;0.00000000E+00&nbsp;
&nbsp;0.00000000E+00&nbsp;&nbsp;2.30671958E-01&nbsp;&nbsp;1.51462322E+00&nbsp;&nbsp;0.00000000E+00&nbsp;
&nbsp;0.00000000E+00&nbsp;&nbsp;6.06877917E-01&nbsp;&nbsp;1.07930050E-01&nbsp;&nbsp;0.00000000E+00&nbsp;
&nbsp;...
&nbsp;5.00000000E-01&nbsp;-1.45534000E-01&nbsp;&nbsp;1.31312692E-04&nbsp;&nbsp;0.00000000E+00&nbsp;
&nbsp;5.00000000E-01&nbsp;&nbsp;2.30671958E-01&nbsp;&nbsp;1.28614756E+00&nbsp;&nbsp;0.00000000E+00&nbsp;
&nbsp;5.00000000E-01&nbsp;&nbsp;6.06877917E-01&nbsp;&nbsp;4.46251462E-10&nbsp;&nbsp;0.00000000E+00&nbsp;
&nbsp;...
&nbsp;1.00000000E+00&nbsp;-1.45534000E-01&nbsp;&nbsp;8.75871124E-05&nbsp;&nbsp;0.00000000E+00&nbsp;
&nbsp;1.00000000E+00&nbsp;&nbsp;2.30671958E-01&nbsp;&nbsp;2.42291042E+00&nbsp;&nbsp;0.00000000E+00&nbsp;
&nbsp;1.00000000E+00&nbsp;&nbsp;6.06877917E-01&nbsp;&nbsp;1.60277894E-16&nbsp;&nbsp;0.00000000E+00&nbsp;
&nbsp;...
</pre>
  </span>
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc7.22"></a><h2>
7.22&nbsp;&nbsp;Optimizations with  O<span style="font-size:x-small">RCA</span> and  S<span style="font-size:x-small">HARC</span>: <b><tt>orca_External</tt></b> and <b><tt>setup_orca_opt.py</tt></b></h2><a id="sec:Orca_External">
</a>
<div class="p"><!----></div>
All  S<span style="font-size:x-small">HARC</span>&nbsp;interfaces can deliver gradients for (multiple) ground and excited states in a uniform manner.
This allows in principle to perform optimizations of excited-state minima, conical intersections, or crossing points.
In order to employ a high-quality geometry optimizer for this task, the  S<span style="font-size:x-small">HARC</span>&nbsp;suite is interfaced to the external optimizer feature of  O<span style="font-size:x-small">RCA</span>.
This is accomplished by providing the script <b><tt>orca_External</tt></b>, which is called by  O<span style="font-size:x-small">RCA</span>, runs any of the  S<span style="font-size:x-small">HARC</span>&nbsp;interfaces, constructs the appropriate gradient, and returns that to <span class="roman">Orca</span>.
For the methodology used to construct the gradients, see section&nbsp;<a href="#met:orcaopt">8.16</a>.
<div class="p"><!----></div>
In order to easily prepare the input files for such an optimization, the script <b><tt>setup_orca_opt.py</tt></b> can be used.
It takes a geometry file, interface input files, and the path to  O<span style="font-size:x-small">RCA</span>, and creates a directory containing all relevant input files.
In the following, <b><tt>setup_orca_opt.py</tt></b> is described first, because it is the script which the user directly employs. Afterwards, <b><tt>orca_External</tt></b> is specified.
<div class="p"><!----></div>
     <a id="tth_sEc7.22.1"></a><h3>
7.22.1&nbsp;&nbsp;Usage</h3>
<div class="p"><!----></div>
<b><tt>setup_orca_opt.py</tt></b> is an interactive script, which is started with:
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/setup_orca_opt.py
</pre>
Note that before executing the script you should prepare a template for the interface you want to use (as, e.g., in <b><tt>setup_init.py</tt></b> or <b><tt>setup_traj.py</tt></b>).
<div class="p"><!----></div>
     <a id="tth_sEc7.22.2"></a><h3>
7.22.2&nbsp;&nbsp;Input</h3>
<div class="p"><!----></div>
In the input section, the script asks for: (i) the path to  O<span style="font-size:x-small">RCA</span>, (ii) the input geometries, (iii) the optimization settings, (iv) the interface settings.
<div class="p"><!----></div>
<b>Path to  O<span style="font-size:x-small">RCA</span>&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Here the user is prompted to provide the path to the  O<span style="font-size:x-small">RCA</span> directory. Note that the script will not expand the user (<b><tt> </tt></b>) and shell variables (since possibly the calculations are running on a different machine than the one used for setup). <b><tt> </tt></b> and shell variables will only be expanded during the actual calculation.
<div class="p"><!----></div>
<b>Interface&nbsp;&nbsp;</b>
<div class="p"><!----></div>
In this point, choose any of the displayed interfaces to carry out the ab initio calculations. Enter the corresponding number. 
<div class="p"><!----></div>
<b>Input geometry&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Here the user is prompted for a geometry file in XYZ format, containing one or more geometries (with consistent number of atoms).
For each geometry in this file, a directory with all input files is created, in order to carry out multiple optimizations (e.g., with output from <b><tt>crossing.py</tt></b>).
<div class="p"><!----></div>
<b>Number of states&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Here the user can specify the number of excited states to be calculated. Note that the ground state has to be counted as well, e.g., if 4 singlet states are specified, the calculation will involve the S<sub>0</sub>, S<sub>1</sub>, S<sub>2</sub> and S<sub>3</sub>. Also states of higher multiplicity can be given, e.g.&nbsp;triplet or quintet states. 
<div class="p"><!----></div>
<b>States to optimize&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Two different optimization tasks can be carried out: optimization of a minimum (ground or excited state) or optimization of a crossing point (either a conical intersection between states of the same multiplicity or a minimum-energy crossing points between states of different multiplicities; this is detected automatically).
<div class="p"><!----></div>
For minima, the state to optimize needs to be specified.
For crossing points, the two involved states need to be specified.
In all cases, the specified states need to be included in the number of states given before.
<div class="p"><!----></div>
<b>CI optimization parameters&nbsp;&nbsp;</b>
<div class="p"><!----></div>
If you are optimizing a conical intersection (states of same multiplicity) with an interface which cannot provide nonadiabatic coupling vectors (e.g., <b><tt>SHARC_MOLCAS.py</tt></b>, <b><tt>SHARC_RICC2.py</tt></b>, <b><tt>SHARC_ADF.py</tt></b>, or <b><tt>SHARC_GAUSSIAN.py</tt></b>), then the optimization will employ the the penalty function method of Levine, Coe, and Mart&#237;nez&nbsp;<a href="#Levine2008JPCB" class="tth_citeref">[85</a>].
In this method, a penalty function is optimized, which depends on the energies of the two states and on two parameters, &#963; and &#945; (see section&nbsp;<a href="#met:orcaopt">8.16</a> for their mathematical meaning).
<div class="p"><!----></div>
Practically, the parameters affect how close the minimum of the penalty function is to the true minimum on the crossing seam and how hard the optimization will be to converge.
Generally, a large &#963; will allow going closer to the true conical intersection, but will make the penalty function more stiff (steeper harmonic) and thus harder to optimize.
A small &#945; will also allow going closer to the true conical intersection, but will make the penalty function less harmonic; at &#945; = 0, the penalty function will have a cusp at the minimum, making it unoptimizable because the gradient never becomes zero.
<div class="p"><!----></div>
The default values, 3.5 and 0.02, are the ones suggested in&nbsp;<a href="#Levine2008JPCB" class="tth_citeref">[85</a>].
They can be regarded as relatively soft, i.e., they enable a very smooth convergence but might lead to unacceptably large energy gaps at convergence (i.e., the minimum of the penalty function is too far from the true minimum of the crossing seam).
In this case, it is advisable to restart the optimization from the last point with increased &#963; (e.g., by a factor of 4), and simultaneously reducing the maximum step (see next point).
The &#945; is best left at the suggested value of 0.02 to avoid the cusp problem.
<div class="p"><!----></div>
<b>Maximum allowed displacement&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Within  O<span style="font-size:x-small">RCA</span>, it is possible to restrict the maximum step (the trust radius) of the optimizer. 
A larger maximum step might decrease the number of iterations necessary, but might also lead to instabilities in the optimization (if the potential energy surface is very steep or anharmonic).
Hence, it can be advisable to reduce the maximum allowed step (from the default of 0.3 a.u.), especially if the starting geometry is already very good (e.g., after restart with increase of &#963;) or if the potential is known to be stiff (strong bond, large &#963;, small &#945;, ...).
Note that the maximum step can be restricted even the penalty function method is not used and &#963; and &#945; are not relevant.
<div class="p"><!----></div>
<b>Interface-specific input&nbsp;&nbsp;</b>
<div class="p"><!----></div>
This input section is basically the same as for <b><tt>setup_init.py</tt></b> (sections&nbsp;<a href="#sec:setup_init.py:several">7.4.3</a>). Also for the optimizations an initial wave function file should be provided, especially for the multi-reference methods.
<div class="p"><!----></div>
<b>Run script setup&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Here the user needs to provide the path to the directory where the optimizations should be setup.
<div class="p"><!----></div>
     <a id="tth_sEc7.22.3"></a><h3>
7.22.3&nbsp;&nbsp;Output</h3>
<div class="p"><!----></div>
Inside the specified directory, <b><tt>setup_orca_opt.py</tt></b> creates one subdirectory for each geometry in the input geometry file.
Each subdirectory is prepared with the corresponding initial geometry file (<b><tt>geom.xyz</tt></b>), the  O<span style="font-size:x-small">RCA</span> input file (<b><tt>orca.inp</tt></b>), the appropriate interface-specific files (template, resources, QM/MM), and a shell script for execution (<b><tt>run_EXTORCA.sh</tt></b>).
<div class="p"><!----></div>
In order to run one of the optimizations, execute the shell script or send it to a batch queuing system.
Note that $SHARC needs to be added to the $PATH so that  O<span style="font-size:x-small">RCA</span> can find <b><tt>orca_External</tt></b> (this is automatically done inside <b><tt>run_EXTORCA.sh</tt></b>).
<div class="p"><!----></div>
When the shell script is started,  O<span style="font-size:x-small">RCA</span> will write a couple of output files, where the two most relevant are <b><tt>orca.trj</tt></b> and <b><tt>orca.log</tt></b>.
The former is an XYZ file with all geometries from the optimization steps.
The latter (the  O<span style="font-size:x-small">RCA</span> standard output) contains all details of the optimization (convergence, step size, etc) as well as a summary of what <b><tt>orca_External</tt></b> did (after the line <b><tt>EXTERNAL SHARC JOB</tt></b>).
This summary contains all relevant energies and shows how the gradient is constructed.
Note that in each iteration, a line starting with <b><tt> </tt></b> is written, which contains the energies of the optimized state(s). This line can easily be extracted with <b><tt>grep</tt></b> to follow the optimization of a crossing point.
<div class="p"><!----></div>
     <a id="tth_sEc7.22.4"></a><h3>
7.22.4&nbsp;&nbsp;Description of <b><tt>orca_External</tt></b></h3>
<div class="p"><!----></div>
<b><tt>orca_External</tt></b> provides a connection between the external optimizer of  O<span style="font-size:x-small">RCA</span> and any of the  S<span style="font-size:x-small">HARC</span>&nbsp;interfaces.
In figure&nbsp;<a href="#fig:interface_orcaExt"> 7.5</a>, the file communication between  O<span style="font-size:x-small">RCA</span>, <b><tt>orca_External</tt></b>, and the interfaces is presented.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_fIg7.5">
</a>   <div style="text-align:center">  <img src="http://sharc-md.org/wp-content/uploads/2018/02/general_orcaExternal.png">  
<div style="text-align:center">Figure 7.5: Communication between  O<span style="font-size:x-small">RCA</span>, <b><tt>orca_External</tt></b>, the interfaces, and the quantum chemistry codes.</div>
  <a id="fig:interface_orcaExt">
</a>
</div>
<div class="p"><!----></div>
As can be seen, <b><tt>orca_External</tt></b> writes <b><tt>QM.in</tt></b> and <b><tt>QM.out</tt></b> files, in the same way that <b><tt>sharc.x</tt></b> is doing.
All information to write the <b><tt>QM.in</tt></b> file comes from the  O<span style="font-size:x-small">RCA</span> communication file <b><tt>orca.extcomp.inp</tt></b> (geometry) and the  O<span style="font-size:x-small">RCA</span> input file (number of states, interface, states to optimize).
To provide the latter information, <b><tt>orca_External</tt></b> reads specially marked comments from the  O<span style="font-size:x-small">RCA</span> input file which are ignored by  O<span style="font-size:x-small">RCA</span>.
These comments start with <b><tt>#SHARC:</tt></b>, followed by a keyword (<b><tt>states</tt></b>, <b><tt>interface</tt></b>, <b><tt>opt</tt></b>, or <b><tt>param</tt></b>) and the keyword arguments.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc7.23"></a><h2>
7.23&nbsp;&nbsp;Single Point Calculations: <b><tt>setup_single_point.py</tt></b></h2><a id="sec:setup_single_point.py">
</a>
<div class="p"><!----></div>
It is possible to run single point calculations through the  S<span style="font-size:x-small">HARC</span>&nbsp;interfaces.
This is useful, e.g., to do a computation in exactly the same way as during the dynamics simulations.
Single point calculations using the interfaces can also be easily automatized.
<div class="p"><!----></div>
     <a id="tth_sEc7.23.1"></a><h3>
7.23.1&nbsp;&nbsp;Usage</h3>
<div class="p"><!----></div>
<b><tt>setup_single_point.py</tt></b> is an interactive script, which is started with:
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/setup_single_point.py
</pre>
Note that before executing the script you should prepare a template for the interface you want to use (as, e.g., in <b><tt>setup_init.py</tt></b> or <b><tt>setup_traj.py</tt></b>).
<div class="p"><!----></div>
     <a id="tth_sEc7.23.2"></a><h3>
7.23.2&nbsp;&nbsp;Input</h3>
<div class="p"><!----></div>
In the input section, the script asks for: (i) the input geometries, (ii) the number of states, and (iii) the interface settings.
<div class="p"><!----></div>
<b>Interface&nbsp;&nbsp;</b>
<div class="p"><!----></div>
First, choose any of the displayed interfaces to carry out the ab initio calculations. Enter the corresponding number. 
<div class="p"><!----></div>
<b>Input geometry&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Here the user is prompted for a geometry file in XYZ format, containing one or more geometries (with consistent number of atoms).
For each geometry in this file, a directory with all input files is created, in order to carry out multiple optimizations (e.g., with output from <b><tt>crossing.py</tt></b>).
<div class="p"><!----></div>
<b>Number of states&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Here the user can specify the number of excited states to be calculated. Note that the ground state has to be counted as well, e.g., if 4 singlet states are specified, the calculation will involve the S<sub>0</sub>, S<sub>1</sub>, S<sub>2</sub> and S<sub>3</sub>. Also states of higher multiplicity can be given, e.g.&nbsp;triplet or quintet states. 
<div class="p"><!----></div>
<b>Interface-specific input&nbsp;&nbsp;</b>
<div class="p"><!----></div>
This input section is basically the same as for <b><tt>setup_init.py</tt></b> (sections&nbsp;<a href="#sec:setup_init.py:several">7.4.3</a>). Also for the optimizations an initial wave function file should be provided, especially for the multi-reference methods.
<div class="p"><!----></div>
<b>Run script setup&nbsp;&nbsp;</b>
<div class="p"><!----></div>
Here the user needs to provide the path to the directory where the optimizations should be setup.
<div class="p"><!----></div>
     <a id="tth_sEc7.23.3"></a><h3>
7.23.3&nbsp;&nbsp;Output</h3>
<div class="p"><!----></div>
Inside the specified directory, <b><tt>setup_single_point.py</tt></b> creates one subdirectory for each geometry in the input geometry file.
Each subdirectory is prepared with the corresponding geometry file (<b><tt>QM.in</tt></b>), the appropriate interface-specific files (template, resources, QM/MM), and a shell script for execution (<b><tt>run.sh</tt></b>).
<div class="p"><!----></div>
In order to run one of the optimizations, execute the shell script or send it to a batch queuing system.
<div class="p"><!----></div>
When the shell script is started, the chosen  S<span style="font-size:x-small">HARC</span>&nbsp;interface is executed.
The interface writes a file called <b><tt>QM.log</tt></b> which contains details of the computation and progress status.
The final results of the computation are written to <b><tt>QM.out</tt></b>, which can be inspected manually.
Alternatively, some basic data (excitation energies, oscillator strengths) can be computed with <b><tt>QMout_print.py</tt></b> (section <a href="#sec:QMout_print.py">7.24</a>).
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc7.24"></a><h2>
7.24&nbsp;&nbsp;Format Data from <b><tt>QM.out</tt></b> Files: <b><tt>QMout_print.py</tt></b></h2><a id="sec:QMout_print.py">
</a>
<div class="p"><!----></div>
With the script <b><tt>QMout_print.py</tt></b> one can print a table with energies and oscillator strengths from a <b><tt>QM.out</tt></b> file, as it is produced by the interfaces.
<div class="p"><!----></div>
     <a id="tth_sEc7.24.1"></a><h3>
7.24.1&nbsp;&nbsp;Usage</h3>
<div class="p"><!----></div>
<b><tt>QMout_print.py</tt></b> is a command line tool, and is executed like this:
<pre>
user@host&#62;&nbsp;python&nbsp;$SHARC/QMout_print.py&nbsp;[options]&nbsp;QM.out
</pre>
The options are summarized in Table&nbsp;<a href="#tab:QMoutprint_options"> 7.12</a>
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_tAb7.12">
</a>   <div style="text-align:center">  <div style="text-align:center">Table 7.12: Command-line options for <b><tt>QMout_print.py</tt></b>. </div>
  <a id="tab:QMoutprint_options">
</a>
<table>
<tr><td align="left"><span class="roman">Option         </td><td align="left">Description    </td><td align="left">Default</td></tr>
<tr><td align="left">-h          </td><td align="left">Display help message and quit.         </td><td align="left">-       </td></tr>
<tr><td align="left">-i FILENAME </td><td align="left">Path to <b><tt>QM.in</tt></b> file (to read number of states)    </td><td align="left">-</td></tr>
<tr><td align="left">-s INTEGERS </td><td align="left">List of numbers of states per multiplicity             </td><td align="left">1</td></tr>
<tr><td align="left">-e FLOAT    </td><td align="left">Absolute energy shift in Hartree                       </td><td align="left">0.0</td></tr>
<tr><td align="left">-D          </td><td align="left">Output diagonal states                                 </td><td align="left">MCH states</td></tr></span></table>
</div>
<div class="p"><!----></div>
     <a id="tth_sEc7.24.2"></a><h3>
7.24.2&nbsp;&nbsp;Output</h3>
<div class="p"><!----></div>
The script prints a table with state index, state label, energy, relative energy, oscillator strength, and spin expectation value to standard output.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc7.25"></a><h2>
7.25&nbsp;&nbsp;Diagonalization Helper: <b><tt>diagonalizer.x</tt></b></h2><a id="sec:diagonalizer.x">
</a>
<div class="p"><!----></div>
The small program <b><tt>diagonalizer.x</tt></b> is used by the Python scripts to diagonalize matrices if the  N<span style="font-size:x-small">UM</span>P<span style="font-size:x-small">Y</span> library is not available. Currently, only <b><tt>excite.py</tt></b> and <b><tt>SHARC_Analytical.py</tt></b> need to diagonalize matrices. The program <b><tt>diagonalizer.x</tt></b> is implemented as a simple front-end to the LAPACK libary.
<div class="p"><!----></div>
The program reads from stdin. The first line consists of the letter "r" or "c", followed by two integers giving the matrix dimensions. For "r", the program assumes a real symmetric matrix, for "c" a Hermitian matrix. The matrix must be square.
The second line is a comment and is ignored.
In the following lines, the matrix elements are given. On each line one row of the matrix has to be written. If the matrix is complex, each line contains the double number of entries, where real and imaginary part are always given subsequently.
The following is an example input:
<span class="footnotesize">
<pre>
c&nbsp;2&nbsp;2
comment
1.0&nbsp;&nbsp;0.0&nbsp;&nbsp;&nbsp;&nbsp;2.0&nbsp;&nbsp;0.1
2.0&nbsp;-0.1&nbsp;&nbsp;&nbsp;&nbsp;6.0&nbsp;&nbsp;0.0
</pre>
  </span>
<div class="p"><!----></div>
<div class="normalsize">for the matrix 
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-22.png">
</td><td width="1%">(7.6)</td></tr></table>
The diagonal matrix and the matrix of eigenvectors is written to stdout.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_chAp8"></a><h1>
Chapter 8 Methodology</h1>
<a id="chap:met">
</a>
<div class="p"><!----></div>
In this chapter different aspects of  S<span style="font-size:x-small">HARC</span>&nbsp;simulations are discussed in detail. The topics are ordered alphabetically.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.1"></a><h2>
8.1&nbsp;&nbsp;Absorption Spectrum</h2><a id="met:spectrum">
</a>
<div class="p"><!----></div>
Using <b><tt>spectrum.py</tt></b>, an absorption spectrum can be calculated as the sum over the absorption spectra of each individual initial condition:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-23.png">
</td><td width="1%">(8.1)</td></tr></table>
where i runs over the initial conditions.
<div class="p"><!----></div>
The spectrum of a single initial condition is the convolution of its line spectrum, defined through a set of tuples (E<sup>&#945;</sup>,f<sub>osc</sub><sup>&#945;</sup>) for each electronic state &#945;, where E<sup>&#945;</sup> is the excitation energy and f<sub>osc</sub><sup>&#945;</sup>) is the oscillator strength.
<div class="p"><!----></div>
The convolution of the line spectrum can be performed with <b><tt>spectrum.py</tt></b> using either Gaussian or Lorentzian functions. The contribution of a state &#945; to the absorption spectrum &#963;<sup>&#945;</sup>(E) is given by:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-24.png">
</td><td width="1%">(8.2)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-25.png">
</td><td width="1%">(8.3)</td></tr></table>
or
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-26.png">
</td><td width="1%">(8.4)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-27.png">
</td><td width="1%">(8.5)</td></tr></table>
or
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-28.png">
</td><td width="1%">(8.6)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-29.png">
</td><td width="1%">(8.7)</td></tr></table>
where FWHM is the full width at half maximum.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.2"></a><h2>
8.2&nbsp;&nbsp;Active and inactive states</h2><a id="met:activestates">
</a>
<div class="p"><!----></div>
 S<span style="font-size:x-small">HARC</span>&nbsp;allows to "freeze" certain states, which then do not participate in the dynamics. Only energies and dipole moments are calculated, but all couplings are disabled. In this way, these states are never visited (hence also no gradients and nonadiabatic couplings are calculated, making the inclusion of these states cheap). Example:
<div class="p"><!----></div>
        <tt>nstates&nbsp;2&nbsp;0&nbsp;2</tt>
<div class="p"><!----></div>
  <tt>actstates&nbsp;2&nbsp;0&nbsp;1</tt>
<div class="p"><!----></div>
In the example given, state T<sub>2</sub> is frozen. The corresponding Hamiltonian looks like:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-30.png">
</td><td width="1%">(8.8)</td></tr></table>
where all matrix elements marked 
<table>
<tr><td align="center">red</td></tr></table>
 are deleted, since T<sub>2</sub> is frozen. 
<div class="p"><!----></div>
The corresponding matrix elements are also deleted from the nonadiabatic coupling and overlap matrices. For propagation including laser fields, also the corresponding transition dipole moments are neglected, while the transition dipole moments still show up in the output (in order to characterize the frozen states).
<div class="p"><!----></div>
Active and frozen states are defined with the <b><tt>states</tt></b> and <b><tt>actstates</tt></b> keywords in the input file. Note that only the highest states in each multiplicity can be frozen, i.e., it is not possible to freeze the T<sub>1</sub> while having T<sub>2</sub> active. However, it is possible to freeze all states of a certain multiplicity.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.3"></a><h2>
8.3&nbsp;&nbsp;Amdahl's Law</h2><a id="met:amdahl">
</a>
<div class="p"><!----></div>
Some of the interfaces (<b><tt>SHARC_ADF.py</tt></b> and <b><tt>SHARC_GAUSSIAN.py</tt></b>) use Amdahl's law to predict the most efficient way to run multiple calculations in parallel, where each calculation itself is parallelized.
For example, in <b><tt>SHARC_GAUSSIAN.py</tt></b> it might be necessary to compute the gradients of five states, using four CPU cores.
The most efficient way to run these five jobs depends on how well the  G<span style="font-size:x-small">AUSSIAN</span> computation scales with the number of cores-for bad scaling, running four jobs on one core each followed by the fifth job might be best, whereas for good scaling, running each job on four cores subsequently is better because no core is idle at any time.
In order to automatically distribute the jobs efficiently, the interfaces use Amdahl's law, which can be stated as:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-31.png">
</td><td width="1%">(8.9)</td></tr></table>
Here, T(1) is the run time of the job with one CPU core, and r is the fraction of T(1) which benefits from parallelization.
The parameter r can be given to the interfaces; it is between 0 and 1, where 0 means that the calculation does not get faster at all with multiple cores, whereas 1 means that the run time scales linearly with the number of cores.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.4"></a><h2>
8.4&nbsp;&nbsp;Bootstrapping for Population Fits</h2><a id="met:bootstrapping">
</a>
<div class="p"><!----></div>
Bootstrapping, in the context of population fitting, is a statistical method to obtain the statistical distribution of the fitted parameters, which can be used to infer the error associated with the fitted parameter.
The general idea of bootstrapping is to take the original sample (the set of trajectories in the ensemble), and generate new samples (resamples) by randomly drawing trajectories "with replacement" from the original ensemble.
These resamples will differ form the original ensemble by containing some trajectories multiple times while other trajectories might be missing.
For each of the resamples, the fitting parameter are obtained normally and saved for later analysis.
<div class="p"><!----></div>
After many resamples, we obtain a list of many "alternative" parameters, which can be plotted in a histogram to see the statistical distribution of the fitting parameter.
The number of resamples should generally be large (several hundred or thousand resamples), although with <b><tt>bootstrap.py</tt></b>, one can inspect the convergence of the fitting parameters/errors to decide how many resamples are sufficient.
<div class="p"><!----></div>
From the computed list of parameters, error measures can be computed.
Assume that {x<sub>i</sub>} is the set of fitting parameters obtained.
<b><tt>bootstrap.py</tt></b> computes the arithmetic mean and standard deviation like this:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-32.png">
</td><td width="1%">(8.10)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-33.png">
</td><td width="1%">(8.11)</td></tr></table>
Because the distribution of {x<sub>i</sub>} might be skewed (e.g., contains some very large values but few very small ones), the script also computes the geometric mean and standard deviation like this:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-34.png">
</td><td width="1%">(8.12)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-35.png">
</td><td width="1%">(8.13)</td></tr></table>
Note that the geometric standard deviation is a dimensionless factor (unlike the arithmetic standard deviation, which has the same dimension as the mean).
Therefore, within <b><tt>bootstrap.py</tt></b> the geometric errors are always displayed with separate upper and lower bounds as <span class="overacc2">&#x2015;</span>x\substack+<span class="overacc2">&#x2015;</span>x(&#963;(x)&#8722;1) &#8722;<span class="overacc2">&#x2015;</span>x(1/&#963;(x)&#8722;1). 
Note that <b><tt>bootstrap.py</tt></b> will always report one times the standard deviation in the output.
If larger confidence intervals are desired, simply multiply the arithmetic error as usual.
For the geometric error, use for example <span class="overacc2">&#x2015;</span>x\substack+<span class="overacc2">&#x2015;</span>x(&#963;(x)<sup>2</sup>&#8722;1) &#8722;<span class="overacc2">&#x2015;</span>x(1/&#963;(x)<sup>2</sup>&#8722;1).
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.5"></a><h2>
8.5&nbsp;&nbsp;Damping</h2><a id="met:damping">
</a>
<div class="p"><!----></div>
If damping is activated in  S<span style="font-size:x-small">HARC</span>&nbsp;(keyword <b><tt>dampeddyn</tt></b>), in each time step the following modification to the velocity vector is made
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-36.png">
</td><td width="1%">(8.14)</td></tr></table>
where C is the damping factor given in the input. Hence, in each time step the kinetic energy is modified by
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-37.png">
</td><td width="1%">(8.15)</td></tr></table>
The damping factor C must be between 0 and 1.
<div class="p"><!----></div>
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.6"></a><h2>
8.6&nbsp;&nbsp;Decoherence</h2><a id="met:decoherence">
</a>
<div class="p"><!----></div>
In surface hopping, without any corrections the coherence between the states is usually too large <a href="#Granucci2007JCP" class="tth_citeref">[21</a>]. A trajectory in state &#946;, but where state &#945; has a large coefficient, will still travel according to the gradient of state &#946;. However, the gradients of state &#945; are almost certainly different to the ones of state &#946;. As a consequence, too much population of state &#945; is following the gradient of state &#946;. Decoherence corrections damp in different ways the population of all states &#945; &#8800; &#946;, so that only population of &#946; follows the gradient of state &#946;.
<div class="p"><!----></div>
Currently, in  S<span style="font-size:x-small">HARC</span>&nbsp;there are two decoherence corrections implemented, "energy-based decoherence", or EDC, as given in <a href="#Granucci2010JCP" class="tth_citeref">[101</a>] and "augmented fewest-switches surface hopping", or AFSSH, as described in <a href="#Jain2016JCTC" class="tth_citeref">[30</a>].
<div class="p"><!----></div>
     <a id="tth_sEc8.6.1"></a><h3>
8.6.1&nbsp;&nbsp;Energy-based decoherence</h3>
<div class="p"><!----></div>
In this scheme, after the surface hopping procedure, when the system is in state &#946;, the coefficients are updated by the following relation
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-38.png">
</td><td width="1%">(8.16)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-39.png">
</td><td width="1%">(8.17)</td></tr></table>
where C is the decoherence parameter. The decoherence correction can be activated with the keyword <b><tt>decoherence</tt></b> in the input file. The decoherence parameter C can be set with the keyword <b><tt>decoherence_param</tt></b> (the default is 0.1&nbsp;hartree, as suggested in <a href="#Granucci2010JCP" class="tth_citeref">[101</a>]).
<div class="p"><!----></div>
     <a id="tth_sEc8.6.2"></a><h3>
8.6.2&nbsp;&nbsp;Augmented FSSH decoherence</h3>
<div class="p"><!----></div>
Augmented FSSH by Subotnik and coworkers is described in <a href="#Jain2016JCTC" class="tth_citeref">[30</a>].
For  S<span style="font-size:x-small">HARC</span>, the augmented FSSH algorithm was adjusted to the case of the diagonal representation.
<div class="p"><!----></div>
The basic idea is that besides the actual trajectory, the program maintains an auxiliary trajectory for each state.
The auxiliary trajectories are propagated using the gradients of the associated (not active) state, and because the gradients are different, the auxiliary trajectories eventually diverge from each other and from the main trajectory.
From this diverging, one can compute decoherence rates which can be used to stochastically set the electronic coefficients of the diverging state to zero.
<div class="p"><!----></div>
First, we compute two matrices:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-40.png">
</td><td width="1%">(8.18)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-41.png">
</td><td width="1%">(8.19)</td></tr></table>
where <b>S</b> is the overlap matrix, as used in&nbsp;<a href="#met:propagate">8.27</a>.
Hence, <b>S</b><sup>diag</sup>(t,t+&#8710;t) is the overlap matrix in the diagonal basis and <b>H</b><sup>olddiag</sup>(t+&#8710;t) is the Hamiltonian at time t+&#8710;t expressed in the diagonal basis of time step t.
<div class="p"><!----></div>
We then propagate the auxiliary trajectories for each state j, considering that the active state is &#945;.
For this, we need the gradient matrix <b>G</b><sup>diag</sup> from section&nbsp;<a href="#met:gradtra">8.10</a>.
We define:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-42.png">
</td><td width="1%">(8.20)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-43.png">
</td><td width="1%">(8.21)</td></tr></table>
We do the X step of the velocity-Verlet algorithm:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-44.png">
</td><td width="1%">(8.22)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-45.png">
</td><td width="1%">(8.23)</td></tr></table>
where A goes over the atoms.
Then, we compute the new gradient:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-46.png">
</td><td width="1%">(8.24)</td></tr></table>
We then carry out the v step:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-47.png">
</td><td width="1%">(8.25)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-48.png">
</td><td width="1%">(8.26)</td></tr></table>
We then perform a diabatization of the auxiliary trajectories (e.g., for a trivially avoided crossing, the moments between the crossing states are interchanged):
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-49.png">
</td><td width="1%">(8.27)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-50.png">
</td><td width="1%">(8.28)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-51.png">
</td><td width="1%">(8.29)</td></tr></table>
to transform the data back into the adiabatic basis at time t+&#8710;t.
<div class="p"><!----></div>
Finally, we carry out the decoherence correction procedure for each auxiliary trajectory.
We compute the displacement from the auxiliary trajectory of the active state:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-52.png">
</td><td width="1%">(8.30)</td></tr></table>
We compute two rate constants:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-53.png">
</td><td width="1%">(8.31)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-54.png">
</td><td width="1%">(8.32)</td></tr></table>
or if no nonadiabatic coupling vectors are available:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-55.png">
</td><td width="1%">(8.33)</td></tr></table>
<div class="p"><!----></div>
We draw a random number (identical for all states) r between 0 and 1.
If r &lt; &#8710;t(r<sup>j</sup><sub>1</sub>&#8722;r<sup>j</sup><sub>2</sub>), then we collapse state j, by setting its coefficient to zero and enlarging the coefficient of the active state such that the total norm is conserved; we also set the moments <b>R</b><sup>j</sup> and <b>v</b><sup>j</sup> to zero.
If no collapse occurred, if r &lt; &#8722;&#8710;t r<sup>j</sup><sub>1</sub>, we set the moments <b>R</b><sup>j</sup> and <b>v</b><sup>j</sup> to zero.
<div class="p"><!----></div>
After a surface hop occurred, we reset all auxiliary trajectories.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.7"></a><h2>
8.7&nbsp;&nbsp;Essential Dynamics Analysis</h2><a id="met:essdyn">
</a>
<div class="p"><!----></div>
As an alternative to normal mode analysis (see section&nbsp;<a href="#met:nma">8.15</a>), essential dynamics analysis can be used to identify important modes in the dynamics.
This procedure is a principal component analysis of the geometric displacements.<a href="#Amadei1993PSFB" class="tth_citeref">[82</a>,<a href="#Plasser2009" class="tth_citeref">[81</a>]
Unlike normal mode analysis, it does not depend on the availability of the normal mode vectors.
<div class="p"><!----></div>
The covariance matrix is computed from the following equation (&#956; and &#957; are indices over the 3N<sub>atom</sub> degrees of freedom):
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-56.png">
</td><td width="1%">(8.34)</td></tr></table>
and
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-57.png">
</td><td width="1%">(8.35)</td></tr></table>
as a matrix <b>C</b> with elements:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-58.png">
</td><td width="1%">(8.36)</td></tr></table>
<div class="p"><!----></div>
Diagonalization of the symmetric matrix <b>C</b> gives a set of eigenvalues and eigenvectors.
The eigenvectors represent the essential dynamics modes, and the corresponding eigenvalues are the variances of the modes.
Modes with large variances show strong motion in the dynamics, whereas small variances are found for modes which show weak motion.
Because the modes are uncorrelated, the few modes with the largest variance describe most of the molecular motion, which shows that essential dynamics analysis can be used to for data reduction.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.8"></a><h2>
8.8&nbsp;&nbsp;Excitation Selection</h2><a id="met:exc_selection">
</a>
<div class="p"><!----></div>
<b><tt>excite.py</tt></b> can select initial active states for the dynamics based on the excitation energies E<sub>k,&#945;</sub> and the oscillator strengths f<sup>osc</sup><sub>k,&#945;</sub> for each initial condition k and excited state &#945;. 
<div class="p"><!----></div>
First, for all excited states of all initial conditions, the maximum value p<sub>max</sub> of 
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-59.png"><a id="eq:exc_prob">
</a>
</td><td width="1%">(8.37)</td></tr></table>
is found. Then for each excited state, a random number r<sub>k,&#945;</sub> is picked from [0,1]. If
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-60.png">
</td><td width="1%">(8.38)</td></tr></table>
then the excited state is selected as a valid initial condition. This excited-state selection scheme is taken from <a href="#Barbatti2011" id="CITEBarbatti2011" class="tth_citation">[103</a>].
<div class="p"><!----></div>
Within <b><tt>excite.py</tt></b> it is possible to restrict the selection to a subset of all excited states (only certain adiabatic states/within a given energy range). In this case, also p<sub>max</sub> is only determined based on this subset of excited states.
<div class="p"><!----></div>
     <a id="tth_sEc8.8.1"></a><h3>
8.8.1&nbsp;&nbsp;Excitation Selection with Diabatization</h3><a id="met:exc_diabatic">
</a>
<div class="p"><!----></div>
The active states can be selected based on a diabatization.
This necessitates the wave function overlaps between a reference geometry (<b><tt>ICOND_00000/</tt></b>) and the current initial condition k.
<div class="p"><!----></div>
The overlap matrix with elements
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-61.png">
</td><td width="1%">(8.39)</td></tr></table>
can be computed with <b><tt>wfoverlap.x</tt></b> (calculations can be setup with <b><tt>setup_init.py</tt></b>).
This overlap matrix is rescaled during the excitation selection procedure such S<sup>0k</sup><sub>11</sub> is equal to one (by dividing all elements by &#124;S<sup>0k</sup><sub>11</sub>&#124;<sup>2</sup>).
Then, assume we want to start all trajectories in the state which corresponds to state x at the reference geometry.
The excitation selection will select a state y as initial state if S<sup>0k</sup><sub>xy</sub> &gt; 0.5.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.9"></a><h2>
8.9&nbsp;&nbsp;Global fits and kinetic models</h2><a id="met:globalfit">
</a>
<div class="p"><!----></div>
In this section, we specify the basic assumptions of the chemical kinetic models used with the script <b><tt>make_fitscript.py</tt></b> and the globals fits of these models to data.
<div class="p"><!----></div>
     <a id="tth_sEc8.9.1"></a><h3>
8.9.1&nbsp;&nbsp;Reaction networks</h3>
<div class="p"><!----></div>
The kinetic models used by <b><tt>make_fitscript.py</tt></b> is based on a chemical reaction network, where chemical <i>species</i> react via unimolecular <i>reactions</i>.
<div class="p"><!----></div>
The reaction networks allowed in the script are a simple directed graphs, where the species are the vertices and the reactions are the directed edges.
Each reaction is characterized by an associated rate constant and connects exactly one reactant species to exactly one product species.
<div class="p"><!----></div>
In order to obtain rate laws which can analytically be integrated easily, there are a number of restrictions imposed on the network graphs.
Some restrictions and possible features of the graphs are depicted exemplarily in Figure&nbsp;<a href="#fig:graph_restrictions"> 8.1</a>.
First, each species and each reaction rate needs to have a unique label. 
There cannot be two species with the same label and there cannot be two reactions with the same reaction rate constant.
Second, the graph must be a simple directed graph, hence there cannot be any (self-) loops or more than one reaction with the same initial and the same final species.
All restrictions marked as "Not allowed" in the Figure are enforced in the input dialogue of <b><tt>make_fitscript.py</tt></b>
However, back reactions are allowed (as a back reaction has a different initial and a different final species as the corresponding reaction).
Except from these restrictions, the graph may contain combinations of sequential and parallel reactions.
The graph may also be disjoint, i.e., it can be the union of several independent sub-networks.
<div class="p"><!----></div>
There are two kinds of cycles possible, called here <i>parallel pathways</i> and <i>closed walks</i>.
Parallel pathways are independent sequences of reactions with the same initial and final species (e.g., A&#8594; C and A&#8594; B&#8594; C).
A closed walk is a sequence of reactions where the initial species is equal to the final species.
These cycles can sometimes lead to problems, either in solving the system of differential equations of the rate laws (for some networks containing cycles, the integrated rate equations cannot be stated in closed form and hence cannot be used with  G<span style="font-size:x-small">NUPLOT</span>) or in the fitting procedure (rate constants in parallel pathways can be strongly correlated and cause large errors and bad convergence in fitting).
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_fIg8.1">
</a>   <div style="text-align:center">  <img src="http://sharc-md.org/wp-content/uploads/2018/02/allowed_notallowed.png">  
<div style="text-align:center">Figure 8.1: Forbidden and allowed features of the reaction network graphs.</div>
  <a id="fig:graph_restrictions">
</a>
</div>
<div class="p"><!----></div>
An example reaction network graph is shown in Figure&nbsp;<a href="#fig:example_graph"> 8.2</a>.
In this graph, there are 5&nbsp;species (S<sub>2</sub>, S<sub>1</sub>, S<sub>0</sub>, T<sub>2</sub>, and T<sub>1</sub>) and 6&nbsp;reactions, each with a rate constant (k<sub>S</sub>, k<sub>Rlx</sub>, k<sub>22</sub>, k<sub>11</sub>, k<sub>21</sub>, k<sub>12</sub>).
This graph shows some features which are allowed in the reaction networks for <b><tt>make_fitscript.py</tt></b>: sequential reactions, parallel reactions, back reactions, and converging reaction pathways.
Note that this reaction network is likely to cause problems in the integrating or fitting steps.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_fIg8.2">
</a>   <div style="text-align:center">  <img src="http://sharc-md.org/wp-content/uploads/2018/02/example_graph.png">  
<div style="text-align:center">Figure 8.2: Example reaction network graph. For explanation see text.</div>
  <a id="fig:example_graph">
</a>
</div>
<div class="p"><!----></div>
     <a id="tth_sEc8.9.2"></a><h3>
8.9.2&nbsp;&nbsp;Kinetic models</h3>
<div class="p"><!----></div>
Based on the reaction network graph, a system of differential equations describing the rate laws of all species can be setup.
The system of equations (equivalently, the matrix differential equation) can be written as:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-62.png"><a id="eq:rate_law">
</a>
</td><td width="1%">(8.40)</td></tr></table>
where <b>s</b> is the vector of the time-dependent populations of each species and <b>A</b> is the matrix containing the rate constants.
In order to construct <b>A</b>, start with <b>A</b>=0 and, for each reaction from species i to species j with rate k, substract k from A<sub>ii</sub> and add k to A<sub>ji</sub>.
<div class="p"><!----></div>
In order to integrate this system of equations, in practice one also needs to define initial conditions. 
In the present context, the initial conditions are fully specified by <b>s</b>(t=0)=<b>s</b><sub>0</sub>, where <b>s</b><sub>0</sub> are constant expressions defined by the user.
<div class="p"><!----></div>
Solving&nbsp;(<a href="#eq:rate_law"> 8.40</a> yields (in not too complicated cases) the closed-form expressions for the functions <b>s</b>(t), which contain as parameters all rate constants k and all initial values <b>s</b>)<sub>0</sub>.
<div class="p"><!----></div>
     <a id="tth_sEc8.9.3"></a><h3>
8.9.3&nbsp;&nbsp;Global fit</h3>
<div class="p"><!----></div>
Suppose there is a data set <b>p</b>(t)=(p<sub>1</sub>(t),p<sub>2</sub>(t),...) of time-dependent populations of several states k=1,2,... and which is given at several points of time {t<sub>i</sub>: 0 &lt; t<sub>i</sub> &lt; t<sub><span class="roman">max</span></sub>}.
We can <i>fit</i> to one data set p<sub>k</sub>(t) a function s<sub>l</sub>(t) from <b>s</b>(t) by optimizing the parameters (mainly the rate constants) such that &#8721;<sub>i</sub> &#124;p<sub>k</sub>(t<sub>i</sub>)&#8722;s<sub>l</sub>(t<sub>i</sub>)&#124;<sup>2</sup> becomes minimal.
<div class="p"><!----></div>
In order to perform global fit including several species l and several states k, we construct piecewise global functions from <b>p</b>(t) and <b>s</b>(t) and then optimize the parameters accordingly.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.10"></a><h2>
8.10&nbsp;&nbsp;Gradient transformation</h2><a id="met:gradtra">
</a>
<div class="p"><!----></div>
Since the actual dynamics is performed on the PESs of the diagonal states, also the gradients have to be transformed to the diagonal representation. To this end, first a generalized gradient matrix <b>G</b><sup>MCH</sup> is constructed from the gradients  <b>g</b><sup>MCH</sup><sub>&#945;</sub>=&#8722;&#8711;<sub>R</sub>H<sub>&#945;&#945;</sub><sup>MCH</sup>
and the nonadiabatic coupling vectors 
<b>K</b><sub>&#946;&#945;</sub><sup>MCH</sup>:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-63.png">
</td><td width="1%">(8.41)</td></tr></table>
Note that all quantities in the matrix are in the MCH representation, the superscripts were omitted for brevity.
<div class="p"><!----></div>
The matrix <b>G</b><sup>MCH</sup> is subsequently transformed into the diagonal representation, using the transformation matrix <b>U</b>:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-64.png">
</td><td width="1%">(8.42)</td></tr></table>
The diagonal elements of <b>G</b><sup>diag</sup> now contain the gradients of the diagonal states, while the off-diagonal elements contain the scaled nonadiabatic couplings &#8722;(H<sup>diag</sup><sub>&#946;&#946;</sub>&#8722;H<sup>diag</sup><sub>&#945;&#945;</sub>)<b>K</b><sub>&#946;&#945;</sub><sup>diag</sup>. The gradients are needed in the Velocity Verlet algorithm in order to propagate the nuclear coordinates. The nonadiabatic couplings are necessary if the velocity vector is to be rescaled along the nonadiabatic coupling vector.
<div class="p"><!----></div>
Since the matrix <b>G</b><sup>MCH</sup> contains elements which are itself vectors with 3N components, the transformation is done component-wise (e.g.&nbsp;first a matrix G<sub>x,atom 1</sub> is constructed from the x components of all gradients (and nonadiabatic couplings) for atom 1, this matrix is transformed and written to the x, atom 1 component of <b>G</b><sup>diag</sup>, then this is repeated for all components).
<div class="p"><!----></div>
Since the calculation of the nonadiabatic couplings <b>K</b><sup>MCH</sup><sub>&#946;&#945;</sub> might add considerable computational cost, there is the input keyword <b><tt>nogradcorrect</tt></b> which tells  S<span style="font-size:x-small">HARC</span>&nbsp;to neglect the <b>K</b><sup>MCH</sup><sub>&#946;&#945;</sub> in the gradient transformation.
<div class="p"><!----></div>
     <a id="tth_sEc8.10.1"></a><h3>
8.10.1&nbsp;&nbsp;Dipole moment derivatives</h3><a id="met:dipolegrad">
</a>
<div class="p"><!----></div>
For strong laser fields, the derivative of the dipole moments might be a non-negligible contribution to the gradients. In this case, they should be included in the gradient transformation step:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-65.png">
</td><td width="1%">(8.43)</td></tr></table>
This can be activated with the keyword <b><tt>dipole_grad</tt></b> in the  S<span style="font-size:x-small">HARC</span>&nbsp;input file.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.11"></a><h2>
8.11&nbsp;&nbsp;Internal coordinates definitions</h2><a id="met:geo">
</a>
<div class="p"><!----></div>
In this section, the internal coordinates available in <b><tt>geo.py</tt></b> are defined.
<div class="p"><!----></div>
<b>Bond length&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The bond length between two atoms a and b is:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-66.png">
</td><td width="1%">(8.44)</td></tr></table>
<div class="p"><!----></div>
<b>Bond angle&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The bond angle for atoms a, b and c is defined as the angle
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-67.png"><a id="eq:angle">
</a>
</td><td width="1%">(8.45)</td></tr></table>
where <b>v</b><sub>ba</sub> is the vector from atom b to atom a.
<div class="p"><!----></div>
<b>Dihedral&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The dihedral angle is defined via the vectors <b>w</b><sub>1</sub> and <b>w</b><sub>2</sub>:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-68.png">
</td><td width="1%">(8.46)</td></tr></table>
The dihedral is given as the angle between <b>w</b><sub>1</sub> and <b>w</b><sub>2</sub> according to equation&nbsp;(<a href="#eq:angle"> 8.45</a>).
In order to distinguish left- and right-handed rotation, also the vector <b>Q</b>=<b>w</b><sub>1</sub>&times;<b>w</b><sub>2</sub> is computed, and if the angle between <b>Q</b> and <b>v</b><sub>bc</sub> is larger than 90<sup>&#176;</sup> then the value of the dihedral is multiplied by -1.
<div class="p"><!----></div>
<b>Pyramidalization angle&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The pyramidalization angle is defined via the vectors <b>v</b><sub>ba</sub> and 
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-69.png">
</td><td width="1%">(8.47)</td></tr></table>
The pyramidalization angle is then given as 90<sup>&#176;</sup> &#8722; &#952;(<b>v</b><sub>ba</sub>,<b>w</b><sub>1</sub>).
This definition of the pyramidalization angle works best for nearly planar arrangements, like in amino groups.
<div class="p"><!----></div>
An alternative definition of the pyramidalization angle works better for strongly pyramidalized situations (e.g., <em>fac</em>-arranged atoms in a octahedral metal complex).
This pyramidalization angle is defined as 180<sup>&#176;</sup> minus the angle between <b>v</b><sub>ab</sub> and the average of <b>v</b><sub>bc</sub> and <b>v</b><sub>bd</sub>.
<div class="p"><!----></div>
<b>Cremer-Pople parameters&nbsp;&nbsp;</b>
<div class="p"><!----></div>
The definitions of the Cremer-Pople parameters for 5- and 6-membered rings is described in <a href="#Cremer1975JACS" class="tth_citeref">[78</a>].
<div class="p"><!----></div>
<b>Boeyens classification&nbsp;&nbsp;</b>
<div class="p"><!----></div>
For 6-membered rings, the Boeyens classification scheme is described in <a href="#Boeyens1976JCMS" class="tth_citeref">[79</a>].
<div class="p"><!----></div>
<b>Angle between two rings&nbsp;&nbsp;</b>
<div class="p"><!----></div>
In order to compute angles between the mean planes of two rings, we compute the normal vector of the two rings as in <a href="#Cremer1975JACS" class="tth_citeref">[78</a>].
We then compute the angle between the two normal vectors.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.12"></a><h2>
8.12&nbsp;&nbsp;Kinetic energy adjustments</h2><a id="met:ekinadj">
</a>
<div class="p"><!----></div>
There are several options how to adjust the kinetic energy after a surface hop occurred. The simplest option is to not adjust the kinetic energy at all (input: <b><tt>ekincorrect none</tt></b>), but this obviously leads to violation of the conservation of total energy.
<div class="p"><!----></div>
Alternatively, the velocities of all atoms can be rescaled so that the new kinetic energy and the potential energy of the new state &#946; again sum up to the total energy.
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-70.png">
</td><td width="1%">(8.48)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-71.png">
</td><td width="1%">(8.49)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-72.png">
</td><td width="1%">(8.50)</td></tr></table>
Within this methodology, when the energy of the old state &#945; was lower than the energy of the new state &#946; the kinetic energy is lowered. Since the kinetic energy must be positive, this implies that there might be states which cannot be reached (their potential energy is above the total energy). A hop to such a state is called "frustrated hop" and will be rejected by  S<span style="font-size:x-small">HARC</span>. Rescaling parallel to the nuclear velocity vector is requested with <b><tt>ekincorrect parallel_vel</tt></b>.
<div class="p"><!----></div>
Alternatively, according to Tully's original formulation of the surface hopping method <a href="#Tully1990JCP" class="tth_citeref">[14</a>], after a hop from &#945; to &#946; only the component of the velocity along the direction of the nonadiabatic coupling vector <b>K</b><sub>&#946;&#945;</sub> should be rescaled. With
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-73.png">
</td><td width="1%">(8.51)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-74.png">
</td><td width="1%">(8.52)</td></tr></table>
the available energy can be calculated:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-75.png">
</td><td width="1%">(8.53)</td></tr></table>
If &#8710; &lt; 0, the hop is frustrated and will be rejected. Otherwise, the scaled velocities <b>v</b>&#8242; can be calculated as
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-76.png">
</td><td width="1%">(8.54)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-77.png">
</td><td width="1%">(8.55)</td></tr></table>
This procedure can be requested with <b><tt>ekincorrect parallel_nac</tt></b>. Note that in this case  S<span style="font-size:x-small">HARC</span>&nbsp;will request the nonadiabatic coupling vectors, even if they are not used for the wave function propagation.
<div class="p"><!----></div>
     <a id="tth_sEc8.12.1"></a><h3>
8.12.1&nbsp;&nbsp;Reflection for frustrated hops</h3><a id="met:refl_frust">
</a>
<div class="p"><!----></div>
As suggested by Tully <a href="#Tully1990JCP" class="tth_citeref">[14</a>], during a frustrated hop one might want to reflect the trajectory (i.e., invert some component of the velocity vector).
In  S<span style="font-size:x-small">HARC</span>, there are three possible options to this, the first being no reflection (<b><tt>reflect_frustrated none</tt></b>).
Alternatively, one can invert the total velocity vector <b>v</b>:=&#8722;<b>v</b> (<b><tt>reflect_frustrated parallel_vel</tt></b>).
<div class="p"><!----></div>
As this leads to a nearly complete time reversal and might be inappropriate, as a third option one can choose to only reflect the velocity component parallel to the nonadiabatic coupling vector between the active state and the state to which the frustrated hop was attempted.
The condition for reflection in this case is based on three scalar products:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-78.png">
</td><td width="1%">(8.56)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-79.png">
</td><td width="1%">(8.57)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-80.png">
</td><td width="1%">(8.58)</td></tr></table>
Reflection is only carried out if k<sub>1</sub>k<sub>2</sub> &lt; 0 and k<sub>2</sub>k<sub>3</sub> &lt; 0.
In order to reflect, we compute:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-81.png">
</td><td width="1%">(8.59)</td></tr></table>
where <b>t</b><sub>A</sub> is the component of <b>t</b><sub>&#945;f</sub> corresponding to atom A.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.13"></a><h2>
8.13&nbsp;&nbsp;Laser fields</h2><a id="met:laser_field">
</a>
<div class="p"><!----></div>
The program <b><tt>laser.x</tt></b> can calculate laser fields as superpositions of several analytical, possibly chirped, laser pulses. In the following, the laser parametrization is given (see <a href="#Marquetand2007" id="CITEMarquetand2007" class="tth_citation">[104</a>] for further details).
<div class="p"><!----></div>
     <a id="tth_sEc8.13.1"></a><h3>
8.13.1&nbsp;&nbsp;Form of the laser field</h3>
<div class="p"><!----></div>
In general, the laser field &#1013;(t) is a linear superposition of a number of laser pulses l<sub>i</sub>(t):
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-82.png">
</td><td width="1%">(8.60)</td></tr></table>
where <b>p</b><sub>i</sub> is the normalized polarization vector of pulse i.
<div class="p"><!----></div>
A pulse l(t) is formed as the product of an envelope function and a field function. 
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-83.png">
</td><td width="1%">(8.61)</td></tr></table>
<div class="p"><!----></div>
     <a id="tth_sEc8.13.2"></a><h3>
8.13.2&nbsp;&nbsp;Envelope functions</h3>
<div class="p"><!----></div>
There are two types of envelope function defined in <b><tt>laser.x</tt></b>, which are Gaussian and sinusoidal.
<div class="p"><!----></div>
The Gaussian envelope is defined as:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-84.png"><a id="eq:laser_gauss_1">
</a>
</td><td width="1%">(8.62)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-85.png"><a id="eq:laser_gauss_2">
</a>
</td><td width="1%">(8.63)</td></tr></table>
where <i>E</i><sub>0</sub> is the peak field strength, FWHM is the full width at half maximum and t<sub>c</sub> is the temporal center of the pulse.
<div class="p"><!----></div>
The sinusoidal envelope is defined as:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-86.png"><a id="eq:laser_sinus">
</a>
</td><td width="1%">(8.64)</td></tr></table>
where again <i>E</i><sub>0</sub> is the peak field strength, t<sub>0</sub> and t<sub>c</sub> define the interval where the field strength increases, and t<sub>c2</sub> and t<sub>e</sub> define the interval where the field strength decreases. Figure&nbsp;<a href="#fig:laser_envelope"> 8.3</a> shows the general form of the envelope functions and the meaning of the temporal parameters t<sub>0</sub>, t<sub>c</sub>, t<sub>2c</sub> and t<sub>e</sub>.
<div class="p"><!----></div>
<div class="p"><!----></div>
<a id="tth_fIg8.3">
</a>   <div style="text-align:center">  <img src="http://sharc-md.org/wp-content/uploads/2018/02/laser_envelope.png">  
<div style="text-align:center">Figure 8.3: Types of laser envelopes implemented in <b><tt>laser.x</tt></b>.</div>
  <a id="fig:laser_envelope">
</a>
</div>
<div class="p"><!----></div>
     <a id="tth_sEc8.13.3"></a><h3>
8.13.3&nbsp;&nbsp;Field functions</h3>
<div class="p"><!----></div>
The field function f(t) is defined as:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-87.png">
</td><td width="1%">(8.65)</td></tr></table>
where &#969;<sub>0</sub> is the central frequency and &#981; is the phase of the pulse. Even though the laser field is complex in this expression, in the propagation of the electronic wave function in  S<span style="font-size:x-small">HARC</span>&nbsp;only the real part is used.
<div class="p"><!----></div>
     <a id="tth_sEc8.13.4"></a><h3>
8.13.4&nbsp;&nbsp;Chirped pulses</h3>
<div class="p"><!----></div>
In order to apply a chirp to the laser pulse l(t), it is first Fourier transformed to the frequency domain, giving the function <span class="overacc1">~</span>l(&#969;). The chirp is applied by calculating:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-88.png"><a id="eq:laser_chirp">
</a>
</td><td width="1%">(8.66)</td></tr></table>
The chirped laser in the time domain l&#8242;(t) is then obtained by Fourier transform of the chirped pulse <span class="overacc1">~</span>l&#8242;(&#969;).
<div class="p"><!----></div>
     <a id="tth_sEc8.13.5"></a><h3>
8.13.5&nbsp;&nbsp;Quadratic chirp without Fourier transform</h3>
<div class="p"><!----></div>
If <b><tt>laser.x</tt></b> was compiled without the FFTW package, the only accessible chirps are quadratic chirps for Gaussian pulses:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-89.png">
</td><td width="1%">(8.67)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-90.png">
</td><td width="1%">(8.68)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-91.png">
</td><td width="1%">(8.69)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-92.png">
</td><td width="1%">(8.70)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-93.png">
</td><td width="1%">(8.71)</td></tr></table>
Other chirps are only possible with the Fourier transformation.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.14"></a><h2>
8.14&nbsp;&nbsp;Laser interactions</h2><a id="met:laser">
</a>
<div class="p"><!----></div>
The laser field &#1013; is included in the propagation of the electronic wave function. In each substep of the propagation, the interaction of the laser field with the dipole moments is included in the Hamiltonian. The contribution <b>V</b><sub>i</sub> is in each time step added to the Hamiltonian in equations&nbsp;(<a href="#eq:ham_propn"> 8.126</a> or ), respectively:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-94.png">
</td><td width="1%">(8.72)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-95.png">
</td><td width="1%">(8.73)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-96.png">
</td><td width="1%">(8.74)</td></tr></table>
where i, n t and &#8710;t are defined as in section <a href="#met:propagate">8.27</a>.
<div class="p"><!----></div>
     <a id="tth_sEc8.14.1"></a><h3>
8.14.1&nbsp;&nbsp;Surface Hopping with laser fields</h3>
<div class="p"><!----></div>
If laser fields are present, there can be two fundamentally different types of hops: laser-induced hops and nonadiabatic hops. The latter ones are the same hops as in the laser-free simulations, and demand that the total energy is conserved. The laser-induced hops on the other hand demand that the momentum (kinetic energy) is conserved. Hence,  S<span style="font-size:x-small">HARC</span>&nbsp;needs to decide for every hop whether it is laser-induced or not. 
<div class="p"><!----></div>
Consider a previous state &#945; and a new state &#946;. Currently, the hop is classified based on the energy gap &#8710;E=&#124;E<sub>&#946;</sub><sup>diag</sup>&#8722;E<sub>&#945;</sub><sup>diag</sup>&#124; and the instantaneous central energy of the laser pulse &#969;. 
The hop is assumed to be laser-induced if
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-97.png">
</td><td width="1%">(8.75)</td></tr></table>
where W is a fixed parameter. W can be set using the input keyword <b><tt>laserwidth</tt></b>.
<div class="p"><!----></div>
If a hop has been classified as laser-free, the momentum is adjusted according to the equations given in section&nbsp;<a href="#met:ekinadj">8.12</a>.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.15"></a><h2>
8.15&nbsp;&nbsp;Normal Mode Analysis</h2><a id="met:nma">
</a>
<div class="p"><!----></div>
The normal mode analysis can be used to find important vibrational modes in the excited-state dynamics.<a href="#Kurtz2001JCP" class="tth_citeref">[80</a>,<a href="#Plasser2009" class="tth_citeref">[81</a>]
<div class="p"><!----></div>
Given a matrix <b>Q</b> containing the normal mode vectors and a reference geometry <b>R</b><sup>ref</sup>, calculate for each trajectory
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-98.png">
</td><td width="1%">(8.76)</td></tr></table>
to obtain the displacements in normal mode coordinates.
Averaging over the displacements gives the average trajectory:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-99.png">
</td><td width="1%">(8.77)</td></tr></table>
which should contain only coherent motion, since random motion cancels out in an ensemble.
<div class="p"><!----></div>
A measure for the coherent activity in a mode is the standard deviation (over time) of the average trajectory:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-100.png">
</td><td width="1%">(8.78)</td></tr></table>
where k<sub>start</sub> and k<sub>end</sub> are the start and end time steps for the analysis.
R<sub>coh</sub> a vector with one number per normal mode, where larger number mean that there is more coherent activity in this mode.
<div class="p"><!----></div>
A measure for the total motion in a mode is the total standard deviation:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-101.png">
</td><td width="1%">(8.79)</td></tr></table>
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.16"></a><h2>
8.16&nbsp;&nbsp;Optimization of Crossing Points</h2><a id="met:orcaopt">
</a>
<div class="p"><!----></div>
With <b><tt>orca_External</tt></b> it is possible to optimize different kinds of crossing points.
In all cases, these optimizations involve the energies of the lower state E<sub>l</sub> and upper state E<sub>u</sub>, the energy difference &#8710;E=E<sub>u</sub>&#8722;E<sub>l</sub>, the gradients of the lower state <b>g</b><sub>l</sub> and upper state <b>g</b><sub>u</sub>, the gradient difference vector <b>d</b>, and/or the nonadiabatic coupling vector <b>t</b>.
<div class="p"><!----></div>
The simplest case is the optimization of minimum-energy crossing points between states of different multiplicity, because in this case the nonadiabatic coupling vector is zero and the branching space is one-dimensional.
In this case <a href="#Bearpark1994CPL" class="tth_citeref">[84</a>], the energy to optimize is E<sub>u</sub> inside the intersection space, and &#8710;E inside the branching space.
The corresponding gradient to follow <b>F</b> can be written as:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-102.png">
</td><td width="1%">(8.80)</td></tr></table>
<div class="p"><!----></div>
More complicated is the optimization of a conical intersection, between states of the same multiplicity, because the branching space is two-dimensional.
The corresponding gradient to follow <b>F</b> is:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-103.png">
</td><td width="1%">(8.81)</td></tr></table>
where <b>d</b> and <b>t</b> need to be orthogonalized.
<div class="p"><!----></div>
If no nonadiabatic coupling vector is available because the interface cannot deliver them, conical intersections are optimized with the penalty function method of Levine et al.&nbsp;<a href="#Levine2008JPCB" class="tth_citeref">[85</a>].
The effective energy to optimize is defined as:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-104.png">
</td><td width="1%">(8.82)</td></tr></table>
This equation is a combination of the two main targets of the optimization, the average energy and the energy gap. 
The parameter &#963; allows prioritizing either of the two, with a larger &#963; leading to smaller energy gaps.
The parameter &#945; is there to avoid the discontinuity at E<sub>u</sub>=E<sub>l</sub>.
The corresponding gradient to follow <b>F</b> is:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-105.png">
</td><td width="1%">(8.83)</td></tr></table>
Note that &#963; and &#945; might strongly influence the quality (i.e., with the penalty function method the optimization will not converge to the true minimum energy conical intersection point) of the result and the convergence behavior.
A large &#963; and a small &#945; will improve the quality of the result, but make the optimization harder to converge.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.17"></a><h2>
8.17&nbsp;&nbsp;Phase tracking</h2>
<div class="p"><!----></div>
     <a id="tth_sEc8.17.1"></a><h3>
8.17.1&nbsp;&nbsp;Phase tracking of the transformation matrix</h3><a id="met:phase_track">
</a>
<div class="p"><!----></div>
A Hermitian matrix <b>H</b><sup>MCH</sup> can always be diagonalized. Its eigenvectors form the rows of a unitary matrix <b>U</b>, which can be used to transform between the original basis and the basis of the eigenfunctions of <b>H</b>. 
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-106.png">
</td><td width="1%">(8.84)</td></tr></table>
<div class="p"><!----></div>
However, the condition that <b>U</b> diagonalizes <b>H</b><sup>MCH</sup> is not sufficient to define <b>U</b> uniquely. Each normalized eigenvector <b>u</b> can be multiplied by a complex number on the unit circle and still remains a normalized eigenvector:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-107.png">
</td><td width="1%">(8.85)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-108.png">
</td><td width="1%">(8.86)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-109.png">
</td><td width="1%">(8.87)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-110.png">
</td><td width="1%">(8.88)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-111.png">
</td><td width="1%">(8.89)</td></tr></table>
Thus, for all diagonal matrices &#934; with elements 
 &#948;<sub>&#946;&#945;</sub>exp(<span class="roman">i</span>&#981;<sub>&#946;</sub>), 
also the matrix <b>U</b>&#8242;=<b>U</b>&#934; diagonalizes <b>H</b><sup>MCH</sup> (if <b>U</b> diagonalizes it).
<div class="p"><!----></div>
The propagation of the coefficients in the diagonal basis is written as (see section&nbsp;<a href="#met:propagate">8.27</a>):
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-112.png">
</td><td width="1%">(8.90)</td></tr></table>
where <b>U</b>(t) and <b>U</b>(t+&#8710;t) are determined independently from diagonalizing the matrices <b>H</b><sup>MCH</sup>(t) and <b>H</b><sup>MCH</sup>(t+&#8710;t), respectively. However, depending on the implementation of the diagonalization, <b>U</b>(t) and <b>U</b>(t+&#8710;t) may carry unrelated, random phases. Even if <b>H</b><sup>MCH</sup>(t) and <b>H</b><sup>MCH</sup>(t+&#8710;t) were identical, <b>U</b>(t) and <b>U</b>(t+&#8710;t) might still differ, e.g.:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-113.png">
</td><td width="1%">(8.91)</td></tr></table>
The result is that the coefficients <b>c</b> pick up random phases during the propagation, leading to random changes in the direction of population transfer, invalidating the whole propagation.
<div class="p"><!----></div>
In order to make the phases of <b>U</b>(t) and <b>U</b>(t+&#8710;t) as similar as possible,  S<span style="font-size:x-small">HARC</span>&nbsp;employs a projection technique. First, we define the overlap matrix <b>V</b> between <b>U</b>(t) and <b>U</b>(t+&#8710;t):
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-114.png">
</td><td width="1%">(8.92)</td></tr></table>
For &#8710;t=0, clearly
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-115.png">
</td><td width="1%">(8.93)</td></tr></table>
and <b>V</b> can be identified with the phase matrix &#934;.
<div class="p"><!----></div>
For &#8710;t &#8800; 0, we must now find a matrix <b>P</b> so that
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-116.png">
</td><td width="1%">(8.94)</td></tr></table>
still diagonalizes <b>H</b><sup>MCH</sup>(t+&#8710;t), but which minimizes the phase change with regard to <b>U</b>(t).
The matrix <b>P</b> has elements
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-117.png">
</td><td width="1%">(8.95)</td></tr></table>
where E<sub>&#946;</sub> is the &#946;-th eigenvalue of <b>H</b><sup>MCH</sup>(t+&#8710;t).
<div class="p"><!----></div>
Within the  S<span style="font-size:x-small">HARC</span>&nbsp;algorithm, the phase of <b>U</b>(t+&#8710;t) is adjusted to be most similar to <b>U</b>(t) by calculating first <b>V</b>, generating <b>P</b> from <b>V</b> and the eigenvalues of <b>H</b><sup>MCH</sup>(t+&#8710;t) and calculating the phase-corrected matrix <b>U</b>&#8242;(t+&#8710;t) as <b>U</b>(t+&#8710;t)<b>P</b>.
<div class="p"><!----></div>
     <a id="tth_sEc8.17.2"></a><h3>
8.17.2&nbsp;&nbsp;Tracking of the phase of the MCH wave functions</h3>
<div class="p"><!----></div>
Additionally, within the quantum chemistry programs, the phases of the electronic wave functions may change from one time step to the next one. This will result in changes of the phase of all off-diagonal matrix elements (spin-orbit couplings, transition dipole moments, nonadiabatic couplings).  S<span style="font-size:x-small">HARC</span>&nbsp;has several possibilities to correct for that:
<ul>
<li> The interface can provide wave function phases through <b><tt>QM.out</tt></b>.
<div class="p"><!----></div>
</li>
<li> If the overlap matrix is available, its diagonal contains the necessary phase information.
<div class="p"><!----></div>
</li>
<li> Otherwise the scalar products of old and new nonadiabatic couplings and the relative phase of SOC matrix elements can be used to construct phase information.
<div class="p"><!----></div>
</li>
</ul>
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.18"></a><h2>
8.18&nbsp;&nbsp;Random initial velocities</h2><a id="met:veloc">
</a>
<div class="p"><!----></div>
Random initial velocities are calculated with a given amount of kinetic energy E per atom a. For each atom, the velocity is calculated as follows, with two uniform random numbers &#952; and &#981;, from the interval [0,1[:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-118.png">
</td><td width="1%">(8.96)</td></tr></table>
This procedure gives a uniform probability distribution on a sphere with radius &#8730;{2E/m<sub>a</sub>}.
<div class="p"><!----></div>
Note that the translational and rotational components of random initial velocities are not projected out in the current implementation.
<div class="p"><!----></div>
Random initial velocities can be requested in the input with <b><tt>veloc random E</tt></b>, where E is a float defining the kinetic energy per atom (in eV).
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.19"></a><h2>
8.19&nbsp;&nbsp;Representations</h2><a id="sec:repr">
</a>
<div class="p"><!----></div>
Within  S<span style="font-size:x-small">HARC</span>, two different representations for the electronic states are used. The first is the so-called MCH basis, which is the basis of the eigenfunctions of the molecular Coulomb Hamiltonian. The molecular Coulomb Hamiltonian is the standard electronic Hamiltonian employed by the majority of quantum chemistry programs. It contains only the kinetic energy of the electrons and the potential energy arising from the Coulomb interaction between the electrons and nuclei.
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-119.png">
</td><td width="1%">(8.97)</td></tr></table>
With this hamiltonian, states of the same multiplicity couple via the nonadiabatic couplings, while states of different multiplicity do not interact at all. 
<div class="p"><!----></div>
The second representation used in  S<span style="font-size:x-small">HARC</span>&nbsp;is the so-called diagonal representation. It is the basis of the eigenfunctions of the total Hamiltonian.
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-120.png">
</td><td width="1%">(8.98)</td></tr></table>
The term <span class="overacc1">&#8743;</span>H<sub>el</sub><sup>coup</sup> contains additional couplings not contained in the molecular Coulomb Hamiltonian. The most common couplings are spin-orbit couplings and interactions with an external electric field.
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-121.png">
</td><td width="1%">(8.99)</td></tr></table>
Both of these couplings introduce off-diagonal elements in the total Hamiltonian. Thus, the eigenfunctions of the molecular Coulomb Hamiltonian are not the eigenfunctions of the total Hamiltonian. 
<div class="p"><!----></div>
Within  S<span style="font-size:x-small">HARC</span>, usually quantum chemistry information is read in the MCH representation, while the surface hopping is performed in the diagonal one.
<div class="p"><!----></div>
     <a id="tth_sEc8.19.1"></a><h3>
8.19.1&nbsp;&nbsp;Current state in MCH representation</h3><a id="ssec:state_transform">
</a>
<div class="p"><!----></div>
Oftentimes, it is very useful to know to which MCH state the currently active diagonal state corresponds. If <span class="overacc1">&#8743;</span>H<sub>el</sub><sup>coup</sup> is small or the state separation is large, then each diagonal state approximately corresponds to one MCH state. Only in the case of large couplings and/or near-degenerate states are the MCH states strongly mixed in the diagonal states.
<div class="p"><!----></div>
In order to obtain for a given time step from the currently active diagonal state &#946; the corresponding MCH state &#945;, a vector <b>c</b><sup>diag</sup> with c<sub>i</sub><sup>diag</sup>=&#948;<sub>i&#946;</sub> is generated. The vector is transformed into the MCH representation
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-122.png">
</td><td width="1%">(8.100)</td></tr></table>
The corresponding MCH state &#945; is the index of the (absolute) largest element of vector <b>c</b><sup>MCH</sup>.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.20"></a><h2>
8.20&nbsp;&nbsp;Sampling from Wigner Distribution</h2><a id="met:wigner">
</a>
<div class="p"><!----></div>
The sampling is based on references&nbsp;<a href="#Dahl1988JCP" class="tth_citeref">[74</a>,<a href="#Schinke1995" class="tth_citeref">[75</a>].
<div class="p"><!----></div>
Besides the equilibrium geometry <b>R</b><sub>eq</sub>, the optimization plus frequency calculation provides a set of vibrational frequencies {&#957;<sub>i</sub>} and the corresponding normal mode vectors {<b>n</b><sub>i</sub>}, where i runs from 1 to N=3n<sub>atom</sub>.
<div class="p"><!----></div>
The normal mode vectors need to be provided in terms of mass-weighted Cartesian normal modes, in units of [l[a.u.]&#183;&#8730;{m[a.u.]}].
Most quantum chemistry programs follow different conventions when writing  M<span style="font-size:x-small">OLDEN</span> files.  M<span style="font-size:x-small">OLPRO</span> and  M<span style="font-size:x-small">OLCAS</span> write these files with unweighted Cartesian normal modes, with units of [l[a.u.]].  G<span style="font-size:x-small">AUSSIAN</span>,  T<span style="font-size:x-small">URBOMOLE</span>,  Q-C<span style="font-size:x-small">HEM</span>,  ADF, and  O<span style="font-size:x-small">RCA</span> employ what could be called the " G<span style="font-size:x-small">AUSSIAN</span> convention", which are normalized Cartesian normal modes.  C<span style="font-size:x-small">OLUMBUS</span> uses yet another convention in the output of their <b><tt>suscal.x</tt></b> module.
The script <b><tt>wigner.py</tt></b> automatically transforms these different conventions; it does so by applying all possible transformations to the input data until it finds one transformation which produces an orthonormal normal mode matrix.
The latter one is then used for the Wigner sampling.
<div class="p"><!----></div>
In order to create an initial condition (<b>R</b>,<b>v</b>), the following procedure is applied. Initially, <b>R</b><sub>0</sub>=<b>R</b><sub>eq</sub> and <b>v</b><sub>0</sub>=0. Then, for each normal mode i, two random numbers P<sub>i</sub> and Q<sub>i</sub> are chosen uniformly from the interval [&#8722;3,3]. The value of a ground state quantum Wigner distribution for these values is calculated:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-123.png">
</td><td width="1%">(8.101)</td></tr></table>
W<sub>i</sub> is compared to a uniform random r<sub>i</sub> number from [0,1]. If W<sub>i</sub> &gt; r<sub>i</sub>, then P<sub>i</sub> and Q<sub>i</sub> are accepted and the coordinates and velocities are updated:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-124.png"><a id="eq:wigner1">
</a>
</td><td width="1%">(8.102)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-125.png"><a id="eq:wigner2">
</a>
</td><td width="1%">(8.103)</td></tr></table>
The random number procedure and updates are repeated for all normal modes, until (<b>R</b><sub>N</sub>,<b>v</b>)<sub>N</sub> is obtained, which constitutes one initial condition. Finally, the center of mass is restored and translational and rotational components are projected out of <b>v</b>. The harmonic potential energy is given by:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-126.png">
</td><td width="1%">(8.104)</td></tr></table>
<div class="p"><!----></div>
     <a id="tth_sEc8.20.1"></a><h3>
8.20.1&nbsp;&nbsp;Sampling at Non-zero Temperature</h3>
<div class="p"><!----></div>
<div class="p"><!----></div>
In the case of a non-zero temperature, the molecule might not be in the vibrational ground state of the harmonic oscillator, but rather in an excited vibrational state.
For a given mode i, the probability to be in any given vibrational state j (j=0 is the ground state) is:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-127.png">
</td><td width="1%">(8.105)</td></tr></table>
where y is &#957;<sub>i</sub> divided by k<sub>B</sub>T.
In order to find the vibrational state for mode i, a random number is drawn (from [0,1]) and used as in equation&nbsp;(<a href="#eq:cumuprob"> 8.109</a>).
<div class="p"><!----></div>
The displacements and velocity contributions for mode i in state j are then obtained as in equations&nbsp;(<a href="#eq:wigner1"> 8.100</a> and ), except that the Wigner distribution for state j is calculated as:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-128.png">
</td><td width="1%">(8.106)</td></tr></table>
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.21"></a><h2>
8.21&nbsp;&nbsp;Scaling</h2><a id="met:scaling">
</a>
<div class="p"><!----></div>
The scaling factor (keyword <b><tt>scaling</tt></b>) applies to all energies and derivatives of energies. Hence, the full Hamiltonian is scaled, and the gradients are scaled. Nothing else is scaled (no dipole moments, nonadiabatic couplings, overlaps, etc).
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.22"></a><h2>
8.22&nbsp;&nbsp;Seeding of the RNG</h2><a id="met:seed">
</a>
<div class="p"><!----></div>
The standard Fortran 90 random number generator (used for <b><tt>sharc.x</tt></b>, but not for the auxiliary scripts) is seeded by a sequence of integers of length n, where n depends on the computer architecture. The input of  S<span style="font-size:x-small">HARC</span>, however, takes only a single RNG seed, which must reproducibly produce the same sequence of random numbers for the same input.
<div class="p"><!----></div>
In order to generate the seed sequence from the single input x, the following procedure is applied:
<ul>
<li> Query for the number n,
<div class="p"><!----></div>
</li>
<li> Generate a first seed sequence <b>s</b> with s<sub>i</sub>=x+37i+17i<sup>2</sup>,
<div class="p"><!----></div>
</li>
<li> Seed with the sequence <b>s</b>,
<div class="p"><!----></div>
</li>
<li> Obtain a sequence <b>r</b> of n random numbers on the interval [0,1[,
<div class="p"><!----></div>
</li>
<li> Generate a second seed sequence <b>s</b>&#8242; with s<sub>i</sub>&#8242;=int(65536(r<sub>i</sub>&#8722;[1/2])),
<div class="p"><!----></div>
</li>
<li> Reseed with the sequence <b>s</b>&#8242;.
<div class="p"><!----></div>
</li>
</ul>
The fifth step will generate a sequence of nearly uncorrelated numbers, distributed uniformly over the full range of possible integer values. 
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.23"></a><h2>
8.23&nbsp;&nbsp;Selection of gradients and nonadiabatic couplings</h2><a id="met:selection">
</a>
<div class="p"><!----></div>
In order to increase performance, it is possible to omit the calculation of certain gradients and nonadiabatic couplings. An energy-gap-based algorithm selects at each time step a subset of all possible gradients and nonadiabatic couplings to be calculated. Given the diagonal energy E<sup>diag</sup><sub>&#958;</sub> of the current active state &#958;, the gradient <b>g</b><sup>MCH</sup><sub>&#945;</sub> of MCH state &#945; is calculated if:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-129.png">
</td><td width="1%">(8.107)</td></tr></table>
where &#949;<sub>grad</sub> is the selection threshold.
<div class="p"><!----></div>
Similarly, a nonadiabatic coupling vector <b>K</b><sup>MCH</sup><sub>&#946;&#945;</sub> is calculated if:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-130.png">
</td><td width="1%">(8.108)</td></tr></table>
with selection threshold &#949;<sub>nac</sub>.
<div class="p"><!----></div>
Neither <b>g</b><sup>MCH</sup><sub>&#945;</sub> nor <b>K</b><sup>MCH</sup><sub>&#946;&#945;</sub> are ever calculated if &#945; or &#946; are frozen states.
<div class="p"><!----></div>
There is only one keyword (<b><tt>eselect</tt></b>) to set the selection threshold, so &#949;<sub>grad</sub> and &#949;<sub>nac</sub> are the same in most cases. 
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.24"></a><h2>
8.24&nbsp;&nbsp;State ordering</h2><a id="met:ordering">
</a>
<div class="p"><!----></div>
The canonical ordering of MCH states of different S and M<sub>S</sub> in  S<span style="font-size:x-small">HARC</span>&nbsp;is as follows. In the innermost loop, the quantum number is increased; then M<sub>S</sub> and finally S. Example:
<div class="p"><!----></div>
        <tt>nstates&nbsp;3&nbsp;0&nbsp;3</tt>
<div class="p"><!----></div>
In this example, the order of states is given as:
<div class="p"><!----></div>
<table>
<tr><td align="right">Number      </td><td align="left">Label       </td><td align="center">S </td><td align="center">M<sub>S</sub>  </td><td align="center">n</td></tr>
<tr><td align="right">1</td><td align="left">S<sub>0</sub>       </td><td align="center">0</td><td align="center">0</td><td align="center">1</td></tr>
<tr><td align="right">2</td><td align="left">S<sub>1</sub>       </td><td align="center">0</td><td align="center">0</td><td align="center">2</td></tr>
<tr><td align="right">3</td><td align="left">S<sub>2</sub>       </td><td align="center">0</td><td align="center">0</td><td align="center">3</td></tr>
<tr><td align="right">4</td><td align="left">T<sub>1</sub><sup>&#8722;</sup>       </td><td align="center">2</td><td align="center">-1</td><td align="center">1</td></tr>
<tr><td align="right">5</td><td align="left">T<sub>2</sub><sup>&#8722;</sup>       </td><td align="center">2</td><td align="center">-1</td><td align="center">2</td></tr>
<tr><td align="right">6</td><td align="left">T<sub>3</sub><sup>&#8722;</sup>       </td><td align="center">2</td><td align="center">-1</td><td align="center">3</td></tr>
<tr><td align="right">7</td><td align="left">T<sub>1</sub><sup>0</sup>       </td><td align="center">2</td><td align="center">0</td><td align="center">1</td></tr>
<tr><td align="right">8</td><td align="left">T<sub>2</sub><sup>0</sup>       </td><td align="center">2</td><td align="center">0</td><td align="center">2</td></tr>
<tr><td align="right">9</td><td align="left">T<sub>3</sub><sup>0</sup>       </td><td align="center">2</td><td align="center">0</td><td align="center">3</td></tr>
<tr><td align="right">10</td><td align="left">T<sub>1</sub><sup>+</sup>       </td><td align="center">2</td><td align="center">+1</td><td align="center">1</td></tr>
<tr><td align="right">11</td><td align="left">T<sub>2</sub><sup>+</sup>       </td><td align="center">2</td><td align="center">+1</td><td align="center">2</td></tr>
<tr><td align="right">12</td><td align="left">T<sub>3</sub><sup>+</sup>       </td><td align="center">2</td><td align="center">+1</td><td align="center">3</td></tr></table>
<div class="p"><!----></div>
The canonical ordering of states is for example important in order to specify the initial state in the MCH basis (using the <b><tt>state</tt></b> keyword in the input file).
<div class="p"><!----></div>
Note that the diagonal states do not follow the same prescription. Since the diagonal states are in general not eigenfunctions of the total spin operator, they do not have a well-defined multiplicity. 
Hence, the diagonal states are simply ordered by increasing energy.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.25"></a><h2>
8.25&nbsp;&nbsp;Surface Hopping</h2><a id="met:hopping">
</a>
<div class="p"><!----></div>
Given two coefficient vectors <b>c</b><sup>diag</sup>(t) and <b>c</b><sup>diag</sup>(t+&#8710;t) and the corresponding propagator matrix <b>R</b><sup>diag</sup>(t+&#8710;t,t), the surface hopping probabilities are given by
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-131.png">
</td><td width="1%">(8.109)</td></tr></table>
where, however, P<sub>&#946;&#8594;&#946;</sub>=0 and all negative P<sub>&#946;&#8594;&#945;</sub> are set to zero.
This equation is the default in  S<span style="font-size:x-small">HARC</span>, and can be used with <b><tt>hopping_procedure sharc</tt></b>.
<div class="p"><!----></div>
Alternatively, the hopping probabilities can be obtained with the "global flux surface hopping" method by Prezhdo and coworkers <a href="#Wang2014JCTC" class="tth_citeref">[70</a>].
The equation is:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-132.png">
</td><td width="1%">(8.110)</td></tr></table>
As above, P<sub>&#946;&#8594;&#946;</sub>=0 and all negative P<sub>&#946;&#8594;&#945;</sub> are set to zero.
This equation and can be used with <b><tt>hopping_procedure gfsh</tt></b>.
<div class="p"><!----></div>
In any case, the hopping procedure itself obtains a uniform random number r from the interval [0,1]. A hop to state &#945; is performed, if
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-133.png"><a id="eq:cumuprob">
</a>
</td><td width="1%">(8.111)</td></tr></table>
See section&nbsp;<a href="#met:refl_frust">8.12.1</a> for further details on how frustrated hops (hops according to the hopping probabilities, but where not enough energy is available to execute the hop) are handled.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.26"></a><h2>
8.26&nbsp;&nbsp;Velocity Verlet</h2>
<div class="p"><!----></div>
The nuclear coordinates of atom A are updated according to the Velocity Verlet algorithm <a href="#Verlet1967PR" id="CITEVerlet1967PR" class="tth_citation">[105</a>], based on the gradient of state &#946; at <b>R</b>(t) and <b>R</b>(t+&#8710;t):
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-134.png">
</td><td width="1%">(8.112)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-135.png">
</td><td width="1%">(8.113)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-136.png">
</td><td width="1%">(8.114)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-137.png">
</td><td width="1%">(8.115)</td></tr></table>
<div class="p"><!----></div>
Currently, there are no other integrators for the nuclear motion implemented in  S<span style="font-size:x-small">HARC</span>.
<div class="p"><!----></div>
<div class="p"><!----></div>
 <a id="tth_sEc8.27"></a><h2>
8.27&nbsp;&nbsp;Wavefunction propagation</h2><a id="met:propagate">
</a>
<div class="p"><!----></div>
The electronic wave function is needed in order to carry out surface hopping. The electronic wave function is expanded in the basis of the so-called model space <i>S</i>, which includes the few lowest states &#124;&#968;<sup>MCH</sup><sub>&#945;</sub>&#9002; of the multiplicities under consideration (e.g.&nbsp;the 3 lowest singlet and 2 lowest triplet states). 
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-138.png">
</td><td width="1%">(8.116)</td></tr></table>
All multiplet components are included explicitly, i.e., the inclusion of an MCH triplet state adds three explicit states to the model space (the three components of the triplet).
<div class="p"><!----></div>
Within  S<span style="font-size:x-small">HARC</span>, the wave function is represented just by the vector <b>c</b><sup>MCH</sup>. The Hamiltonian <b>H</b><sup>MCH</sup> is represented in matrix form with elements:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-139.png">
</td><td width="1%">(8.117)</td></tr></table>
<div class="p"><!----></div>
From the MCH representation, the diagonal representation can be obtained by unitary transformation within the model space <i>S</i> (<b>U</b><sup>&#8224;</sup><b>H</b><sup>MCH</sup><b>U</b>=<b>H</b><sup>diag</sup> and <b>U</b><sup>&#8224;</sup><b>c</b><sup>MCH</sup>=<b>c</b><sup>diag</sup>):
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-140.png">
</td><td width="1%">(8.118)</td></tr></table>
and
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-141.png">
</td><td width="1%">(8.119)</td></tr></table>
<div class="p"><!----></div>
The propagation of the electronic wave function from time t to t+&#8710;t can then be written as the product of a propagation matrix with the coefficients at time t:
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-142.png">
</td><td width="1%">(8.120)</td></tr></table>
or
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-143.png">
</td><td width="1%">(8.121)</td></tr></table>
<div class="p"><!----></div>
In order to calculate <b>R</b><sup>MCH</sup>(t+&#8710;t,t),  S<span style="font-size:x-small">HARC</span>&nbsp;uses (unitary) operator exponentials. 
<div class="p"><!----></div>
     <a id="tth_sEc8.27.1"></a><h3>
8.27.1&nbsp;&nbsp;Propagation using nonadiabatic couplings</h3>
<div class="p"><!----></div>
Here we assume that in the dynamics the interaction between the electronic states is described by a matrix of nonadiabatic couplings <b>K</b><sup>MCH</sup>(t), such that
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-144.png"><a id="eq:ddt">
</a>
</td><td width="1%">(8.122)</td></tr></table>
or
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-145.png"><a id="eq:ddr">
</a>
</td><td width="1%">(8.123)</td></tr></table>
In equation&nbsp;(<a href="#eq:ddt"> 8.120</a>, the time-derivative couplings are directly calculated by the quantum chemistry program (use <b><tt>coupling ddt</tt></b> in the  S<span style="font-size:x-small">HARC</span>&nbsp;input), while in&nbsp; the matrix <b>K</b><sup>MCH</sup>(t) is obtained from the scalar product of the nuclear velocity and the nonadiabatic coupling vectors (use <b><tt>coupling ddr</tt></b>) in the input).
<div class="p"><!----></div>
The propagation matrix can then be written as 
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-146.png">
</td><td width="1%">(8.124)</td></tr></table>
with the time-ordering operator <span class="overacc1">&#8743;</span><i>T</i>. For small time steps &#8710;t, <b>H</b><sup>MCH</sup>(&#964;) and <b>K</b><sup>MCH</sup>(&#964;) can be interpolated linearly
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-147.png">
</td><td width="1%">(8.125)</td></tr></table>
And in order to have a sufficiently small time step for this to work, the interval (t,t+&#8710;t) is further split into subtime steps &#8710;&#964; = [(&#8710;t)/n]. 
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-148.png">
</td><td width="1%">(8.126)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-149.png">
</td><td width="1%">(8.127)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-150.png"><a id="eq:ham_propn">
</a>
</td><td width="1%">(8.128)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-151.png">
</td><td width="1%">(8.129)</td></tr></table>
<div class="p"><!----></div>
     <a id="tth_sEc8.27.2"></a><h3>
8.27.2&nbsp;&nbsp;Propagation using overlap matrices</h3>
<div class="p"><!----></div>
In many situations, the nonadiabatic couplings in <b>K</b><sup>MCH</sup> are very localized on the potential hypersurfaces. If this is the case, in the dynamics very short time steps are necessary to properly sample the nonadiabatic couplings. If too large time steps are used, part of the coupling may be missed, leading to wrong population transfer. The local diabatization algorithm gives more numerical stability in these situations. It can be requested with the line <b><tt>coupling overlap</tt></b> in the input file.
<div class="p"><!----></div>
Within this algorithm, the change of the electronic states between time steps is described by the overlap matrix <b>S</b><sup>MCH</sup>(t,t+&#8710;t)
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-152.png">
</td><td width="1%">(8.130)</td></tr></table>
<div class="p"><!----></div>
With this, the propagator matrix can be written as
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-153.png">
</td><td width="1%">(8.131)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-154.png">
</td><td width="1%">(8.132)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-155.png"><a id="eq:ham_propl">
</a>
</td><td width="1%">(8.133)</td></tr></table>
<div class="p"><!----></div>
<table border="0" width="100%"><tr><td><img src="http://sharc-md.org/wp-content/uploads/2018/02/equation-156.png">
</td><td width="1%">(8.134)</td></tr></table>
<div class="p"><!----></div>
<div class="p"><!----></div>
  <a id="tth_chAp9"></a><h1>
Chapter 9 Bibliography</h1>
<div class="p"><!----></div>
<h2>Bibliography</h2>
<dl>
 <dt><a href="#CITEKasha1950DFS" id="Kasha1950DFS">[1]</a></dt><dd>
M.&nbsp;Kasha:
  <a href="http://dx.doi.org/10.1039/df9500900014">""Characterization of
  electronic transitions in complex molecules</a>. <em>Discuss. Faraday Soc.</em>,
  <b>9</b>, 14 (1950).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMarian2012WCMS" id="Marian2012WCMS">[2]</a></dt><dd>
C.&nbsp;M. Marian: <a href="http://dx.doi.org/10.1002/wcms.83">""Spin-orbit
  coupling and intersystem crossing in molecules</a>. <em>WIREs Comput. Mol.
  Sci.</em>, <b>2</b>, 187-203 (2012).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEWilkinson2014JCP" id="Wilkinson2014JCP">[3]</a></dt><dd>
I.&nbsp;Wilkinson, A.&nbsp;E. Boguslavskiy, J.&nbsp;Mikosch, D.&nbsp;M. Villeneuve, H.-J. W&#246;rner,
  M.&nbsp;Spanner, S.&nbsp;Patchkovskii, A.&nbsp;Stolow:
  <a href="http://dx.doi.org/10.1063/1.4875035">""Non-adiabatic and
  intersystem crossing dynamics in SO<sub>2</sub> I: Bound State Relaxation Studied
  By Time-Resolved Photoelectron Photoion Coincidence Spectroscopy</a>. <em>J.
  Chem. Phys.</em>, <b>140</b>, 204&nbsp;301 (2014).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMai2014JCP_SO2" id="Mai2014JCP_SO2">[4]</a></dt><dd>
S.&nbsp;Mai, P.&nbsp;Marquetand, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1063/1.4875036">""Non-Adiabatic Dynamics in
  SO<sub>2</sub>: II. The Role of Triplet States Studied by Surface-Hopping
  Simulations</a>. <em>J. Chem. Phys.</em>, <b>140</b>, 204&nbsp;302 (2014).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITELeveque2014JCP_ISC" id="Leveque2014JCP_ISC">[5]</a></dt><dd>
C.&nbsp;L&#233;v&#234;que, R.&nbsp;Ta&#239;eb, H.&nbsp;K&#246;ppel:
  <a href="http://dx.doi.org/10.1063/1.4867252">""Communication:
  Theoretical prediction of the importance of the <sup>3</sup>B<sub>2</sub> state in the dynamics
  of sulfur dioxide</a>. <em>J. Chem. Phys.</em>, <b>140</b>, 091101 (2014).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEPenfold2012JCP" id="Penfold2012JCP">[6]</a></dt><dd>
T.&nbsp;J. Penfold, R.&nbsp;Spesyvtsev, O.&nbsp;M. Kirkby, R.&nbsp;S. Minns, D.&nbsp;S.&nbsp;N. Parker, H.&nbsp;H.
  Fielding, G.&nbsp;A. Worth:
  <a href="http://dx.doi.org/10.1063/1.4767054">""Quantum dynamics study of
  the competing ultrafast intersystem crossing and internal conversion in the
  "channel 3" region of benzene</a>. <em>J. Chem. Phys.</em>, <b>137</b>,
  204310 (2012).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEVogt2013JPC" id="Vogt2013JPC">[7]</a></dt><dd>
R.&nbsp;A. Vogt, C.&nbsp;Reichardt, C.&nbsp;E. Crespo-Hern&#225;ndez:
  <a href="http://dx.doi.org/10.1021/jp405656n">""Excited-State Dynamics in
  Nitro-Naphthalene Derivatives: Intersystem Crossing to the Triplet Manifold
  in Hundreds of Femtoseconds</a>. <em>J. Phys. Chem.</em>, <b>117</b>,
  6580-6588 (2013).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITECrespo-Hernandez2004CR" id="Crespo-Hernandez2004CR">[8]</a></dt><dd>
C.&nbsp;E. Crespo-Hern&#225;ndez, B.&nbsp;Cohen, P.&nbsp;M. Hare, B.&nbsp;Kohler:
  <a href="http://dx.doi.org/10.1021/cr0206770">""Ultrafast Excited-State
  Dynamics in Nucleic Acids</a>. <em>Chem. Rev.</em>, <b>104</b>, 1977-2020
  (2004).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITERichter2012JPCL" id="Richter2012JPCL">[9]</a></dt><dd>
M.&nbsp;Richter, P.&nbsp;Marquetand, J.&nbsp;Gonz&#225;lez-V&#225;zquez, I.&nbsp;Sola, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1021/jz301312h">""Femtosecond Intersystem
  Crossing in the DNA Nucleobase Cytosine</a>. <em>J. Phys. Chem. Lett.</em>,
  <b>3</b>, 3090-3095 (2012).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMartinez-Fernandez2012CC" id="Martinez-Fernandez2012CC">[10]</a></dt><dd>
L.&nbsp;Mart&#237;nez-Fern&#225;ndez, L.&nbsp;Gonz&#225;lez, I.&nbsp;Corral:
  <a href="http://dx.doi.org/10.1039/C2CC15775F">""An Ab Initio Mechanism
  for Efficient Population of Triplet States in Cytotoxic Sulfur Substituted
  DNA Bases: The Case of 6-Thioguanine</a>. <em>Chem. Commun.</em>, <b>48</b>,
  2134-2136 (2012).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMai2013C" id="Mai2013C">[11]</a></dt><dd>
S.&nbsp;Mai, P.&nbsp;Marquetand, M.&nbsp;Richter, J.&nbsp;Gonz&#225;lez-V&#225;zquez, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1002/cphc.201300370">""Singlet and Triplet
  Excited-State Dynamics Study of the Keto and Enol Tautomers of Cytosine</a>.
  <em>ChemPhysChem</em>, <b>14</b>, 2920-2931 (2013).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEReichardt2010CC" id="Reichardt2010CC">[12]</a></dt><dd>
C.&nbsp;Reichardt, C.&nbsp;E. Crespo-Hern&#225;ndez:
  <a href="http://dx.doi.org/10.1039/C0CC01181A">""Ultrafast Spin Crossover
  in 4-Thiothymidine in an Ionic Liquid</a>. <em>Chem. Commun.</em>, <b>46</b>,
  5963-5965 (2010).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITETully1971JCP" id="Tully1971JCP">[13]</a></dt><dd>
J.&nbsp;C. Tully, R.&nbsp;K. Preston:
  <a href="http://dx.doi.org/doi:10.1063/1.1675788">""Trajectory Surface
  Hopping Approach to Nonadiabatic Molecular Collisions: The Reaction of
  H<sup>+</sup> with D<sub>2</sub></a>. <em>J. Chem. Phys.</em>, <b>55</b>, 562-572 (1971).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITETully1990JCP" id="Tully1990JCP">[14]</a></dt><dd>
J.&nbsp;C. Tully: <a href="http://dx.doi.org/doi:10.1063/1.459170">""Molecular
  dynamics with electronic transitions</a>. <em>J. Chem. Phys.</em>, <b>93</b>,
  1061-1071 (1990).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEBarbatti2011WCMS" id="Barbatti2011WCMS">[15]</a></dt><dd>
M.&nbsp;Barbatti: <a href="http://dx.doi.org/10.1002/wcms.64">""Nonadiabatic
  dynamics with trajectory surface hopping method</a>. <em>WIREs Comput. Mol.
  Sci.</em>, <b>1</b>, 620-633 (2011).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITESubotnik2016ARPC" id="Subotnik2016ARPC">[16]</a></dt><dd>
J.&nbsp;E. Subotnik, A.&nbsp;Jain, B.&nbsp;Landry, A.&nbsp;Petit, W.&nbsp;Ouyang, N.&nbsp;Bellonzi:
  <a href="http://dx.doi.org/10.1146/annurev-physchem-040215-112245">""Understanding
  the Surface Hopping View of Electronic Transitions and Decoherence</a>.
  <em>Annu. Rev. Phys. Chem.</em>, <b>67</b>, 387-417 (2016).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEWang2016JPCL" id="Wang2016JPCL">[17]</a></dt><dd>
L.&nbsp;Wang, A.&nbsp;Akimov, O.&nbsp;V. Prezhdo:
  <a href="http://dx.doi.org/10.1021/acs.jpclett.6b00710">""Recent Progress
  in Surface Hopping: 2011–2015</a>. <em>J. Phys. Chem. Lett.</em>, <b>7</b>,
  2100-2112 (2016).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEDoltsinis2006" id="Doltsinis2006">[18]</a></dt><dd>
N.&nbsp;L. Doltsinis: ""Molecular Dynamics Beyond the Born-Oppenheimer
  Approximation: Mixed Quantum-Classical Approaches. In J.&nbsp;Grotendorst,
  S.&nbsp;Bl&#252;gel, D.&nbsp;Marx (editors), <em>Computational Nanoscience: Do It
  Yourself!</em>, volume&nbsp;31 of <em>NIC Series</em>, 389-409, John von Neuman
  Institut for Computing, J&#252;lich (2006).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEDoltsinis2002JTCC" id="Doltsinis2002JTCC">[19]</a></dt><dd>
N.&nbsp;L. Doltsinis, D.&nbsp;Marx:
  <a href="http://dx.doi.org/10.1142/S0219633602000257">""First Principles
  Molecular Dynamics Involving Excited States And Nonadiabatic Transitions</a>.
  <em>J. Theor. Comput. Chem.</em>, <b>1</b>, 319-349 (2002).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEHammes-Schiffer1994JCP" id="Hammes-Schiffer1994JCP">[20]</a></dt><dd>
S.&nbsp;Hammes-Schiffer, J.&nbsp;C. Tully:
  <a href="http://dx.doi.org/10.1063/1.467455">""Proton transfer in
  solution: Molecular dynamics with quantum transitions</a>. <em>J. Chem.
  Phys.</em>, <b>101</b>, 4657-4667 (1994).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEGranucci2007JCP" id="Granucci2007JCP">[21]</a></dt><dd>
G.&nbsp;Granucci, M.&nbsp;Persico:
  <a href="http://dx.doi.org/10.1063/1.2715585">""Critical appraisal of the
  fewest switches algorithm for surface hopping</a>. <em>J. Chem. Phys.</em>,
  <b>126</b>, 134&nbsp;114 (2007).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEThachuk1996JCP" id="Thachuk1996JCP">[22]</a></dt><dd>
M.&nbsp;Thachuk, M.&nbsp;Y. Ivanov, D.&nbsp;M. Wardlaw:
  <a href="http://dx.doi.org/10.1063/1.472281">""A semiclassical approach
  to intense-field above-threshold dissociation in the long wavelength limit</a>.
  <em>J. Chem. Phys.</em>, <b>105</b>, 4094-4104 (1996).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMaiti2004JPCA" id="Maiti2004JPCA">[23]</a></dt><dd>
B.&nbsp;Maiti, G.&nbsp;C. Schatz, G.&nbsp;Lendvay:
  <a href="http://dx.doi.org/10.1021/jp049143o">""Importance of Intersystem
  Crossing in the S(3P, 1D) + H2 &#8594; SH + H Reaction</a>. <em>J.
  Phys. Chem. A</em>, <b>108</b>, 8772-8781 (2004).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEJones2008JPCA" id="Jones2008JPCA">[24]</a></dt><dd>
G.&nbsp;A. Jones, A.&nbsp;Acocella, F.&nbsp;Zerbetto:
  <a href="http://dx.doi.org/10.1021/jp805360v">""On-the-Fly,
  Electric-Field-Driven, Coupled Electron-Nuclear Dynamics</a>. <em>J. Phys.
  Chem. A</em>, <b>112</b>, 9650-9656 (2008).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMitric2009PRA" id="Mitric2009PRA">[25]</a></dt><dd>
R.&nbsp;Mitri\'c, J.&nbsp;Petersen, V.&nbsp;Bonac\'c-Kouteck&#253;:
  <a href="http://dx.doi.org/10.1103/PhysRevA.79.053416">""Laser-field-induced
  surface-hopping method for the simulation and control of ultrafast
  photodynamics</a>. <em>Phys. Rev. A</em>, <b>79</b>, 053&nbsp;416 (2009).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEGranucci2012JCP" id="Granucci2012JCP">[26]</a></dt><dd>
G.&nbsp;Granucci, M.&nbsp;Persico, G.&nbsp;Spighi:
  <a href="http://dx.doi.org/10.1063/1.4707737">""Surface hopping
  trajectory simulations with spin-orbit and dynamical couplings</a>. <em>J.
  Chem. Phys.</em>, <b>137</b>, 22A501 (2012).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITECurchod2013C" id="Curchod2013C">[27]</a></dt><dd>
B.&nbsp;F.&nbsp;E. Curchod, T.&nbsp;J. Penfold, U.&nbsp;Rothlisberger, I.&nbsp;Tavernelli:
  <a href="http://dx.doi.org/doi:10.2533/chimia.2013.218">""Local Control
  Theory using Trajectory Surface Hopping and Linear-Response Time-Dependent
  Density Functional Theory</a>. <em>Chimia</em>, <b>67</b>, 218-221 (2013).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITECui2014JCP" id="Cui2014JCP">[28]</a></dt><dd>
G.&nbsp;Cui, W.&nbsp;Thiel:
  <a href="http://dx.doi.org/10.1063/1.4894849">""Generalized trajectory
  surface-hopping method for internal conversion and intersystem crossing</a>.
  <em>J. Chem. Phys.</em>, <b>141</b>, 124&nbsp;101 (2014).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEPittner2009CP" id="Pittner2009CP">[29]</a></dt><dd>
J.&nbsp;Pittner, H.&nbsp;Lischka, M.&nbsp;Barbatti:
  <a href="http://dx.doi.org/10.1016/j.chemphys.2008.10.013">""Optimization
  of mixed quantum-classical dynamics: Time-derivative coupling terms and
  selected couplings</a>. <em>Chem. Phys.</em>, <b>356</b>, 147 - 152 (2009).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEJain2016JCTC" id="Jain2016JCTC">[30]</a></dt><dd>
A.&nbsp;Jain, E.&nbsp;Alguire, J.&nbsp;E. Subotnik:
  <a href="http://dx.doi.org/10.1021/acs.jctc.6b00673">""An Efficient,
  Augmented Surface Hopping Algorithm That Includes Decoherence for Use in
  Large-Scale Simulations</a>. <em>J. Chem. Theory Comput.</em>, <b>12</b>,
  5256-5268 (2016).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITERuckenbauer2016SR" id="Ruckenbauer2016SR">[31]</a></dt><dd>
M.&nbsp;Ruckenbauer, S.&nbsp;Mai, P.&nbsp;Marquetand, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1038/srep35522">""Revealing Deactivation
  Pathways Hidden in Time-Resolved Photoelectron Spectra</a>. <em>Sci. Rep.</em>,
  <b>6</b>, 35&nbsp;522 (2016).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEPlasser2014JCP1" id="Plasser2014JCP1">[32]</a></dt><dd>
F.&nbsp;Plasser, M.&nbsp;Wormit, A.&nbsp;Dreuw:
  <a href="http://dx.doi.org/10.1063/1.4885819">""New tools for the
  systematic analysis and visualization of electronic excitations. I.
  Formalism</a>. <em>J. Chem. Phys.</em>, <b>141</b>, 024&nbsp;106 (2014).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEPlasser2014JCP2" id="Plasser2014JCP2">[33]</a></dt><dd>
F.&nbsp;Plasser, S.&nbsp;A. B&#228;ppler, M.&nbsp;Wormit, A.&nbsp;Dreuw:
  <a href="http://dx.doi.org/10.1063/1.4885820">""New tools for the
  systematic analysis and visualization of electronic excitations. II.
  Applications</a>. <em>J. Chem. Phys.</em>, <b>141</b>, 024&nbsp;107 (2014).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEPlasser2017TheoDORE" id="Plasser2017TheoDORE">[34]</a></dt><dd>
F.&nbsp;Plasser: ""TheoDORE: A package for theoretical density, orbital
  relaxation, and exciton analysis. http://theodore-qc.sourceforge.net (2017).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITERichter2011JCTC" id="Richter2011JCTC">[35]</a></dt><dd>
M.&nbsp;Richter, P.&nbsp;Marquetand, J.&nbsp;Gonz&#225;lez-V&#225;zquez, I.&nbsp;Sola, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1021/ct1007394">""SHARC: Ab Initio
  Molecular Dynamics with Surface Hopping in the Adiabatic Representation
  Including Arbitrary Couplings</a>. <em>J. Chem. Theory Comput.</em>, <b>7</b>,
  1253-1258 (2011).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMai2015IJQC" id="Mai2015IJQC">[36]</a></dt><dd>
S.&nbsp;Mai, P.&nbsp;Marquetand, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1002/qua.24891">""A General Method to
  Describe Intersystem Crossing Dynamics in Trajectory Surface Hopping</a>.
  <em>Int. J. Quantum Chem.</em>, <b>115</b>, 1215-1231 (2015).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMai2018WCMS" id="Mai2018WCMS">[37]</a></dt><dd>
S.&nbsp;Mai, P.&nbsp;Marquetand, L.&nbsp;Gonz&#225;lez: ""Nonadiabatic Dynamics: The SHARC
  Approach. <em>WIREs Comput. Mol. Sci.</em>, in preparation (2018).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMai2018SHARC" id="Mai2018SHARC">[38]</a></dt><dd>
S.&nbsp;Mai, M.&nbsp;Richter, M.&nbsp;Heindl, M.&nbsp;F. S.&nbsp;J. Menger, A.&nbsp;J. Atkins,
  M.&nbsp;Ruckenbauer, F.&nbsp;Plasser, M.&nbsp;Oppel, P.&nbsp;Marquetand, L.&nbsp;Gonz&#225;lez:
  ""SHARC2.0: Surface Hopping Including Arbitrary Couplings - Program
  Package for Non-Adiabatic Dynamics. sharc-md.org (2018).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITERichter2012JCTC_erratum" id="Richter2012JCTC_erratum">[39]</a></dt><dd>
M.&nbsp;Richter, P.&nbsp;Marquetand, J.&nbsp;Gonz&#225;lez-V&#225;zquez, I.&nbsp;Sola, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1021/ct2005819">""Correction to SHARC: Ab
  Initio Molecular Dynamics with Surface Hopping in the Adiabatic
  Representation Including Arbitrary Couplings</a>. <em>J. Chem. Theory
  Comput.</em>, <b>8</b>, 374-374 (2012).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEBajo2012JPCA" id="Bajo2012JPCA">[40]</a></dt><dd>
J.&nbsp;J. Bajo, J.&nbsp;Gonz&#225;lez-V&#225;zquez, I.&nbsp;Sola, J.&nbsp;Santamaria, M.&nbsp;Richter,
  P.&nbsp;Marquetand, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1021/jp208997r">""Mixed Quantum-Classical
  Dynamics in the Adiabatic Representation to Simulate Molecules Driven by
  Strong Laser Pulses</a>. <em>J. Phys. Chem. A</em>, <b>116</b>, 2800-2807
  (2012).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMarquetand2011FD" id="Marquetand2011FD">[41]</a></dt><dd>
P.&nbsp;Marquetand, M.&nbsp;Richter, J.&nbsp;Gonz&#225;lez-V&#225;zquez, I.&nbsp;Sola, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1039/c1fd00055a">""Nonadiabatic ab initio
  molecular dynamics including spin-orbit coupling and laser fields</a>.
  <em>Faraday Discuss.</em>, <b>153</b>, 261-273 (2011).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMai2018" id="Mai2018">[42]</a></dt><dd>
S.&nbsp;Mai, F.&nbsp;Plasser, P.&nbsp;Marquetand, L.&nbsp;Gonz&#225;lez: ""General trajectory
  surface hopping method for ultrafast nonadiabatic dynamics. In M.&nbsp;Vrakking,
  F.&nbsp;Lepine (editors), <em>Chemistry and Molecular Physics on the Attosecond
  Timescale. Theoretical Approaches</em> (2018).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMai2014TCC" id="Mai2014TCC">[43]</a></dt><dd>
S.&nbsp;Mai, M.&nbsp;Richter, P.&nbsp;Marquetand, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1007/128_2014_549">""Excitation of
  Nucleobases from a Computational Perspective II: Dynamics</a>. In
  M.&nbsp;Barbatti, A.&nbsp;C. Borin, S.&nbsp;Ullrich (editors), <em>Photoinduced Phenomena
  in Nucleic Acids I</em>, volume 355 of <em>Topics in Current Chemistry</em>,
  99-153, Springer Berlin Heidelberg (2015).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEGonzalez2014" id="Gonzalez2014">[44]</a></dt><dd>
L.&nbsp;Gonz&#225;lez, P.&nbsp;Marquetand, M.&nbsp;Richter, J.&nbsp;Gonz&#225;lez-V&#225;zquez, I.&nbsp;Sola:
  <a href="http://dx.doi.org/10.1007/978-3-319-02051-8_7">""Ultrafast
  laser-induced processes described by ab initio molecular dynamics</a>. In
  R.&nbsp;de&nbsp;Nalda, L.&nbsp;Ba&#241;ares (editors), <em>Ultrafast Phenomena in Molecular
  Sciences</em>, volume 107 of <em>Springer Series in Chemical Physics</em>,
  145-170, Springer (2014).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITERichter2014PCCP" id="Richter2014PCCP">[45]</a></dt><dd>
M.&nbsp;Richter, S.&nbsp;Mai, P.&nbsp;Marquetand, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1039/C4CP04158E">""Ultrafast Intersystem
  Crossing Dynamics in Uracil Unravelled by Ab Initio Molecular Dynamics</a>.
  <em>Phys. Chem. Chem. Phys.</em>, <b>16</b>, 24&nbsp;423-24&nbsp;436 (2014).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMartinez-Fernandez2014JCTC" id="Martinez-Fernandez2014JCTC">[46]</a></dt><dd>
L.&nbsp;Mart&#237;nez-Fern&#225;ndez, J.&nbsp;Gonz&#225;lez-V&#225;zquez, L.&nbsp;Gonz&#225;lez,
  I.&nbsp;Corral: <a href="http://dx.doi.org/10.1021/ct500909a">""Time-resolved
  insight into the photosensitized generation of singlet oxygen in
  endoperoxides</a>. <em>J. Chem. Theory Comput.</em>, accepted (2014).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITECorrales2014PCCP" id="Corrales2014PCCP">[47]</a></dt><dd>
M.&nbsp;E. Corrales, V.&nbsp;Loriot, G.&nbsp;Balerdi, J.&nbsp;Gonz&#225;lez-V&#225;zquez,
  R.&nbsp;de&nbsp;Nalda, L.&nbsp;Ba&#241;ares, A.&nbsp;H. Zewail:
  <a href="http://dx.doi.org/10.1039/C3CP54677B">""Structural dynamics
  effects on the ultrafast chemical bond cleavage of a photodissociation
  reaction</a>. <em>Phys. Chem. Chem. Phys.</em>, <b>16</b>, 8812-8818 (2014).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITECrespo-Hernandez2015JACS" id="Crespo-Hernandez2015JACS">[48]</a></dt><dd>
C.&nbsp;E. Crespo-Hern&#225;ndez, L.&nbsp;Mart&#237;nez-Fern&#225;ndez, C.&nbsp;Rauer, C.&nbsp;Reichardt,
  S.&nbsp;Mai, M.&nbsp;Pollum, P.&nbsp;Marquetand, L.&nbsp;Gonz&#225;lez, I.&nbsp;Corral:
  <a href="http://dx.doi.org/10.1021/ja512536c">""Electronic and Structural
  Elements That Regulate the Excited-State Dynamics in Purine Nucleobase
  Derivatives</a>. <em>J. Am. Chem. Soc.</em>, <b>137</b>, 4368-4381 (2015).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMarazzi2016JPCL" id="Marazzi2016JPCL">[49]</a></dt><dd>
M.&nbsp;Marazzi, S.&nbsp;Mai, D.&nbsp;Roca-Sanju&#225;n, M.&nbsp;G. Delcey, R.&nbsp;Lindh, L.&nbsp;Gonz&#225;lez,
  A.&nbsp;Monari:
  <a href="http://dx.doi.org/10.1021/acs.jpclett.5b02792">""Benzophenone
  Ultrafast Triplet Population: Revisiting the Kinetic Model by Surface-Hopping
  Dynamics</a>. <em>J. Phys. Chem. Lett.</em>, <b>7</b>, 622-626 (2016).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITERichter2016JCTC" id="Richter2016JCTC">[50]</a></dt><dd>
M.&nbsp;Richter, B.&nbsp;P. Fingerhut:
  <a href="http://dx.doi.org/10.1021/acs.jctc.6b00371">""Simulation of
  Multi-Dimensional Signals in the Optical Domain: Quantum-Classical Feedback
  in Nonlinear Exciton Propagation</a>. <em>J. Chem. Theory Comput.</em>,
  <b>12</b>, 3284-3294 (2016).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITECao2016CP" id="Cao2016CP">[51]</a></dt><dd>
J.&nbsp;Cao, Z.-Z. Xie, X.&nbsp;Yu:
  <a href="http://dx.doi.org/10.1016/j.chemphys.2016.05.003">""Excited-state
  dynamics of oxazole: A combined electronic structure calculations and dynamic
  simulations study</a>. <em>Chem. Phys.</em>, <b>474</b>, 25 - 35 (2016).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEBanerjee2016PCCP" id="Banerjee2016PCCP">[52]</a></dt><dd>
A.&nbsp;Banerjee, D.&nbsp;Halder, G.&nbsp;Ganguly, A.&nbsp;Paul:
  <a href="http://dx.doi.org/10.1039/C6CP03789E">""Deciphering the cryptic
  role of a catalytic electron in a photochemical bond dissociation using
  excited state aromaticity markers</a>. <em>Phys. Chem. Chem. Phys.</em>,
  <b>18</b>, 25&nbsp;308-25&nbsp;314 (2016).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMai2016JPCL" id="Mai2016JPCL">[53]</a></dt><dd>
S.&nbsp;Mai, P.&nbsp;Marquetand, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1021/acs.jpclett.6b00616">""Intersystem
  Crossing Pathways in the Noncanonical Nucleobase 2-Thiouracil: A
  Time-Dependent Picture</a>. <em>J. Phys. Chem. Lett.</em>, <b>7</b>, 1978-1983
  (2016).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMai2016NC" id="Mai2016NC">[54]</a></dt><dd>
S.&nbsp;Mai, M.&nbsp;Pollum, L.&nbsp;Mart&#237;nez-Fern&#225;ndez, N.&nbsp;Dunn, P.&nbsp;Marquetand,
  I.&nbsp;Corral, C.&nbsp;E. Crespo-Hern&#225;ndez, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1038/ncomms13077">""The Origin of Efficient
  Triplet State Population in Sulfur-Substituted Nucleobases</a>. <em>Nat.
  Commun.</em>, <b>7</b>, 13&nbsp;077 (2016).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEPeccati2016PTRSA" id="Peccati2016PTRSA">[55]</a></dt><dd>
F.&nbsp;Peccati, S.&nbsp;Mai, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1098/rsta.2016.0202">""Insights into the
  Deactivation of 5-Bromouracil after UV Excitation</a>. <em>Phil. Trans. R.
  Soc. A</em>, <b>375</b>, 20160&nbsp;202 (2017).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMurillo-Sanchez2017CPL" id="Murillo-Sanchez2017CPL">[56]</a></dt><dd>
M.&nbsp;Murillo-S&#225;nchez, S.&nbsp;M. Poullain, J.&nbsp;Gonz&#225;lez-V&#225;zquez, M.&nbsp;Corrales,
  G.&nbsp;Balerdi, L.&nbsp;Ba&#241;ares:
  <a href="http://dx.doi.org/https://doi.org/10.1016/j.cplett.2017.02.037">""Femtosecond
  photodissociation dynamics of chloroiodomethane in the first absorption
  band</a>. <em>Chem. Phys. Lett.</em>, <b>683</b>, 22 - 28 (2017), ahmed Zewail
  (1946-2016) Commemoration Issue of Chemical Physics Letters.
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEBorin2017PCCP" id="Borin2017PCCP">[57]</a></dt><dd>
A.&nbsp;C. Borin, S.&nbsp;Mai, P.&nbsp;Marquetand, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1039/C6CP07919A">""Ab initio molecular
  dynamics relaxation and intersystem crossing mechanisms of 5-azacytosine</a>.
  <em>Phys. Chem. Chem. Phys.</em>, <b>19</b>, 5888-5894 (2017).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMai2017CP" id="Mai2017CP">[58]</a></dt><dd>
S.&nbsp;Mai, M.&nbsp;Richter, P.&nbsp;Marquetand, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1016/j.chemphys.2016.10.003">""The DNA
  Nucleobase Thymine in Motion - Intersystem Crossing Simulated with Surface
  Hopping</a>. <em>Chem. Phys.</em>, <b>482</b>, 9-15 (2017).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITESiouri2017JPCA" id="Siouri2017JPCA">[59]</a></dt><dd>
F.&nbsp;M. Siouri, S.&nbsp;Boldissar, J.&nbsp;A. Berenbeim, M.&nbsp;S. de Vries:
  <a href="http://dx.doi.org/10.1021/acs.jpca.7b03036">""Excited State
  Dynamics of 6-Thioguanine</a>. <em>J. Phys. Chem. A</em>, <b>121</b>,
  5257-5266 (2017).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEBellshaw2017CPL" id="Bellshaw2017CPL">[60]</a></dt><dd>
D.&nbsp;Bellshaw, D.&nbsp;A. Horke, A.&nbsp;D. Smith, H.&nbsp;M. Watts, E.&nbsp;Jager, E.&nbsp;Springate,
  O.&nbsp;Alexander, C.&nbsp;Cacho, R.&nbsp;T. Chapman, A.&nbsp;Kirrander, R.&nbsp;S. Minns:
  <a href="http://dx.doi.org/https://doi.org/10.1016/j.cplett.2017.02.058">""Ab-initio
  surface hopping and multiphoton ionisation study of the photodissociation
  dynamics of CS2</a>. <em>Chem. Phys. Lett.</em>, <b>683</b>, 383-388 (2017).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITESun2017JPCA" id="Sun2017JPCA">[61]</a></dt><dd>
S.&nbsp;Sun, B.&nbsp;Mignolet, L.&nbsp;Fan, W.&nbsp;Li, R.&nbsp;D. Levine, F.&nbsp;Remacle:
  <a href="http://dx.doi.org/10.1021/acs.jpca.6b12310">""Nuclear Motion
  Driven Ultrafast Photodissociative Charge Transfer of the PENNA Cation: An
  Experimental and Computational Study</a>. <em>J. Phys. Chem. A</em>,
  <b>121</b>, 1442-1447 (2017).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITERauer2016JACS" id="Rauer2016JACS">[62]</a></dt><dd>
C.&nbsp;Rauer, J.&nbsp;J. Nogueira, P.&nbsp;Marquetand, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1021/jacs.6b06701">""Cyclobutane Thymine
  Photodimerization Mechanism Revealed by Nonadiabatic Molecular Dynamics</a>.
  <em>J. Am. Chem. Soc.</em>, <b>138</b>, 15&nbsp;911-15&nbsp;916 (2016).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEAtkins2017JPCL" id="Atkins2017JPCL">[63]</a></dt><dd>
A.&nbsp;J. Atkins, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1021/acs.jpclett.7b01479">""Trajectory
  Surface-Hopping Dynamics Including Intersystem Crossing in
  [Ru(bpy)<sub>3</sub>]<sup>2+</sup></a>. <em>J. Phys. Chem. Lett.</em>, <b>8</b>, 3840-3845
  (2017).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITESchnappinger2017PCCP" id="Schnappinger2017PCCP">[64]</a></dt><dd>
T.&nbsp;Schnappinger, P.&nbsp;Kolle, M.&nbsp;Marazzi, A.&nbsp;Monari, L.&nbsp;Gonz&#225;lez,
  R.&nbsp;de&nbsp;Vivie-Riedle: <a href="http://dx.doi.org/10.1039/C7CP05061E">""Ab
  initio molecular dynamics of thiophene: the interplay of internal conversion
  and intersystem crossing</a>. <em>Phys. Chem. Chem. Phys.</em>, <b>19</b>,
  25&nbsp;662-25&nbsp;670 (2017).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMai2017JCP" id="Mai2017JCP">[65]</a></dt><dd>
S.&nbsp;Mai, F.&nbsp;Plasser, M.&nbsp;Pabst, F.&nbsp;Neese, A.&nbsp;K&#246;hn, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1063/1.4999687">""Surface Hopping Dynamics
  Including Intersystem Crossing using the Algebraic Diagrammatic Construction
  Method</a>. <em>J. Chem. Phys.</em>, <b>147</b>, 184&nbsp;109 (2017).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEZobel2018CEJ" id="Zobel2018CEJ">[66]</a></dt><dd>
J.&nbsp;P. Zobel, J.&nbsp;J. Nogueira, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1002/chem.201705854">""The Mechanism of
  Ultrafast Intersystem Crossing in 2-Nitronaphthalene</a>. <em>Chem. Eur. J.</em>,
  DOI:10.1002/chem.201705854 (2018).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITERauer2018MC" id="Rauer2018MC">[67]</a></dt><dd>
C.&nbsp;Rauer, J.&nbsp;J. Nogueira, P.&nbsp;Marquetand, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1007/s00706-017-2108-4">""Stepwise
  photosensitized thymine dimerization mediated by an exciton intermediate</a>.
  <em>Monatsh. Chem.</em>, <b>149</b>, 1-9 (2018).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITECao2018JMS" id="Cao2018JMS">[68]</a></dt><dd>
J.&nbsp;Cao:
  <a href="http://dx.doi.org/https://doi.org/10.1016/j.molstruc.2017.11.008">""The
  position of the N atom in the pentacyclic ring of heterocyclic molecules
  affects the excited-state decay: A case study of isothiazole and thiazole</a>.
  <em>J. Mol. Struct.</em>, DOI:10.1016/j.molstruc.2017.11.008 (2018).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITESquibb2018NC" id="Squibb2018NC">[69]</a></dt><dd>
R.&nbsp;J. Squibb, M.&nbsp;Sapunar, A.&nbsp;Ponzi, R.&nbsp;Richter, A.&nbsp;Kivim&#228;ki, O.&nbsp;Plekan,
  P.&nbsp;Finetti, N.&nbsp;Sisourat, V.&nbsp;Zhaunerchyk, T.&nbsp;Marchenko, L.&nbsp;Journel,
  R.&nbsp;Guillemin, R.&nbsp;Cucini, M.&nbsp;Coreno, C.&nbsp;Grazioli, M.&nbsp;Di&nbsp;Fraia, C.&nbsp;Callegari,
  K.&nbsp;C. Prince, P.&nbsp;Decleva, M.&nbsp;Simon, J.&nbsp;H.&nbsp;D. Eland, N.&nbsp;Dosli\'c,
  R.&nbsp;Feifel, M.&nbsp;N. Piancastelli:
  <a href="http://dx.doi.org/10.1038/s41467-017-02478-0">""Acetylacetone
  photodynamics at a seeded free-electron laser</a>. <em>Nat. Commun.</em>,
  <b>9</b>, 63 (2018).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEWang2014JCTC" id="Wang2014JCTC">[70]</a></dt><dd>
L.&nbsp;Wang, D.&nbsp;Trivedi, O.&nbsp;V. Prezhdo:
  <a href="http://dx.doi.org/10.1021/ct5003835">""Global Flux Surface
  Hopping Approach for Mixed Quantum-Classical Dynamics</a>. <em>J. Chem.
  Theory Comput.</em>, <b>10</b>, 3598-3605 (2014).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEGranucci2001JCP" id="Granucci2001JCP">[71]</a></dt><dd>
G.&nbsp;Granucci, M.&nbsp;Persico, A.&nbsp;Toniolo:
  <a href="http://dx.doi.org/doi:10.1063/1.1376633">""Direct Semiclassical
  Simulation of Photochemical Processes with Semiempirical Wave Functions</a>.
  <em>J. Chem. Phys.</em>, <b>114</b>, 10&nbsp;608-10&nbsp;615 (2001).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEPlasser2012JCP" id="Plasser2012JCP">[72]</a></dt><dd>
F.&nbsp;Plasser, G.&nbsp;Granucci, J.&nbsp;Pittner, M.&nbsp;Barbatti, M.&nbsp;Persico, H.&nbsp;Lischka:
  <a href="http://dx.doi.org/doi:10.1063/1.4738960">""Surface Hopping
  Dynamics using a Locally Diabatic Formalism: Charge Transfer in The Ethylene
  Dimer Cation and Excited State Dynamics in the 2-Pyridone Dimer</a>. <em>J.
  Chem. Phys.</em>, <b>137</b>, 22A514 (2012).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEPlasser2016JCTC" id="Plasser2016JCTC">[73]</a></dt><dd>
F.&nbsp;Plasser, M.&nbsp;Ruckenbauer, S.&nbsp;Mai, M.&nbsp;Oppel, P.&nbsp;Marquetand, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1021/acs.jctc.5b01148">""Efficient and
  Flexible Computation of Many-Electron Wave Function Overlaps</a>. <em>J.
  Chem. Theory Comput.</em>, <b>12</b>, 1207 (2016).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEDahl1988JCP" id="Dahl1988JCP">[74]</a></dt><dd>
J.&nbsp;P. Dahl, M.&nbsp;Springborg:
  <a href="http://dx.doi.org/doi:10.1063/1.453761">""The Morse oscillator
  in position space, momentum space, and phase space</a>. <em>J. Chem. Phys.</em>,
  <b>88</b>, 4535-4547 (1988).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITESchinke1995" id="Schinke1995">[75]</a></dt><dd>
R.&nbsp;Schinke: <em>Photodissociation Dynamics: Spectroscopy and Fragmentation of
  Small Polyatomic Molecules</em>. Cambridge University Press (1995).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEBarbatti2016IJQC" id="Barbatti2016IJQC">[76]</a></dt><dd>
M.&nbsp;Barbatti, K.&nbsp;Sen:
  <a href="http://dx.doi.org/10.1002/qua.25049">""Effects of different
  initial condition samplings on photodynamics and spectrum of pyrrole</a>.
  <em>Int. J. Quantum Chem.</em>, <b>116</b>, 762-771 (2016).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEBarbatti2007JPPA" id="Barbatti2007JPPA">[77]</a></dt><dd>
M.&nbsp;Barbatti, G.&nbsp;Granucci, M.&nbsp;Persico, M.&nbsp;Ruckenbauer, M.&nbsp;Vazdar,
  M.&nbsp;Eckert-Maksi\'c, H.&nbsp;Lischka:
  <a href="http://dx.doi.org/10.1016/j.jphotochem.2006.12.008">""The
  on-the-fly surface-hopping program system Newton-X: Application to ab
  initio simulation of the nonadiabatic photodynamics of benchmark systems</a>.
  <em>J. Photochem. Photobiol. A</em>, <b>190</b>, 228-240 (2007).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITECremer1975JACS" id="Cremer1975JACS">[78]</a></dt><dd>
D.&nbsp;Cremer, J.&nbsp;A. Pople:
  <a href="http://dx.doi.org/10.1021/ja00839a011">""General definition of
  ring puckering coordinates</a>. <em>J. Am. Chem. Soc.</em>, <b>97</b>,
  1354-1358 (1975).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEBoeyens1976JCMS" id="Boeyens1976JCMS">[79]</a></dt><dd>
J.&nbsp;C.&nbsp;A. Boeyens: <a href="http://dx.doi.org/10.1007/BF01200485">""The
  conformation of six-membered rings</a>. <em>J. Cryst. Mol. Struct.</em>,
  <b>8</b>, 317 (1978).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEKurtz2001JCP" id="Kurtz2001JCP">[80]</a></dt><dd>
L.&nbsp;Kurtz, A.&nbsp;Hofmann, R.&nbsp;de&nbsp;Vivie-Riedle: ""Ground state normal mode
  analysis: Linking excited state dynamics and experimental observables.
  <em>J. Chem. Phys.</em>, <b>114</b>, 6151-6159 (2001).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEPlasser2009" id="Plasser2009">[81]</a></dt><dd>
F.&nbsp;Plasser: <em>Dynamics Simulation of Excited State Intramolecular Proton
  Transfer</em>. Master's thesis, University of Vienna (2009).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEAmadei1993PSFB" id="Amadei1993PSFB">[82]</a></dt><dd>
A.&nbsp;Amadei, A.&nbsp;B.&nbsp;M. Linssen, H.&nbsp;J.&nbsp;C. Berendsen:
  <a href="http://dx.doi.org/10.1002/prot.340170408">""Essential dynamics
  of proteins</a>. <em>Proteins: Struct., Funct., Bioinf.</em>, <b>17</b>,
  412-425 (1993).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITENangia2004JCP" id="Nangia2004JCP">[83]</a></dt><dd>
S.&nbsp;Nangia, A.&nbsp;W. Jasper, T.&nbsp;F. Miller, D.&nbsp;G. Truhlar:
  <a href="http://dx.doi.org/10.1063/1.1641019">""Army Ants Algorithm for
  Rare Event Sampling of Delocalized Nonadiabatic Transitions by Trajectory
  Surface Hopping and the Estimation of Sampling Errors by the Bootstrap
  Method</a>. <em>J. Chem. Phys.</em>, <b>120</b>, 3586-3597 (2004).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEBearpark1994CPL" id="Bearpark1994CPL">[84]</a></dt><dd>
M.&nbsp;J. Bearpark, M.&nbsp;A. Robb, H.&nbsp;B. Schlegel:
  <a href="http://dx.doi.org/10.1016/0009-2614(94)00433-1">""A direct
  method for the location of the lowest energy point on a potential surface
  crossing</a>. <em>Chem. Phys. Lett.</em>, <b>223</b>, 269 (1994).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITELevine2008JPCB" id="Levine2008JPCB">[85]</a></dt><dd>
B.&nbsp;G. Levine, J.&nbsp;D. Coe, T.&nbsp;J. Mart&#237;nez:
  <a href="http://dx.doi.org/10.1021/jp0761618">""Optimizing Conical
  Intersections without Derivative Coupling Vectors: Application to Multistate
  Multireference Second-Order Perturbation Theory (MS-CASPT2)</a>. <em>J.
  Phys. Chem. B</em>, <b>112</b>, 405-413 (2008).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITERuckenbauer2016JCP" id="Ruckenbauer2016JCP">[86]</a></dt><dd>
M.&nbsp;Ruckenbauer, S.&nbsp;Mai, P.&nbsp;Marquetand, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1063/1.4941948">""Photoelectron spectra of
  2-thiouracil, 4-thiouracil, and 2,4-dithiouracil</a>. <em>J. Chem. Phys.</em>,
  <b>144</b>, 074&nbsp;303 (2016).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEPlasser2016JCP" id="Plasser2016JCP">[87]</a></dt><dd>
F.&nbsp;Plasser, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1063/1.4958462">""Communication:
  Unambiguous comparison of many-electron wavefunctions through their
  overlaps</a>. <em>J. Chem. Phys.</em>, <b>145</b>, 021&nbsp;103 (2016).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEWerner2012WCMS" id="Werner2012WCMS">[88]</a></dt><dd>
H.-J. Werner, P.&nbsp;J. Knowles, G.&nbsp;Knizia, F.&nbsp;R. Manby, M.&nbsp;Sch&#252;tz:
  <a href="http://dx.doi.org/10.1002/wcms.82">""Molpro: A general-purpose
  quantum chemistry program package</a>. <em>WIREs Comput. Mol. Sci.</em>,
  <b>2</b>, 242-253 (2012).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEWerner2012" id="Werner2012">[89]</a></dt><dd>
H.-J. Werner, P.&nbsp;J. Knowles, G.&nbsp;Knizia, F.&nbsp;R. Manby, et&nbsp;al.: ""MOLPRO,
  version 2012.1, a package of ab initio programs. www.molpro.net (2012).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEKarlstrom2003CMS" id="Karlstrom2003CMS">[90]</a></dt><dd>
G.&nbsp;Karlstr&#246;m, R.&nbsp;Lindh, P.- &#197;. Malmqvist, B.&nbsp;O. Roos, U.&nbsp;Ryde,
  V.&nbsp;Veryazov, P.-O. Widmark, M.&nbsp;Cossi, B.&nbsp;Schimmelpfennig, P.&nbsp;Neogrady,
  L.&nbsp;Seijo:
  <a href="http://dx.doi.org/10.1016/S0927-0256(03)00109-5">""MOLCAS: a
  program package for computational chemistry</a>. <em>Comput. Mater. Sci.</em>,
  <b>28</b>, 222 - 239 (2003).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEAquilante2010JCC" id="Aquilante2010JCC">[91]</a></dt><dd>
F.&nbsp;Aquilante, L.&nbsp;De&nbsp;Vico, N.&nbsp;Ferr&#233;, G.&nbsp;Ghigo, P.- &#197;. Malmqvist,
  P.&nbsp;Neogr&#225;dy, T.&nbsp;B. Pedersen, M.&nbsp;Piton&#225;k, M.&nbsp;Reiher, B.&nbsp;O. Roos,
  L.&nbsp;Serrano-Andr&#233;s, M.&nbsp;Urban, V.&nbsp;Veryazov, R.&nbsp;Lindh:
  <a href="http://dx.doi.org/10.1002/jcc.21318">""MOLCAS 7: The Next
  Generation</a>. <em>J. Comput. Chem.</em>, <b>31</b>, 224-247 (2010).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEAquilante2015JCC" id="Aquilante2015JCC">[92]</a></dt><dd>
F.&nbsp;Aquilante, J.&nbsp;Autschbach, R.&nbsp;K. Carlson, L.&nbsp;F. Chibotaru, M.&nbsp;G. Delcey,
  L.&nbsp;De&nbsp;Vico, I.&nbsp;Fdez.&nbsp;Galv&#225;n, N.&nbsp;Ferr&#233;, L.&nbsp;M. Frutos, L.&nbsp;Gagliardi,
  M.&nbsp;Garavelli, A.&nbsp;Giussani, C.&nbsp;E. Hoyer, G.&nbsp;Li&nbsp;Manni, H.&nbsp;Lischka, D.&nbsp;Ma,
  P.- &#197;. Malmqvist, T.&nbsp;M&#252;ller, A.&nbsp;Nenov, M.&nbsp;Olivucci, T.&nbsp;B.
  Pedersen, D.&nbsp;Peng, F.&nbsp;Plasser, B.&nbsp;Pritchard, M.&nbsp;Reiher, I.&nbsp;Rivalta,
  I.&nbsp;Schapiro, J.&nbsp;Segarra-Mart&#237;, M.&nbsp;Stenrup, D.&nbsp;G. Truhlar, L.&nbsp;Ungur,
  A.&nbsp;Valentini, S.&nbsp;Vancoillie, V.&nbsp;Veryazov, V.&nbsp;P. Vysotskiy, O.&nbsp;Weingart,
  F.&nbsp;Zapata, R.&nbsp;Lindh:
  <a href="http://dx.doi.org/10.1002/jcc.24221">""Molcas 8: New
  Capabilities for Multiconfigurational Quantum Chemical Calculations Across
  the Periodic Table</a>. <em>J. Comput. Chem.</em>, <b>37</b>, 506-541 (2015).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITELischka2011WCMS" id="Lischka2011WCMS">[93]</a></dt><dd>
H.&nbsp;Lischka, T.&nbsp;M&#252;ller, P.&nbsp;G. Szalay, I.&nbsp;Shavitt, R.&nbsp;M. Pitzer, R.&nbsp;Shepard:
  <a href="http://dx.doi.org/10.1002/wcms.25">""Columbus - a program
  system for advanced multireference theory calculations.</a> <em>WIREs Comput.
  Mol. Sci.</em>, <b>1</b>, 191-199 (2011).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITELischka2012" id="Lischka2012">[94]</a></dt><dd>
H.&nbsp;Lischka, R.&nbsp;Shepard, I.&nbsp;Shavitt, R.&nbsp;M. Pitzer, M.&nbsp;Dallos, T.&nbsp;M&#252;ller, P.&nbsp;G.
  Szalay, F.&nbsp;B. Brown, R.&nbsp;Ahlrichs, H.&nbsp;J. B&#246;hm, A.&nbsp;Chang, D.&nbsp;C. Comeau,
  R.&nbsp;Gdanitz, H.&nbsp;Dachsel, C.&nbsp;Ehrhardt, M.&nbsp;Ernzerhof, P.&nbsp;H&#246;chtl, S.&nbsp;Irle,
  G.&nbsp;Kedziora, T.&nbsp;Kovar, V.&nbsp;Parasuk, M.&nbsp;J.&nbsp;M. Pepper, P.&nbsp;Scharf, H.&nbsp;Schiffer,
  M.&nbsp;Schindler, M.&nbsp;Sch&#252;ler, M.&nbsp;Seth, E.&nbsp;A. Stahlberg, J.-G. Zhao,
  S.&nbsp;Yabushita, Z.&nbsp;Zhang, M.&nbsp;Barbatti, S.&nbsp;Matsika, M.&nbsp;Schuurmann, D.&nbsp;R.
  Yarkony, S.&nbsp;R. Brozell, E.&nbsp;V. Beck, , J.-P. Blaudeau, M.&nbsp;Ruckenbauer,
  B.&nbsp;Sellner, F.&nbsp;Plasser, J.&nbsp;J. Szymczak: ""COLUMBUS, an ab initio
  electronic structure program, release 7.0 (2012).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEYabushita1999JPCA" id="Yabushita1999JPCA">[95]</a></dt><dd>
S.&nbsp;Yabushita, Z.&nbsp;Zhang, R.&nbsp;M. Pitzer:
  <a href="http://dx.doi.org/10.1021/jp9901242">""Spin-Orbit
  Configuration Interaction Using the Graphical Unitary Group Approach and
  Relativistic Core Potential and Spin-Orbit Operators</a>. <em>J. Phys. Chem.
  A</em>, <b>103</b>, 5791-5800 (1999).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMai2014JCP_reindex" id="Mai2014JCP_reindex">[96]</a></dt><dd>
S.&nbsp;Mai, T.&nbsp;M&#252;ller, P.&nbsp;Marquetand, F.&nbsp;Plasser, H.&nbsp;Lischka, L.&nbsp;Gonz&#225;lez:
  <a href="http://dx.doi.org/10.1063/1.4892060">""Perturbational Treatment
  of Spin-Orbit Coupling for Generally Applicable High-Level Multi-Reference
  Methods</a>. <em>J. Chem. Phys.</em>, <b>141</b>, 074&nbsp;105 (2014).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEADF2017" id="ADF2017">[97]</a></dt><dd>
E.&nbsp;J. Baerends, T.&nbsp;Ziegler, A.&nbsp;J. Atkins, J.&nbsp;Autschbach, D.&nbsp;Bashford,
  O.&nbsp;Baseggio, A.&nbsp;B&#233;rces, F.&nbsp;M. Bickelhaupt, C.&nbsp;Bo, P.&nbsp;M. Boerritger,
  L.&nbsp;Cavallo, C.&nbsp;Daul, D.&nbsp;P. Chong, D.&nbsp;V. Chulhai, L.&nbsp;Deng, R.&nbsp;M. Dickson,
  J.&nbsp;M. Dieterich, D.&nbsp;E. Ellis, M.&nbsp;van Faassen, A.&nbsp;Ghysels, A.&nbsp;Giammona,
  S.&nbsp;J.&nbsp;A. van Gisbergen, A.&nbsp;Goez, A.&nbsp;W. G&#246;tz, S.&nbsp;Gusarov, F.&nbsp;E. Harris,
  P.&nbsp;van&nbsp;den Hoek, Z.&nbsp;Hu, C.&nbsp;R. Jacob, H.&nbsp;Jacobsen, L.&nbsp;Jensen, L.&nbsp;Joubert,
  J.&nbsp;W. Kaminski, G.&nbsp;van Kessel, C.&nbsp;K&#246;nig, F.&nbsp;Kootstra, A.&nbsp;Kovalenko,
  M.&nbsp;Krykunov, E.&nbsp;van Lenthe, D.&nbsp;A. McCormack, A.&nbsp;Michalak, M.&nbsp;Mitoraj, S.&nbsp;M.
  Morton, J.&nbsp;Neugebauer, V.&nbsp;P. Nicu, L.&nbsp;Noodleman, V.&nbsp;P. Osinga,
  S.&nbsp;Patchkovskii, M.&nbsp;Pavanello, C.&nbsp;A. Peeples, P.&nbsp;H.&nbsp;T. Philipsen, D.&nbsp;Post,
  C.&nbsp;C. Pye, H.&nbsp;Ramanantoanina, P.&nbsp;Ramos, W.&nbsp;Ravenek, J.&nbsp;I. Rodr&#237;guez,
  P.&nbsp;Ros, R.&nbsp;R&#252;ger, P.&nbsp;R.&nbsp;T. Schipper, D.&nbsp;Schl&#252;ns, H.&nbsp;van Schoot,
  G.&nbsp;Schreckenbach, J.&nbsp;S. Seldenthuis, M.&nbsp;Seth, J.&nbsp;G. Snijders, M.&nbsp;Sol&#224;,
  S.&nbsp;M., M.&nbsp;Swart, D.&nbsp;Swerhone, G.&nbsp;te&nbsp;Velde, V.&nbsp;Tognetti, P.&nbsp;Vernooijs,
  L.&nbsp;Versluis, L.&nbsp;Visscher, O.&nbsp;Visser, F.&nbsp;Wang, T.&nbsp;A. Wesolowski, E.&nbsp;M. van
  Wezenbeek, G.&nbsp;Wiesenekker, S.&nbsp;K. Wolff, T.&nbsp;K. Woo, A.&nbsp;L. Yakovlev:
  ""Amsterdam density functional modeling suite 2017. SCM, Theoretical
  Chemistry, Vrije Universiteit, Amsterdam, The Netherlands,
  https://www.scm.com (2017).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITETURBOMOLE70" id="TURBOMOLE70">[98]</a></dt><dd>
""TURBOMOLE V7.0, A development of University of Karlsruhe and
  Forschungszentrum Karlsruhe GmbH (2015).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEGaussian09" id="Gaussian09">[99]</a></dt><dd>
M.&nbsp;J. Frisch, G.&nbsp;W. Trucks, H.&nbsp;B. Schlegel, G.&nbsp;E. Scuseria, M.&nbsp;A. Robb, J.&nbsp;R.
  Cheeseman, G.&nbsp;Scalmani, V.&nbsp;Barone, B.&nbsp;Mennucci, G.&nbsp;A. Petersson,
  H.&nbsp;Nakatsuji, M.&nbsp;Caricato, X.&nbsp;Li, H.&nbsp;P. Hratchian, A.&nbsp;F. Izmaylov, J.&nbsp;Bloino,
  G.&nbsp;Zheng, J.&nbsp;L. Sonnenberg, M.&nbsp;Hada, M.&nbsp;Ehara, K.&nbsp;Toyota, R.&nbsp;Fukuda,
  J.&nbsp;Hasegawa, M.&nbsp;Ishida, T.&nbsp;Nakajima, Y.&nbsp;Honda, O.&nbsp;Kitao, H.&nbsp;Nakai, T.&nbsp;Vreven,
  J.&nbsp;A. Montgomery, Jr., J.&nbsp;E. Peralta, F.&nbsp;Ogliaro, M.&nbsp;Bearpark, J.&nbsp;J. Heyd,
  E.&nbsp;Brothers, K.&nbsp;N. Kudin, V.&nbsp;N. Staroverov, R.&nbsp;Kobayashi, J.&nbsp;Normand,
  K.&nbsp;Raghavachari, A.&nbsp;Rendell, J.&nbsp;C. Burant, S.&nbsp;S. Iyengar, J.&nbsp;Tomasi,
  M.&nbsp;Cossi, N.&nbsp;Rega, J.&nbsp;M. Millam, M.&nbsp;Klene, J.&nbsp;E. Knox, J.&nbsp;B. Cross,
  V.&nbsp;Bakken, C.&nbsp;Adamo, J.&nbsp;Jaramillo, R.&nbsp;Gomperts, R.&nbsp;E. Stratmann, O.&nbsp;Yazyev,
  A.&nbsp;J. Austin, R.&nbsp;Cammi, C.&nbsp;Pomelli, J.&nbsp;W. Ochterski, R.&nbsp;L. Martin,
  K.&nbsp;Morokuma, V.&nbsp;G. Zakrzewski, G.&nbsp;A. Voth, P.&nbsp;Salvador, J.&nbsp;J. Dannenberg,
  S.&nbsp;Dapprich, A.&nbsp;D. Daniels, &#214;.&nbsp;Farkas, J.&nbsp;B. Foresman, J.&nbsp;V. Ortiz,
  J.&nbsp;Cioslowski, , D.&nbsp;J. Fox: ""Gaussian 09, Revision A.1. Gaussian,
  Inc.: Wallingford CT, 2009.
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEGaussian16" id="Gaussian16">[100]</a></dt><dd>
M.&nbsp;J. Frisch, G.&nbsp;W. Trucks, H.&nbsp;B. Schlegel, G.&nbsp;E. Scuseria, M.&nbsp;A. Robb, J.&nbsp;R.
  Cheeseman, G.&nbsp;Scalmani, V.&nbsp;Barone, G.&nbsp;A. Petersson, H.&nbsp;Nakatsuji, X.&nbsp;Li,
  M.&nbsp;Caricato, A.&nbsp;V. Marenich, J.&nbsp;Bloino, B.&nbsp;G. Janesko, R.&nbsp;Gomperts,
  B.&nbsp;Mennucci, H.&nbsp;P. Hratchian, J.&nbsp;V. Ortiz, A.&nbsp;F. Izmaylov, J.&nbsp;L. Sonnenberg,
  D.&nbsp;Williams-Young, F.&nbsp;Ding, F.&nbsp;Lipparini, F.&nbsp;Egidi, J.&nbsp;Goings, B.&nbsp;Peng,
  A.&nbsp;Petrone, T.&nbsp;Henderson, D.&nbsp;Ranasinghe, V.&nbsp;G. Zakrzewski, J.&nbsp;Gao, N.&nbsp;Rega,
  G.&nbsp;Zheng, W.&nbsp;Liang, M.&nbsp;Hada, M.&nbsp;Ehara, K.&nbsp;Toyota, R.&nbsp;Fukuda, J.&nbsp;Hasegawa,
  M.&nbsp;Ishida, T.&nbsp;Nakajima, Y.&nbsp;Honda, O.&nbsp;Kitao, H.&nbsp;Nakai, T.&nbsp;Vreven,
  K.&nbsp;Throssell, J.&nbsp;A. Montgomery, Jr., J.&nbsp;E. Peralta, F.&nbsp;Ogliaro, M.&nbsp;J.
  Bearpark, J.&nbsp;J. Heyd, E.&nbsp;N. Brothers, K.&nbsp;N. Kudin, V.&nbsp;N. Staroverov, T.&nbsp;A.
  Keith, R.&nbsp;Kobayashi, J.&nbsp;Normand, K.&nbsp;Raghavachari, A.&nbsp;P. Rendell, J.&nbsp;C.
  Burant, S.&nbsp;S. Iyengar, J.&nbsp;Tomasi, M.&nbsp;Cossi, J.&nbsp;M. Millam, M.&nbsp;Klene, C.&nbsp;Adamo,
  R.&nbsp;Cammi, J.&nbsp;W. Ochterski, R.&nbsp;L. Martin, K.&nbsp;Morokuma, O.&nbsp;Farkas, J.&nbsp;B.
  Foresman, D.&nbsp;J. Fox: ""Gaussian16 Revision A.03 (2016), gaussian
  Inc. Wallingford CT.
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEGranucci2010JCP" id="Granucci2010JCP">[101]</a></dt><dd>
G.&nbsp;Granucci, M.&nbsp;Persico, A.&nbsp;Zoccante:
  <a href="http://dx.doi.org/10.1063/1.3489004">""Including quantum
  decoherence in surface hopping</a>. <em>J. Chem. Phys.</em>, <b>133</b>,
  134&nbsp;111 (2010).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEKoeppel84ACP" id="Koeppel84ACP">[102]</a></dt><dd>
H.&nbsp;K&#246;ppel, W.&nbsp;Domcke, L.&nbsp;S. Cederbaum: ""Multimode molecular
  dynamics beyond the Born-Oppenheimer approximation. <em>Adv. Chem. Phys.</em>,
  <b>57</b>, 59-246 (1984).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEBarbatti2011" id="Barbatti2011">[103]</a></dt><dd>
M.&nbsp;Barbatti, G.&nbsp;Granucci, M.&nbsp;Ruckenbauer, F.&nbsp;Plasser, J.&nbsp;Pittner, M.&nbsp;Persico,
  H.&nbsp;Lischka: ""NEWTON-X: a package for Newtonian dynamics close to
  the crossing seam, version 1.2. www.newtonx.org (2011).
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEMarquetand2007" id="Marquetand2007">[104]</a></dt><dd>
P.&nbsp;Marquetand: <em>Vectorial properties and laser control of molecular
  dynamics</em>. Ph.D. thesis, University of W&#252;rzburg (2007),
  <a href="http://opus.bibliothek.uni-wuerzburg.de/volltexte/2007/2469/"><tt>http://opus.bibliothek.uni-wuerzburg.de/volltexte/2007/2469/</tt></a>.
<div class="p"><!----></div>
</dd>
 <dt><a href="#CITEVerlet1967PR" id="Verlet1967PR">[105]</a></dt><dd>
L.&nbsp;Verlet: <a href="http://dx.doi.org/10.1103/PhysRev.159.98">""Computer
  &#203;xperiments" on Classical Fluids. I. Thermodynamical Properties of
  Lennard-Jones Molecules</a>. <em>Phys. Rev.</em>, <b>159</b>, 98-103 (1967).</dd>
</dl>
<div class="p"><!----></div>
<div class="p"><!----></div>
  <a id="tth_chAp10"></a><h1>
Chapter 10 List of Tables</h1>
<div class="p"><!----></div>
<div class="p"><!----></div>
  <a id="tth_chAp11"></a><h1>
Chapter 11 List of Figures</h1>
<div class="p"><!----></div>
</div>