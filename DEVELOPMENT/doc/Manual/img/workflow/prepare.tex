\documentclass[10pt]{article}

\usepackage{tikz,graphicx,siunitx,pgfplots,amsmath}
\usepackage{mystuff}
\usepackage[version=3]{mhchem}
\usepackage[active,tightpage]{preview}
\PreviewEnvironment{tikzpicture}
\setlength\PreviewBorder{1pt}
\setlength{\textwidth}{246pt}
\pgfplotsset{every tick label/.append style={/pgf/number format/1000 sep={}}}
\pgfplotsset{compat=1.3}
\usetikzlibrary{plotmarks,fit,positioning}
\DeclareSIUnit\year{y}
\usetikzlibrary{calc}
\usetikzlibrary{decorations}

\usepackage{sfmath}


\newcommand*\phantomas[3][c]{% 
   \ifmmode 
     \makebox[\widthof{$#2$}][#1]{$#3$}% 
   \else 
     \makebox[\widthof{#2}][#1]{#3}% 
   \fi 
} 

\begin{document}
  \begin{tikzpicture}[font=\sffamily, >=stealth, scale=1]


%       \draw[RL, fill=RL!30] (-1.5,1) -- (1.5,1) -- (1.5,-3.5) -- (4.5,-3.5) -- (4.5,-6) -- (-1.5,-6) -- (-1.5,1);
%       \draw[RL, fill=RL!30, rounded corners] (1.5,1) rectangle (-1.5,-6);
%       \node[anchor=north, minimum width=3cm, draw=RL, fill=RL!60, rounded corners] at (0,1) {\textsc{Columbus}};
%       \begin{scope}[local bounding box=colbox]
%         \node[rectangle, rounded corners, draw=RL, fill=RL!0, anchor=center] (rasscf) at (0.2,-0) {\textbf{MCSCF}};
%         \node[rectangle, rounded corners, draw=RL, fill=RL!0, anchor=center] (rassi) at (0.2,-1) {\textbf{MRCI}};
%         \node[rectangle, rounded corners, draw=RL, fill=RL!0, anchor=center] (reindex) at (0.2,-3) {\textbf{SO-MRCI}};
%         \node[rectangle, rounded corners, draw=RL, fill=RL!0, anchor=center] (cioverlap) at (0.2,-5) {\textbf{cioverlap}};
%         \node[rectangle, rounded corners, draw=RL, fill=RL!0, anchor=center] (mclr) at (0.2,-4) {\textbf{mclr}};
%       \end{scope}

  \draw[B, fill=B!30, rounded corners] (1.0,1) rectangle (6,-9);
  \node[anchor=north, minimum width=5cm, draw=B, fill=B!60, rounded corners] at (3.5,1) {\textsc{Sharc} Workflow};
  \node[rectangle, rounded corners, draw=B, fill=B!0, anchor=center] (a1) at (3.5,0) {\textbf{Optimization}};
  \node[rectangle, rounded corners, draw=B, fill=B!0, anchor=center] (a2) at (3.5,-1) {\textbf{Frequencies}};
  \node[rectangle, rounded corners, draw=B, fill=B!0, anchor=center] (a3) at (3.5,-2) {\textbf{Wigner Sampling}};
  \node[rectangle, rounded corners, draw=B, fill=B!0, anchor=center] (as1) at (3.5,-3.45) {Setup};
  \node[rectangle, rounded corners, draw=B, fill=B!0, anchor=center] (a4) at (3.5,-4) {\textbf{Excited-State Calcs.}};
  \node[rectangle, rounded corners, draw=B, fill=B!0, anchor=center] (a5) at (3.5,-5) {\textbf{Excited-State Selection}};
  \node[rectangle, rounded corners, draw=B, fill=B!0, anchor=center] (as2) at (3.5,-6.4) {Setup};
  \node[rectangle, rounded corners, draw=B, fill=B!100, anchor=center] (a6) at (3.5,-7) {\textbf{Dynamics}};
  \node[rectangle, rounded corners, draw=B, fill=B!0, anchor=center] (a7) at (3.5,-8) {\textbf{Analysis}};

  \draw[->, very thick] (a1) --node[right] {\small $\mathbf{R}_{\text{eq}}$} (a2);
  \draw[->, very thick] (a2) --node[right] {\small $\mathbf{R}_{\text{eq}}$, $\{\nu_i\}$, $\{\mathbf{n}_i\}$} (a3);
  \draw[->, very thick] (a3) --node[right] {\small $\{(\mathbf{R},\mathbf{v})_k\}$} (as1);
  \draw[->, very thick] (a4) --node[right] {\small $\{\Delta E_{k,\beta}\}$,$\{F^{\text{osc}}_{k,\beta}\}$} (a5);
  \draw[->, very thick] (a5) --node[right] {\small $\{(\mathbf{R},\mathbf{v},\alpha)_k\}$} (as2);


  \node[rectangle, rounded corners, draw=black!50, fill=black!20, anchor=center] (b1) at (8.0,-0) {Quantum Chemistry};
  \node[rectangle, rounded corners, draw=black!50, fill=black!20, anchor=center] (b2) at (8.0,-1) {Quantum Chemistry};
  \node[rectangle, rounded corners, draw=black!50, fill=B!0,      anchor=center] (b3) at (8.0,-2) {\tt wigner.py};
  \node[rectangle, rounded corners, draw=black!50, fill=B!0,      anchor=center] (b4) at (8.0,-3.4) {\tt setup\_init.py};
  \node[rectangle, rounded corners, draw=black!50, fill=black!20, anchor=center] (b5) at (8.0,-4) {Quantum Chemistry};
  \node[rectangle, rounded corners, draw=black!50, fill=B!0,      anchor=center] (b6) at (8.0,-5) {\tt excite.py};
  \node[rectangle, rounded corners, draw=black!50, fill=B!0,      anchor=center] (b7) at (8.0,-6.4) {\tt setup\_traj.py};
  \node[rectangle, rounded corners, draw=black!50, fill=B!0,      anchor=center] (b8) at (8.0,-7) {\tt sharc.x};
  \node[rectangle, rounded corners, draw=black!50, fill=B!0,      anchor=center] (b9) at (8.0,-8) {many tools...};

  \draw[->, very thick] (b1) --node[right] {\small } (b2);
  \draw[->, very thick] (b2) --node[right] {\small\tt freq.molden} (b3);
  \draw[->, very thick] (b3) --node[right] {\small\tt initconds } (b4);
%   \draw[->, very thick] (b4) --node[right] {\small } (b5);
  \draw[->, very thick] (b5) --node[right] {\small\tt QM.out} (b6);
  \draw[->, very thick] (b6) --node[right] {\small\tt initconds.excited} (b7);
%   \draw[->, very thick] (b7) --node[right] {\small } (b8);
  \draw[->, very thick] (b8) --node[right] {\small\tt output.dat, output.xyz} (b9);







  \draw[decorate, decoration=brace, line width=2pt] (0.7,-1.4) --node[inner sep=3pt, rectangle, rounded corners,  anchor=east] {Preparation} (0.7,0.4);
  \draw[decorate, decoration=brace, line width=2pt] (0.7,-5.4) --node[inner sep=3pt, rectangle, rounded corners,  anchor=east] {Initial Conditions} (0.7,-1.6);
  \draw[decorate, decoration=brace, line width=2pt] (0.7,-7.4) --node[inner sep=3pt, rectangle, rounded corners,  anchor=east] {Dynamics Simulations} (0.7,-6.0);
  \draw[decorate, decoration=brace, line width=2pt] (0.7,-8.4) --node[inner sep=3pt, rectangle, rounded corners,  anchor=east] {Aftermath} (0.7,-7.6);





%     \draw[->, very thick] (seward) --node[right] {Integrals} (rasscf);
%     \draw[->, very thick] (rasscf) --node[right] {MOs, $\Psi$} (rassi);
%     \draw[very thick] (rasscf) -- ++(180:1.25) --node[below,sloped] {MOs, $\Psi$} ++(270:3);
%     \draw[very thick, <-] (mclr) -- ++(180:1.25);
% %       \draw[very thick, <-] (reindex) -- ++(180:1.25);
% %       \draw[very thick, <-] (cioverlap) -- ++(180:1.25);
%     \draw[->, very thick] (mclr) --node[right] {eff. $\rho$} (alaska);
% 
%     \node[rectangle, rounded corners, draw=black, fill=black!30, anchor=center] (energies) at (6,-1) {\textbf{Energies}};
%     \draw[->,  very thick] (rasscf) -- (energies);
%     \node[rectangle, rounded corners, draw=black, fill=black!30, anchor=center] (energies) at (6,-5) {\textbf{Gradients}};
%     \draw[->,  very thick] (alaska) -- (energies);
%     \node[rectangle, rounded corners, draw=black, fill=black!30, anchor=center] (energies) at (6,-2) {\textbf{SO-Coupling}};
%     \draw[->,  very thick] (rassi) -- (energies);
%     \node[rectangle, rounded corners, draw=black, fill=black!30, anchor=center] (energies) at (6,-3) {\textbf{Overlaps}};
%     \draw[->,  very thick] (rassi) -- (energies);
%     
% %       \draw[line width=5pt, B!30] ( $ (seward) !.1! (reindex) $ ) -- ( $ (seward) !.5! (reindex) $ );
%     \draw[->, very thick] (seward) .. controls +(180:1.2) and +(180:1.2) .. node[sloped, above, near start] {AMFI} (rassi);




  \end{tikzpicture}
\end{document}