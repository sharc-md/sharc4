\documentclass[10pt]{article}

\usepackage{tikz,graphicx,pgfplots,amsmath}
% \usepackage[lighttt]{lmodern}
\usepackage{libertine}
\usepackage[libertine]{newtxmath}
\usepackage[scaled=0.95]{inconsolata}
\usepackage{mycolors}
\usepackage{sfmath}
\usepackage[version=3]{mhchem}
\usepackage[active,tightpage]{preview}


\PreviewEnvironment{tikzpicture}
\setlength\PreviewBorder{1pt}
\setlength{\textwidth}{246pt}


\pgfplotsset{every tick label/.append style={/pgf/number format/1000 sep={}}}
% \pgfplotsset{compat=1.3}
\usetikzlibrary{plotmarks,fit,positioning,arrows}
\usetikzlibrary{calc,shapes}
\usetikzlibrary{trees}


\newcommand*\phantomas[3][c]{% 
   \ifmmode 
     \makebox[\widthof{$#2$}][#1]{$#3$}% 
   \else 
     \makebox[\widthof{#2}][#1]{#3}% 
   \fi 
} 


\begin{document}[font=\sffamily]
% \begin{figure}[h]
  % Define block styles
%   \tikzstyle{input} = [rectangle, draw, fill=gray!10, 
%       text width=7em, text centered, rounded corners, minimum height=4em]
  \tikzstyle{action} = [rectangle, draw, fill=black!20,
      text width=2.2cm, text centered, rounded corners, minimum height=0.3cm]
  \tikzstyle{result} = [draw,,fill=R!30,
      minimum height=0.3cm, text width=1.6cm, text centered]
  \tikzstyle{op} = [draw, fill=Y!20,diamond, inner sep=1pt]    
  \tikzstyle{nop} = [inner sep=0pt,outer sep=0pt,fill=black,circle]    
  \tikzstyle{line} = [draw, -stealth,ultra thick]   
  \tikzstyle{linen} = [draw,ultra thick]  

  \centering
  \begin{tikzpicture}[node distance = 9em, auto]

    % nodes
    \node[action] (collect) {Collectin\smash{g}};

    \node [op, below=0.3cm of collect] (1) {1};
    \node [action, below right=0.1cm and 0.5cm of 1] (smooth) {Smoothin\smash{g}};
    \node [nop, below=0.6cm of 1] (1n) {};

    \node [op, below=0.3cm of 1n] (2) {2};

    \node[action, below right=0.1cm and 2.0cm of 2] (synch) {Synchronizin\smash{g}};

    \node [op, below=0.3cm of synch] (3) {3};

    \node [op, below left=1.1cm and 1.5cm of 3] (4) {4};
    \node [action, below right=0.1cm and 0.5cm of 4] (average) {Avera\smash{ging}};
    \node [nop, below=0.6cm of 4] (4n) {};

    \node [op, below=0.3cm of 4n] (5) {5};
    \node [action, below right=0.1cm and 0.5cm of 5] (statistics) {Statistics};
    \node [nop, below=0.6cm of 5] (5n) {};

    \node[action, below right=0.1cm and 1.0cm of 3] (convX) {Convolutin\smash{g}(X)};

    \node [op, below=0.3cm of convX] (6) {6};
    \node [action, below right=0.1cm and 0.5cm of 6] (sumY) {Summin\smash{g}(Y)};
    \node [nop, below=0.6cm of 6] (6n) {};

    \node [op, below=0.3cm of 6n] (7) {7};
    \node [action, below right=0.1cm and 0.5cm of 7] (integrateX) {Inte\smash{g}ratin\smash{g}(X)};
    \node [nop, below=0.6cm of 7] (7n) {};

    \node [op, below=0.3cm of 7n] (8) {8};
    \node [op, below=0.3cm of 8] (9) {9};
    \node [nop, below=0.6cm of 9] (9n) {};
    \node [nop, below=0.3cm of 9n] (8n) {};

    \node [action, below right=0.1cm and 0.5cm of 8] (convT) {Convolutin\smash{g}(T)};
    \node [action, below left =0.1cm and 0.5cm of 9] (intT) {Inte\smash{grating}(T)};

    \node [op, below=0.3cm of 8n] (10) {10};
    \node [nop] (10l) at (5n|-10) {};
    \node [nop, left=2.5cm of 10l] (10ll) {};

    \node [action] (convert) at ($(10)!0.5!(10l)$) {Convertin\smash{g}};

    \node [result, fill=B!30, below=0.6cm of 10ll] (t1) {T\smash{yp}e1};
    \node [result, fill=T!30, below=0.6cm of 10l]  (t2) {T\smash{yp}e2};
    \node [result, fill=G!30, below=0.6cm of 10.center]   (t3) {T\smash{yp}e3};


    % edges
    \draw[B,line]  (collect) -- (1);

    \draw[B,line]  (1) -| (smooth);
    \draw[B,line]  (smooth) |- (1n);
    \draw[B,linen] (1) -- (1n);

    \draw[B,line]  (1n) -- (2);

    \draw[B,line]  (2) -| (synch);
    \draw[B,linen] (2) -| (10ll);

    \draw[T,line]  (synch) -- (3);

    \draw[T,line]  (3) -| (4);
    \draw[T,line]  (4) -| (average);
    \draw[T,line]  (average) |- (4n);
    \draw[T,linen] (4) -- (4n);

    \draw[T,line]  (4n) -- (5);
    \draw[T,line]  (5) -| (statistics);
    \draw[T,line]  (statistics) |- (5n);
    \draw[T,linen] (5) -- (5n);

    \draw[T,line]  (3) -| (convX);
    \draw[G,line]  (convX) -- (6);
    \draw[G,line]  (6) -| (sumY);
    \draw[G,line]  (sumY) |- (6n);
    \draw[G,linen] (6) -- (6n);

    \draw[G,line]  (6n) -- (7);
    \draw[G,line]  (7) -| (integrateX);
    \draw[G,line]  (integrateX) |- (7n);
    \draw[G,linen] (7) -- (7n);

    \draw[G,line]  (7n) -- (8);
    \draw[G,line]  (8) -- (9);
    \draw[G,line]  (8) -| (convT);
    \draw[G,line]  (9) -| (intT);
    \draw[G,linen] (9) -- (9n);
    \draw[G,linen] (9n) -- (8n);
    \draw[G,line]  (intT) |- (9n);
    \draw[G,line]  (convT) |- (8n);

    \draw[G,line]  (8n) -- (10);
    \draw[T,linen] (5n) -- (10l);
    \draw[G,line]  (10) -- (convert);
    \draw[T,line]  (convert) -- (10l);
%     \draw[G,T,line]  (10) --node[action,anchor=center,semithick,draw=black,text=black] {Convert} (10l);

    \draw[B,line]  (10ll) -- (t1);
    \draw[T,line]  (10l) -- (t2);
    \draw[G,line]  (10) -- (t3);


%       % Place nodes for Overlap Flowchart
%       \node [cloud] (SIJ) {$\left<\Psi_I\mid\Psi_J'\right>$};
%       \node [op, above of=SIJ, node distance=4em] (cont) {Contract};
%           \node [action, left of=cont] (bovl) {Unique factors
% 
%           $\mathcal{S}_{kl}, \bar{\mathcal{S}}_{kl}$};
%           \node [op, above of=bovl, node distance=4em] (prec) {Precompute};
%           \node [op, above of=prec, node distance=3em] (sort) {Sort};
%           \node [input, above of=sort, node distance=4em] (det) {Slater \\Determinants
% 
%           $\left|\Phi_k\right>, \left|\Phi_l'\right>$};    
%       \node [input, right of=det] (cic) {CI coefficients
% 
%       $d_{kI},d_{lJ}'$};
%           \node [action, left of=prec, node distance=13.5em] (Smo) {MO overlaps
% 
%           $\left<\varphi_p|\varphi_q'\right>$};
%           \node [input, left of=det] (C) {MO coefficients
% 
%           $C_{p\mu}, C_{q\nu}'$};
%           \node [input, left of=C] (Sao) {\textit{Double molecule}
% 
%           AO overlaps
% 
%           $\left<\chi_{\mu}|\chi_{\nu}'\right>$};
%       % Edges
%       \path [line] (cont) -- (SIJ);
%       \path [line] (cic) -- (cont);
%       \path [line] (bovl) -- (cont);
%       \path [line] (det) -- (sort);
%       \path [line] (sort) -- (prec);
%       \path [line] (prec) -- (bovl);
%       \path [line] (Smo) -- (prec);
%       \path [line] (C) -| (Smo);
%       \path [line] (Sao) -| (Smo);
  \end{tikzpicture}
%   \caption{Workflow of the wavefunction overlap program.}
%   \label{fig:work}
% \end{figure}
\end{document}